Ext.apply(Ext.form.VTypes,{daterange:function(e,t){var i=t.parseDate(e);if(!i){return false}if(t.startDateField){var r=Ext.getCmp(t.startDateField);if(!r.maxValue||i.getTime()!=r.maxValue.getTime()){r.setMaxValue(i);r.validate()}}else if(t.endDateField){var a=Ext.getCmp(t.endDateField);if(!a.minValue||i.getTime()!=a.minValue.getTime()){a.setMinValue(i);a.validate()}}return true}});var OpenLayers={VERSION_NUMBER:"Release 2.13 dev",singleFile:true,_getScriptLocation:function(){var e=new RegExp("(^|(.*?\\/))(OpenLayers[^\\/]*?\\.js)(\\?|$)"),t=document.getElementsByTagName("script"),i,r,a="";for(var s=0,n=t.length;s<n;s++){i=t[s].getAttribute("src");if(i){r=i.match(e);if(r){a=r[1];break}}}return function(){return a}}(),ImgPath:""};OpenLayers.Class=function(){var e=arguments.length;var t=arguments[0];var i=arguments[e-1];var r=typeof i.initialize=="function"?i.initialize:function(){t.prototype.initialize.apply(this,arguments)};if(e>1){var a=[r,t].concat(Array.prototype.slice.call(arguments).slice(1,e-1),i);OpenLayers.inherit.apply(null,a)}else{r.prototype=i}return r};OpenLayers.inherit=function(e,t){var i=function(){};i.prototype=t.prototype;e.prototype=new i;var r,a,s;for(r=2,a=arguments.length;r<a;r++){s=arguments[r];if(typeof s==="function"){s=s.prototype}OpenLayers.Util.extend(e.prototype,s)}};OpenLayers.Util=OpenLayers.Util||{};OpenLayers.Util.extend=function(e,t){e=e||{};if(t){for(var i in t){var r=t[i];if(r!==undefined){e[i]=r}}var a=typeof window.Event=="function"&&t instanceof window.Event;if(!a&&t.hasOwnProperty&&t.hasOwnProperty("toString")){e.toString=t.toString}}return e};OpenLayers.String={startsWith:function(e,t){return e.indexOf(t)==0},contains:function(e,t){return e.indexOf(t)!=-1},trim:function(e){return e.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},camelize:function(e){var t=e.split("-");var i=t[0];for(var r=1,a=t.length;r<a;r++){var s=t[r];i+=s.charAt(0).toUpperCase()+s.substring(1)}return i},format:function(e,s,n){if(!s){s=window}var t=function(e,t){var i;var r=t.split(/\.+/);for(var a=0;a<r.length;a++){if(a==0){i=s}if(i===undefined){break}i=i[r[a]]}if(typeof i=="function"){i=n?i.apply(null,n):i()}if(typeof i=="undefined"){return"undefined"}else{return i}};return e.replace(OpenLayers.String.tokenRegEx,t)},tokenRegEx:/\$\{([\w.]+?)\}/g,numberRegEx:/^([+-]?)(?=\d|\.\d)\d*(\.\d*)?([Ee]([+-]?\d+))?$/,isNumeric:function(e){return OpenLayers.String.numberRegEx.test(e)},numericIf:function(e,t){var i=e;if(t===true&&e!=null&&e.replace){e=e.replace(/^\s*|\s*$/g,"")}return OpenLayers.String.isNumeric(e)?parseFloat(e):i}};OpenLayers.Number={decimalSeparator:".",thousandsSeparator:",",limitSigDigs:function(e,t){var i=0;if(t>0){i=parseFloat(e.toPrecision(t))}return i},format:function(e,t,i,r){t=typeof t!="undefined"?t:0;i=typeof i!="undefined"?i:OpenLayers.Number.thousandsSeparator;r=typeof r!="undefined"?r:OpenLayers.Number.decimalSeparator;if(t!=null){e=parseFloat(e.toFixed(t))}var a=e.toString().split(".");if(a.length==1&&t==null){t=0}var s=a[0];if(i){var n=/(-?[0-9]+)([0-9]{3})/;while(n.test(s)){s=s.replace(n,"$1"+i+"$2")}}var o;if(t==0){o=s}else{var l=a.length>1?a[1]:"0";if(t!=null){l=l+new Array(t-l.length+1).join("0")}o=s+r+l}return o},zeroPad:function(e,t,i){var r=e.toString(i||10);while(r.length<t){r="0"+r}return r}};OpenLayers.Function={bind:function(t,i){var r=Array.prototype.slice.apply(arguments,[2]);return function(){var e=r.concat(Array.prototype.slice.apply(arguments,[0]));return t.apply(i,e)}},bindAsEventListener:function(t,i){return function(e){return t.call(i,e||window.event)}},False:function(){return false},True:function(){return true},Void:function(){}};OpenLayers.Array={filter:function(e,t,i){var r=[];if(Array.prototype.filter){r=e.filter(t,i)}else{var a=e.length;if(typeof t!="function"){throw new TypeError}for(var s=0;s<a;s++){if(s in e){var n=e[s];if(t.call(i,n,s,e)){r.push(n)}}}}return r}};OpenLayers.Bounds=OpenLayers.Class({left:null,bottom:null,right:null,top:null,centerLonLat:null,initialize:function(e,t,i,r){if(OpenLayers.Util.isArray(e)){r=e[3];i=e[2];t=e[1];e=e[0]}if(e!=null){this.left=OpenLayers.Util.toFloat(e)}if(t!=null){this.bottom=OpenLayers.Util.toFloat(t)}if(i!=null){this.right=OpenLayers.Util.toFloat(i)}if(r!=null){this.top=OpenLayers.Util.toFloat(r)}},clone:function(){return new OpenLayers.Bounds(this.left,this.bottom,this.right,this.top)},equals:function(e){var t=false;if(e!=null){t=this.left==e.left&&this.right==e.right&&this.top==e.top&&this.bottom==e.bottom}return t},toString:function(){return[this.left,this.bottom,this.right,this.top].join(",")},toArray:function(e){if(e===true){return[this.bottom,this.left,this.top,this.right]}else{return[this.left,this.bottom,this.right,this.top]}},toBBOX:function(e,t){if(e==null){e=6}var i=Math.pow(10,e);var r=Math.round(this.left*i)/i;var a=Math.round(this.bottom*i)/i;var s=Math.round(this.right*i)/i;var n=Math.round(this.top*i)/i;if(t===true){return a+","+r+","+n+","+s}else{return r+","+a+","+s+","+n}},toGeometry:function(){return new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing([new OpenLayers.Geometry.Point(this.left,this.bottom),new OpenLayers.Geometry.Point(this.right,this.bottom),new OpenLayers.Geometry.Point(this.right,this.top),new OpenLayers.Geometry.Point(this.left,this.top)])])},getWidth:function(){return this.right-this.left},getHeight:function(){return this.top-this.bottom},getSize:function(){return new OpenLayers.Size(this.getWidth(),this.getHeight())},getCenterPixel:function(){return new OpenLayers.Pixel((this.left+this.right)/2,(this.bottom+this.top)/2)},getCenterLonLat:function(){if(!this.centerLonLat){this.centerLonLat=new OpenLayers.LonLat((this.left+this.right)/2,(this.bottom+this.top)/2)}return this.centerLonLat},scale:function(e,t){if(t==null){t=this.getCenterLonLat()}var i,r;if(t.CLASS_NAME=="OpenLayers.LonLat"){i=t.lon;r=t.lat}else{i=t.x;r=t.y}var a=(this.left-i)*e+i;var s=(this.bottom-r)*e+r;var n=(this.right-i)*e+i;var o=(this.top-r)*e+r;return new OpenLayers.Bounds(a,s,n,o)},add:function(e,t){if(e==null||t==null){throw new TypeError("Bounds.add cannot receive null values")}return new OpenLayers.Bounds(this.left+e,this.bottom+t,this.right+e,this.top+t)},extend:function(e){if(e){switch(e.CLASS_NAME){case"OpenLayers.LonLat":this.extendXY(e.lon,e.lat);break;case"OpenLayers.Geometry.Point":this.extendXY(e.x,e.y);break;case"OpenLayers.Bounds":this.centerLonLat=null;if(this.left==null||e.left<this.left){this.left=e.left}if(this.bottom==null||e.bottom<this.bottom){this.bottom=e.bottom}if(this.right==null||e.right>this.right){this.right=e.right}if(this.top==null||e.top>this.top){this.top=e.top}break}}},extendXY:function(e,t){this.centerLonLat=null;if(this.left==null||e<this.left){this.left=e}if(this.bottom==null||t<this.bottom){this.bottom=t}if(this.right==null||e>this.right){this.right=e}if(this.top==null||t>this.top){this.top=t}},containsLonLat:function(e,t){if(typeof t==="boolean"){t={inclusive:t}}t=t||{};var i=this.contains(e.lon,e.lat,t.inclusive),r=t.worldBounds;if(r&&!i){var a=r.getWidth();var s=(r.left+r.right)/2;var n=Math.round((e.lon-s)/a);i=this.containsLonLat({lon:e.lon-n*a,lat:e.lat},{inclusive:t.inclusive})}return i},containsPixel:function(e,t){return this.contains(e.x,e.y,t)},contains:function(e,t,i){if(i==null){i=true}if(e==null||t==null){return false}e=OpenLayers.Util.toFloat(e);t=OpenLayers.Util.toFloat(t);var r=false;if(i){r=e>=this.left&&e<=this.right&&t>=this.bottom&&t<=this.top}else{r=e>this.left&&e<this.right&&t>this.bottom&&t<this.top}return r},intersectsBounds:function(e,t){if(typeof t==="boolean"){t={inclusive:t}}t=t||{};if(t.worldBounds){var i=this.wrapDateLine(t.worldBounds);e=e.wrapDateLine(t.worldBounds)}else{i=this}if(t.inclusive==null){t.inclusive=true}var r=false;var a=i.left==e.right||i.right==e.left||i.top==e.bottom||i.bottom==e.top;if(t.inclusive||!a){var s=e.bottom>=i.bottom&&e.bottom<=i.top||i.bottom>=e.bottom&&i.bottom<=e.top;var p=e.top>=i.bottom&&e.top<=i.top||i.top>e.bottom&&i.top<e.top;var u=e.left>=i.left&&e.left<=i.right||i.left>=e.left&&i.left<=e.right;var c=e.right>=i.left&&e.right<=i.right||i.right>=e.left&&i.right<=e.right;r=(s||p)&&(u||c)}if(t.worldBounds&&!r){var n=t.worldBounds;var o=n.getWidth();var l=!n.containsBounds(i);var h=!n.containsBounds(e);if(l&&!h){e=e.add(-o,0);r=i.intersectsBounds(e,{inclusive:t.inclusive})}else if(h&&!l){i=i.add(-o,0);r=e.intersectsBounds(i,{inclusive:t.inclusive})}}return r},containsBounds:function(e,t,i){if(t==null){t=false}if(i==null){i=true}var r=this.contains(e.left,e.bottom,i);var a=this.contains(e.right,e.bottom,i);var s=this.contains(e.left,e.top,i);var n=this.contains(e.right,e.top,i);return t?r||a||s||n:r&&a&&s&&n},determineQuadrant:function(e){var t="";var i=this.getCenterLonLat();t+=e.lat<i.lat?"b":"t";t+=e.lon<i.lon?"l":"r";return t},transform:function(e,t){this.centerLonLat=null;var i=OpenLayers.Projection.transform({x:this.left,y:this.bottom},e,t);var r=OpenLayers.Projection.transform({x:this.right,y:this.bottom},e,t);var a=OpenLayers.Projection.transform({x:this.left,y:this.top},e,t);var s=OpenLayers.Projection.transform({x:this.right,y:this.top},e,t);this.left=Math.min(i.x,a.x);this.bottom=Math.min(i.y,r.y);this.right=Math.max(r.x,s.x);this.top=Math.max(a.y,s.y);return this},wrapDateLine:function(e,t){t=t||{};var i=t.leftTolerance||0;var r=t.rightTolerance||0;var a=this.clone();if(e){var s=e.getWidth();while(a.left<e.left&&a.right-r<=e.left){a=a.add(s,0)}while(a.left+i>=e.right&&a.right>e.right){a=a.add(-s,0)}var n=a.left+i;if(n<e.right&&n>e.left&&a.right-r>e.right){a=a.add(-s,0)}}return a},CLASS_NAME:"OpenLayers.Bounds"});OpenLayers.Bounds.fromString=function(e,t){var i=e.split(",");return OpenLayers.Bounds.fromArray(i,t)};OpenLayers.Bounds.fromArray=function(e,t){return t===true?new OpenLayers.Bounds(e[1],e[0],e[3],e[2]):new OpenLayers.Bounds(e[0],e[1],e[2],e[3])};OpenLayers.Bounds.fromSize=function(e){return new OpenLayers.Bounds(0,e.h,e.w,0)};OpenLayers.Bounds.oppositeQuadrant=function(e){var t="";t+=e.charAt(0)=="t"?"b":"t";t+=e.charAt(1)=="l"?"r":"l";return t};OpenLayers.Element={visible:function(e){return OpenLayers.Util.getElement(e).style.display!="none"},toggle:function(){for(var e=0,t=arguments.length;e<t;e++){var i=OpenLayers.Util.getElement(arguments[e]);var r=OpenLayers.Element.visible(i)?"none":"";i.style.display=r}},remove:function(e){e=OpenLayers.Util.getElement(e);e.parentNode.removeChild(e)},getHeight:function(e){e=OpenLayers.Util.getElement(e);return e.offsetHeight},hasClass:function(e,t){var i=e.className;return!!i&&new RegExp("(^|\\s)"+t+"(\\s|$)").test(i)},addClass:function(e,t){if(!OpenLayers.Element.hasClass(e,t)){e.className+=(e.className?" ":"")+t}return e},removeClass:function(e,t){var i=e.className;if(i){e.className=OpenLayers.String.trim(i.replace(new RegExp("(^|\\s+)"+t+"(\\s+|$)")," "))}return e},toggleClass:function(e,t){if(OpenLayers.Element.hasClass(e,t)){OpenLayers.Element.removeClass(e,t)}else{OpenLayers.Element.addClass(e,t)}return e},getStyle:function(e,t){e=OpenLayers.Util.getElement(e);var i=null;if(e&&e.style){i=e.style[OpenLayers.String.camelize(t)];if(!i){if(document.defaultView&&document.defaultView.getComputedStyle){var r=document.defaultView.getComputedStyle(e,null);i=r?r.getPropertyValue(t):null}else if(e.currentStyle){i=e.currentStyle[OpenLayers.String.camelize(t)]}}var a=["left","top","right","bottom"];if(window.opera&&OpenLayers.Util.indexOf(a,t)!=-1&&OpenLayers.Element.getStyle(e,"position")=="static"){i="auto"}}return i=="auto"?null:i}};OpenLayers.LonLat=OpenLayers.Class({lon:0,lat:0,initialize:function(e,t){if(OpenLayers.Util.isArray(e)){t=e[1];e=e[0]}this.lon=OpenLayers.Util.toFloat(e);this.lat=OpenLayers.Util.toFloat(t)},toString:function(){return"lon="+this.lon+",lat="+this.lat},toShortString:function(){return this.lon+", "+this.lat},clone:function(){return new OpenLayers.LonLat(this.lon,this.lat)},add:function(e,t){if(e==null||t==null){throw new TypeError("LonLat.add cannot receive null values")}return new OpenLayers.LonLat(this.lon+OpenLayers.Util.toFloat(e),this.lat+OpenLayers.Util.toFloat(t))},equals:function(e){var t=false;if(e!=null){t=this.lon==e.lon&&this.lat==e.lat||isNaN(this.lon)&&isNaN(this.lat)&&isNaN(e.lon)&&isNaN(e.lat)}return t},transform:function(e,t){var i=OpenLayers.Projection.transform({x:this.lon,y:this.lat},e,t);this.lon=i.x;this.lat=i.y;return this},wrapDateLine:function(e){var t=this.clone();if(e){while(t.lon<e.left){t.lon+=e.getWidth()}while(t.lon>e.right){t.lon-=e.getWidth()}}return t},CLASS_NAME:"OpenLayers.LonLat"});OpenLayers.LonLat.fromString=function(e){var t=e.split(",");return new OpenLayers.LonLat(t[0],t[1])};OpenLayers.LonLat.fromArray=function(e){var t=OpenLayers.Util.isArray(e),i=t&&e[0],r=t&&e[1];return new OpenLayers.LonLat(i,r)};OpenLayers.Pixel=OpenLayers.Class({x:0,y:0,initialize:function(e,t){this.x=parseFloat(e);this.y=parseFloat(t)},toString:function(){return"x="+this.x+",y="+this.y},clone:function(){return new OpenLayers.Pixel(this.x,this.y)},equals:function(e){var t=false;if(e!=null){t=this.x==e.x&&this.y==e.y||isNaN(this.x)&&isNaN(this.y)&&isNaN(e.x)&&isNaN(e.y)}return t},distanceTo:function(e){return Math.sqrt(Math.pow(this.x-e.x,2)+Math.pow(this.y-e.y,2))},add:function(e,t){if(e==null||t==null){throw new TypeError("Pixel.add cannot receive null values")}return new OpenLayers.Pixel(this.x+e,this.y+t)},offset:function(e){var t=this.clone();if(e){t=this.add(e.x,e.y)}return t},CLASS_NAME:"OpenLayers.Pixel"});OpenLayers.Size=OpenLayers.Class({w:0,h:0,initialize:function(e,t){this.w=parseFloat(e);this.h=parseFloat(t)},toString:function(){return"w="+this.w+",h="+this.h},clone:function(){return new OpenLayers.Size(this.w,this.h)},equals:function(e){var t=false;if(e!=null){t=this.w==e.w&&this.h==e.h||isNaN(this.w)&&isNaN(this.h)&&isNaN(e.w)&&isNaN(e.h)}return t},CLASS_NAME:"OpenLayers.Size"});OpenLayers.Console={log:function(){},debug:function(){},info:function(){},warn:function(){},error:function(){},userError:function(e){alert(e)},assert:function(){},dir:function(){},dirxml:function(){},trace:function(){},group:function(){},groupEnd:function(){},time:function(){},timeEnd:function(){},profile:function(){},profileEnd:function(){},count:function(){},CLASS_NAME:"OpenLayers.Console"};(function(){var e=document.getElementsByTagName("script");for(var t=0,i=e.length;t<i;++t){if(e[t].src.indexOf("firebug.js")!=-1){if(console){OpenLayers.Util.extend(OpenLayers.Console,console);break}}}})();OpenLayers.Lang={code:null,defaultCode:"en",getCode:function(){if(!OpenLayers.Lang.code){OpenLayers.Lang.setCode()}return OpenLayers.Lang.code},setCode:function(e){var t;if(!e){e=OpenLayers.BROWSER_NAME=="msie"?navigator.userLanguage:navigator.language}var i=e.split("-");i[0]=i[0].toLowerCase();if(typeof OpenLayers.Lang[i[0]]=="object"){t=i[0]}if(i[1]){var r=i[0]+"-"+i[1].toUpperCase();if(typeof OpenLayers.Lang[r]=="object"){t=r}}if(!t){OpenLayers.Console.warn("Failed to find OpenLayers.Lang."+i.join("-")+" dictionary, falling back to default language");t=OpenLayers.Lang.defaultCode}OpenLayers.Lang.code=t},translate:function(e,t){var i=OpenLayers.Lang[OpenLayers.Lang.getCode()];var r=i&&i[e];if(!r){r=e}if(t){r=OpenLayers.String.format(r,t)}return r}};OpenLayers.i18n=OpenLayers.Lang.translate;OpenLayers.Util=OpenLayers.Util||{};OpenLayers.Util.getElement=function(){var e=[];for(var t=0,i=arguments.length;t<i;t++){var r=arguments[t];if(typeof r=="string"){r=document.getElementById(r)}if(arguments.length==1){return r}e.push(r)}return e};OpenLayers.Util.isElement=function(e){return!!(e&&e.nodeType===1)};OpenLayers.Util.isArray=function(e){return Object.prototype.toString.call(e)==="[object Array]"};OpenLayers.Util.removeItem=function(e,t){for(var i=e.length-1;i>=0;i--){if(e[i]==t){e.splice(i,1)}}return e};OpenLayers.Util.indexOf=function(e,t){if(typeof e.indexOf=="function"){return e.indexOf(t)}else{for(var i=0,r=e.length;i<r;i++){if(e[i]==t){return i}}return-1}};OpenLayers.Util.dotless=/\./g;OpenLayers.Util.modifyDOMElement=function(e,t,i,r,a,s,n,o){if(t){e.id=t.replace(OpenLayers.Util.dotless,"_")}if(i){e.style.left=i.x+"px";e.style.top=i.y+"px"}if(r){e.style.width=r.w+"px";e.style.height=r.h+"px"}if(a){e.style.position=a}if(s){e.style.border=s}if(n){e.style.overflow=n}if(parseFloat(o)>=0&&parseFloat(o)<1){e.style.filter="alpha(opacity="+o*100+")";e.style.opacity=o}else if(parseFloat(o)==1){e.style.filter="";e.style.opacity=""}};OpenLayers.Util.createDiv=function(e,t,i,r,a,s,n,o){var l=document.createElement("div");if(r){l.style.backgroundImage="url("+r+")"}if(!e){e=OpenLayers.Util.createUniqueID("OpenLayersDiv")}if(!a){a="absolute"}OpenLayers.Util.modifyDOMElement(l,e,t,i,a,s,n,o);return l};OpenLayers.Util.createImage=function(e,t,i,r,a,s,n,o){var l=document.createElement("img");if(!e){e=OpenLayers.Util.createUniqueID("OpenLayersDiv")}if(!a){a="relative"}OpenLayers.Util.modifyDOMElement(l,e,t,i,a,s,null,n);if(o){l.style.display="none";function h(){l.style.display="";OpenLayers.Event.stopObservingElement(l)}OpenLayers.Event.observe(l,"load",h);OpenLayers.Event.observe(l,"error",h)}l.style.alt=e;l.galleryImg="no";if(r){l.src=r}return l};OpenLayers.IMAGE_RELOAD_ATTEMPTS=0;OpenLayers.Util.alphaHackNeeded=null;OpenLayers.Util.alphaHack=function(){if(OpenLayers.Util.alphaHackNeeded==null){var e=navigator.appVersion.split("MSIE");var t=parseFloat(e[1]);var i=false;try{i=!!document.body.filters}catch(e){}OpenLayers.Util.alphaHackNeeded=i&&t>=5.5&&t<7}return OpenLayers.Util.alphaHackNeeded};OpenLayers.Util.modifyAlphaImageDiv=function(e,t,i,r,a,s,n,o,l){OpenLayers.Util.modifyDOMElement(e,t,i,r,s,null,null,l);var h=e.childNodes[0];if(a){h.src=a}OpenLayers.Util.modifyDOMElement(h,e.id+"_innerImage",null,r,"relative",n);if(OpenLayers.Util.alphaHack()){if(e.style.display!="none"){e.style.display="inline-block"}if(o==null){o="scale"}e.style.filter="progid:DXImageTransform.Microsoft"+".AlphaImageLoader(src='"+h.src+"', "+"sizingMethod='"+o+"')";if(parseFloat(e.style.opacity)>=0&&parseFloat(e.style.opacity)<1){e.style.filter+=" alpha(opacity="+e.style.opacity*100+")"}h.style.filter="alpha(opacity=0)"}};OpenLayers.Util.createAlphaImageDiv=function(e,t,i,r,a,s,n,o,p){var l=OpenLayers.Util.createDiv();var h=OpenLayers.Util.createImage(null,null,null,null,null,null,null,p);h.className="olAlphaImg";l.appendChild(h);OpenLayers.Util.modifyAlphaImageDiv(l,e,t,i,r,a,s,n,o);return l};OpenLayers.Util.upperCaseObject=function(e){var t={};for(var i in e){t[i.toUpperCase()]=e[i]}return t};OpenLayers.Util.applyDefaults=function(e,t){e=e||{};var i=typeof window.Event=="function"&&t instanceof window.Event;for(var r in t){if(e[r]===undefined||!i&&t.hasOwnProperty&&t.hasOwnProperty(r)&&!e.hasOwnProperty(r)){e[r]=t[r]}}if(!i&&t&&t.hasOwnProperty&&t.hasOwnProperty("toString")&&!e.hasOwnProperty("toString")){e.toString=t.toString}return e};OpenLayers.Util.getParameterString=function(e){var t=[];for(var i in e){var r=e[i];if(r!=null&&typeof r!="function"){var a;if(typeof r=="object"&&r.constructor==Array){var s=[];var n;for(var o=0,l=r.length;o<l;o++){n=r[o];s.push(encodeURIComponent(n===null||n===undefined?"":n))}a=s.join(",")}else{a=encodeURIComponent(r)}t.push(encodeURIComponent(i)+"="+a)}}return t.join("&")};OpenLayers.Util.urlAppend=function(e,t){var i=e;if(t){var r=(e+" ").split(/[?&]/);i+=r.pop()===" "?t:r.length?"&"+t:"?"+t}return i};OpenLayers.Util.getImagesLocation=function(){return OpenLayers.ImgPath||OpenLayers._getScriptLocation()+"img/"};OpenLayers.Util.getImageLocation=function(e){return OpenLayers.Util.getImagesLocation()+e};OpenLayers.Util.Try=function(){var e=null;for(var t=0,i=arguments.length;t<i;t++){var r=arguments[t];try{e=r();break}catch(e){}}return e};OpenLayers.Util.getXmlNodeValue=function(e){var t=null;OpenLayers.Util.Try(function(){t=e.text;if(!t){t=e.textContent}if(!t){t=e.firstChild.nodeValue}},function(){t=e.textContent});return t};OpenLayers.Util.mouseLeft=function(e,t){var i=e.relatedTarget?e.relatedTarget:e.toElement;while(i!=t&&i!=null){i=i.parentNode}return i!=t};OpenLayers.Util.DEFAULT_PRECISION=14;OpenLayers.Util.toFloat=function(e,t){if(t==null){t=OpenLayers.Util.DEFAULT_PRECISION}if(typeof e!=="number"){e=parseFloat(e)}return t===0?e:parseFloat(e.toPrecision(t))};OpenLayers.Util.rad=function(e){return e*Math.PI/180};OpenLayers.Util.deg=function(e){return e*180/Math.PI};OpenLayers.Util.VincentyConstants={a:6378137,b:6356752.3142,f:1/298.257223563};OpenLayers.Util.distVincenty=function(p,u){var c=OpenLayers.Util.VincentyConstants;var d=c.a,e=c.b,t=c.f;var f=OpenLayers.Util.rad(u.lon-p.lon);var y=Math.atan((1-t)*Math.tan(OpenLayers.Util.rad(p.lat)));var g=Math.atan((1-t)*Math.tan(OpenLayers.Util.rad(u.lat)));var i=Math.sin(y),r=Math.cos(y);var a=Math.sin(g),s=Math.cos(g);var n=f,m=2*Math.PI;var v=20;while(Math.abs(n-m)>1e-12&&--v>0){var x=Math.sin(n),L=Math.cos(n);var o=Math.sqrt(s*x*(s*x)+(r*a-i*s*L)*(r*a-i*s*L));if(o==0){return 0}var b=i*a+r*s*L;var E=Math.atan2(o,b);var S=Math.asin(r*s*x/o);var O=Math.cos(S)*Math.cos(S);var l=b-2*i*a/O;var C=t/16*O*(4+t*(4-3*O));m=n;n=f+(1-C)*t*Math.sin(S)*(E+C*o*(l+C*b*(-1+2*l*l)))}if(v==0){return NaN}var h=O*(d*d-e*e)/(e*e);var w=1+h/16384*(4096+h*(-768+h*(320-175*h)));var T=h/1024*(256+h*(-128+h*(74-47*h)));var F=T*o*(l+T/4*(b*(-1+2*l*l)-T/6*l*(-3+4*o*o)*(-3+4*l*l)));var P=e*w*(E-F);var N=P.toFixed(3)/1e3;return N};OpenLayers.Util.destinationVincenty=function(p,u,c){var e=OpenLayers.Util;var d=e.VincentyConstants;var f=d.a,t=d.b,i=d.f;var y=p.lon;var g=p.lat;var m=c;var v=e.rad(u);var x=Math.sin(v);var L=Math.cos(v);var b=(1-i)*Math.tan(e.rad(g));var r=1/Math.sqrt(1+b*b),E=b*r;var S=Math.atan2(b,L);var a=r*x;var O=1-a*a;var s=O*(f*f-t*t)/(t*t);var C=1+s/16384*(4096+s*(-768+s*(320-175*s)));var w=s/1024*(256+s*(-128+s*(74-47*s)));var n=m/(t*C),T=2*Math.PI;while(Math.abs(n-T)>1e-12){var o=Math.cos(2*S+n);var l=Math.sin(n);var h=Math.cos(n);var F=w*l*(o+w/4*(h*(-1+2*o*o)-w/6*o*(-3+4*l*l)*(-3+4*o*o)));T=n;n=m/(t*C)+F}var P=E*l-r*h*L;var N=Math.atan2(E*h+r*l*L,(1-i)*Math.sqrt(a*a+P*P));var M=Math.atan2(l*x,r*h-E*l*L);var R=i/16*O*(4+i*(4-3*O));var A=M-(1-R)*i*a*(n+R*l*(o+R*h*(-1+2*o*o)));var _=Math.atan2(a,-P);return new OpenLayers.LonLat(y+e.deg(A),e.deg(N))};OpenLayers.Util.getParameters=function(e,t){t=t||{};e=e===null||e===undefined?window.location.href:e;var i="";if(OpenLayers.String.contains(e,"?")){var r=e.indexOf("?")+1;var p=OpenLayers.String.contains(e,"#")?e.indexOf("#"):e.length;i=e.substring(r,p)}var a={};var s=i.split(/[&;]/);for(var n=0,u=s.length;n<u;++n){var o=s[n].split("=");if(o[0]){var l=o[0];try{l=decodeURIComponent(l)}catch(e){l=unescape(l)}var h=(o[1]||"").replace(/\+/g," ");try{h=decodeURIComponent(h)}catch(e){h=unescape(h)}if(t.splitArgs!==false){h=h.split(",")}if(h.length==1){h=h[0]}a[l]=h}}return a};OpenLayers.Util.lastSeqID=0;OpenLayers.Util.createUniqueID=function(e){if(e==null){e="id_"}else{e=e.replace(OpenLayers.Util.dotless,"_")}OpenLayers.Util.lastSeqID+=1;return e+OpenLayers.Util.lastSeqID};OpenLayers.INCHES_PER_UNIT={inches:1,ft:12,mi:63360,m:39.37,km:39370,dd:4374754,yd:36};OpenLayers.INCHES_PER_UNIT["in"]=OpenLayers.INCHES_PER_UNIT.inches;OpenLayers.INCHES_PER_UNIT["degrees"]=OpenLayers.INCHES_PER_UNIT.dd;OpenLayers.INCHES_PER_UNIT["nmi"]=1852*OpenLayers.INCHES_PER_UNIT.m;OpenLayers.METERS_PER_INCH=.0254000508001016;OpenLayers.Util.extend(OpenLayers.INCHES_PER_UNIT,{Inch:OpenLayers.INCHES_PER_UNIT.inches,Meter:1/OpenLayers.METERS_PER_INCH,Foot:.3048006096012192/OpenLayers.METERS_PER_INCH,IFoot:.3048/OpenLayers.METERS_PER_INCH,ClarkeFoot:.3047972651151/OpenLayers.METERS_PER_INCH,SearsFoot:.30479947153867626/OpenLayers.METERS_PER_INCH,GoldCoastFoot:.3047997101815088/OpenLayers.METERS_PER_INCH,IInch:.0254/OpenLayers.METERS_PER_INCH,MicroInch:254e-7/OpenLayers.METERS_PER_INCH,Mil:2.54e-8/OpenLayers.METERS_PER_INCH,Centimeter:.01/OpenLayers.METERS_PER_INCH,Kilometer:1e3/OpenLayers.METERS_PER_INCH,Yard:.9144018288036576/OpenLayers.METERS_PER_INCH,SearsYard:.914398414616029/OpenLayers.METERS_PER_INCH,IndianYard:.9143985307444408/OpenLayers.METERS_PER_INCH,IndianYd37:.91439523/OpenLayers.METERS_PER_INCH,IndianYd62:.9143988/OpenLayers.METERS_PER_INCH,IndianYd75:.9143985/OpenLayers.METERS_PER_INCH,IndianFoot:.30479951/OpenLayers.METERS_PER_INCH,IndianFt37:.30479841/OpenLayers.METERS_PER_INCH,IndianFt62:.3047996/OpenLayers.METERS_PER_INCH,IndianFt75:.3047995/OpenLayers.METERS_PER_INCH,Mile:1609.3472186944373/OpenLayers.METERS_PER_INCH,IYard:.9144/OpenLayers.METERS_PER_INCH,IMile:1609.344/OpenLayers.METERS_PER_INCH,NautM:1852/OpenLayers.METERS_PER_INCH,"Lat-66":110943.31648893273/OpenLayers.METERS_PER_INCH,"Lat-83":110946.25736872235/OpenLayers.METERS_PER_INCH,Decimeter:.1/OpenLayers.METERS_PER_INCH,Millimeter:.001/OpenLayers.METERS_PER_INCH,Dekameter:10/OpenLayers.METERS_PER_INCH,Decameter:10/OpenLayers.METERS_PER_INCH,Hectometer:100/OpenLayers.METERS_PER_INCH,GermanMeter:1.0000135965/OpenLayers.METERS_PER_INCH,CaGrid:.999738/OpenLayers.METERS_PER_INCH,ClarkeChain:20.1166194976/OpenLayers.METERS_PER_INCH,GunterChain:20.11684023368047/OpenLayers.METERS_PER_INCH,BenoitChain:20.116782494375872/OpenLayers.METERS_PER_INCH,SearsChain:20.11676512155/OpenLayers.METERS_PER_INCH,ClarkeLink:.201166194976/OpenLayers.METERS_PER_INCH,GunterLink:.2011684023368047/OpenLayers.METERS_PER_INCH,BenoitLink:.20116782494375873/OpenLayers.METERS_PER_INCH,SearsLink:.2011676512155/OpenLayers.METERS_PER_INCH,Rod:5.02921005842012/OpenLayers.METERS_PER_INCH,IntnlChain:20.1168/OpenLayers.METERS_PER_INCH,IntnlLink:.201168/OpenLayers.METERS_PER_INCH,Perch:5.02921005842012/OpenLayers.METERS_PER_INCH,Pole:5.02921005842012/OpenLayers.METERS_PER_INCH,Furlong:201.1684023368046/OpenLayers.METERS_PER_INCH,Rood:3.778266898/OpenLayers.METERS_PER_INCH,CapeFoot:.3047972615/OpenLayers.METERS_PER_INCH,Brealey:375/OpenLayers.METERS_PER_INCH,ModAmFt:.304812252984506/OpenLayers.METERS_PER_INCH,Fathom:1.8288/OpenLayers.METERS_PER_INCH,"NautM-UK":1853.184/OpenLayers.METERS_PER_INCH,"50kilometers":5e4/OpenLayers.METERS_PER_INCH,"150kilometers":15e4/OpenLayers.METERS_PER_INCH});OpenLayers.Util.extend(OpenLayers.INCHES_PER_UNIT,{mm:OpenLayers.INCHES_PER_UNIT["Meter"]/1e3,cm:OpenLayers.INCHES_PER_UNIT["Meter"]/100,dm:OpenLayers.INCHES_PER_UNIT["Meter"]*100,km:OpenLayers.INCHES_PER_UNIT["Meter"]*1e3,kmi:OpenLayers.INCHES_PER_UNIT["nmi"],fath:OpenLayers.INCHES_PER_UNIT["Fathom"],ch:OpenLayers.INCHES_PER_UNIT["IntnlChain"],link:OpenLayers.INCHES_PER_UNIT["IntnlLink"],"us-in":OpenLayers.INCHES_PER_UNIT["inches"],"us-ft":OpenLayers.INCHES_PER_UNIT["Foot"],"us-yd":OpenLayers.INCHES_PER_UNIT["Yard"],"us-ch":OpenLayers.INCHES_PER_UNIT["GunterChain"],"us-mi":OpenLayers.INCHES_PER_UNIT["Mile"],"ind-yd":OpenLayers.INCHES_PER_UNIT["IndianYd37"],"ind-ft":OpenLayers.INCHES_PER_UNIT["IndianFt37"],"ind-ch":20.11669506/OpenLayers.METERS_PER_INCH});OpenLayers.DOTS_PER_INCH=72;OpenLayers.Util.normalizeScale=function(e){var t=e>1?1/e:e;return t};OpenLayers.Util.getResolutionFromScale=function(e,t){var i;if(e){if(t==null){t="degrees"}var r=OpenLayers.Util.normalizeScale(e);i=1/(r*OpenLayers.INCHES_PER_UNIT[t]*OpenLayers.DOTS_PER_INCH)}return i};OpenLayers.Util.getScaleFromResolution=function(e,t){if(t==null){t="degrees"}var i=e*OpenLayers.INCHES_PER_UNIT[t]*OpenLayers.DOTS_PER_INCH;return i};OpenLayers.Util.pagePosition=function(e){var t=[0,0];var i=OpenLayers.Util.getViewportElement();if(!e||e==window||e==i){return t}var r=OpenLayers.IS_GECKO&&document.getBoxObjectFor&&OpenLayers.Element.getStyle(e,"position")=="absolute"&&(e.style.top==""||e.style.left=="");var a=null;var s;if(e.getBoundingClientRect){s=e.getBoundingClientRect();var n=window.pageYOffset||i.scrollTop;var o=window.pageXOffset||i.scrollLeft;t[0]=s.left+o;t[1]=s.top+n}else if(document.getBoxObjectFor&&!r){s=document.getBoxObjectFor(e);var l=document.getBoxObjectFor(i);t[0]=s.screenX-l.screenX;t[1]=s.screenY-l.screenY}else{t[0]=e.offsetLeft;t[1]=e.offsetTop;a=e.offsetParent;if(a!=e){while(a){t[0]+=a.offsetLeft;t[1]+=a.offsetTop;a=a.offsetParent}}var h=OpenLayers.BROWSER_NAME;if(h=="opera"||h=="safari"&&OpenLayers.Element.getStyle(e,"position")=="absolute"){t[1]-=document.body.offsetTop}a=e.offsetParent;while(a&&a!=document.body){t[0]-=a.scrollLeft;if(h!="opera"||a.tagName!="TR"){t[1]-=a.scrollTop}a=a.offsetParent}}return t};OpenLayers.Util.getViewportElement=function(){var e=arguments.callee.viewportElement;if(e==undefined){e=OpenLayers.BROWSER_NAME=="msie"&&document.compatMode!="CSS1Compat"?document.body:document.documentElement;arguments.callee.viewportElement=e}return e};OpenLayers.Util.isEquivalentUrl=function(e,t,i){i=i||{};OpenLayers.Util.applyDefaults(i,{ignoreCase:true,ignorePort80:true,ignoreHash:true,splitArgs:false});var r=OpenLayers.Util.createUrlObject(e,i);var a=OpenLayers.Util.createUrlObject(t,i);for(var s in r){if(s!=="args"){if(r[s]!=a[s]){return false}}}for(var s in r.args){if(r.args[s]!=a.args[s]){return false}delete a.args[s]}for(var s in a.args){return false}return true};OpenLayers.Util.createUrlObject=function(e,t){t=t||{};if(!/^\w+:\/\//.test(e)){var i=window.location;var r=i.port?":"+i.port:"";var a=i.protocol+"//"+i.host.split(":").shift()+r;if(e.indexOf("/")===0){e=a+e}else{var s=i.pathname.split("/");s.pop();e=a+s.join("/")+"/"+e}}if(t.ignoreCase){if(e instanceof Array){e=e[0].toLowerCase()}else{e=e.toLowerCase()}}var n=document.createElement("a");n.href=e;var o={};o.host=n.host.split(":").shift();o.protocol=n.protocol;if(t.ignorePort80){o.port=n.port=="80"||n.port=="0"?"":n.port}else{o.port=n.port==""||n.port=="0"?"80":n.port}o.hash=t.ignoreHash||n.hash==="#"?"":n.hash;var l=n.search;if(!l){var h=e.indexOf("?");l=h!=-1?e.substr(h):""}o.args=OpenLayers.Util.getParameters(l,{splitArgs:t.splitArgs});o.pathname=n.pathname.charAt(0)=="/"?n.pathname:"/"+n.pathname;return o};OpenLayers.Util.removeTail=function(e){var t=null;var i=e.indexOf("?");var r=e.indexOf("#");if(i==-1){t=r!=-1?e.substr(0,r):e}else{t=r!=-1?e.substr(0,Math.min(i,r)):e.substr(0,i)}return t};OpenLayers.IS_GECKO=function(){var e=navigator.userAgent.toLowerCase();return e.indexOf("webkit")==-1&&e.indexOf("gecko")!=-1}();OpenLayers.CANVAS_SUPPORTED=function(){var e=document.createElement("canvas");return!!(e.getContext&&e.getContext("2d"))}();OpenLayers.BROWSER_NAME=function(){var e="";var t=navigator.userAgent.toLowerCase();if(t.indexOf("opera")!=-1){e="opera"}else if(t.indexOf("msie")!=-1){e="msie"}else if(t.indexOf("safari")!=-1){e="safari"}else if(t.indexOf("mozilla")!=-1){if(t.indexOf("firefox")!=-1){e="firefox"}else{e="mozilla"}}return e}();OpenLayers.Util.getBrowserName=function(){return OpenLayers.BROWSER_NAME};OpenLayers.Util.getRenderedDimensions=function(p,e,t){var i,r;var a=document.createElement("div");a.style.visibility="hidden";var s=t&&t.containerElement?t.containerElement:document.body;var u=false;var n=null;var o=s;while(o&&o.tagName.toLowerCase()!="body"){var c=OpenLayers.Element.getStyle(o,"position");if(c=="absolute"){u=true;break}else if(c&&c!="static"){break}o=o.parentNode}if(u&&(s.clientHeight===0||s.clientWidth===0)){n=document.createElement("div");n.style.visibility="hidden";n.style.position="absolute";n.style.overflow="visible";n.style.width=document.body.clientWidth+"px";n.style.height=document.body.clientHeight+"px";n.appendChild(a)}a.style.position="absolute";if(e){if(e.w){i=e.w;a.style.width=i+"px"}else if(e.h){r=e.h;a.style.height=r+"px"}}if(t&&t.displayClass){a.className=t.displayClass}var l=document.createElement("div");l.innerHTML=p;l.style.overflow="visible";if(l.childNodes){for(var h=0,d=l.childNodes.length;h<d;h++){if(!l.childNodes[h].style)continue;l.childNodes[h].style.overflow="visible"}}a.appendChild(l);if(n){s.appendChild(n)}else{s.appendChild(a)}if(!i){i=parseInt(l.scrollWidth);a.style.width=i+"px"}if(!r){r=parseInt(l.scrollHeight)}a.removeChild(l);if(n){n.removeChild(a);s.removeChild(n)}else{s.removeChild(a)}return new OpenLayers.Size(i,r)};OpenLayers.Util.getScrollbarWidth=function(){var e=OpenLayers.Util._scrollbarWidth;if(e==null){var t=null;var i=null;var r=0;var a=0;t=document.createElement("div");t.style.position="absolute";t.style.top="-1000px";t.style.left="-1000px";t.style.width="100px";t.style.height="50px";t.style.overflow="hidden";i=document.createElement("div");i.style.width="100%";i.style.height="200px";t.appendChild(i);document.body.appendChild(t);r=i.offsetWidth;t.style.overflow="scroll";a=i.offsetWidth;document.body.removeChild(document.body.lastChild);OpenLayers.Util._scrollbarWidth=r-a;e=OpenLayers.Util._scrollbarWidth}return e};OpenLayers.Util.getFormattedLonLat=function(e,t,i){if(!i){i="dms"}e=(e+540)%360-180;var r=Math.abs(e);var a=Math.floor(r);var s=(r-a)/(1/60);var n=s;s=Math.floor(s);var o=(n-s)/(1/60);o=Math.round(o*10);o/=10;if(o>=60){o-=60;s+=1;if(s>=60){s-=60;a+=1}}if(a<10){a="0"+a}var l=a+"Â°";if(i.indexOf("dm")>=0){if(s<10){s="0"+s}l+=s+"'";if(i.indexOf("dms")>=0){if(o<10){o="0"+o}l+=o+'"'}}if(t=="lon"){l+=e<0?OpenLayers.i18n("W"):OpenLayers.i18n("E")}else{l+=e<0?OpenLayers.i18n("S"):OpenLayers.i18n("N")}return l};OpenLayers.Util.getConstructor=function(e){var t;var i=e.split(".");if(i[0]==="OpenLayers"){t=OpenLayers}else{t=window[i[0]]}for(var r=1,a=i.length;r<a;++r){t=t[i[r]]}return t};OpenLayers.Util=OpenLayers.Util||{};OpenLayers.Util.vendorPrefix=function(){"use strict";var o=["","O","ms","Moz","Webkit"],t=document.createElement("div").style,r={},l={};function a(e){if(!e){return null}return e.replace(/([A-Z])/g,function(e){return"-"+e.toLowerCase()}).replace(/^ms-/,"-ms-")}function e(e){if(r[e]===undefined){var t=e.replace(/(-[\s\S])/g,function(e){return e.charAt(1).toUpperCase()});var i=s(t);r[e]=a(i)}return r[e]}function i(e,t){if(l[t]===undefined){var i,r=0,a=o.length,s,n=typeof e.cssText!=="undefined";l[t]=null;for(;r<a;r++){s=o[r];if(s){if(!n){s=s.toLowerCase()}i=s+t.charAt(0).toUpperCase()+t.slice(1)}else{i=t}if(e[i]!==undefined){l[t]=i;break}}}return l[t]}function s(e){return i(t,e)}return{css:e,js:i,style:s,cssCache:r,jsCache:l}}();OpenLayers.Event={observers:false,KEY_SPACE:32,KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,element:function(e){return e.target||e.srcElement},isSingleTouch:function(e){return e.touches&&e.touches.length==1},isMultiTouch:function(e){return e.touches&&e.touches.length>1},isLeftClick:function(e){return e.which&&e.which==1||e.button&&e.button==1},isRightClick:function(e){return e.which&&e.which==3||e.button&&e.button==2},stop:function(e,t){if(!t){OpenLayers.Event.preventDefault(e)}if(e.stopPropagation){e.stopPropagation()}else{e.cancelBubble=true}},preventDefault:function(e){if(e.preventDefault){e.preventDefault()}else{e.returnValue=false}},findElement:function(e,t){var i=OpenLayers.Event.element(e);while(i.parentNode&&(!i.tagName||i.tagName.toUpperCase()!=t.toUpperCase())){i=i.parentNode}return i},observe:function(e,t,i,r){var a=OpenLayers.Util.getElement(e);r=r||false;if(t=="keypress"&&(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||a.attachEvent)){t="keydown"}if(!this.observers){this.observers={}}if(!a._eventCacheID){var s="eventCacheID_";if(a.id){s=a.id+"_"+s}a._eventCacheID=OpenLayers.Util.createUniqueID(s)}var n=a._eventCacheID;if(!this.observers[n]){this.observers[n]=[]}this.observers[n].push({element:a,name:t,observer:i,useCapture:r});if(a.addEventListener){a.addEventListener(t,i,r)}else if(a.attachEvent){a.attachEvent("on"+t,i)}},stopObservingElement:function(e){var t=OpenLayers.Util.getElement(e);var i=t._eventCacheID;this._removeElementObservers(OpenLayers.Event.observers[i])},_removeElementObservers:function(e){if(e){for(var t=e.length-1;t>=0;t--){var i=e[t];OpenLayers.Event.stopObserving.apply(this,[i.element,i.name,i.observer,i.useCapture])}}},stopObserving:function(e,t,i,r){r=r||false;var a=OpenLayers.Util.getElement(e);var s=a._eventCacheID;if(t=="keypress"){if(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||a.detachEvent){t="keydown"}}var n=false;var o=OpenLayers.Event.observers[s];if(o){var l=0;while(!n&&l<o.length){var h=o[l];if(h.name==t&&h.observer==i&&h.useCapture==r){o.splice(l,1);if(o.length==0){delete OpenLayers.Event.observers[s]}n=true;break}l++}}if(n){if(a.removeEventListener){a.removeEventListener(t,i,r)}else if(a&&a.detachEvent){a.detachEvent("on"+t,i)}}return n},unloadCache:function(){if(OpenLayers.Event&&OpenLayers.Event.observers){for(var e in OpenLayers.Event.observers){var t=OpenLayers.Event.observers[e];OpenLayers.Event._removeElementObservers.apply(this,[t])}OpenLayers.Event.observers=false}},CLASS_NAME:"OpenLayers.Event"};OpenLayers.Event.observe(window,"unload",OpenLayers.Event.unloadCache,false);OpenLayers.Events=OpenLayers.Class({BROWSER_EVENTS:["mouseover","mouseout","mousedown","mouseup","mousemove","click","dblclick","rightclick","dblrightclick","resize","focus","blur","touchstart","touchmove","touchend","keydown"],listeners:null,object:null,element:null,eventHandler:null,fallThrough:null,includeXY:false,extensions:null,extensionCount:null,clearMouseListener:null,initialize:function(e,t,i,r,a){OpenLayers.Util.extend(this,a);this.object=e;this.fallThrough=r;this.listeners={};this.extensions={};this.extensionCount={};this._msTouches=[];if(t!=null){this.attachToElement(t)}},destroy:function(){for(var e in this.extensions){if(typeof this.extensions[e]!=="boolean"){this.extensions[e].destroy()}}this.extensions=null;if(this.element){OpenLayers.Event.stopObservingElement(this.element);if(this.element.hasScrollEvent){OpenLayers.Event.stopObserving(window,"scroll",this.clearMouseListener)}}this.element=null;this.listeners=null;this.object=null;this.fallThrough=null;this.eventHandler=null},addEventType:function(e){},attachToElement:function(e){if(this.element){OpenLayers.Event.stopObservingElement(this.element)}else{this.eventHandler=OpenLayers.Function.bindAsEventListener(this.handleBrowserEvent,this);this.clearMouseListener=OpenLayers.Function.bind(this.clearMouseCache,this)}this.element=e;var t=!!window.navigator.msMaxTouchPoints;var i;for(var r=0,a=this.BROWSER_EVENTS.length;r<a;r++){i=this.BROWSER_EVENTS[r];OpenLayers.Event.observe(e,i,this.eventHandler);if(t&&i.indexOf("touch")===0){this.addMsTouchListener(e,i,this.eventHandler)}}OpenLayers.Event.observe(e,"dragstart",OpenLayers.Event.stop)},on:function(e){for(var t in e){if(t!="scope"&&e.hasOwnProperty(t)){this.register(t,e.scope,e[t])}}},register:function(e,t,i,r){if(e in OpenLayers.Events&&!this.extensions[e]){this.extensions[e]=new OpenLayers.Events[e](this)}if(i!=null){if(t==null){t=this.object}var a=this.listeners[e];if(!a){a=[];this.listeners[e]=a;this.extensionCount[e]=0}var s={obj:t,func:i};if(r){a.splice(this.extensionCount[e],0,s);if(typeof r==="object"&&r.extension){this.extensionCount[e]++}}else{a.push(s)}}},registerPriority:function(e,t,i){this.register(e,t,i,true)},un:function(e){for(var t in e){if(t!="scope"&&e.hasOwnProperty(t)){this.unregister(t,e.scope,e[t])}}},unregister:function(e,t,i){if(t==null){t=this.object}var r=this.listeners[e];if(r!=null){for(var a=0,s=r.length;a<s;a++){if(r[a].obj==t&&r[a].func==i){r.splice(a,1);break}}}},remove:function(e){if(this.listeners[e]!=null){this.listeners[e]=[]}},triggerEvent:function(e,t){var i=this.listeners[e];if(!i||i.length==0){return undefined}if(t==null){t={}}t.object=this.object;t.element=this.element;if(!t.type){t.type=e}i=i.slice();var r;for(var a=0,s=i.length;a<s;a++){var n=i[a];r=n.func.apply(n.obj,[t]);if(r!=undefined&&r==false){break}}if(!this.fallThrough){OpenLayers.Event.stop(t,true)}return r},handleBrowserEvent:function(e){var t=e.type,i=this.listeners[t];if(!i||i.length==0){return}var r=e.touches;if(r&&r[0]){var a=0;var s=0;var n=r.length;var o;for(var l=0;l<n;++l){o=this.getTouchClientXY(r[l]);a+=o.clientX;s+=o.clientY}e.clientX=a/n;e.clientY=s/n}if(this.includeXY){e.xy=this.getMousePosition(e)}this.triggerEvent(t,e)},getTouchClientXY:function(e){var t=window.olMockWin||window,i=t.pageXOffset,r=t.pageYOffset,a=e.clientX,s=e.clientY;if(e.pageY===0&&Math.floor(s)>Math.floor(e.pageY)||e.pageX===0&&Math.floor(a)>Math.floor(e.pageX)){a=a-i;s=s-r}else if(s<e.pageY-r||a<e.pageX-i){a=e.pageX-i;s=e.pageY-r}e.olClientX=a;e.olClientY=s;return{clientX:a,clientY:s}},clearMouseCache:function(){this.element.scrolls=null;this.element.lefttop=null;this.element.offsets=null},getMousePosition:function(e){if(!this.includeXY){this.clearMouseCache()}else if(!this.element.hasScrollEvent){OpenLayers.Event.observe(window,"scroll",this.clearMouseListener);this.element.hasScrollEvent=true}if(!this.element.scrolls){var t=OpenLayers.Util.getViewportElement();this.element.scrolls=[window.pageXOffset||t.scrollLeft,window.pageYOffset||t.scrollTop]}if(!this.element.lefttop){this.element.lefttop=[document.documentElement.clientLeft||0,document.documentElement.clientTop||0]}if(!this.element.offsets){this.element.offsets=OpenLayers.Util.pagePosition(this.element)}return new OpenLayers.Pixel(e.clientX+this.element.scrolls[0]-this.element.offsets[0]-this.element.lefttop[0],e.clientY+this.element.scrolls[1]-this.element.offsets[1]-this.element.lefttop[1])},addMsTouchListener:function(e,t,i){var r=this.eventHandler;var a=this._msTouches;function s(e){i(OpenLayers.Util.applyDefaults({stopPropagation:function(){for(var e=a.length-1;e>=0;--e){a[e].stopPropagation()}},preventDefault:function(){for(var e=a.length-1;e>=0;--e){a[e].preventDefault()}},type:t},e))}switch(t){case"touchstart":return this.addMsTouchListenerStart(e,t,s);case"touchend":return this.addMsTouchListenerEnd(e,t,s);case"touchmove":return this.addMsTouchListenerMove(e,t,s);default:throw"Unknown touch event type"}},addMsTouchListenerStart:function(e,t,a){var s=this._msTouches;var i=function(e){var t=false;for(var i=0,r=s.length;i<r;++i){if(s[i].pointerId==e.pointerId){t=true;break}}if(!t){s.push(e)}e.touches=s.slice();a(e)};OpenLayers.Event.observe(e,"MSPointerDown",i);var r=function(e){for(var t=0,i=s.length;t<i;++t){if(s[t].pointerId==e.pointerId){s.splice(t,1);break}}};OpenLayers.Event.observe(e,"MSPointerUp",r)},addMsTouchListenerMove:function(e,t,r){var a=this._msTouches;var i=function(e){if(e.pointerType==e.MSPOINTER_TYPE_MOUSE&&e.buttons==0){return}if(a.length==1&&a[0].pageX==e.pageX&&a[0].pageY==e.pageY){return}for(var t=0,i=a.length;t<i;++t){if(a[t].pointerId==e.pointerId){a[t]=e;break}}e.touches=a.slice();r(e)};OpenLayers.Event.observe(e,"MSPointerMove",i)},addMsTouchListenerEnd:function(e,t,r){var a=this._msTouches;var i=function(e){for(var t=0,i=a.length;t<i;++t){if(a[t].pointerId==e.pointerId){a.splice(t,1);break}}e.touches=a.slice();r(e)};OpenLayers.Event.observe(e,"MSPointerUp",i)},CLASS_NAME:"OpenLayers.Events"});OpenLayers.Animation=function(r){var e=OpenLayers.Util.vendorPrefix.js(r,"requestAnimationFrame");var t=!!e;var s=function(){var i=r[e]||function(e,t){r.setTimeout(e,16)};return function(e,t){i.apply(r,[e,t])}}();var n=0;var o={};function i(e,t,i){t=t>0?t:Number.POSITIVE_INFINITY;var r=++n;var a=+new Date;o[r]=function(){if(o[r]&&+new Date-a<=t){e();if(o[r]){s(o[r],i)}}else{delete o[r]}};s(o[r],i);return r}function a(e){delete o[e]}return{isNative:t,requestFrame:s,start:i,stop:a}}(window);OpenLayers.Tween=OpenLayers.Class({easing:null,begin:null,finish:null,duration:null,callbacks:null,time:null,minFrameRate:null,startTime:null,animationId:null,playing:false,initialize:function(e){this.easing=e?e:OpenLayers.Easing.Expo.easeOut},start:function(e,t,i,r){this.playing=true;this.begin=e;this.finish=t;this.duration=i;this.callbacks=r.callbacks;this.minFrameRate=r.minFrameRate||30;this.time=0;this.startTime=(new Date).getTime();OpenLayers.Animation.stop(this.animationId);this.animationId=null;if(this.callbacks&&this.callbacks.start){this.callbacks.start.call(this,this.begin)}this.animationId=OpenLayers.Animation.start(OpenLayers.Function.bind(this.play,this))},stop:function(){if(!this.playing){return}if(this.callbacks&&this.callbacks.done){this.callbacks.done.call(this,this.finish)}OpenLayers.Animation.stop(this.animationId);this.animationId=null;this.playing=false},play:function(){var e={};for(var t in this.begin){var i=this.begin[t];var r=this.finish[t];if(i==null||r==null||isNaN(i)||isNaN(r)){throw new TypeError("invalid value for Tween")}var a=r-i;e[t]=this.easing.apply(this,[this.time,i,a,this.duration])}this.time++;if(this.callbacks&&this.callbacks.eachStep){if(((new Date).getTime()-this.startTime)/this.time<=1e3/this.minFrameRate){this.callbacks.eachStep.call(this,e)}}if(this.time>this.duration){this.stop()}},CLASS_NAME:"OpenLayers.Tween"});OpenLayers.Easing={CLASS_NAME:"OpenLayers.Easing"};OpenLayers.Easing.Linear={easeIn:function(e,t,i,r){return i*e/r+t},easeOut:function(e,t,i,r){return i*e/r+t},easeInOut:function(e,t,i,r){return i*e/r+t},CLASS_NAME:"OpenLayers.Easing.Linear"};OpenLayers.Easing.Expo={easeIn:function(e,t,i,r){return e==0?t:i*Math.pow(2,10*(e/r-1))+t},easeOut:function(e,t,i,r){return e==r?t+i:i*(-Math.pow(2,-10*e/r)+1)+t},easeInOut:function(e,t,i,r){if(e==0)return t;if(e==r)return t+i;if((e/=r/2)<1)return i/2*Math.pow(2,10*(e-1))+t;return i/2*(-Math.pow(2,-10*--e)+2)+t},CLASS_NAME:"OpenLayers.Easing.Expo"};OpenLayers.Easing.Quad={easeIn:function(e,t,i,r){return i*(e/=r)*e+t},easeOut:function(e,t,i,r){return-i*(e/=r)*(e-2)+t},easeInOut:function(e,t,i,r){if((e/=r/2)<1)return i/2*e*e+t;return-i/2*(--e*(e-2)-1)+t},CLASS_NAME:"OpenLayers.Easing.Quad"};OpenLayers.Projection=OpenLayers.Class({proj:null,projCode:null,titleRegEx:/\+title=[^\+]*/,initialize:function(e,t){OpenLayers.Util.extend(this,t);this.projCode=e;if(typeof Proj4js=="object"){this.proj=new Proj4js.Proj(e)}},getCode:function(){return this.proj?this.proj.srsCode:this.projCode},getUnits:function(){return this.proj?this.proj.units:null},toString:function(){return this.getCode()},equals:function(e){var t=e,i=false;if(t){if(!(t instanceof OpenLayers.Projection)){t=new OpenLayers.Projection(t)}if(typeof Proj4js=="object"&&this.proj.defData&&t.proj.defData){i=this.proj.defData.replace(this.titleRegEx,"")==t.proj.defData.replace(this.titleRegEx,"")}else if(t.getCode){var r=this.getCode(),a=t.getCode();i=r==a||!!OpenLayers.Projection.transforms[r]&&OpenLayers.Projection.transforms[r][a]===OpenLayers.Projection.nullTransform}}return i},destroy:function(){delete this.proj;delete this.projCode},CLASS_NAME:"OpenLayers.Projection"});OpenLayers.Projection.transforms={};OpenLayers.Projection.defaults={"EPSG:4326":{units:"degrees",maxExtent:[-180,-90,180,90],yx:true},"CRS:84":{units:"degrees",maxExtent:[-180,-90,180,90]},"EPSG:900913":{units:"m",maxExtent:[-20037508.34,-20037508.34,20037508.34,20037508.34]}};OpenLayers.Projection.addTransform=function(e,t,i){if(i===OpenLayers.Projection.nullTransform){var r=OpenLayers.Projection.defaults[e];if(r&&!OpenLayers.Projection.defaults[t]){OpenLayers.Projection.defaults[t]=r}}if(!OpenLayers.Projection.transforms[e]){OpenLayers.Projection.transforms[e]={}}OpenLayers.Projection.transforms[e][t]=i};OpenLayers.Projection.transform=function(e,t,i){if(t&&i){if(!(t instanceof OpenLayers.Projection)){t=new OpenLayers.Projection(t)}if(!(i instanceof OpenLayers.Projection)){i=new OpenLayers.Projection(i)}if(t.proj&&i.proj){e=Proj4js.transform(t.proj,i.proj,e)}else{var r=t.getCode();var a=i.getCode();var s=OpenLayers.Projection.transforms;if(s[r]&&s[r][a]){s[r][a](e)}}}return e};OpenLayers.Projection.nullTransform=function(e){return e};(function(){var i=20037508.34;function h(e){e.x=180*e.x/i;e.y=180/Math.PI*(2*Math.atan(Math.exp(e.y/i*Math.PI))-Math.PI/2);return e}function p(e){e.x=e.x*i/180;var t=Math.log(Math.tan((90+e.y)*Math.PI/360))/Math.PI*i;e.y=Math.max(-20037508.34,Math.min(t,20037508.34));return e}function e(e,t){var i=OpenLayers.Projection.addTransform;var r=OpenLayers.Projection.nullTransform;var a,s,n,o,l;for(a=0,s=t.length;a<s;++a){n=t[a];i(e,n,p);i(n,e,h);for(l=a+1;l<s;++l){o=t[l];i(n,o,r);i(o,n,r)}}}var t=["EPSG:900913","EPSG:3857","EPSG:102113","EPSG:102100","OSGEO:41001"],r=["CRS:84","urn:ogc:def:crs:EPSG:6.6:4326","EPSG:4326"],a;for(a=t.length-1;a>=0;--a){e(t[a],r)}for(a=r.length-1;a>=0;--a){e(r[a],t)}})();OpenLayers.Map=OpenLayers.Class({Z_INDEX_BASE:{BaseLayer:100,Overlay:325,Feature:725,Popup:750,Control:1e3},id:null,fractionalZoom:false,events:null,allOverlays:false,div:null,dragging:false,size:null,viewPortDiv:null,layerContainerOrigin:null,layerContainerDiv:null,layers:null,controls:null,popups:null,baseLayer:null,center:null,resolution:null,zoom:0,panRatio:1.5,options:null,tileSize:null,projection:"EPSG:4326",units:null,resolutions:null,maxResolution:null,minResolution:null,maxScale:null,minScale:null,maxExtent:null,minExtent:null,restrictedExtent:null,numZoomLevels:16,theme:null,displayProjection:null,tileManager:{zoomDelay:15,moveDelay:15,tilesPerFrame:16,frameDelay:10},fallThrough:false,autoUpdateSize:true,eventListeners:null,panTween:null,panMethod:OpenLayers.Easing.Expo.easeOut,panDuration:50,zoomTween:null,zoomMethod:OpenLayers.Easing.Quad.easeOut,zoomDuration:20,paddingForPopups:null,layerContainerOriginPx:null,minPx:null,maxPx:null,initialize:function(e,t){if(arguments.length===1&&typeof e==="object"){t=e;e=t&&t.div}this.tileSize=new OpenLayers.Size(OpenLayers.Map.TILE_WIDTH,OpenLayers.Map.TILE_HEIGHT);this.paddingForPopups=new OpenLayers.Bounds(15,15,15,15);this.theme=OpenLayers._getScriptLocation()+"theme/default/style.css";this.options=OpenLayers.Util.extend({},t);OpenLayers.Util.extend(this,t);var i=this.projection instanceof OpenLayers.Projection?this.projection.projCode:this.projection;OpenLayers.Util.applyDefaults(this,OpenLayers.Projection.defaults[i]);if(this.maxExtent&&!(this.maxExtent instanceof OpenLayers.Bounds)){this.maxExtent=new OpenLayers.Bounds(this.maxExtent)}if(this.minExtent&&!(this.minExtent instanceof OpenLayers.Bounds)){this.minExtent=new OpenLayers.Bounds(this.minExtent)}if(this.restrictedExtent&&!(this.restrictedExtent instanceof OpenLayers.Bounds)){this.restrictedExtent=new OpenLayers.Bounds(this.restrictedExtent)}if(this.center&&!(this.center instanceof OpenLayers.LonLat)){this.center=new OpenLayers.LonLat(this.center)}this.layers=[];this.id=OpenLayers.Util.createUniqueID("OpenLayers.Map_");this.div=OpenLayers.Util.getElement(e);if(!this.div){this.div=document.createElement("div");this.div.style.height="1px";this.div.style.width="1px"}OpenLayers.Element.addClass(this.div,"olMap");var r=this.id+"_OpenLayers_ViewPort";this.viewPortDiv=OpenLayers.Util.createDiv(r,null,null,null,"relative",null,"hidden");this.viewPortDiv.style.width="100%";this.viewPortDiv.style.height="100%";this.viewPortDiv.className="olMapViewport";this.div.appendChild(this.viewPortDiv);this.events=new OpenLayers.Events(this,this.viewPortDiv,null,this.fallThrough,{includeXY:true});if(OpenLayers.TileManager&&this.tileManager!==null){if(!(this.tileManager instanceof OpenLayers.TileManager)){this.tileManager=new OpenLayers.TileManager(this.tileManager)}this.tileManager.addMap(this)}r=this.id+"_OpenLayers_Container";this.layerContainerDiv=OpenLayers.Util.createDiv(r);this.layerContainerDiv.style.zIndex=this.Z_INDEX_BASE["Popup"]-1;this.layerContainerOriginPx={x:0,y:0};this.applyTransform();this.viewPortDiv.appendChild(this.layerContainerDiv);this.updateSize();if(this.eventListeners instanceof Object){this.events.on(this.eventListeners)}if(this.autoUpdateSize===true){this.updateSizeDestroy=OpenLayers.Function.bind(this.updateSize,this);OpenLayers.Event.observe(window,"resize",this.updateSizeDestroy)}if(this.theme){var a=true;var s=document.getElementsByTagName("link");for(var n=0,o=s.length;n<o;++n){if(OpenLayers.Util.isEquivalentUrl(s.item(n).href,this.theme)){a=false;break}}if(a){var l=document.createElement("link");l.setAttribute("rel","stylesheet");l.setAttribute("type","text/css");l.setAttribute("href",this.theme);document.getElementsByTagName("head")[0].appendChild(l)}}if(this.controls==null){this.controls=[];if(OpenLayers.Control!=null){if(OpenLayers.Control.Navigation){this.controls.push(new OpenLayers.Control.Navigation)}else if(OpenLayers.Control.TouchNavigation){this.controls.push(new OpenLayers.Control.TouchNavigation)}if(OpenLayers.Control.Zoom){this.controls.push(new OpenLayers.Control.Zoom)}else if(OpenLayers.Control.PanZoom){this.controls.push(new OpenLayers.Control.PanZoom)}if(OpenLayers.Control.ArgParser){this.controls.push(new OpenLayers.Control.ArgParser)}if(OpenLayers.Control.Attribution){this.controls.push(new OpenLayers.Control.Attribution)}}}for(var n=0,o=this.controls.length;n<o;n++){this.addControlToMap(this.controls[n])}this.popups=[];this.unloadDestroy=OpenLayers.Function.bind(this.destroy,this);OpenLayers.Event.observe(window,"unload",this.unloadDestroy);if(t&&t.layers){delete this.center;delete this.zoom;this.addLayers(t.layers);if(t.center&&!this.getCenter()){this.setCenter(t.center,t.zoom)}}if(this.panMethod){this.panTween=new OpenLayers.Tween(this.panMethod)}if(this.zoomMethod&&this.applyTransform.transform){this.zoomTween=new OpenLayers.Tween(this.zoomMethod)}},getViewport:function(){return this.viewPortDiv},render:function(e){this.div=OpenLayers.Util.getElement(e);OpenLayers.Element.addClass(this.div,"olMap");this.viewPortDiv.parentNode.removeChild(this.viewPortDiv);this.div.appendChild(this.viewPortDiv);this.updateSize()},unloadDestroy:null,updateSizeDestroy:null,destroy:function(){if(!this.unloadDestroy){return false}if(this.panTween){this.panTween.stop();this.panTween=null}if(this.zoomTween){this.zoomTween.stop();this.zoomTween=null}OpenLayers.Event.stopObserving(window,"unload",this.unloadDestroy);this.unloadDestroy=null;if(this.updateSizeDestroy){OpenLayers.Event.stopObserving(window,"resize",this.updateSizeDestroy)}this.paddingForPopups=null;if(this.controls!=null){for(var e=this.controls.length-1;e>=0;--e){this.controls[e].destroy()}this.controls=null}if(this.layers!=null){for(var e=this.layers.length-1;e>=0;--e){this.layers[e].destroy(false)}this.layers=null}if(this.viewPortDiv&&this.viewPortDiv.parentNode){this.viewPortDiv.parentNode.removeChild(this.viewPortDiv)}this.viewPortDiv=null;if(this.tileManager){this.tileManager.removeMap(this);this.tileManager=null}if(this.eventListeners){this.events.un(this.eventListeners);this.eventListeners=null}this.events.destroy();this.events=null;this.options=null},setOptions:function(e){var t=this.minPx&&e.restrictedExtent!=this.restrictedExtent;OpenLayers.Util.extend(this,e);t&&this.moveTo(this.getCachedCenter(),this.zoom,{forceZoomChange:true})},getTileSize:function(){return this.tileSize},getBy:function(e,t,i){var r=typeof i.test=="function";var a=OpenLayers.Array.filter(this[e],function(e){return e[t]==i||r&&i.test(e[t])});return a},getLayersBy:function(e,t){return this.getBy("layers",e,t)},getLayersByName:function(e){return this.getLayersBy("name",e)},getLayersByClass:function(e){return this.getLayersBy("CLASS_NAME",e)},getControlsBy:function(e,t){return this.getBy("controls",e,t)},getControlsByClass:function(e){return this.getControlsBy("CLASS_NAME",e)},getLayer:function(e){var t=null;for(var i=0,r=this.layers.length;i<r;i++){var a=this.layers[i];if(a.id==e){t=a;break}}return t},setLayerZIndex:function(e,t){e.setZIndex(this.Z_INDEX_BASE[e.isBaseLayer?"BaseLayer":"Overlay"]+t*5)},resetLayersZIndex:function(){for(var e=0,t=this.layers.length;e<t;e++){var i=this.layers[e];this.setLayerZIndex(i,e)}},addLayer:function(e){for(var t=0,i=this.layers.length;t<i;t++){if(this.layers[t]==e){return false}}if(this.events.triggerEvent("preaddlayer",{layer:e})===false){return false}if(this.allOverlays){e.isBaseLayer=false}e.div.className="olLayerDiv";e.div.style.overflow="";this.setLayerZIndex(e,this.layers.length);if(e.isFixed){this.viewPortDiv.appendChild(e.div)}else{this.layerContainerDiv.appendChild(e.div)}this.layers.push(e);e.setMap(this);if(e.isBaseLayer||this.allOverlays&&!this.baseLayer){if(this.baseLayer==null){this.setBaseLayer(e)}else{e.setVisibility(false)}}else{e.redraw()}this.events.triggerEvent("addlayer",{layer:e});e.events.triggerEvent("added",{map:this,layer:e});e.afterAdd();return true},addLayers:function(e){for(var t=0,i=e.length;t<i;t++){this.addLayer(e[t])}},removeLayer:function(e,t){if(this.events.triggerEvent("preremovelayer",{layer:e})===false){return}if(t==null){t=true}if(e.isFixed){this.viewPortDiv.removeChild(e.div)}else{this.layerContainerDiv.removeChild(e.div)}OpenLayers.Util.removeItem(this.layers,e);e.removeMap(this);e.map=null;if(this.baseLayer==e){this.baseLayer=null;if(t){for(var i=0,r=this.layers.length;i<r;i++){var a=this.layers[i];if(a.isBaseLayer||this.allOverlays){this.setBaseLayer(a);break}}}}this.resetLayersZIndex();this.events.triggerEvent("removelayer",{layer:e});e.events.triggerEvent("removed",{map:this,layer:e})},getNumLayers:function(){return this.layers.length},getLayerIndex:function(e){return OpenLayers.Util.indexOf(this.layers,e)},setLayerIndex:function(e,t){var i=this.getLayerIndex(e);if(t<0){t=0}else if(t>this.layers.length){t=this.layers.length}if(i!=t){this.layers.splice(i,1);this.layers.splice(t,0,e);for(var r=0,a=this.layers.length;r<a;r++){this.setLayerZIndex(this.layers[r],r)}this.events.triggerEvent("changelayer",{layer:e,property:"order"});if(this.allOverlays){if(t===0){this.setBaseLayer(e)}else if(this.baseLayer!==this.layers[0]){this.setBaseLayer(this.layers[0])}}}},raiseLayer:function(e,t){var i=this.getLayerIndex(e)+t;this.setLayerIndex(e,i)},setBaseLayer:function(e){if(e!=this.baseLayer){if(OpenLayers.Util.indexOf(this.layers,e)!=-1){var t=this.getCachedCenter();var i=OpenLayers.Util.getResolutionFromScale(this.getScale(),e.units);if(this.baseLayer!=null&&!this.allOverlays){this.baseLayer.setVisibility(false)}this.baseLayer=e;if(!this.allOverlays||this.baseLayer.visibility){this.baseLayer.setVisibility(true);if(this.baseLayer.inRange===false){this.baseLayer.redraw()}}if(t!=null){var r=this.getZoomForResolution(i||this.resolution,true);this.setCenter(t,r,false,true)}this.events.triggerEvent("changebaselayer",{layer:this.baseLayer})}}},addControl:function(e,t){this.controls.push(e);this.addControlToMap(e,t)},addControls:function(e,t){var i=arguments.length===1?[]:t;for(var r=0,a=e.length;r<a;r++){var s=e[r];var n=i[r]?i[r]:null;this.addControl(s,n)}},addControlToMap:function(e,t){e.outsideViewport=e.div!=null;if(this.displayProjection&&!e.displayProjection){e.displayProjection=this.displayProjection}e.setMap(this);var i=e.draw(t);if(i){if(!e.outsideViewport){i.style.zIndex=this.Z_INDEX_BASE["Control"]+this.controls.length;this.viewPortDiv.appendChild(i)}}if(e.autoActivate){e.activate()}},getControl:function(e){var t=null;for(var i=0,r=this.controls.length;i<r;i++){var a=this.controls[i];if(a.id==e){t=a;break}}return t},removeControl:function(e){if(e&&e==this.getControl(e.id)){if(e.div&&e.div.parentNode==this.viewPortDiv){this.viewPortDiv.removeChild(e.div)}OpenLayers.Util.removeItem(this.controls,e)}},addPopup:function(e,t){if(t){for(var i=this.popups.length-1;i>=0;--i){this.removePopup(this.popups[i])}}e.map=this;this.popups.push(e);var r=e.draw();if(r){r.style.zIndex=this.Z_INDEX_BASE["Popup"]+this.popups.length;this.layerContainerDiv.appendChild(r)}},removePopup:function(e){OpenLayers.Util.removeItem(this.popups,e);if(e.div){try{this.layerContainerDiv.removeChild(e.div)}catch(e){}}e.map=null},getSize:function(){var e=null;if(this.size!=null){e=this.size.clone()}return e},updateSize:function(){var e=this.getCurrentSize();if(e&&!isNaN(e.h)&&!isNaN(e.w)){this.events.clearMouseCache();var t=this.getSize();if(t==null){this.size=t=e}if(!e.equals(t)){this.size=e;for(var i=0,r=this.layers.length;i<r;i++){this.layers[i].onMapResize()}var a=this.getCachedCenter();if(this.baseLayer!=null&&a!=null){var s=this.getZoom();this.zoom=null;this.setCenter(a,s)}}}this.events.triggerEvent("updatesize")},getCurrentSize:function(){var e=new OpenLayers.Size(this.div.clientWidth,this.div.clientHeight);if(e.w==0&&e.h==0||isNaN(e.w)&&isNaN(e.h)){e.w=this.div.offsetWidth;e.h=this.div.offsetHeight}if(e.w==0&&e.h==0||isNaN(e.w)&&isNaN(e.h)){e.w=parseInt(this.div.style.width);e.h=parseInt(this.div.style.height)}return e},calculateBounds:function(e,t){var i=null;if(e==null){e=this.getCachedCenter()}if(t==null){t=this.getResolution()}if(e!=null&&t!=null){var r=this.size.w*t/2;var a=this.size.h*t/2;i=new OpenLayers.Bounds(e.lon-r,e.lat-a,e.lon+r,e.lat+a)}return i},getCenter:function(){var e=null;var t=this.getCachedCenter();if(t){e=t.clone()}return e},getCachedCenter:function(){if(!this.center&&this.size){this.center=this.getLonLatFromViewPortPx({x:this.size.w/2,y:this.size.h/2})}return this.center},getZoom:function(){return this.zoom},pan:function(e,t,i){i=OpenLayers.Util.applyDefaults(i,{animate:true,dragging:false});if(i.dragging){if(e!=0||t!=0){this.moveByPx(e,t)}}else{var r=this.getViewPortPxFromLonLat(this.getCachedCenter());var a=r.add(e,t);if(this.dragging||!a.equals(r)){var s=this.getLonLatFromViewPortPx(a);if(i.animate){this.panTo(s)}else{this.moveTo(s);if(this.dragging){this.dragging=false;this.events.triggerEvent("moveend")}}}}},panTo:function(t){if(this.panTween&&this.getExtent().scale(this.panRatio).containsLonLat(t)){var e=this.getCachedCenter();if(t.equals(e)){return}var i=this.getPixelFromLonLat(e);var r=this.getPixelFromLonLat(t);var a={x:r.x-i.x,y:r.y-i.y};var s={x:0,y:0};this.panTween.start({x:0,y:0},a,this.panDuration,{callbacks:{eachStep:OpenLayers.Function.bind(function(e){var t=e.x-s.x,i=e.y-s.y;this.moveByPx(t,i);s.x=Math.round(e.x);s.y=Math.round(e.y)},this),done:OpenLayers.Function.bind(function(e){this.moveTo(t);this.dragging=false;this.events.triggerEvent("moveend")},this)}})}else{this.setCenter(t)}},setCenter:function(e,t,i,r){if(this.panTween){this.panTween.stop()}if(this.zoomTween){this.zoomTween.stop()}this.moveTo(e,t,{dragging:i,forceZoomChange:r})},moveByPx:function(e,t){var i=this.size.w/2;var r=this.size.h/2;var a=i+e;var s=r+t;var p=this.baseLayer.wrapDateLine;var n=0;var o=0;if(this.restrictedExtent){n=i;o=r;p=false}e=p||a<=this.maxPx.x-n&&a>=this.minPx.x+n?Math.round(e):0;t=s<=this.maxPx.y-o&&s>=this.minPx.y+o?Math.round(t):0;if(e||t){if(!this.dragging){this.dragging=true;this.events.triggerEvent("movestart")}this.center=null;if(e){this.layerContainerOriginPx.x-=e;this.minPx.x-=e;this.maxPx.x-=e}if(t){this.layerContainerOriginPx.y-=t;this.minPx.y-=t;this.maxPx.y-=t}this.applyTransform();var l,h,u;for(h=0,u=this.layers.length;h<u;++h){l=this.layers[h];if(l.visibility&&(l===this.baseLayer||l.inRange)){l.moveByPx(e,t);l.events.triggerEvent("move")}}this.events.triggerEvent("move")}},adjustZoom:function(e){if(this.baseLayer&&this.baseLayer.wrapDateLine){var t,i=this.baseLayer.resolutions,r=this.getMaxExtent().getWidth()/this.size.w;if(this.getResolutionForZoom(e)>r){if(this.fractionalZoom){e=this.getZoomForResolution(r)}else{for(var a=e|0,s=i.length;a<s;++a){if(i[a]<=r){e=a;break}}}}}return e},getMinZoom:function(){return this.adjustZoom(0)},moveTo:function(e,t,i){if(e!=null&&!(e instanceof OpenLayers.LonLat)){e=new OpenLayers.LonLat(e)}if(!i){i={}}if(t!=null){t=parseFloat(t);if(!this.fractionalZoom){t=Math.round(t)}}var p=t;t=this.adjustZoom(t);if(t!==p){e=this.getCenter()}var u=i.dragging||this.dragging;var c=i.forceZoomChange;if(!this.getCachedCenter()&&!this.isValidLonLat(e)){e=this.maxExtent.getCenterLonLat();this.center=e.clone()}if(this.restrictedExtent!=null){if(e==null){e=this.center}if(t==null){t=this.getZoom()}var d=this.getResolutionForZoom(t);var r=this.calculateBounds(e,d);if(!this.restrictedExtent.containsBounds(r)){var f=this.restrictedExtent.getCenterLonLat();if(r.getWidth()>this.restrictedExtent.getWidth()){e=new OpenLayers.LonLat(f.lon,e.lat)}else if(r.left<this.restrictedExtent.left){e=e.add(this.restrictedExtent.left-r.left,0)}else if(r.right>this.restrictedExtent.right){e=e.add(this.restrictedExtent.right-r.right,0)}if(r.getHeight()>this.restrictedExtent.getHeight()){e=new OpenLayers.LonLat(e.lon,f.lat)}else if(r.bottom<this.restrictedExtent.bottom){e=e.add(0,this.restrictedExtent.bottom-r.bottom)}else if(r.top>this.restrictedExtent.top){e=e.add(0,this.restrictedExtent.top-r.top)}}}var a=c||this.isValidZoomLevel(t)&&t!=this.getZoom();var y=this.isValidLonLat(e)&&!e.equals(this.center);if(a||y||u){u||this.events.triggerEvent("movestart",{zoomChanged:a});if(y){if(!a&&this.center){this.centerLayerContainer(e)}this.center=e.clone()}var s=a?this.getResolutionForZoom(t):this.getResolution();if(a||this.layerContainerOrigin==null){this.layerContainerOrigin=this.getCachedCenter();this.layerContainerOriginPx.x=0;this.layerContainerOriginPx.y=0;this.applyTransform();var n=this.getMaxExtent({restricted:true});var g=n.getCenterLonLat();var m=this.center.lon-g.lon;var v=g.lat-this.center.lat;var x=Math.round(n.getWidth()/s);var L=Math.round(n.getHeight()/s);this.minPx={x:(this.size.w-x)/2-m/s,y:(this.size.h-L)/2-v/s};this.maxPx={x:this.minPx.x+Math.round(n.getWidth()/s),y:this.minPx.y+Math.round(n.getHeight()/s)}}if(a){this.zoom=t;this.resolution=s}var b=this.getExtent();if(this.baseLayer.visibility){this.baseLayer.moveTo(b,a,i.dragging);i.dragging||this.baseLayer.events.triggerEvent("moveend",{zoomChanged:a})}b=this.baseLayer.getExtent();for(var o=this.layers.length-1;o>=0;--o){var l=this.layers[o];if(l!==this.baseLayer&&!l.isBaseLayer){var h=l.calculateInRange();if(l.inRange!=h){l.inRange=h;if(!h){l.display(false)}this.events.triggerEvent("changelayer",{layer:l,property:"visibility"})}if(h&&l.visibility){l.moveTo(b,a,i.dragging);i.dragging||l.events.triggerEvent("moveend",{zoomChanged:a})}}}this.events.triggerEvent("move");u||this.events.triggerEvent("moveend");if(a){for(var o=0,E=this.popups.length;o<E;o++){this.popups[o].updatePosition()}this.events.triggerEvent("zoomend")}}},centerLayerContainer:function(e){var t=this.getViewPortPxFromLonLat(this.layerContainerOrigin);var i=this.getViewPortPxFromLonLat(e);if(t!=null&&i!=null){var r=this.layerContainerOriginPx.x;var a=this.layerContainerOriginPx.y;var s=Math.round(t.x-i.x);var n=Math.round(t.y-i.y);this.applyTransform(this.layerContainerOriginPx.x=s,this.layerContainerOriginPx.y=n);var o=r-s;var l=a-n;this.minPx.x-=o;this.maxPx.x-=o;this.minPx.y-=l;this.maxPx.y-=l}},isValidZoomLevel:function(e){return e!=null&&e>=0&&e<this.getNumZoomLevels()},isValidLonLat:function(e){var t=false;if(e!=null){var i=this.getMaxExtent();var r=this.baseLayer.wrapDateLine&&i;t=i.containsLonLat(e,{worldBounds:r})}return t},getProjection:function(){var e=this.getProjectionObject();return e?e.getCode():null},getProjectionObject:function(){var e=null;if(this.baseLayer!=null){e=this.baseLayer.projection}return e},getMaxResolution:function(){var e=null;if(this.baseLayer!=null){e=this.baseLayer.maxResolution}return e},getMaxExtent:function(e){var t=null;if(e&&e.restricted&&this.restrictedExtent){t=this.restrictedExtent}else if(this.baseLayer!=null){t=this.baseLayer.maxExtent}return t},getNumZoomLevels:function(){var e=null;if(this.baseLayer!=null){e=this.baseLayer.numZoomLevels}return e},getExtent:function(){var e=null;if(this.baseLayer!=null){e=this.baseLayer.getExtent()}return e},getResolution:function(){var e=null;if(this.baseLayer!=null){e=this.baseLayer.getResolution()}else if(this.allOverlays===true&&this.layers.length>0){e=this.layers[0].getResolution()}return e},getUnits:function(){var e=null;if(this.baseLayer!=null){e=this.baseLayer.units}return e},getScale:function(){var e=null;if(this.baseLayer!=null){var t=this.getResolution();var i=this.baseLayer.units;e=OpenLayers.Util.getScaleFromResolution(t,i)}return e},getZoomForExtent:function(e,t){var i=null;if(this.baseLayer!=null){i=this.baseLayer.getZoomForExtent(e,t)}return i},getResolutionForZoom:function(e){var t=null;if(this.baseLayer){t=this.baseLayer.getResolutionForZoom(e)}return t},getZoomForResolution:function(e,t){var i=null;if(this.baseLayer!=null){i=this.baseLayer.getZoomForResolution(e,t)}return i},zoomTo:function(e,s){var n=this;if(n.isValidZoomLevel(e)){if(n.baseLayer.wrapDateLine){e=n.adjustZoom(e)}if(n.zoomTween){var t=n.getResolution(),i=n.getResolutionForZoom(e),r={scale:1},a={scale:t/i};if(n.zoomTween.playing&&n.zoomTween.duration<3*n.zoomDuration){n.zoomTween.finish={scale:n.zoomTween.finish.scale*a.scale}}else{if(!s){var o=n.getSize();s={x:o.w/2,y:o.h/2}}n.zoomTween.start(r,a,n.zoomDuration,{minFrameRate:50,callbacks:{eachStep:function(e){var t=n.layerContainerOriginPx,i=e.scale,r=(i-1)*(t.x-s.x)|0,a=(i-1)*(t.y-s.y)|0;n.applyTransform(t.x+r,t.y+a,i)},done:function(e){n.applyTransform();var t=n.getResolution()/e.scale,i=n.getZoomForResolution(t,true);n.moveTo(n.getZoomTargetCenter(s,t),i,true)}}})}}else{var l=s?n.getZoomTargetCenter(s,n.getResolutionForZoom(e)):null;n.setCenter(l,e)}}},zoomIn:function(){this.zoomTo(this.getZoom()+1)},zoomOut:function(){this.zoomTo(this.getZoom()-1)},zoomToExtent:function(e,t){if(!(e instanceof OpenLayers.Bounds)){e=new OpenLayers.Bounds(e)}var i=e.getCenterLonLat();if(this.baseLayer.wrapDateLine){var r=this.getMaxExtent();e=e.clone();while(e.right<e.left){e.right+=r.getWidth()}i=e.getCenterLonLat().wrapDateLine(r)}this.setCenter(i,this.getZoomForExtent(e,t))},zoomToMaxExtent:function(e){var t=e?e.restricted:true;var i=this.getMaxExtent({restricted:t});this.zoomToExtent(i)},zoomToScale:function(e,t){var i=OpenLayers.Util.getResolutionFromScale(e,this.baseLayer.units);var r=this.size.w*i/2;var a=this.size.h*i/2;var s=this.getCachedCenter();var n=new OpenLayers.Bounds(s.lon-r,s.lat-a,s.lon+r,s.lat+a);this.zoomToExtent(n,t)},getLonLatFromViewPortPx:function(e){var t=null;if(this.baseLayer!=null){t=this.baseLayer.getLonLatFromViewPortPx(e)}return t},getViewPortPxFromLonLat:function(e){var t=null;if(this.baseLayer!=null){t=this.baseLayer.getViewPortPxFromLonLat(e)}return t},getZoomTargetCenter:function(e,t){var i=null,r=this.getSize(),a=r.w/2-e.x,s=e.y-r.h/2,n=this.getLonLatFromPixel(e);if(n){i=new OpenLayers.LonLat(n.lon+a*t,n.lat+s*t)}return i},getLonLatFromPixel:function(e){return this.getLonLatFromViewPortPx(e)},getPixelFromLonLat:function(e){var t=this.getViewPortPxFromLonLat(e);t.x=Math.round(t.x);t.y=Math.round(t.y);return t},getGeodesicPixelSize:function(e){var t=e?this.getLonLatFromPixel(e):this.getCachedCenter()||new OpenLayers.LonLat(0,0);var i=this.getResolution();var r=t.add(-i/2,0);var a=t.add(i/2,0);var s=t.add(0,-i/2);var n=t.add(0,i/2);var o=new OpenLayers.Projection("EPSG:4326");var l=this.getProjectionObject()||o;if(!l.equals(o)){r.transform(l,o);a.transform(l,o);s.transform(l,o);n.transform(l,o)}return new OpenLayers.Size(OpenLayers.Util.distVincenty(r,a),OpenLayers.Util.distVincenty(s,n))},getViewPortPxFromLayerPx:function(e){var t=null;if(e!=null){var i=this.layerContainerOriginPx.x;var r=this.layerContainerOriginPx.y;t=e.add(i,r)}return t},getLayerPxFromViewPortPx:function(e){var t=null;if(e!=null){var i=-this.layerContainerOriginPx.x;var r=-this.layerContainerOriginPx.y;t=e.add(i,r);if(isNaN(t.x)||isNaN(t.y)){t=null}}return t},getLonLatFromLayerPx:function(e){e=this.getViewPortPxFromLayerPx(e);return this.getLonLatFromViewPortPx(e)},getLayerPxFromLonLat:function(e){var t=this.getPixelFromLonLat(e);return this.getLayerPxFromViewPortPx(t)},applyTransform:function(e,t,i){i=i||1;var r=this.layerContainerOriginPx,a=i!==1;e=e||r.x;t=t||r.y;var s=this.layerContainerDiv.style,n=this.applyTransform.transform,o=this.applyTransform.template;if(n===undefined){n=OpenLayers.Util.vendorPrefix.style("transform");this.applyTransform.transform=n;if(n){var l=OpenLayers.Element.getStyle(this.viewPortDiv,OpenLayers.Util.vendorPrefix.css("transform"));if(!l||l!=="none"){o=["translate3d(",",0) ","scale3d(",",1)"];s[n]=[o[0],"0,0",o[1]].join("")}if(!o||!~s[n].indexOf(o[0])){o=["translate(",") ","scale(",")"]}this.applyTransform.template=o}}if(n!==null&&(o[0]==="translate3d("||a===true)){if(a===true&&o[0]==="translate("){e-=r.x;t-=r.y;s.left=r.x+"px";s.top=r.y+"px"}s[n]=[o[0],e,"px,",t,"px",o[1],o[2],i,",",i,o[3]].join("")}else{s.left=e+"px";s.top=t+"px";if(n!==null){s[n]=""}}},CLASS_NAME:"OpenLayers.Map"});OpenLayers.Map.TILE_WIDTH=256;OpenLayers.Map.TILE_HEIGHT=256;OpenLayers.Feature=OpenLayers.Class({layer:null,id:null,lonlat:null,data:null,marker:null,popupClass:null,popup:null,initialize:function(e,t,i){this.layer=e;this.lonlat=t;this.data=i!=null?i:{};this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){if(this.layer!=null&&this.layer.map!=null){if(this.popup!=null){this.layer.map.removePopup(this.popup)}}if(this.layer!=null&&this.marker!=null){this.layer.removeMarker(this.marker)}this.layer=null;this.id=null;this.lonlat=null;this.data=null;if(this.marker!=null){this.destroyMarker(this.marker);this.marker=null}if(this.popup!=null){this.destroyPopup(this.popup);this.popup=null}},onScreen:function(){var e=false;if(this.layer!=null&&this.layer.map!=null){var t=this.layer.map.getExtent();e=t.containsLonLat(this.lonlat)}return e},createMarker:function(){if(this.lonlat!=null){this.marker=new OpenLayers.Marker(this.lonlat,this.data.icon)}return this.marker},destroyMarker:function(){this.marker.destroy()},createPopup:function(e){if(this.lonlat!=null){if(!this.popup){var t=this.marker?this.marker.icon:null;var i=this.popupClass?this.popupClass:OpenLayers.Popup.Anchored;this.popup=new i(this.id+"_popup",this.lonlat,this.data.popupSize,this.data.popupContentHTML,t,e)}if(this.data.overflow!=null){this.popup.contentDiv.style.overflow=this.data.overflow}this.popup.feature=this}return this.popup},destroyPopup:function(){if(this.popup){this.popup.feature=null;this.popup.destroy();this.popup=null}},CLASS_NAME:"OpenLayers.Feature"});OpenLayers.State={UNKNOWN:"Unknown",INSERT:"Insert",UPDATE:"Update",DELETE:"Delete"};OpenLayers.Feature.Vector=OpenLayers.Class(OpenLayers.Feature,{fid:null,geometry:null,attributes:null,bounds:null,state:null,style:null,url:null,renderIntent:"default",modified:null,initialize:function(e,t,i){OpenLayers.Feature.prototype.initialize.apply(this,[null,null,t]);this.lonlat=null;this.geometry=e?e:null;this.state=null;this.attributes={};if(t){this.attributes=OpenLayers.Util.extend(this.attributes,t)}this.style=i?i:null},destroy:function(){if(this.layer){this.layer.removeFeatures(this);this.layer=null}this.geometry=null;this.modified=null;OpenLayers.Feature.prototype.destroy.apply(this,arguments)},clone:function(){return new OpenLayers.Feature.Vector(this.geometry?this.geometry.clone():null,this.attributes,this.style)},onScreen:function(e){var t=false;if(this.layer&&this.layer.map){var i=this.layer.map.getExtent();if(e){var r=this.geometry.getBounds();t=i.intersectsBounds(r)}else{var a=i.toGeometry();t=a.intersects(this.geometry)}}return t},getVisibility:function(){return!(this.style&&this.style.display=="none"||!this.layer||this.layer&&this.layer.styleMap&&this.layer.styleMap.createSymbolizer(this,this.renderIntent).display=="none"||this.layer&&!this.layer.getVisibility())},createMarker:function(){return null},destroyMarker:function(){},createPopup:function(){return null},atPoint:function(e,t,i){var r=false;if(this.geometry){r=this.geometry.atPoint(e,t,i)}return r},destroyPopup:function(){},move:function(e){if(!this.layer||!this.geometry.move){return undefined}var t;if(e.CLASS_NAME=="OpenLayers.LonLat"){t=this.layer.getViewPortPxFromLonLat(e)}else{t=e}var i=this.layer.getViewPortPxFromLonLat(this.geometry.getBounds().getCenterLonLat());var r=this.layer.map.getResolution();this.geometry.move(r*(t.x-i.x),r*(i.y-t.y));this.layer.drawFeature(this);return i},toState:function(e){if(e==OpenLayers.State.UPDATE){switch(this.state){case OpenLayers.State.UNKNOWN:case OpenLayers.State.DELETE:this.state=e;break;case OpenLayers.State.UPDATE:case OpenLayers.State.INSERT:break}}else if(e==OpenLayers.State.INSERT){switch(this.state){case OpenLayers.State.UNKNOWN:break;default:this.state=e;break}}else if(e==OpenLayers.State.DELETE){switch(this.state){case OpenLayers.State.INSERT:break;case OpenLayers.State.DELETE:break;case OpenLayers.State.UNKNOWN:case OpenLayers.State.UPDATE:this.state=e;break}}else if(e==OpenLayers.State.UNKNOWN){this.state=e}},CLASS_NAME:"OpenLayers.Feature.Vector"});OpenLayers.Feature.Vector.style={default:{fillColor:"#ee9900",fillOpacity:.4,hoverFillColor:"white",hoverFillOpacity:.8,strokeColor:"#ee9900",strokeOpacity:1,strokeWidth:1,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"inherit",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},select:{fillColor:"blue",fillOpacity:.4,hoverFillColor:"white",hoverFillOpacity:.8,strokeColor:"blue",strokeOpacity:1,strokeWidth:2,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"pointer",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},temporary:{fillColor:"#66cccc",fillOpacity:.2,hoverFillColor:"white",hoverFillOpacity:.8,strokeColor:"#66cccc",strokeOpacity:1,strokeLinecap:"round",strokeWidth:2,strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"inherit",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},delete:{display:"none"}};OpenLayers.Style=OpenLayers.Class({id:null,name:null,title:null,description:null,layerName:null,isDefault:false,rules:null,context:null,defaultStyle:null,defaultsPerSymbolizer:false,propertyStyles:null,initialize:function(e,t){OpenLayers.Util.extend(this,t);this.rules=[];if(t&&t.rules){this.addRules(t.rules)}this.setDefaultStyle(e||OpenLayers.Feature.Vector.style["default"]);this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){for(var e=0,t=this.rules.length;e<t;e++){this.rules[e].destroy();this.rules[e]=null}this.rules=null;this.defaultStyle=null},createSymbolizer:function(e){var t=this.defaultsPerSymbolizer?{}:this.createLiterals(OpenLayers.Util.extend({},this.defaultStyle),e);var i=this.rules;var r,h;var a=[];var s=false;for(var n=0,o=i.length;n<o;n++){r=i[n];var l=r.evaluate(e);if(l){if(r instanceof OpenLayers.Rule&&r.elseFilter){a.push(r)}else{s=true;this.applySymbolizer(r,t,e)}}}if(s==false&&a.length>0){s=true;for(var n=0,o=a.length;n<o;n++){this.applySymbolizer(a[n],t,e)}}if(i.length>0&&s==false){t.display="none"}if(t.label!=null&&typeof t.label!=="string"){t.label=String(t.label)}return t},applySymbolizer:function(e,t,i){var r=i.geometry?this.getSymbolizerPrefix(i.geometry):OpenLayers.Style.SYMBOLIZER_PREFIXES[0];var a=e.symbolizer[r]||e.symbolizer;if(this.defaultsPerSymbolizer===true){var s=this.defaultStyle;OpenLayers.Util.applyDefaults(a,{pointRadius:s.pointRadius});if(a.stroke===true||a.graphic===true){OpenLayers.Util.applyDefaults(a,{strokeWidth:s.strokeWidth,strokeColor:s.strokeColor,strokeOpacity:s.strokeOpacity,strokeDashstyle:s.strokeDashstyle,strokeLinecap:s.strokeLinecap})}if(a.fill===true||a.graphic===true){OpenLayers.Util.applyDefaults(a,{fillColor:s.fillColor,fillOpacity:s.fillOpacity})}if(a.graphic===true){OpenLayers.Util.applyDefaults(a,{pointRadius:this.defaultStyle.pointRadius,externalGraphic:this.defaultStyle.externalGraphic,graphicName:this.defaultStyle.graphicName,graphicOpacity:this.defaultStyle.graphicOpacity,graphicWidth:this.defaultStyle.graphicWidth,graphicHeight:this.defaultStyle.graphicHeight,graphicXOffset:this.defaultStyle.graphicXOffset,graphicYOffset:this.defaultStyle.graphicYOffset})}}return this.createLiterals(OpenLayers.Util.extend(t,a),i)},createLiterals:function(e,t){var i=OpenLayers.Util.extend({},t.attributes||t.data);OpenLayers.Util.extend(i,this.context);for(var r in this.propertyStyles){e[r]=OpenLayers.Style.createLiteral(e[r],i,t,r)}return e},findPropertyStyles:function(){var e={};var t=this.defaultStyle;this.addPropertyStyles(e,t);var i=this.rules;var r,a;for(var s=0,n=i.length;s<n;s++){r=i[s].symbolizer;for(var o in r){a=r[o];if(typeof a=="object"){this.addPropertyStyles(e,a)}else{this.addPropertyStyles(e,r);break}}}return e},addPropertyStyles:function(e,t){var i;for(var r in t){i=t[r];if(typeof i=="string"&&i.match(/\$\{\w+\}/)){e[r]=true}}return e},addRules:function(e){Array.prototype.push.apply(this.rules,e);this.propertyStyles=this.findPropertyStyles()},setDefaultStyle:function(e){this.defaultStyle=e;this.propertyStyles=this.findPropertyStyles()},getSymbolizerPrefix:function(e){var t=OpenLayers.Style.SYMBOLIZER_PREFIXES;for(var i=0,r=t.length;i<r;i++){if(e.CLASS_NAME.indexOf(t[i])!=-1){return t[i]}}},clone:function(){var e=OpenLayers.Util.extend({},this);if(this.rules){e.rules=[];for(var t=0,i=this.rules.length;t<i;++t){e.rules.push(this.rules[t].clone())}}e.context=this.context&&OpenLayers.Util.extend({},this.context);var r=OpenLayers.Util.extend({},this.defaultStyle);return new OpenLayers.Style(r,e)},CLASS_NAME:"OpenLayers.Style"});OpenLayers.Style.createLiteral=function(e,t,i,r){if(typeof e=="string"&&e.indexOf("${")!=-1){e=OpenLayers.String.format(e,t,[i,r]);e=isNaN(e)||!e?e:parseFloat(e)}return e};OpenLayers.Style.SYMBOLIZER_PREFIXES=["Point","Line","Polygon","Text","Raster"];OpenLayers.Rule=OpenLayers.Class({id:null,name:null,title:null,description:null,context:null,filter:null,elseFilter:false,symbolizer:null,symbolizers:null,minScaleDenominator:null,maxScaleDenominator:null,initialize:function(e){this.symbolizer={};OpenLayers.Util.extend(this,e);if(this.symbolizers){delete this.symbolizer}this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){for(var e in this.symbolizer){this.symbolizer[e]=null}this.symbolizer=null;delete this.symbolizers},evaluate:function(e){var t=this.getContext(e);var i=true;if(this.minScaleDenominator||this.maxScaleDenominator){var r=e.layer.map.getScale()}if(this.minScaleDenominator){i=r>=OpenLayers.Style.createLiteral(this.minScaleDenominator,t)}if(i&&this.maxScaleDenominator){i=r<OpenLayers.Style.createLiteral(this.maxScaleDenominator,t)}if(i&&this.filter){if(this.filter.CLASS_NAME=="OpenLayers.Filter.FeatureId"){i=this.filter.evaluate(e)}else{i=this.filter.evaluate(t)}}return i},getContext:function(e){var t=this.context;if(!t){t=e.attributes||e.data}if(typeof this.context=="function"){t=this.context(e)}return t},clone:function(){var e=OpenLayers.Util.extend({},this);if(this.symbolizers){var t=this.symbolizers.length;e.symbolizers=new Array(t);for(var i=0;i<t;++i){e.symbolizers[i]=this.symbolizers[i].clone()}}else{e.symbolizer={};var r,a;for(var s in this.symbolizer){r=this.symbolizer[s];a=typeof r;if(a==="object"){e.symbolizer[s]=OpenLayers.Util.extend({},r)}else if(a==="string"){e.symbolizer[s]=r}}}e.filter=this.filter&&this.filter.clone();e.context=this.context&&OpenLayers.Util.extend({},this.context);return new OpenLayers.Rule(e)},CLASS_NAME:"OpenLayers.Rule"});OpenLayers.Symbolizer=OpenLayers.Class({zIndex:0,initialize:function(e){OpenLayers.Util.extend(this,e)},clone:function(){var e=OpenLayers.Util.getConstructor(this.CLASS_NAME);return new e(OpenLayers.Util.extend({},this))},CLASS_NAME:"OpenLayers.Symbolizer"});OpenLayers.Symbolizer.Point=OpenLayers.Class(OpenLayers.Symbolizer,{initialize:function(e){OpenLayers.Symbolizer.prototype.initialize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Symbolizer.Point"});OpenLayers.Symbolizer.Line=OpenLayers.Class(OpenLayers.Symbolizer,{initialize:function(e){OpenLayers.Symbolizer.prototype.initialize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Symbolizer.Line"});OpenLayers.Symbolizer.Polygon=OpenLayers.Class(OpenLayers.Symbolizer,{initialize:function(e){OpenLayers.Symbolizer.prototype.initialize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Symbolizer.Polygon"});OpenLayers.Symbolizer.Text=OpenLayers.Class(OpenLayers.Symbolizer,{initialize:function(e){OpenLayers.Symbolizer.prototype.initialize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Symbolizer.Text"});OpenLayers.Symbolizer.Raster=OpenLayers.Class(OpenLayers.Symbolizer,{initialize:function(e){OpenLayers.Symbolizer.prototype.initialize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Symbolizer.Raster"});OpenLayers.Style2=OpenLayers.Class({id:null,name:null,title:null,description:null,layerName:null,isDefault:false,rules:null,initialize:function(e){OpenLayers.Util.extend(this,e);this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){for(var e=0,t=this.rules.length;e<t;e++){this.rules[e].destroy()}delete this.rules},clone:function(){var e=OpenLayers.Util.extend({},this);if(this.rules){e.rules=[];for(var t=0,i=this.rules.length;t<i;++t){e.rules.push(this.rules[t].clone())}}return new OpenLayers.Style2(e)},CLASS_NAME:"OpenLayers.Style2"});OpenLayers.Format=OpenLayers.Class({options:null,externalProjection:null,internalProjection:null,data:null,keepData:false,initialize:function(e){OpenLayers.Util.extend(this,e);this.options=e},destroy:function(){},read:function(e){throw new Error("Read not implemented.")},write:function(e){throw new Error("Write not implemented.")},CLASS_NAME:"OpenLayers.Format"});OpenLayers.Format.XML=OpenLayers.Class(OpenLayers.Format,{namespaces:null,namespaceAlias:null,defaultPrefix:null,readers:{},writers:{},xmldom:null,initialize:function(e){if(window.ActiveXObject){this.xmldom=new ActiveXObject("Microsoft.XMLDOM")}OpenLayers.Format.prototype.initialize.apply(this,[e]);this.namespaces=OpenLayers.Util.extend({},this.namespaces);this.namespaceAlias={};for(var t in this.namespaces){this.namespaceAlias[this.namespaces[t]]=t}},destroy:function(){this.xmldom=null;OpenLayers.Format.prototype.destroy.apply(this,arguments)},setNamespace:function(e,t){this.namespaces[e]=t;this.namespaceAlias[t]=e},read:function(t){var e=t.indexOf("<");if(e>0){t=t.substring(e)}var i=OpenLayers.Util.Try(OpenLayers.Function.bind(function(){var e;if(window.ActiveXObject&&!this.xmldom){e=new ActiveXObject("Microsoft.XMLDOM")}else{e=this.xmldom}e.loadXML(t);return e},this),function(){return(new DOMParser).parseFromString(t,"text/xml")},function(){var e=new XMLHttpRequest;e.open("GET","data:"+"text/xml"+";charset=utf-8,"+encodeURIComponent(t),false);if(e.overrideMimeType){e.overrideMimeType("text/xml")}e.send(null);return e.responseXML});if(this.keepData){this.data=i}return i},write:function(e){var t;if(this.xmldom){t=e.xml}else{var i=new XMLSerializer;if(e.nodeType==1){var r=document.implementation.createDocument("","",null);if(r.importNode){e=r.importNode(e,true)}r.appendChild(e);t=i.serializeToString(r)}else{t=i.serializeToString(e)}}return t},createElementNS:function(e,t){var i;if(this.xmldom){if(typeof e=="string"){i=this.xmldom.createNode(1,t,e)}else{i=this.xmldom.createNode(1,t,"")}}else{i=document.createElementNS(e,t)}return i},createDocumentFragment:function(){var e;if(this.xmldom){e=this.xmldom.createDocumentFragment()}else{e=document.createDocumentFragment()}return e},createTextNode:function(e){var t;if(typeof e!=="string"){e=String(e)}if(this.xmldom){t=this.xmldom.createTextNode(e)}else{t=document.createTextNode(e)}return t},getElementsByTagNameNS:function(e,t,i){var r=[];if(e.getElementsByTagNameNS){r=e.getElementsByTagNameNS(t,i)}else{var a=e.getElementsByTagName("*");var s,n;for(var o=0,l=a.length;o<l;++o){s=a[o];n=s.prefix?s.prefix+":"+i:i;if(i=="*"||n==s.nodeName){if(t=="*"||t==s.namespaceURI){r.push(s)}}}}return r},getAttributeNodeNS:function(e,t,i){var r=null;if(e.getAttributeNodeNS){r=e.getAttributeNodeNS(t,i)}else{var a=e.attributes;var s,n;for(var o=0,l=a.length;o<l;++o){s=a[o];if(s.namespaceURI==t){n=s.prefix?s.prefix+":"+i:i;if(n==s.nodeName){r=s;break}}}}return r},getAttributeNS:function(e,t,i){var r="";if(e.getAttributeNS){r=e.getAttributeNS(t,i)||""}else{var a=this.getAttributeNodeNS(e,t,i);if(a){r=a.nodeValue}}return r},getChildValue:function(e,t){var i=t||"";if(e){for(var r=e.firstChild;r;r=r.nextSibling){switch(r.nodeType){case 3:case 4:i+=r.nodeValue}}}return i},isSimpleContent:function(e){var t=true;for(var i=e.firstChild;i;i=i.nextSibling){if(i.nodeType===1){t=false;break}}return t},contentType:function(e){var t=false,i=false;var r=OpenLayers.Format.XML.CONTENT_TYPE.EMPTY;for(var a=e.firstChild;a;a=a.nextSibling){switch(a.nodeType){case 1:i=true;break;case 8:break;default:t=true}if(i&&t){break}}if(i&&t){r=OpenLayers.Format.XML.CONTENT_TYPE.MIXED}else if(i){return OpenLayers.Format.XML.CONTENT_TYPE.COMPLEX}else if(t){return OpenLayers.Format.XML.CONTENT_TYPE.SIMPLE}return r},hasAttributeNS:function(e,t,i){var r=false;if(e.hasAttributeNS){r=e.hasAttributeNS(t,i)}else{r=!!this.getAttributeNodeNS(e,t,i)}return r},setAttributeNS:function(e,t,i,r){if(e.setAttributeNS){e.setAttributeNS(t,i,r)}else{if(this.xmldom){if(t){var a=e.ownerDocument.createNode(2,i,t);a.nodeValue=r;e.setAttributeNode(a)}else{e.setAttribute(i,r)}}else{throw"setAttributeNS not implemented"}}},createElementNSPlus:function(e,t){t=t||{};var i=t.uri||this.namespaces[t.prefix];if(!i){var r=e.indexOf(":");i=this.namespaces[e.substring(0,r)]}if(!i){i=this.namespaces[this.defaultPrefix]}var a=this.createElementNS(i,e);if(t.attributes){this.setAttributes(a,t.attributes)}var s=t.value;if(s!=null){a.appendChild(this.createTextNode(s))}return a},setAttributes:function(e,t){var i,r;for(var a in t){if(t[a]!=null&&t[a].toString){i=t[a].toString();r=this.namespaces[a.substring(0,a.indexOf(":"))]||null;this.setAttributeNS(e,r,a,i)}}},readNode:function(e,t){if(!t){t={}}var i=this.readers[e.namespaceURI?this.namespaceAlias[e.namespaceURI]:this.defaultPrefix];if(i){var r=e.localName||e.nodeName.split(":").pop();var a=i[r]||i["*"];if(a){a.apply(this,[e,t])}}return t},readChildNodes:function(e,t){if(!t){t={}}var i=e.childNodes;var r;for(var a=0,s=i.length;a<s;++a){r=i[a];if(r.nodeType==1){this.readNode(r,t)}}return t},writeNode:function(e,t,i){var r,a;var s=e.indexOf(":");if(s>0){r=e.substring(0,s);a=e.substring(s+1)}else{if(i){r=this.namespaceAlias[i.namespaceURI]}else{r=this.defaultPrefix}a=e}var n=this.writers[r][a].apply(this,[t]);if(i){i.appendChild(n)}return n},getChildEl:function(e,t,i){return e&&this.getThisOrNextEl(e.firstChild,t,i)},getNextEl:function(e,t,i){return e&&this.getThisOrNextEl(e.nextSibling,t,i)},getThisOrNextEl:function(e,t,i){e:for(var r=e;r;r=r.nextSibling){switch(r.nodeType){case 1:if((!t||t===(r.localName||r.nodeName.split(":").pop()))&&(!i||i===r.namespaceURI)){break e}r=null;break e;case 3:if(/^\s*$/.test(r.nodeValue)){break}case 4:case 6:case 12:case 10:case 11:r=null;break e}}return r||null},lookupNamespaceURI:function(e,t){var i=null;if(e){if(e.lookupNamespaceURI){i=e.lookupNamespaceURI(t)}else{e:switch(e.nodeType){case 1:if(e.namespaceURI!==null&&e.prefix===t){i=e.namespaceURI;break e}var r=e.attributes.length;if(r){var a;for(var s=0;s<r;++s){a=e.attributes[s];if(a.prefix==="xmlns"&&a.name==="xmlns:"+t){i=a.value||null;break e}else if(a.name==="xmlns"&&t===null){i=a.value||null;break e}}}i=this.lookupNamespaceURI(e.parentNode,t);break e;case 2:i=this.lookupNamespaceURI(e.ownerElement,t);break e;case 9:i=this.lookupNamespaceURI(e.documentElement,t);break e;case 6:case 12:case 10:case 11:break e;default:i=this.lookupNamespaceURI(e.parentNode,t);break e}}}return i},getXMLDoc:function(){if(!OpenLayers.Format.XML.document&&!this.xmldom){if(document.implementation&&document.implementation.createDocument){OpenLayers.Format.XML.document=document.implementation.createDocument("","",null)}else if(!this.xmldom&&window.ActiveXObject){this.xmldom=new ActiveXObject("Microsoft.XMLDOM")}}return OpenLayers.Format.XML.document||this.xmldom},CLASS_NAME:"OpenLayers.Format.XML"});OpenLayers.Format.XML.CONTENT_TYPE={EMPTY:0,SIMPLE:1,COMPLEX:2,MIXED:3};OpenLayers.Format.XML.lookupNamespaceURI=OpenLayers.Function.bind(OpenLayers.Format.XML.prototype.lookupNamespaceURI,OpenLayers.Format.XML.prototype);OpenLayers.Format.XML.document=null;OpenLayers.Geometry=OpenLayers.Class({id:null,parent:null,bounds:null,initialize:function(){this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){this.id=null;this.bounds=null},clone:function(){return new OpenLayers.Geometry},setBounds:function(e){if(e){this.bounds=e.clone()}},clearBounds:function(){this.bounds=null;if(this.parent){this.parent.clearBounds()}},extendBounds:function(e){var t=this.getBounds();if(!t){this.setBounds(e)}else{this.bounds.extend(e)}},getBounds:function(){if(this.bounds==null){this.calculateBounds()}return this.bounds},calculateBounds:function(){},distanceTo:function(e,t){},getVertices:function(e){},atPoint:function(e,t,i){var r=false;var a=this.getBounds();if(a!=null&&e!=null){var s=t!=null?t:0;var n=i!=null?i:0;var o=new OpenLayers.Bounds(this.bounds.left-s,this.bounds.bottom-n,this.bounds.right+s,this.bounds.top+n);r=o.containsLonLat(e)}return r},getLength:function(){return 0},getArea:function(){return 0},getCentroid:function(){return null},toString:function(){var e;if(OpenLayers.Format&&OpenLayers.Format.WKT){e=OpenLayers.Format.WKT.prototype.write(new OpenLayers.Feature.Vector(this))}else{e=Object.prototype.toString.call(this)}return e},CLASS_NAME:"OpenLayers.Geometry"});OpenLayers.Geometry.fromWKT=function(e){var t;if(OpenLayers.Format&&OpenLayers.Format.WKT){var i=OpenLayers.Geometry.fromWKT.format;if(!i){i=new OpenLayers.Format.WKT;OpenLayers.Geometry.fromWKT.format=i}var r=i.read(e);if(r instanceof OpenLayers.Feature.Vector){t=r.geometry}else if(OpenLayers.Util.isArray(r)){var a=r.length;var s=new Array(a);for(var n=0;n<a;++n){s[n]=r[n].geometry}t=new OpenLayers.Geometry.Collection(s)}}return t};OpenLayers.Geometry.segmentsIntersect=function(e,t,i){var p=i&&i.point;var u=i&&i.tolerance;var r=false;var c=e.x1-t.x1;var d=e.y1-t.y1;var f=e.x2-e.x1;var y=e.y2-e.y1;var g=t.y2-t.y1;var m=t.x2-t.x1;var v=g*f-m*y;var x=m*d-g*c;var L=f*d-y*c;if(v==0){if(x==0&&L==0){r=true}}else{var a=x/v;var b=L/v;if(a>=0&&a<=1&&b>=0&&b<=1){if(!p){r=true}else{var s=e.x1+a*f;var n=e.y1+a*y;r=new OpenLayers.Geometry.Point(s,n)}}}if(u){var E;if(r){if(p){var S=[e,t];var O,s,n;e:for(var o=0;o<2;++o){O=S[o];for(var l=1;l<3;++l){s=O["x"+l];n=O["y"+l];E=Math.sqrt(Math.pow(s-r.x,2)+Math.pow(n-r.y,2));if(E<u){r.x=s;r.y=n;break e}}}}}else{var S=[e,t];var C,w,s,n,h,T;e:for(var o=0;o<2;++o){C=S[o];w=S[(o+1)%2];for(var l=1;l<3;++l){h={x:C["x"+l],y:C["y"+l]};T=OpenLayers.Geometry.distanceToSegment(h,w);if(T.distance<u){if(p){r=new OpenLayers.Geometry.Point(h.x,h.y)}else{r=true}break e}}}}}return r};OpenLayers.Geometry.distanceToSegment=function(e,t){var i=OpenLayers.Geometry.distanceSquaredToSegment(e,t);i.distance=Math.sqrt(i.distance);return i};OpenLayers.Geometry.distanceSquaredToSegment=function(e,t){var i=e.x;var p=e.y;var r=t.x1;var a=t.y1;var u=t.x2;var c=t.y2;var s=u-r;var n=c-a;var o=(s*(i-r)+n*(p-a))/(Math.pow(s,2)+Math.pow(n,2));var l,h;if(o<=0){l=r;h=a}else if(o>=1){l=u;h=c}else{l=r+o*s;h=a+o*n}return{distance:Math.pow(l-i,2)+Math.pow(h-p,2),x:l,y:h,along:o}};OpenLayers.Geometry.Point=OpenLayers.Class(OpenLayers.Geometry,{x:null,y:null,initialize:function(e,t){OpenLayers.Geometry.prototype.initialize.apply(this,arguments);this.x=parseFloat(e);this.y=parseFloat(t)},clone:function(e){if(e==null){e=new OpenLayers.Geometry.Point(this.x,this.y)}OpenLayers.Util.applyDefaults(e,this);return e},calculateBounds:function(){this.bounds=new OpenLayers.Bounds(this.x,this.y,this.x,this.y)},distanceTo:function(e,t){var i=!(t&&t.edge===false);var r=i&&t&&t.details;var a,s,n,o,l,h;if(e instanceof OpenLayers.Geometry.Point){s=this.x;n=this.y;o=e.x;l=e.y;a=Math.sqrt(Math.pow(s-o,2)+Math.pow(n-l,2));h=!r?a:{x0:s,y0:n,x1:o,y1:l,distance:a}}else{h=e.distanceTo(this,t);if(r){h={x0:h.x1,y0:h.y1,x1:h.x0,y1:h.y0,distance:h.distance}}}return h},equals:function(e){var t=false;if(e!=null){t=this.x==e.x&&this.y==e.y||isNaN(this.x)&&isNaN(this.y)&&isNaN(e.x)&&isNaN(e.y)}return t},toShortString:function(){return this.x+", "+this.y},move:function(e,t){this.x=this.x+e;this.y=this.y+t;this.clearBounds()},rotate:function(e,t){e*=Math.PI/180;var i=this.distanceTo(t);var r=e+Math.atan2(this.y-t.y,this.x-t.x);this.x=t.x+i*Math.cos(r);this.y=t.y+i*Math.sin(r);this.clearBounds()},getCentroid:function(){return new OpenLayers.Geometry.Point(this.x,this.y)},resize:function(e,t,i){i=i==undefined?1:i;this.x=t.x+e*i*(this.x-t.x);this.y=t.y+e*(this.y-t.y);this.clearBounds();return this},intersects:function(e){var t=false;if(e.CLASS_NAME=="OpenLayers.Geometry.Point"){t=this.equals(e)}else{t=e.intersects(this)}return t},transform:function(e,t){if(e&&t){OpenLayers.Projection.transform(this,e,t);this.bounds=null}return this},getVertices:function(e){return[this]},CLASS_NAME:"OpenLayers.Geometry.Point"});OpenLayers.Geometry.Collection=OpenLayers.Class(OpenLayers.Geometry,{components:null,componentTypes:null,initialize:function(e){OpenLayers.Geometry.prototype.initialize.apply(this,arguments);this.components=[];if(e!=null){this.addComponents(e)}},destroy:function(){this.components.length=0;this.components=null;OpenLayers.Geometry.prototype.destroy.apply(this,arguments)},clone:function(){var e=OpenLayers.Util.getConstructor(this.CLASS_NAME);var t=new e;for(var i=0,r=this.components.length;i<r;i++){t.addComponent(this.components[i].clone())}OpenLayers.Util.applyDefaults(t,this);return t},getComponentsString:function(){var e=[];for(var t=0,i=this.components.length;t<i;t++){e.push(this.components[t].toShortString())}return e.join(",")},calculateBounds:function(){this.bounds=null;var e=new OpenLayers.Bounds;var t=this.components;if(t){for(var i=0,r=t.length;i<r;i++){e.extend(t[i].getBounds())}}if(e.left!=null&&e.bottom!=null&&e.right!=null&&e.top!=null){this.setBounds(e)}},addComponents:function(e){if(!OpenLayers.Util.isArray(e)){e=[e]}for(var t=0,i=e.length;t<i;t++){this.addComponent(e[t])}},addComponent:function(e,t){var i=false;if(e){if(this.componentTypes==null||OpenLayers.Util.indexOf(this.componentTypes,e.CLASS_NAME)>-1){if(t!=null&&t<this.components.length){var r=this.components.slice(0,t);var a=this.components.slice(t,this.components.length);r.push(e);this.components=r.concat(a)}else{this.components.push(e)}e.parent=this;this.clearBounds();i=true}}return i},removeComponents:function(e){var t=false;if(!OpenLayers.Util.isArray(e)){e=[e]}for(var i=e.length-1;i>=0;--i){t=this.removeComponent(e[i])||t}return t},removeComponent:function(e){OpenLayers.Util.removeItem(this.components,e);this.clearBounds();return true},getLength:function(){var e=0;for(var t=0,i=this.components.length;t<i;t++){e+=this.components[t].getLength()}return e},getArea:function(){var e=0;for(var t=0,i=this.components.length;t<i;t++){e+=this.components[t].getArea()}return e},getGeodesicArea:function(e){var t=0;for(var i=0,r=this.components.length;i<r;i++){t+=this.components[i].getGeodesicArea(e)}return t},getCentroid:function(p){if(!p){return this.components.length&&this.components[0].getCentroid()}var e=this.components.length;if(!e){return false}var t=[];var i=[];var r=0;var a=Number.MAX_VALUE;var s;for(var n=0;n<e;++n){s=this.components[n];var o=s.getArea();var l=s.getCentroid(true);if(isNaN(o)||isNaN(l.x)||isNaN(l.y)){continue}t.push(o);r+=o;a=o<a&&o>0?o:a;i.push(l)}e=t.length;if(r===0){for(var n=0;n<e;++n){t[n]=1}r=t.length}else{for(var n=0;n<e;++n){t[n]/=a}r/=a}var h=0,u=0,l,o;for(var n=0;n<e;++n){l=i[n];o=t[n];h+=l.x*o;u+=l.y*o}return new OpenLayers.Geometry.Point(h/r,u/r)},getGeodesicLength:function(e){var t=0;for(var i=0,r=this.components.length;i<r;i++){t+=this.components[i].getGeodesicLength(e)}return t},move:function(e,t){for(var i=0,r=this.components.length;i<r;i++){this.components[i].move(e,t)}},rotate:function(e,t){for(var i=0,r=this.components.length;i<r;++i){this.components[i].rotate(e,t)}},resize:function(e,t,i){for(var r=0;r<this.components.length;++r){this.components[r].resize(e,t,i)}return this},distanceTo:function(e,t){var i=!(t&&t.edge===false);var r=i&&t&&t.details;var a,s,n;var o=Number.POSITIVE_INFINITY;for(var l=0,h=this.components.length;l<h;++l){a=this.components[l].distanceTo(e,t);n=r?a.distance:a;if(n<o){o=n;s=a;if(o==0){break}}}return s},equals:function(e){var t=true;if(!e||!e.CLASS_NAME||this.CLASS_NAME!=e.CLASS_NAME){t=false}else if(!OpenLayers.Util.isArray(e.components)||e.components.length!=this.components.length){t=false}else{for(var i=0,r=this.components.length;i<r;++i){if(!this.components[i].equals(e.components[i])){t=false;break}}}return t},transform:function(e,t){if(e&&t){for(var i=0,r=this.components.length;i<r;i++){var a=this.components[i];a.transform(e,t)}this.bounds=null}return this},intersects:function(e){var t=false;for(var i=0,r=this.components.length;i<r;++i){t=e.intersects(this.components[i]);if(t){break}}return t},getVertices:function(e){var t=[];for(var i=0,r=this.components.length;i<r;++i){Array.prototype.push.apply(t,this.components[i].getVertices(e))}return t},CLASS_NAME:"OpenLayers.Geometry.Collection"});OpenLayers.Geometry.MultiPoint=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.Point"],addPoint:function(e,t){this.addComponent(e,t)},removePoint:function(e){this.removeComponent(e)},CLASS_NAME:"OpenLayers.Geometry.MultiPoint"});OpenLayers.Geometry.Curve=OpenLayers.Class(OpenLayers.Geometry.MultiPoint,{componentTypes:["OpenLayers.Geometry.Point"],getLength:function(){var e=0;if(this.components&&this.components.length>1){for(var t=1,i=this.components.length;t<i;t++){e+=this.components[t-1].distanceTo(this.components[t])}}return e},getGeodesicLength:function(e){var t=this;if(e){var i=new OpenLayers.Projection("EPSG:4326");if(!i.equals(e)){t=this.clone().transform(e,i)}}var r=0;if(t.components&&t.components.length>1){var a,s;for(var n=1,o=t.components.length;n<o;n++){a=t.components[n-1];s=t.components[n];r+=OpenLayers.Util.distVincenty({lon:a.x,lat:a.y},{lon:s.x,lat:s.y})}}return r*1e3},CLASS_NAME:"OpenLayers.Geometry.Curve"});OpenLayers.Geometry.LineString=OpenLayers.Class(OpenLayers.Geometry.Curve,{removeComponent:function(e){var t=this.components&&this.components.length>2;if(t){OpenLayers.Geometry.Collection.prototype.removeComponent.apply(this,arguments)}return t},intersects:function(e){var t=false;var i=e.CLASS_NAME;if(i=="OpenLayers.Geometry.LineString"||i=="OpenLayers.Geometry.LinearRing"||i=="OpenLayers.Geometry.Point"){var p=this.getSortedSegments();var r;if(i=="OpenLayers.Geometry.Point"){r=[{x1:e.x,y1:e.y,x2:e.x,y2:e.y}]}else{r=e.getSortedSegments()}var a,u,c,s,n,o,l,h;e:for(var d=0,f=p.length;d<f;++d){a=p[d];u=a.x1;c=a.x2;s=a.y1;n=a.y2;t:for(var y=0,g=r.length;y<g;++y){o=r[y];if(o.x1>c){break}if(o.x2<u){continue}l=o.y1;h=o.y2;if(Math.min(l,h)>Math.max(s,n)){continue}if(Math.max(l,h)<Math.min(s,n)){continue}if(OpenLayers.Geometry.segmentsIntersect(a,o)){t=true;break e}}}}else{t=e.intersects(this)}return t},getSortedSegments:function(){var e=this.components.length-1;var t=new Array(e),i,r;for(var a=0;a<e;++a){i=this.components[a];r=this.components[a+1];if(i.x<r.x){t[a]={x1:i.x,y1:i.y,x2:r.x,y2:r.y}}else{t[a]={x1:r.x,y1:r.y,x2:i.x,y2:i.y}}}function s(e,t){return e.x1-t.x1}return t.sort(s)},splitWithSegment:function(e,t){var p=!(t&&t.edge===false);var u=t&&t.tolerance;var i=[];var r=this.getVertices();var a=[];var s=[];var c=false;var n,o,l;var d,f,y;var g={point:true,tolerance:u};var m=null;for(var h=0,v=r.length-2;h<=v;++h){n=r[h];a.push(n.clone());o=r[h+1];y={x1:n.x,y1:n.y,x2:o.x,y2:o.y};l=OpenLayers.Geometry.segmentsIntersect(e,y,g);if(l instanceof OpenLayers.Geometry.Point){if(l.x===e.x1&&l.y===e.y1||l.x===e.x2&&l.y===e.y2||l.equals(n)||l.equals(o)){f=true}else{f=false}if(f||p){if(!l.equals(s[s.length-1])){s.push(l.clone())}if(h===0){if(l.equals(n)){continue}}if(l.equals(o)){continue}c=true;if(!l.equals(n)){a.push(l)}i.push(new OpenLayers.Geometry.LineString(a));a=[l.clone()]}}}if(c){a.push(o.clone());i.push(new OpenLayers.Geometry.LineString(a))}if(s.length>0){var x=e.x1<e.x2?1:-1;var L=e.y1<e.y2?1:-1;m={lines:i,points:s.sort(function(e,t){return x*e.x-x*t.x||L*e.y-L*t.y})}}return m},split:function(p,e){var u=null;var c=e&&e.mutual;var d,f,t,i;if(p instanceof OpenLayers.Geometry.LineString){var y=this.getVertices();var r,a,g,s,n,o;var l=[];t=[];for(var m=0,v=y.length-2;m<=v;++m){r=y[m];a=y[m+1];g={x1:r.x,y1:r.y,x2:a.x,y2:a.y};i=i||[p];if(c){l.push(r.clone())}for(var h=0;h<i.length;++h){s=i[h].splitWithSegment(g,e);if(s){n=s.lines;if(n.length>0){n.unshift(h,1);Array.prototype.splice.apply(i,n);h+=n.length-2}if(c){for(var x=0,L=s.points.length;x<L;++x){o=s.points[x];if(!o.equals(r)){l.push(o);t.push(new OpenLayers.Geometry.LineString(l));if(o.equals(a)){l=[]}else{l=[o.clone()]}}}}}}}if(c&&t.length>0&&l.length>0){l.push(a.clone());t.push(new OpenLayers.Geometry.LineString(l))}}else{u=p.splitWith(this,e)}if(i&&i.length>1){f=true}else{i=[]}if(t&&t.length>1){d=true}else{t=[]}if(f||d){if(c){u=[t,i]}else{u=i}}return u},splitWith:function(e,t){return e.split(this,t)},getVertices:function(e){var t;if(e===true){t=[this.components[0],this.components[this.components.length-1]]}else if(e===false){t=this.components.slice(1,this.components.length-1)}else{t=this.components.slice()}return t},distanceTo:function(e,t){var p=!(t&&t.edge===false);var i=p&&t&&t.details;var r,a={};var s=Number.POSITIVE_INFINITY;if(e instanceof OpenLayers.Geometry.Point){var u=this.getSortedSegments();var c=e.x;var d=e.y;var n;for(var o=0,f=u.length;o<f;++o){n=u[o];r=OpenLayers.Geometry.distanceToSegment(e,n);if(r.distance<s){s=r.distance;a=r;if(s===0){break}}else{if(n.x2>c&&(d>n.y1&&d<n.y2||d<n.y1&&d>n.y2)){break}}}if(i){a={distance:a.distance,x0:a.x,y0:a.y,x1:c,y1:d}}else{a=a.distance}}else if(e instanceof OpenLayers.Geometry.LineString){var y=this.getSortedSegments();var g=e.getSortedSegments();var l,m,h,v,x;var L=g.length;var b={point:true};e:for(var o=0,f=y.length;o<f;++o){l=y[o];v=l.x1;x=l.y1;for(var E=0;E<L;++E){m=g[E];h=OpenLayers.Geometry.segmentsIntersect(l,m,b);if(h){s=0;a={distance:0,x0:h.x,y0:h.y,x1:h.x,y1:h.y};break e}else{r=OpenLayers.Geometry.distanceToSegment({x:v,y:x},m);if(r.distance<s){s=r.distance;a={distance:s,x0:v,y0:x,x1:r.x,y1:r.y}}}}}if(!i){a=a.distance}if(s!==0){if(l){r=e.distanceTo(new OpenLayers.Geometry.Point(l.x2,l.y2),t);var S=i?r.distance:r;if(S<s){if(i){a={distance:s,x0:r.x1,y0:r.y1,x1:r.x0,y1:r.y0}}else{a=S}}}}}else{a=e.distanceTo(this,t);if(i){a={distance:a.distance,x0:a.x1,y0:a.y1,x1:a.x0,y1:a.y0}}}return a},simplify:function(e){if(this&&this!==null){var t=this.getVertices();if(t.length<3){return this}var i=function(e,t){return e-t};var l=function(e,t,i,r){var a=0;var s=0;for(var n=t,o;n<i;n++){o=h(e[t],e[i],e[n]);if(o>a){a=o;s=n}}if(a>r&&s!=t){p.push(s);l(e,t,s,r);l(e,s,i,r)}};var h=function(e,t,i){var r=Math.abs(.5*(e.x*t.y+t.x*i.y+i.x*e.y-t.x*e.y-i.x*t.y-e.x*i.y));var a=Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2));var s=r/a*2;return s};var r=0;var a=t.length-1;var p=[];p.push(r);p.push(a);while(t[r].equals(t[a])){a--;p.push(a)}l(t,r,a,e);var s=[];p.sort(i);for(var n=0;n<p.length;n++){s.push(t[p[n]])}return new OpenLayers.Geometry.LineString(s)}else{return this}},CLASS_NAME:"OpenLayers.Geometry.LineString"});OpenLayers.Geometry.MultiLineString=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.LineString"],split:function(p,e){var t=null;var u=e&&e.mutual;var i,r,a,s,c;var n=[];var o=[p];for(var d=0,f=this.components.length;d<f;++d){r=this.components[d];s=false;for(var l=0;l<o.length;++l){i=r.split(o[l],e);if(i){if(u){a=i[0];for(var h=0,y=a.length;h<y;++h){if(h===0&&n.length){n[n.length-1].addComponent(a[h])}else{n.push(new OpenLayers.Geometry.MultiLineString([a[h]]))}}s=true;i=i[1]}if(i.length){i.unshift(l,1);Array.prototype.splice.apply(o,i);break}}}if(!s){if(n.length){n[n.length-1].addComponent(r.clone())}else{n=[new OpenLayers.Geometry.MultiLineString(r.clone())]}}}if(n&&n.length>1){s=true}else{n=[]}if(o&&o.length>1){c=true}else{o=[]}if(s||c){if(u){t=[n,o]}else{t=o}}return t},splitWith:function(e,p){var t=null;var u=p&&p.mutual;var i,r,a,c,s,n,o;if(e instanceof OpenLayers.Geometry.LineString){o=[];n=[e];for(var d=0,f=this.components.length;d<f;++d){s=false;r=this.components[d];for(var l=0;l<n.length;++l){i=n[l].split(r,p);if(i){if(u){a=i[0];if(a.length){a.unshift(l,1);Array.prototype.splice.apply(n,a);l+=a.length-2}i=i[1];if(i.length===0){i=[r.clone()]}}for(var h=0,y=i.length;h<y;++h){if(h===0&&o.length){o[o.length-1].addComponent(i[h])}else{o.push(new OpenLayers.Geometry.MultiLineString([i[h]]))}}s=true}}if(!s){if(o.length){o[o.length-1].addComponent(r.clone())}else{o=[new OpenLayers.Geometry.MultiLineString([r.clone()])]}}}}else{t=e.split(this)}if(n&&n.length>1){c=true}else{n=[]}if(o&&o.length>1){s=true}else{o=[]}if(c||s){if(u){t=[n,o]}else{t=o}}return t},CLASS_NAME:"OpenLayers.Geometry.MultiLineString"});OpenLayers.Geometry.LinearRing=OpenLayers.Class(OpenLayers.Geometry.LineString,{componentTypes:["OpenLayers.Geometry.Point"],addComponent:function(e,t){var i=false;var r=this.components.pop();if(t!=null||!e.equals(r)){i=OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,arguments)}var a=this.components[0];OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,[a]);return i},removeComponent:function(e){var t=this.components&&this.components.length>3;if(t){this.components.pop();OpenLayers.Geometry.Collection.prototype.removeComponent.apply(this,arguments);var i=this.components[0];OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,[i])}return t},move:function(e,t){for(var i=0,r=this.components.length;i<r-1;i++){this.components[i].move(e,t)}},rotate:function(e,t){for(var i=0,r=this.components.length;i<r-1;++i){this.components[i].rotate(e,t)}},resize:function(e,t,i){for(var r=0,a=this.components.length;r<a-1;++r){this.components[r].resize(e,t,i)}return this},transform:function(e,t){if(e&&t){for(var i=0,r=this.components.length;i<r-1;i++){var a=this.components[i];a.transform(e,t)}this.bounds=null}return this},getCentroid:function(){if(this.components){var e=this.components.length;if(e>0&&e<=2){return this.components[0].clone()}else if(e>2){var t=0;var i=0;var r=this.components[0].x;var a=this.components[0].y;var s=-1*this.getArea();if(s!=0){for(var n=0;n<e-1;n++){var o=this.components[n];var l=this.components[n+1];t+=(o.x+l.x-2*r)*((o.x-r)*(l.y-a)-(l.x-r)*(o.y-a));i+=(o.y+l.y-2*a)*((o.x-r)*(l.y-a)-(l.x-r)*(o.y-a))}var h=r+t/(6*s);var p=a+i/(6*s)}else{for(var n=0;n<e-1;n++){t+=this.components[n].x;i+=this.components[n].y}var h=t/(e-1);var p=i/(e-1)}return new OpenLayers.Geometry.Point(h,p)}else{return null}}},getArea:function(){var e=0;if(this.components&&this.components.length>2){var t=0;for(var i=0,r=this.components.length;i<r-1;i++){var a=this.components[i];var s=this.components[i+1];t+=(a.x+s.x)*(s.y-a.y)}e=-t/2}return e},getGeodesicArea:function(e){var t=this;if(e){var i=new OpenLayers.Projection("EPSG:4326");if(!i.equals(e)){t=this.clone().transform(e,i)}}var r=0;var a=t.components&&t.components.length;if(a>2){var s,n;for(var o=0;o<a-1;o++){s=t.components[o];n=t.components[o+1];r+=OpenLayers.Util.rad(n.x-s.x)*(2+Math.sin(OpenLayers.Util.rad(s.y))+Math.sin(OpenLayers.Util.rad(n.y)))}r=r*6378137*6378137/2}return r},containsPoint:function(p){var e=OpenLayers.Number.limitSigDigs;var t=14;var i=e(p.x,t);var r=e(p.y,t);function u(e,t,i,r,a){return(e-a)*((r-t)/(a-i))+r}var c=this.components.length-1;var d,f,a,s,n,o,l,y;var h=0;for(var g=0;g<c;++g){d=this.components[g];a=e(d.x,t);s=e(d.y,t);f=this.components[g+1];n=e(f.x,t);o=e(f.y,t);if(s==o){if(r==s){if(a<=n&&(i>=a&&i<=n)||a>=n&&(i<=a&&i>=n)){h=-1;break}}continue}l=e(u(r,a,s,n,o),t);if(l==i){if(s<o&&(r>=s&&r<=o)||s>o&&(r<=s&&r>=o)){h=-1;break}}if(l<=i){continue}if(a!=n&&(l<Math.min(a,n)||l>Math.max(a,n))){continue}if(s<o&&(r>=s&&r<o)||s>o&&(r<s&&r>=o)){++h}}var m=h==-1?1:!!(h&1);return m},intersects:function(e){var t=false;if(e.CLASS_NAME=="OpenLayers.Geometry.Point"){t=this.containsPoint(e)}else if(e.CLASS_NAME=="OpenLayers.Geometry.LineString"){t=e.intersects(this)}else if(e.CLASS_NAME=="OpenLayers.Geometry.LinearRing"){t=OpenLayers.Geometry.LineString.prototype.intersects.apply(this,[e])}else{for(var i=0,r=e.components.length;i<r;++i){t=e.components[i].intersects(this);if(t){break}}}return t},getVertices:function(e){return e===true?[]:this.components.slice(0,this.components.length-1)},CLASS_NAME:"OpenLayers.Geometry.LinearRing"});OpenLayers.Geometry.Polygon=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.LinearRing"],getArea:function(){var e=0;if(this.components&&this.components.length>0){e+=Math.abs(this.components[0].getArea());for(var t=1,i=this.components.length;t<i;t++){e-=Math.abs(this.components[t].getArea())}}return e},getGeodesicArea:function(e){var t=0;if(this.components&&this.components.length>0){t+=Math.abs(this.components[0].getGeodesicArea(e));for(var i=1,r=this.components.length;i<r;i++){t-=Math.abs(this.components[i].getGeodesicArea(e))}}return t},containsPoint:function(e){var t=this.components.length;var i=false;if(t>0){i=this.components[0].containsPoint(e);if(i!==1){if(i&&t>1){var r;for(var a=1;a<t;++a){r=this.components[a].containsPoint(e);if(r){if(r===1){i=1}else{i=false}break}}}}}return i},intersects:function(e){var t=false;var i,r;if(e.CLASS_NAME=="OpenLayers.Geometry.Point"){t=this.containsPoint(e)}else if(e.CLASS_NAME=="OpenLayers.Geometry.LineString"||e.CLASS_NAME=="OpenLayers.Geometry.LinearRing"){for(i=0,r=this.components.length;i<r;++i){t=e.intersects(this.components[i]);if(t){break}}if(!t){for(i=0,r=e.components.length;i<r;++i){t=this.containsPoint(e.components[i]);if(t){break}}}}else{for(i=0,r=e.components.length;i<r;++i){t=this.intersects(e.components[i]);if(t){break}}}if(!t&&e.CLASS_NAME=="OpenLayers.Geometry.Polygon"){var a=this.components[0];for(i=0,r=a.components.length;i<r;++i){t=e.containsPoint(a.components[i]);if(t){break}}}return t},distanceTo:function(e,t){var i=!(t&&t.edge===false);var r;if(!i&&this.intersects(e)){r=0}else{r=OpenLayers.Geometry.Collection.prototype.distanceTo.apply(this,[e,t])}return r},CLASS_NAME:"OpenLayers.Geometry.Polygon"});OpenLayers.Geometry.Polygon.createRegularPolygon=function(e,t,i,r){var a=Math.PI*(1/i-1/2);if(r){a+=r/180*Math.PI}var s,n,o;var l=[];for(var h=0;h<i;++h){s=a+h*2*Math.PI/i;n=e.x+t*Math.cos(s);o=e.y+t*Math.sin(s);l.push(new OpenLayers.Geometry.Point(n,o))}var p=new OpenLayers.Geometry.LinearRing(l);return new OpenLayers.Geometry.Polygon([p])};OpenLayers.Geometry.MultiPolygon=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.Polygon"],CLASS_NAME:"OpenLayers.Geometry.MultiPolygon"});OpenLayers.Format.GML=OpenLayers.Class(OpenLayers.Format.XML,{featureNS:"http://mapserver.gis.umn.edu/mapserver",featurePrefix:"feature",featureName:"featureMember",layerName:"features",geometryName:"geometry",collectionName:"FeatureCollection",gmlns:"http://www.opengis.net/gml",extractAttributes:true,xy:true,initialize:function(e){this.regExes={trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g};OpenLayers.Format.XML.prototype.initialize.apply(this,[e])},read:function(e){if(typeof e=="string"){e=OpenLayers.Format.XML.prototype.read.apply(this,[e])}var t=this.getElementsByTagNameNS(e.documentElement,this.gmlns,this.featureName);var i=[];for(var r=0;r<t.length;r++){var a=this.parseFeature(t[r]);if(a){i.push(a)}}return i},parseFeature:function(e){var t=["MultiPolygon","Polygon","MultiLineString","LineString","MultiPoint","Point","Envelope"];var i,r,a,s;for(var n=0;n<t.length;++n){i=t[n];r=this.getElementsByTagNameNS(e,this.gmlns,i);if(r.length>0){s=this.parseGeometry[i.toLowerCase()];if(s){a=s.apply(this,[r[0]]);if(this.internalProjection&&this.externalProjection){a.transform(this.externalProjection,this.internalProjection)}}else{throw new TypeError("Unsupported geometry type: "+i)}break}}var p;var u=this.getElementsByTagNameNS(e,this.gmlns,"Box");for(n=0;n<u.length;++n){var c=u[n];var d=this.parseGeometry["box"].apply(this,[c]);var f=c.parentNode;var y=f.localName||f.nodeName.split(":").pop();if(y==="boundedBy"){p=d}else{a=d.toGeometry()}}var g;if(this.extractAttributes){g=this.parseAttributes(e)}var o=new OpenLayers.Feature.Vector(a,g);o.bounds=p;o.gml={featureType:e.firstChild.nodeName.split(":")[1],featureNS:e.firstChild.namespaceURI,featureNSPrefix:e.firstChild.prefix};var l=e.firstChild;var h;while(l){if(l.nodeType==1){h=l.getAttribute("fid")||l.getAttribute("id");if(h){break}}l=l.nextSibling}o.fid=h;return o},parseGeometry:{point:function(e){var t,i;var r=[];var t=this.getElementsByTagNameNS(e,this.gmlns,"pos");if(t.length>0){i=t[0].firstChild.nodeValue;i=i.replace(this.regExes.trimSpace,"");r=i.split(this.regExes.splitSpace)}if(r.length==0){t=this.getElementsByTagNameNS(e,this.gmlns,"coordinates");if(t.length>0){i=t[0].firstChild.nodeValue;i=i.replace(this.regExes.removeSpace,"");r=i.split(",")}}if(r.length==0){t=this.getElementsByTagNameNS(e,this.gmlns,"coord");if(t.length>0){var a=this.getElementsByTagNameNS(t[0],this.gmlns,"X");var s=this.getElementsByTagNameNS(t[0],this.gmlns,"Y");if(a.length>0&&s.length>0){r=[a[0].firstChild.nodeValue,s[0].firstChild.nodeValue]}}}if(r.length==2){r[2]=null}if(this.xy){return new OpenLayers.Geometry.Point(r[0],r[1],r[2])}else{return new OpenLayers.Geometry.Point(r[1],r[0],r[2])}},multipoint:function(e){var t=this.getElementsByTagNameNS(e,this.gmlns,"Point");var i=[];if(t.length>0){var r;for(var a=0;a<t.length;++a){r=this.parseGeometry.point.apply(this,[t[a]]);if(r){i.push(r)}}}return new OpenLayers.Geometry.MultiPoint(i)},linestring:function(p,u){var e,t;var i=[];var r=[];e=this.getElementsByTagNameNS(p,this.gmlns,"posList");if(e.length>0){t=this.getChildValue(e[0]);t=t.replace(this.regExes.trimSpace,"");i=t.split(this.regExes.splitSpace);var a=parseInt(e[0].getAttribute("dimension"));var s,n,o,l;for(var h=0;h<i.length/a;++h){s=h*a;n=i[s];o=i[s+1];l=a==2?null:i[s+2];if(this.xy){r.push(new OpenLayers.Geometry.Point(n,o,l))}else{r.push(new OpenLayers.Geometry.Point(o,n,l))}}}if(i.length==0){e=this.getElementsByTagNameNS(p,this.gmlns,"coordinates");if(e.length>0){t=this.getChildValue(e[0]);t=t.replace(this.regExes.trimSpace,"");t=t.replace(this.regExes.trimComma,",");var c=t.split(this.regExes.splitSpace);for(var h=0;h<c.length;++h){i=c[h].split(",");if(i.length==2){i[2]=null}if(this.xy){r.push(new OpenLayers.Geometry.Point(i[0],i[1],i[2]))}else{r.push(new OpenLayers.Geometry.Point(i[1],i[0],i[2]))}}}}var d=null;if(r.length!=0){if(u){d=new OpenLayers.Geometry.LinearRing(r)}else{d=new OpenLayers.Geometry.LineString(r)}}return d},multilinestring:function(e){var t=this.getElementsByTagNameNS(e,this.gmlns,"LineString");var i=[];if(t.length>0){var r;for(var a=0;a<t.length;++a){r=this.parseGeometry.linestring.apply(this,[t[a]]);if(r){i.push(r)}}}return new OpenLayers.Geometry.MultiLineString(i)},polygon:function(e){var t=this.getElementsByTagNameNS(e,this.gmlns,"LinearRing");var i=[];if(t.length>0){var r;for(var a=0;a<t.length;++a){r=this.parseGeometry.linestring.apply(this,[t[a],true]);if(r){i.push(r)}}}return new OpenLayers.Geometry.Polygon(i)},multipolygon:function(e){var t=this.getElementsByTagNameNS(e,this.gmlns,"Polygon");var i=[];if(t.length>0){var r;for(var a=0;a<t.length;++a){r=this.parseGeometry.polygon.apply(this,[t[a]]);if(r){i.push(r)}}}return new OpenLayers.Geometry.MultiPolygon(i)},envelope:function(e){var t=[];var i;var r;var a=this.getElementsByTagNameNS(e,this.gmlns,"lowerCorner");if(a.length>0){var s=[];if(a.length>0){i=a[0].firstChild.nodeValue;i=i.replace(this.regExes.trimSpace,"");s=i.split(this.regExes.splitSpace)}if(s.length==2){s[2]=null}if(this.xy){var n=new OpenLayers.Geometry.Point(s[0],s[1],s[2])}else{var n=new OpenLayers.Geometry.Point(s[1],s[0],s[2])}}var o=this.getElementsByTagNameNS(e,this.gmlns,"upperCorner");if(o.length>0){var s=[];if(o.length>0){i=o[0].firstChild.nodeValue;i=i.replace(this.regExes.trimSpace,"");s=i.split(this.regExes.splitSpace)}if(s.length==2){s[2]=null}if(this.xy){var l=new OpenLayers.Geometry.Point(s[0],s[1],s[2])}else{var l=new OpenLayers.Geometry.Point(s[1],s[0],s[2])}}if(n&&l){t.push(new OpenLayers.Geometry.Point(n.x,n.y));t.push(new OpenLayers.Geometry.Point(l.x,n.y));t.push(new OpenLayers.Geometry.Point(l.x,l.y));t.push(new OpenLayers.Geometry.Point(n.x,l.y));t.push(new OpenLayers.Geometry.Point(n.x,n.y));var h=new OpenLayers.Geometry.LinearRing(t);r=new OpenLayers.Geometry.Polygon([h])}return r},box:function(e){var t=this.getElementsByTagNameNS(e,this.gmlns,"coordinates");var i;var r,a=null,s=null;if(t.length>0){i=t[0].firstChild.nodeValue;r=i.split(" ");if(r.length==2){a=r[0].split(",");s=r[1].split(",")}}if(a!==null&&s!==null){return new OpenLayers.Bounds(parseFloat(a[0]),parseFloat(a[1]),parseFloat(s[0]),parseFloat(s[1]))}}},parseAttributes:function(e){var t={};var i=e.firstChild;var r,a,s,n,o,l,h;while(i){if(i.nodeType==1){r=i.childNodes;for(a=0;a<r.length;++a){s=r[a];if(s.nodeType==1){n=s.childNodes;if(n.length==1){o=n[0];if(o.nodeType==3||o.nodeType==4){l=s.prefix?s.nodeName.split(":")[1]:s.nodeName;h=o.nodeValue.replace(this.regExes.trimSpace,"");t[l]=h}}else{t[s.nodeName.split(":").pop()]=null}}}break}i=i.nextSibling}return t},write:function(e){if(!OpenLayers.Util.isArray(e)){e=[e]}var t=this.createElementNS("http://www.opengis.net/wfs","wfs:"+this.collectionName);for(var i=0;i<e.length;i++){t.appendChild(this.createFeatureXML(e[i]))}return OpenLayers.Format.XML.prototype.write.apply(this,[t])},createFeatureXML:function(e){var t=e.geometry;var i=this.buildGeometryNode(t);var r=this.createElementNS(this.featureNS,this.featurePrefix+":"+this.geometryName);r.appendChild(i);var a=this.createElementNS(this.gmlns,"gml:"+this.featureName);var s=this.createElementNS(this.featureNS,this.featurePrefix+":"+this.layerName);var n=e.fid||e.id;s.setAttribute("fid",n);s.appendChild(r);for(var o in e.attributes){var l=this.createTextNode(e.attributes[o]);var p=o.substring(o.lastIndexOf(":")+1);var h=this.createElementNS(this.featureNS,this.featurePrefix+":"+p);h.appendChild(l);s.appendChild(h)}a.appendChild(s);return a},buildGeometryNode:function(e){if(this.externalProjection&&this.internalProjection){e=e.clone();e.transform(this.internalProjection,this.externalProjection)}var t=e.CLASS_NAME;var i=t.substring(t.lastIndexOf(".")+1);var r=this.buildGeometry[i.toLowerCase()];return r.apply(this,[e])},buildGeometry:{point:function(e){var t=this.createElementNS(this.gmlns,"gml:Point");t.appendChild(this.buildCoordinatesNode(e));return t},multipoint:function(e){var t=this.createElementNS(this.gmlns,"gml:MultiPoint");var i=e.components;var r,a;for(var s=0;s<i.length;s++){r=this.createElementNS(this.gmlns,"gml:pointMember");a=this.buildGeometry.point.apply(this,[i[s]]);r.appendChild(a);t.appendChild(r)}return t},linestring:function(e){var t=this.createElementNS(this.gmlns,"gml:LineString");t.appendChild(this.buildCoordinatesNode(e));return t},multilinestring:function(e){var t=this.createElementNS(this.gmlns,"gml:MultiLineString");var i=e.components;var r,a;for(var s=0;s<i.length;++s){r=this.createElementNS(this.gmlns,"gml:lineStringMember");a=this.buildGeometry.linestring.apply(this,[i[s]]);r.appendChild(a);t.appendChild(r)}return t},linearring:function(e){var t=this.createElementNS(this.gmlns,"gml:LinearRing");t.appendChild(this.buildCoordinatesNode(e));return t},polygon:function(e){var t=this.createElementNS(this.gmlns,"gml:Polygon");var i=e.components;var r,a,s;for(var n=0;n<i.length;++n){s=n==0?"outerBoundaryIs":"innerBoundaryIs";r=this.createElementNS(this.gmlns,"gml:"+s);a=this.buildGeometry.linearring.apply(this,[i[n]]);r.appendChild(a);t.appendChild(r)}return t},multipolygon:function(e){var t=this.createElementNS(this.gmlns,"gml:MultiPolygon");var i=e.components;var r,a;for(var s=0;s<i.length;++s){r=this.createElementNS(this.gmlns,"gml:polygonMember");a=this.buildGeometry.polygon.apply(this,[i[s]]);r.appendChild(a);t.appendChild(r)}return t},bounds:function(e){var t=this.createElementNS(this.gmlns,"gml:Box");t.appendChild(this.buildCoordinatesNode(e));return t}},buildCoordinatesNode:function(e){var t=this.createElementNS(this.gmlns,"gml:coordinates");t.setAttribute("decimal",".");t.setAttribute("cs",",");t.setAttribute("ts"," ");var i=[];if(e instanceof OpenLayers.Bounds){i.push(e.left+","+e.bottom);i.push(e.right+","+e.top)}else{var r=e.components?e.components:[e];for(var a=0;a<r.length;a++){i.push(r[a].x+","+r[a].y)}}var s=this.createTextNode(i.join(" "));t.appendChild(s);return t},CLASS_NAME:"OpenLayers.Format.GML"});if(!OpenLayers.Format.GML){OpenLayers.Format.GML={}}OpenLayers.Format.GML.Base=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",wfs:"http://www.opengis.net/wfs"},defaultPrefix:"gml",schemaLocation:null,featureType:null,featureNS:null,geometryName:"geometry",extractAttributes:true,srsName:null,xy:true,geometryTypes:null,singleFeatureType:null,regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g,featureMember:/^(.*:)?featureMembers?$/},initialize:function(e){OpenLayers.Format.XML.prototype.initialize.apply(this,[e]);this.setGeometryTypes();if(e&&e.featureNS){this.setNamespace("feature",e.featureNS)}this.singleFeatureType=!e||typeof e.featureType==="string"},read:function(e){if(typeof e=="string"){e=OpenLayers.Format.XML.prototype.read.apply(this,[e])}if(e&&e.nodeType==9){e=e.documentElement}var t=[];this.readNode(e,{features:t},true);if(t.length==0){var i=this.getElementsByTagNameNS(e,this.namespaces.gml,"featureMember");if(i.length){for(var r=0,a=i.length;r<a;++r){this.readNode(i[r],{features:t},true)}}else{var i=this.getElementsByTagNameNS(e,this.namespaces.gml,"featureMembers");if(i.length){this.readNode(i[0],{features:t},true)}}}return t},readNode:function(e,t,i){if(i===true&&this.autoConfig===true){this.featureType=null;delete this.namespaceAlias[this.featureNS];delete this.namespaces["feature"];this.featureNS=null}if(!this.featureNS&&(!(e.prefix in this.namespaces)&&e.parentNode.namespaceURI==this.namespaces["gml"]&&this.regExes.featureMember.test(e.parentNode.nodeName))){this.featureType=e.nodeName.split(":").pop();this.setNamespace("feature",e.namespaceURI);this.featureNS=e.namespaceURI;this.autoConfig=true}return OpenLayers.Format.XML.prototype.readNode.apply(this,[e,t])},readers:{gml:{_inherit:function(e,t,i){},featureMember:function(e,t){this.readChildNodes(e,t)},featureMembers:function(e,t){this.readChildNodes(e,t)},name:function(e,t){t.name=this.getChildValue(e)},boundedBy:function(e,t){var i={};this.readChildNodes(e,i);if(i.components&&i.components.length>0){t.bounds=i.components[0]}},Point:function(e,t){var i={points:[]};this.readChildNodes(e,i);if(!t.components){t.components=[]}t.components.push(i.points[0])},coordinates:function(e,t){var i=this.getChildValue(e).replace(this.regExes.trimSpace,"");i=i.replace(this.regExes.trimComma,",");var r=i.split(this.regExes.splitSpace);var a;var s=r.length;var n=new Array(s);for(var o=0;o<s;++o){a=r[o].split(",");if(this.xy){n[o]=new OpenLayers.Geometry.Point(a[0],a[1],a[2])}else{n[o]=new OpenLayers.Geometry.Point(a[1],a[0],a[2])}}t.points=n},coord:function(e,t){var i={};this.readChildNodes(e,i);if(!t.points){t.points=[]}t.points.push(new OpenLayers.Geometry.Point(i.x,i.y,i.z))},X:function(e,t){t.x=this.getChildValue(e)},Y:function(e,t){t.y=this.getChildValue(e)},Z:function(e,t){t.z=this.getChildValue(e)},MultiPoint:function(e,t){var i={components:[]};this.readers.gml._inherit.apply(this,[e,i,t]);this.readChildNodes(e,i);t.components=[new OpenLayers.Geometry.MultiPoint(i.components)]},pointMember:function(e,t){this.readChildNodes(e,t)},LineString:function(e,t){var i={};this.readers.gml._inherit.apply(this,[e,i,t]);this.readChildNodes(e,i);if(!t.components){t.components=[]}t.components.push(new OpenLayers.Geometry.LineString(i.points))},MultiLineString:function(e,t){var i={components:[]};this.readers.gml._inherit.apply(this,[e,i,t]);this.readChildNodes(e,i);t.components=[new OpenLayers.Geometry.MultiLineString(i.components)]},lineStringMember:function(e,t){this.readChildNodes(e,t)},Polygon:function(e,t){var i={outer:null,inner:[]};this.readers.gml._inherit.apply(this,[e,i,t]);this.readChildNodes(e,i);i.inner.unshift(i.outer);if(!t.components){t.components=[]}t.components.push(new OpenLayers.Geometry.Polygon(i.inner))},LinearRing:function(e,t){var i={};this.readers.gml._inherit.apply(this,[e,i]);this.readChildNodes(e,i);t.components=[new OpenLayers.Geometry.LinearRing(i.points)]},MultiPolygon:function(e,t){var i={components:[]};this.readers.gml._inherit.apply(this,[e,i,t]);this.readChildNodes(e,i);t.components=[new OpenLayers.Geometry.MultiPolygon(i.components)]},polygonMember:function(e,t){this.readChildNodes(e,t)},GeometryCollection:function(e,t){var i={components:[]};this.readers.gml._inherit.apply(this,[e,i,t]);this.readChildNodes(e,i);t.components=[new OpenLayers.Geometry.Collection(i.components)]},geometryMember:function(e,t){this.readChildNodes(e,t)}},feature:{"*":function(e,t){var i;var r=e.localName||e.nodeName.split(":").pop();if(t.features){if(!this.singleFeatureType&&OpenLayers.Util.indexOf(this.featureType,r)!==-1){i="_typeName"}else if(r===this.featureType){i="_typeName"}}else{if(e.childNodes.length==0||e.childNodes.length==1&&e.firstChild.nodeType==3){if(this.extractAttributes){i="_attribute"}}else{i="_geometry"}}if(i){this.readers.feature[i].apply(this,[e,t])}},_typeName:function(e,t){var i={components:[],attributes:{}};this.readChildNodes(e,i);if(i.name){i.attributes.name=i.name}var r=new OpenLayers.Feature.Vector(i.components[0],i.attributes);if(!this.singleFeatureType){r.type=e.nodeName.split(":").pop();r.namespace=e.namespaceURI}var a=e.getAttribute("fid")||this.getAttributeNS(e,this.namespaces["gml"],"id");if(a){r.fid=a}if(this.internalProjection&&this.externalProjection&&r.geometry){r.geometry.transform(this.externalProjection,this.internalProjection)}if(i.bounds){r.bounds=i.bounds}t.features.push(r)},_geometry:function(e,t){if(!this.geometryName){this.geometryName=e.nodeName.split(":").pop()}this.readChildNodes(e,t)},_attribute:function(e,t){var i=e.localName||e.nodeName.split(":").pop();var r=this.getChildValue(e);t.attributes[i]=r}},wfs:{FeatureCollection:function(e,t){this.readChildNodes(e,t)}}},write:function(e){var t;if(OpenLayers.Util.isArray(e)){t="featureMembers"}else{t="featureMember"}var i=this.writeNode("gml:"+t,e);this.setAttributeNS(i,this.namespaces["xsi"],"xsi:schemaLocation",this.schemaLocation);return OpenLayers.Format.XML.prototype.write.apply(this,[i])},writers:{gml:{featureMember:function(e){var t=this.createElementNSPlus("gml:featureMember");this.writeNode("feature:_typeName",e,t);return t},MultiPoint:function(e){var t=this.createElementNSPlus("gml:MultiPoint");var i=e.components||[e];for(var r=0,a=i.length;r<a;++r){this.writeNode("pointMember",i[r],t)}return t},pointMember:function(e){var t=this.createElementNSPlus("gml:pointMember");this.writeNode("Point",e,t);return t},MultiLineString:function(e){var t=this.createElementNSPlus("gml:MultiLineString");var i=e.components||[e];for(var r=0,a=i.length;r<a;++r){this.writeNode("lineStringMember",i[r],t)}return t},lineStringMember:function(e){var t=this.createElementNSPlus("gml:lineStringMember");this.writeNode("LineString",e,t);return t},MultiPolygon:function(e){var t=this.createElementNSPlus("gml:MultiPolygon");var i=e.components||[e];for(var r=0,a=i.length;r<a;++r){this.writeNode("polygonMember",i[r],t)}return t},polygonMember:function(e){var t=this.createElementNSPlus("gml:polygonMember");this.writeNode("Polygon",e,t);return t},GeometryCollection:function(e){var t=this.createElementNSPlus("gml:GeometryCollection");for(var i=0,r=e.components.length;i<r;++i){this.writeNode("geometryMember",e.components[i],t)}return t},geometryMember:function(e){var t=this.createElementNSPlus("gml:geometryMember");var i=this.writeNode("feature:_geometry",e);t.appendChild(i.firstChild);return t}},feature:{_typeName:function(e){var t=this.createElementNSPlus("feature:"+this.featureType,{attributes:{fid:e.fid}});if(e.geometry){this.writeNode("feature:_geometry",e.geometry,t)}for(var i in e.attributes){var r=e.attributes[i];if(r!=null){this.writeNode("feature:_attribute",{name:i,value:r},t)}}return t},_geometry:function(e){if(this.externalProjection&&this.internalProjection){e=e.clone().transform(this.internalProjection,this.externalProjection)}var t=this.createElementNSPlus("feature:"+this.geometryName);var i=this.geometryTypes[e.CLASS_NAME];var r=this.writeNode("gml:"+i,e,t);if(this.srsName){r.setAttribute("srsName",this.srsName)}return t},_attribute:function(e){return this.createElementNSPlus("feature:"+e.name,{value:e.value})}},wfs:{FeatureCollection:function(e){var t=this.createElementNSPlus("wfs:FeatureCollection");for(var i=0,r=e.length;i<r;++i){this.writeNode("gml:featureMember",e[i],t)}return t}}},setGeometryTypes:function(){this.geometryTypes={"OpenLayers.Geometry.Point":"Point","OpenLayers.Geometry.MultiPoint":"MultiPoint","OpenLayers.Geometry.LineString":"LineString","OpenLayers.Geometry.MultiLineString":"MultiLineString","OpenLayers.Geometry.Polygon":"Polygon","OpenLayers.Geometry.MultiPolygon":"MultiPolygon","OpenLayers.Geometry.Collection":"GeometryCollection"}},CLASS_NAME:"OpenLayers.Format.GML.Base"});OpenLayers.Format.GML.v2=OpenLayers.Class(OpenLayers.Format.GML.Base,{schemaLocation:"http://www.opengis.net/gml http://schemas.opengis.net/gml/2.1.2/feature.xsd",initialize:function(e){OpenLayers.Format.GML.Base.prototype.initialize.apply(this,[e])},readers:{gml:OpenLayers.Util.applyDefaults({outerBoundaryIs:function(e,t){var i={};this.readChildNodes(e,i);t.outer=i.components[0]},innerBoundaryIs:function(e,t){var i={};this.readChildNodes(e,i);t.inner.push(i.components[0])},Box:function(e,t){var i={};this.readChildNodes(e,i);if(!t.components){t.components=[]}var r=i.points[0];var a=i.points[1];t.components.push(new OpenLayers.Bounds(r.x,r.y,a.x,a.y))}},OpenLayers.Format.GML.Base.prototype.readers["gml"]),feature:OpenLayers.Format.GML.Base.prototype.readers["feature"],wfs:OpenLayers.Format.GML.Base.prototype.readers["wfs"]},write:function(e){var t;if(OpenLayers.Util.isArray(e)){t="wfs:FeatureCollection"}else{t="gml:featureMember"}var i=this.writeNode(t,e);this.setAttributeNS(i,this.namespaces["xsi"],"xsi:schemaLocation",this.schemaLocation);return OpenLayers.Format.XML.prototype.write.apply(this,[i])},writers:{gml:OpenLayers.Util.applyDefaults({Point:function(e){var t=this.createElementNSPlus("gml:Point");this.writeNode("coordinates",[e],t);return t},coordinates:function(e){var t=e.length;var i=new Array(t);var r;for(var a=0;a<t;++a){r=e[a];if(this.xy){i[a]=r.x+","+r.y}else{i[a]=r.y+","+r.x}if(r.z!=undefined){i[a]+=","+r.z}}return this.createElementNSPlus("gml:coordinates",{attributes:{decimal:".",cs:",",ts:" "},value:t==1?i[0]:i.join(" ")})},LineString:function(e){var t=this.createElementNSPlus("gml:LineString");this.writeNode("coordinates",e.components,t);return t},Polygon:function(e){var t=this.createElementNSPlus("gml:Polygon");this.writeNode("outerBoundaryIs",e.components[0],t);for(var i=1;i<e.components.length;++i){this.writeNode("innerBoundaryIs",e.components[i],t)}return t},outerBoundaryIs:function(e){var t=this.createElementNSPlus("gml:outerBoundaryIs");this.writeNode("LinearRing",e,t);return t},innerBoundaryIs:function(e){var t=this.createElementNSPlus("gml:innerBoundaryIs");this.writeNode("LinearRing",e,t);return t},LinearRing:function(e){var t=this.createElementNSPlus("gml:LinearRing");this.writeNode("coordinates",e.components,t);return t},Box:function(e){var t=this.createElementNSPlus("gml:Box");this.writeNode("coordinates",[{x:e.left,y:e.bottom},{x:e.right,y:e.top}],t);if(this.srsName){t.setAttribute("srsName",this.srsName)}return t}},OpenLayers.Format.GML.Base.prototype.writers["gml"]),feature:OpenLayers.Format.GML.Base.prototype.writers["feature"],wfs:OpenLayers.Format.GML.Base.prototype.writers["wfs"]},CLASS_NAME:"OpenLayers.Format.GML.v2"});OpenLayers.Format.GML.v3=OpenLayers.Class(OpenLayers.Format.GML.Base,{schemaLocation:"http://www.opengis.net/gml http://schemas.opengis.net/gml/3.1.1/profiles/gmlsfProfile/1.0.0/gmlsf.xsd",curve:false,multiCurve:true,surface:false,multiSurface:true,initialize:function(e){OpenLayers.Format.GML.Base.prototype.initialize.apply(this,[e])},readers:{gml:OpenLayers.Util.applyDefaults({_inherit:function(e,t,i){var r=parseInt(e.getAttribute("srsDimension"),10)||i&&i.srsDimension;if(r){t.srsDimension=r}},featureMembers:function(e,t){this.readChildNodes(e,t)},Curve:function(e,t){var i={points:[]};this.readers.gml._inherit.apply(this,[e,i,t]);this.readChildNodes(e,i);if(!t.components){t.components=[]}t.components.push(new OpenLayers.Geometry.LineString(i.points))},segments:function(e,t){this.readChildNodes(e,t)},LineStringSegment:function(e,t){var i={};this.readChildNodes(e,i);if(i.points){Array.prototype.push.apply(t.points,i.points)}},pos:function(e,t){var i=this.getChildValue(e).replace(this.regExes.trimSpace,"");var r=i.split(this.regExes.splitSpace);var a;if(this.xy){a=new OpenLayers.Geometry.Point(r[0],r[1],r[2])}else{a=new OpenLayers.Geometry.Point(r[1],r[0],r[2])}t.points=[a]},posList:function(e,t){var i=this.getChildValue(e).replace(this.regExes.trimSpace,"");var r=i.split(this.regExes.splitSpace);var a=t.srsDimension||parseInt(e.getAttribute("srsDimension")||e.getAttribute("dimension"),10)||2;var p,s,n,o;var u=r.length/a;var l=new Array(u);for(var h=0,c=r.length;h<c;h+=a){s=r[h];n=r[h+1];o=a==2?undefined:r[h+2];if(this.xy){l[h/a]=new OpenLayers.Geometry.Point(s,n,o)}else{l[h/a]=new OpenLayers.Geometry.Point(n,s,o)}}t.points=l},Surface:function(e,t){this.readChildNodes(e,t)},patches:function(e,t){this.readChildNodes(e,t)},PolygonPatch:function(e,t){this.readers.gml.Polygon.apply(this,[e,t])},exterior:function(e,t){var i={};this.readChildNodes(e,i);t.outer=i.components[0]},interior:function(e,t){var i={};this.readChildNodes(e,i);t.inner.push(i.components[0])},MultiCurve:function(e,t){var i={components:[]};this.readers.gml._inherit.apply(this,[e,i,t]);this.readChildNodes(e,i);if(i.components.length>0){t.components=[new OpenLayers.Geometry.MultiLineString(i.components)]}},curveMember:function(e,t){this.readChildNodes(e,t)},MultiSurface:function(e,t){var i={components:[]};this.readers.gml._inherit.apply(this,[e,i,t]);this.readChildNodes(e,i);if(i.components.length>0){t.components=[new OpenLayers.Geometry.MultiPolygon(i.components)]}},surfaceMember:function(e,t){this.readChildNodes(e,t)},surfaceMembers:function(e,t){this.readChildNodes(e,t)},pointMembers:function(e,t){this.readChildNodes(e,t)},lineStringMembers:function(e,t){this.readChildNodes(e,t)},polygonMembers:function(e,t){this.readChildNodes(e,t)},geometryMembers:function(e,t){this.readChildNodes(e,t)},Envelope:function(e,t){var i={points:new Array(2)};this.readChildNodes(e,i);if(!t.components){t.components=[]}var r=i.points[0];var a=i.points[1];t.components.push(new OpenLayers.Bounds(r.x,r.y,a.x,a.y))},lowerCorner:function(e,t){var i={};this.readers.gml.pos.apply(this,[e,i]);t.points[0]=i.points[0]},upperCorner:function(e,t){var i={};this.readers.gml.pos.apply(this,[e,i]);t.points[1]=i.points[0]}},OpenLayers.Format.GML.Base.prototype.readers["gml"]),feature:OpenLayers.Format.GML.Base.prototype.readers["feature"],wfs:OpenLayers.Format.GML.Base.prototype.readers["wfs"]},write:function(e){var t;if(OpenLayers.Util.isArray(e)){t="featureMembers"}else{t="featureMember"}var i=this.writeNode("gml:"+t,e);this.setAttributeNS(i,this.namespaces["xsi"],"xsi:schemaLocation",this.schemaLocation);return OpenLayers.Format.XML.prototype.write.apply(this,[i])},writers:{gml:OpenLayers.Util.applyDefaults({featureMembers:function(e){var t=this.createElementNSPlus("gml:featureMembers");for(var i=0,r=e.length;i<r;++i){this.writeNode("feature:_typeName",e[i],t)}return t},Point:function(e){var t=this.createElementNSPlus("gml:Point");this.writeNode("pos",e,t);return t},pos:function(e){var t=this.xy?e.x+" "+e.y:e.y+" "+e.x;return this.createElementNSPlus("gml:pos",{value:t})},LineString:function(e){var t=this.createElementNSPlus("gml:LineString");this.writeNode("posList",e.components,t);return t},Curve:function(e){var t=this.createElementNSPlus("gml:Curve");this.writeNode("segments",e,t);return t},segments:function(e){var t=this.createElementNSPlus("gml:segments");this.writeNode("LineStringSegment",e,t);return t},LineStringSegment:function(e){var t=this.createElementNSPlus("gml:LineStringSegment");this.writeNode("posList",e.components,t);return t},posList:function(e){var t=e.length;var i=new Array(t);var r;for(var a=0;a<t;++a){r=e[a];if(this.xy){i[a]=r.x+" "+r.y}else{i[a]=r.y+" "+r.x}}return this.createElementNSPlus("gml:posList",{value:i.join(" ")})},Surface:function(e){var t=this.createElementNSPlus("gml:Surface");this.writeNode("patches",e,t);return t},patches:function(e){var t=this.createElementNSPlus("gml:patches");this.writeNode("PolygonPatch",e,t);return t},PolygonPatch:function(e){var t=this.createElementNSPlus("gml:PolygonPatch",{attributes:{interpolation:"planar"}});this.writeNode("exterior",e.components[0],t);for(var i=1,r=e.components.length;i<r;++i){this.writeNode("interior",e.components[i],t)}return t},Polygon:function(e){var t=this.createElementNSPlus("gml:Polygon");this.writeNode("exterior",e.components[0],t);for(var i=1,r=e.components.length;i<r;++i){this.writeNode("interior",e.components[i],t)}return t},exterior:function(e){var t=this.createElementNSPlus("gml:exterior");this.writeNode("LinearRing",e,t);return t},interior:function(e){var t=this.createElementNSPlus("gml:interior");this.writeNode("LinearRing",e,t);return t},LinearRing:function(e){var t=this.createElementNSPlus("gml:LinearRing");this.writeNode("posList",e.components,t);return t},MultiCurve:function(e){var t=this.createElementNSPlus("gml:MultiCurve");var i=e.components||[e];for(var r=0,a=i.length;r<a;++r){this.writeNode("curveMember",i[r],t)}return t},curveMember:function(e){var t=this.createElementNSPlus("gml:curveMember");if(this.curve){this.writeNode("Curve",e,t)}else{this.writeNode("LineString",e,t)}return t},MultiSurface:function(e){var t=this.createElementNSPlus("gml:MultiSurface");var i=e.components||[e];for(var r=0,a=i.length;r<a;++r){this.writeNode("surfaceMember",i[r],t)}return t},surfaceMember:function(e){var t=this.createElementNSPlus("gml:surfaceMember");if(this.surface){this.writeNode("Surface",e,t)}else{this.writeNode("Polygon",e,t)}return t},Envelope:function(e){var t=this.createElementNSPlus("gml:Envelope");this.writeNode("lowerCorner",e,t);this.writeNode("upperCorner",e,t);if(this.srsName){t.setAttribute("srsName",this.srsName)}return t},lowerCorner:function(e){var t=this.xy?e.left+" "+e.bottom:e.bottom+" "+e.left;return this.createElementNSPlus("gml:lowerCorner",{value:t})},upperCorner:function(e){var t=this.xy?e.right+" "+e.top:e.top+" "+e.right;return this.createElementNSPlus("gml:upperCorner",{value:t})}},OpenLayers.Format.GML.Base.prototype.writers["gml"]),feature:OpenLayers.Format.GML.Base.prototype.writers["feature"],wfs:OpenLayers.Format.GML.Base.prototype.writers["wfs"]},setGeometryTypes:function(){this.geometryTypes={"OpenLayers.Geometry.Point":"Point","OpenLayers.Geometry.MultiPoint":"MultiPoint","OpenLayers.Geometry.LineString":this.curve===true?"Curve":"LineString","OpenLayers.Geometry.MultiLineString":this.multiCurve===false?"MultiLineString":"MultiCurve","OpenLayers.Geometry.Polygon":this.surface===true?"Surface":"Polygon","OpenLayers.Geometry.MultiPolygon":this.multiSurface===false?"MultiPolygon":"MultiSurface","OpenLayers.Geometry.Collection":"GeometryCollection"}},CLASS_NAME:"OpenLayers.Format.GML.v3"});OpenLayers.Format.OGCExceptionReport=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ogc:"http://www.opengis.net/ogc"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},defaultPrefix:"ogc",read:function(e){var t;if(typeof e=="string"){e=OpenLayers.Format.XML.prototype.read.apply(this,[e])}var i=e.documentElement;var r={exceptionReport:null};if(i){this.readChildNodes(e,r);if(r.exceptionReport===null){r=(new OpenLayers.Format.OWSCommon).read(e)}}return r},readers:{ogc:{ServiceExceptionReport:function(e,t){t.exceptionReport={exceptions:[]};this.readChildNodes(e,t.exceptionReport)},ServiceException:function(e,t){var i={code:e.getAttribute("code"),locator:e.getAttribute("locator"),text:this.getChildValue(e)};t.exceptions.push(i)}}},CLASS_NAME:"OpenLayers.Format.OGCExceptionReport"});OpenLayers.Format.XML.VersionedOGC=OpenLayers.Class(OpenLayers.Format.XML,{defaultVersion:null,version:null,profile:null,allowFallback:false,name:null,stringifyOutput:false,parser:null,initialize:function(e){OpenLayers.Format.XML.prototype.initialize.apply(this,[e]);var t=this.CLASS_NAME;this.name=t.substring(t.lastIndexOf(".")+1)},getVersion:function(e,t){var i;if(e){i=this.version;if(!i){i=e.getAttribute("version");if(!i){i=this.defaultVersion}}}else{i=t&&t.version||this.version||this.defaultVersion}return i},getParser:function(e){e=e||this.defaultVersion;var t=this.profile?"_"+this.profile:"";if(!this.parser||this.parser.VERSION!=e){var i=OpenLayers.Format[this.name]["v"+e.replace(/\./g,"_")+t];if(!i){if(t!==""&&this.allowFallback){t="";i=OpenLayers.Format[this.name]["v"+e.replace(/\./g,"_")]}if(!i){throw"Can't find a "+this.name+" parser for version "+e+t}}this.parser=new i(this.options)}return this.parser},write:function(e,t){var i=this.getVersion(null,t);this.parser=this.getParser(i);var r=this.parser.write(e,t);if(this.stringifyOutput===false){return r}else{return OpenLayers.Format.XML.prototype.write.apply(this,[r])}},read:function(e,t){if(typeof e=="string"){e=OpenLayers.Format.XML.prototype.read.apply(this,[e])}var i=e.documentElement;var r=this.getVersion(i);this.parser=this.getParser(r);var a=this.parser.read(e,t);var s=this.parser.errorProperty||null;if(s!==null&&a[s]===undefined){var n=new OpenLayers.Format.OGCExceptionReport;a.error=n.read(e)}a.version=r;return a},CLASS_NAME:"OpenLayers.Format.XML.VersionedOGC"});OpenLayers.Format.WMSDescribeLayer=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.1.1",CLASS_NAME:"OpenLayers.Format.WMSDescribeLayer"});OpenLayers.Format.WMSDescribeLayer.v1_1_1=OpenLayers.Class(OpenLayers.Format.WMSDescribeLayer,{initialize:function(e){OpenLayers.Format.WMSDescribeLayer.prototype.initialize.apply(this,[e])},read:function(e){if(typeof e=="string"){e=OpenLayers.Format.XML.prototype.read.apply(this,[e])}var p=e.documentElement;var t=p.childNodes;var i={layerDescriptions:[]};var r,a;for(var s=0;s<t.length;++s){r=t[s];a=r.nodeName;if(a=="LayerDescription"){var u=r.getAttribute("name");var n="";var o="";var l="";if(r.getAttribute("owsType")){n=r.getAttribute("owsType");o=r.getAttribute("owsURL")}else{if(r.getAttribute("wfs")!=""){n="WFS";o=r.getAttribute("wfs")}else if(r.getAttribute("wcs")!=""){n="WCS";o=r.getAttribute("wcs")}}var h=r.getElementsByTagName("Query");if(h.length>0){l=h[0].getAttribute("typeName");if(!l){l=h[0].getAttribute("typename")}}var c={layerName:u,owsType:n,owsURL:o,typeName:l};i.layerDescriptions.push(c);i.length=i.layerDescriptions.length;i[i.length-1]=c}else if(a=="ServiceException"){var d=new OpenLayers.Format.OGCExceptionReport;return{error:d.read(e)}}}return i},CLASS_NAME:"OpenLayers.Format.WMSDescribeLayer.v1_1_1"});OpenLayers.Format.WMSDescribeLayer.v1_1_0=OpenLayers.Format.WMSDescribeLayer.v1_1_1;OpenLayers.Format.WFSDescribeFeatureType=OpenLayers.Class(OpenLayers.Format.XML,{regExes:{trimSpace:/^\s*|\s*$/g},namespaces:{xsd:"http://www.w3.org/2001/XMLSchema"},readers:{xsd:{schema:function(e,t){var i=[];var r={};var p={complexTypes:i,customTypes:r};var a,s;this.readChildNodes(e,p);var n=e.attributes;var o,l;for(a=0,s=n.length;a<s;++a){o=n[a];l=o.name;if(l.indexOf("xmlns")===0){this.setNamespace(l.split(":")[1]||"",o.value)}else{t[l]=o.value}}t.featureTypes=i;t.targetPrefix=this.namespaceAlias[t.targetNamespace];var h,u;for(a=0,s=i.length;a<s;++a){h=i[a];u=r[h.typeName];if(r[h.typeName]){h.typeName=u.name}}},complexType:function(e,t){var i={typeName:e.getAttribute("name")};this.readChildNodes(e,i);t.complexTypes.push(i)},complexContent:function(e,t){this.readChildNodes(e,t)},extension:function(e,t){this.readChildNodes(e,t)},sequence:function(e,t){var i={elements:[]};this.readChildNodes(e,i);t.properties=i.elements},element:function(e,t){var i;if(t.elements){var r={};var a=e.attributes;var s;for(var n=0,o=a.length;n<o;++n){s=a[n];r[s.name]=s.value}i=r.type;if(!i){i={};this.readChildNodes(e,i);r.restriction=i;r.type=i.base}var l=i.base||i;r.localType=l.split(":").pop();t.elements.push(r);this.readChildNodes(e,r)}if(t.complexTypes){i=e.getAttribute("type");var h=i.split(":").pop();t.customTypes[h]={name:e.getAttribute("name"),type:i}}},annotation:function(e,t){t.annotation={};this.readChildNodes(e,t.annotation)},appinfo:function(e,t){if(!t.appinfo){t.appinfo=[]}t.appinfo.push(this.getChildValue(e))},documentation:function(e,t){if(!t.documentation){t.documentation=[]}var i=this.getChildValue(e);t.documentation.push({lang:e.getAttribute("xml:lang"),textContent:i.replace(this.regExes.trimSpace,"")})},simpleType:function(e,t){this.readChildNodes(e,t)},restriction:function(e,t){t.base=e.getAttribute("base");this.readRestriction(e,t)}}},readRestriction:function(e,t){var i=e.childNodes;var r,a,s;for(var n=0,o=i.length;n<o;++n){r=i[n];if(r.nodeType==1){a=r.nodeName.split(":").pop();s=r.getAttribute("value");if(!t[a]){t[a]=s}else{if(typeof t[a]=="string"){t[a]=[t[a]]}t[a].push(s)}}}},read:function(e){if(typeof e=="string"){e=OpenLayers.Format.XML.prototype.read.apply(this,[e])}if(e&&e.nodeType==9){e=e.documentElement}var t={};if(e.nodeName.split(":").pop()==="ExceptionReport"){var i=new OpenLayers.Format.OGCExceptionReport;t.error=i.read(e)}else{this.readNode(e,t)}return t},CLASS_NAME:"OpenLayers.Format.WFSDescribeFeatureType"});OpenLayers.Filter=OpenLayers.Class({initialize:function(e){OpenLayers.Util.extend(this,e)},destroy:function(){},evaluate:function(e){return true},clone:function(){return null},toString:function(){var e;if(OpenLayers.Format&&OpenLayers.Format.CQL){e=OpenLayers.Format.CQL.prototype.write(this)}else{e=Object.prototype.toString.call(this)}return e},CLASS_NAME:"OpenLayers.Filter"});OpenLayers.Filter.FeatureId=OpenLayers.Class(OpenLayers.Filter,{fids:null,type:"FID",initialize:function(e){this.fids=[];OpenLayers.Filter.prototype.initialize.apply(this,[e])},evaluate:function(e){for(var t=0,i=this.fids.length;t<i;t++){var r=e.fid||e.id;if(r==this.fids[t]){return true}}return false},clone:function(){var e=new OpenLayers.Filter.FeatureId;OpenLayers.Util.extend(e,this);e.fids=this.fids.slice();return e},CLASS_NAME:"OpenLayers.Filter.FeatureId"});OpenLayers.Filter.Logical=OpenLayers.Class(OpenLayers.Filter,{filters:null,type:null,initialize:function(e){this.filters=[];OpenLayers.Filter.prototype.initialize.apply(this,[e])},destroy:function(){this.filters=null;OpenLayers.Filter.prototype.destroy.apply(this)},evaluate:function(e){var t,i;switch(this.type){case OpenLayers.Filter.Logical.AND:for(t=0,i=this.filters.length;t<i;t++){if(this.filters[t].evaluate(e)==false){return false}}return true;case OpenLayers.Filter.Logical.OR:for(t=0,i=this.filters.length;t<i;t++){if(this.filters[t].evaluate(e)==true){return true}}return false;case OpenLayers.Filter.Logical.NOT:return!this.filters[0].evaluate(e)}return undefined},clone:function(){var e=[];for(var t=0,i=this.filters.length;t<i;++t){e.push(this.filters[t].clone())}return new OpenLayers.Filter.Logical({type:this.type,filters:e})},CLASS_NAME:"OpenLayers.Filter.Logical"});OpenLayers.Filter.Logical.AND="&&";OpenLayers.Filter.Logical.OR="||";OpenLayers.Filter.Logical.NOT="!";OpenLayers.Filter.Comparison=OpenLayers.Class(OpenLayers.Filter,{type:null,property:null,value:null,matchCase:true,lowerBoundary:null,upperBoundary:null,initialize:function(e){OpenLayers.Filter.prototype.initialize.apply(this,[e]);if(this.type===OpenLayers.Filter.Comparison.LIKE&&e.matchCase===undefined){this.matchCase=null}},evaluate:function(e){if(e instanceof OpenLayers.Feature.Vector){e=e.attributes}var t=false;var i=e[this.property];var r;switch(this.type){case OpenLayers.Filter.Comparison.EQUAL_TO:r=this.value;if(!this.matchCase&&typeof i=="string"&&typeof r=="string"){t=i.toUpperCase()==r.toUpperCase()}else{t=i==r}break;case OpenLayers.Filter.Comparison.NOT_EQUAL_TO:r=this.value;if(!this.matchCase&&typeof i=="string"&&typeof r=="string"){t=i.toUpperCase()!=r.toUpperCase()}else{t=i!=r}break;case OpenLayers.Filter.Comparison.LESS_THAN:t=i<this.value;break;case OpenLayers.Filter.Comparison.GREATER_THAN:t=i>this.value;break;case OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO:t=i<=this.value;break;case OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO:t=i>=this.value;break;case OpenLayers.Filter.Comparison.BETWEEN:t=i>=this.lowerBoundary&&i<=this.upperBoundary;break;case OpenLayers.Filter.Comparison.LIKE:var a=new RegExp(this.value,"gi");t=a.test(i);break;case OpenLayers.Filter.Comparison.IS_NULL:t=i===null;break}return t},value2regex:function(e,t,i){if(e=="."){throw new Error("'.' is an unsupported wildCard character for "+"OpenLayers.Filter.Comparison")}e=e?e:"*";t=t?t:".";i=i?i:"!";this.value=this.value.replace(new RegExp("\\"+i+"(.|$)","g"),"\\$1");this.value=this.value.replace(new RegExp("\\"+t,"g"),".");this.value=this.value.replace(new RegExp("\\"+e,"g"),".*");this.value=this.value.replace(new RegExp("\\\\.\\*","g"),"\\"+e);this.value=this.value.replace(new RegExp("\\\\\\.","g"),"\\"+t);return this.value},regex2value:function(){var e=this.value;e=e.replace(/!/g,"!!");e=e.replace(/(\\)?\\\./g,function(e,t){return t?e:"!."});e=e.replace(/(\\)?\\\*/g,function(e,t){return t?e:"!*"});e=e.replace(/\\\\/g,"\\");e=e.replace(/\.\*/g,"*");return e},clone:function(){return OpenLayers.Util.extend(new OpenLayers.Filter.Comparison,this)},CLASS_NAME:"OpenLayers.Filter.Comparison"});OpenLayers.Filter.Comparison.EQUAL_TO="==";OpenLayers.Filter.Comparison.NOT_EQUAL_TO="!=";OpenLayers.Filter.Comparison.LESS_THAN="<";OpenLayers.Filter.Comparison.GREATER_THAN=">";OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO="<=";OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO=">=";OpenLayers.Filter.Comparison.BETWEEN="..";OpenLayers.Filter.Comparison.LIKE="~";OpenLayers.Filter.Comparison.IS_NULL="NULL";OpenLayers.Filter.Spatial=OpenLayers.Class(OpenLayers.Filter,{type:null,property:null,value:null,distance:null,distanceUnits:null,evaluate:function(e){var t=false;switch(this.type){case OpenLayers.Filter.Spatial.BBOX:case OpenLayers.Filter.Spatial.INTERSECTS:if(e.geometry){var i=this.value;if(this.value.CLASS_NAME=="OpenLayers.Bounds"){i=this.value.toGeometry()}if(e.geometry.intersects(i)){t=true}}break;default:throw new Error("evaluate is not implemented for this filter type.")}return t},clone:function(){var e=OpenLayers.Util.applyDefaults({value:this.value&&this.value.clone&&this.value.clone()},this);return new OpenLayers.Filter.Spatial(e)},CLASS_NAME:"OpenLayers.Filter.Spatial"});OpenLayers.Filter.Spatial.BBOX="BBOX";OpenLayers.Filter.Spatial.INTERSECTS="INTERSECTS";OpenLayers.Filter.Spatial.DWITHIN="DWITHIN";OpenLayers.Filter.Spatial.WITHIN="WITHIN";OpenLayers.Filter.Spatial.CONTAINS="CONTAINS";OpenLayers.Format.SLD=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{profile:null,defaultVersion:"1.0.0",stringifyOutput:true,namedLayersAsArray:false,CLASS_NAME:"OpenLayers.Format.SLD"});OpenLayers.Format.Filter=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",CLASS_NAME:"OpenLayers.Format.Filter"});OpenLayers.Filter.Function=OpenLayers.Class(OpenLayers.Filter,{name:null,params:null,CLASS_NAME:"OpenLayers.Filter.Function"});OpenLayers.Date={dateRegEx:/^(?:(\d{4})(?:-(\d{2})(?:-(\d{2}))?)?)?(?:(?:T(\d{1,2}):(\d{2}):(\d{2}(?:\.\d+)?)(Z|(?:[+-]\d{1,2}(?::(\d{2}))?)))|Z)?$/,toISOString:function(){if("toISOString"in Date.prototype){return function(e){return e.toISOString()}}else{return function(e){var t;if(isNaN(e.getTime())){t="Invalid Date"}else{t=e.getUTCFullYear()+"-"+OpenLayers.Number.zeroPad(e.getUTCMonth()+1,2)+"-"+OpenLayers.Number.zeroPad(e.getUTCDate(),2)+"T"+OpenLayers.Number.zeroPad(e.getUTCHours(),2)+":"+OpenLayers.Number.zeroPad(e.getUTCMinutes(),2)+":"+OpenLayers.Number.zeroPad(e.getUTCSeconds(),2)+"."+OpenLayers.Number.zeroPad(e.getUTCMilliseconds(),3)+"Z"}return t}}}(),parse:function(e){var t;var i=e.match(this.dateRegEx);if(i&&(i[1]||i[7])){var r=parseInt(i[1],10)||0;var a=parseInt(i[2],10)-1||0;var s=parseInt(i[3],10)||1;t=new Date(Date.UTC(r,a,s));var n=i[7];if(n){var o=parseInt(i[4],10);var p=parseInt(i[5],10);var l=parseFloat(i[6]);var h=l|0;var u=Math.round(1e3*(l-h));t.setUTCHours(o,p,h,u);if(n!=="Z"){var c=parseInt(n,10);var d=parseInt(i[8],10)||0;var f=-1e3*(60*(c*60)+d*60);t=new Date(t.getTime()+f)}}}else{t=new Date("invalid")}return t}};OpenLayers.Format.Filter.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ogc:"http://www.opengis.net/ogc",gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"ogc",schemaLocation:null,initialize:function(e){OpenLayers.Format.XML.prototype.initialize.apply(this,[e])},read:function(e){var t={};this.readers.ogc["Filter"].apply(this,[e,t]);return t.filter},readers:{ogc:{_expression:function(e){var t,i="";for(var r=e.firstChild;r;r=r.nextSibling){switch(r.nodeType){case 1:t=this.readNode(r);if(t.property){i+="${"+t.property+"}"}else if(t.value!==undefined){i+=t.value}break;case 3:case 4:i+=r.nodeValue}}return i},Filter:function(e,t){var i={fids:[],filters:[]};this.readChildNodes(e,i);if(i.fids.length>0){t.filter=new OpenLayers.Filter.FeatureId({fids:i.fids})}else if(i.filters.length>0){t.filter=i.filters[0]}},FeatureId:function(e,t){var i=e.getAttribute("fid");if(i){t.fids.push(i)}},And:function(e,t){var i=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND});this.readChildNodes(e,i);t.filters.push(i)},Or:function(e,t){var i=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.OR});this.readChildNodes(e,i);t.filters.push(i)},Not:function(e,t){var i=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.NOT});this.readChildNodes(e,i);t.filters.push(i)},PropertyIsLessThan:function(e,t){var i=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LESS_THAN});this.readChildNodes(e,i);t.filters.push(i)},PropertyIsGreaterThan:function(e,t){var i=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.GREATER_THAN});this.readChildNodes(e,i);t.filters.push(i)},PropertyIsLessThanOrEqualTo:function(e,t){var i=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO});this.readChildNodes(e,i);t.filters.push(i)},PropertyIsGreaterThanOrEqualTo:function(e,t){var i=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO});this.readChildNodes(e,i);t.filters.push(i)},PropertyIsBetween:function(e,t){var i=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.BETWEEN});this.readChildNodes(e,i);t.filters.push(i)},Literal:function(e,t){t.value=OpenLayers.String.numericIf(this.getChildValue(e),true)},PropertyName:function(e,t){t.property=this.getChildValue(e)},LowerBoundary:function(e,t){t.lowerBoundary=OpenLayers.String.numericIf(this.readers.ogc._expression.call(this,e),true)},UpperBoundary:function(e,t){t.upperBoundary=OpenLayers.String.numericIf(this.readers.ogc._expression.call(this,e),true)},Intersects:function(e,t){this.readSpatial(e,t,OpenLayers.Filter.Spatial.INTERSECTS)},Within:function(e,t){this.readSpatial(e,t,OpenLayers.Filter.Spatial.WITHIN)},Contains:function(e,t){this.readSpatial(e,t,OpenLayers.Filter.Spatial.CONTAINS)},DWithin:function(e,t){this.readSpatial(e,t,OpenLayers.Filter.Spatial.DWITHIN)},Distance:function(e,t){t.distance=parseInt(this.getChildValue(e));t.distanceUnits=e.getAttribute("units")},Function:function(e,t){return},PropertyIsNull:function(e,t){var i=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.IS_NULL});this.readChildNodes(e,i);t.filters.push(i)}}},readSpatial:function(e,t,i){var r=new OpenLayers.Filter.Spatial({type:i});this.readChildNodes(e,r);r.value=r.components[0];delete r.components;t.filters.push(r)},encodeLiteral:function(e){if(e instanceof Date){e=OpenLayers.Date.toISOString(e)}return e},writeOgcExpression:function(e,t){if(e instanceof OpenLayers.Filter.Function){this.writeNode("Function",e,t)}else{this.writeNode("Literal",e,t)}return t},write:function(e){return this.writers.ogc["Filter"].apply(this,[e])},writers:{ogc:{Filter:function(e){var t=this.createElementNSPlus("ogc:Filter");this.writeNode(this.getFilterType(e),e,t);return t},_featureIds:function(e){var t=this.createDocumentFragment();for(var i=0,r=e.fids.length;i<r;++i){this.writeNode("ogc:FeatureId",e.fids[i],t)}return t},FeatureId:function(e){return this.createElementNSPlus("ogc:FeatureId",{attributes:{fid:e}})},And:function(e){var t=this.createElementNSPlus("ogc:And");var i;for(var r=0,a=e.filters.length;r<a;++r){i=e.filters[r];this.writeNode(this.getFilterType(i),i,t)}return t},Or:function(e){var t=this.createElementNSPlus("ogc:Or");var i;for(var r=0,a=e.filters.length;r<a;++r){i=e.filters[r];this.writeNode(this.getFilterType(i),i,t)}return t},Not:function(e){var t=this.createElementNSPlus("ogc:Not");var i=e.filters[0];this.writeNode(this.getFilterType(i),i,t);return t},PropertyIsLessThan:function(e){var t=this.createElementNSPlus("ogc:PropertyIsLessThan");this.writeNode("PropertyName",e,t);this.writeOgcExpression(e.value,t);return t},PropertyIsGreaterThan:function(e){var t=this.createElementNSPlus("ogc:PropertyIsGreaterThan");this.writeNode("PropertyName",e,t);this.writeOgcExpression(e.value,t);return t},PropertyIsLessThanOrEqualTo:function(e){var t=this.createElementNSPlus("ogc:PropertyIsLessThanOrEqualTo");this.writeNode("PropertyName",e,t);this.writeOgcExpression(e.value,t);return t},PropertyIsGreaterThanOrEqualTo:function(e){var t=this.createElementNSPlus("ogc:PropertyIsGreaterThanOrEqualTo");this.writeNode("PropertyName",e,t);this.writeOgcExpression(e.value,t);return t},PropertyIsBetween:function(e){var t=this.createElementNSPlus("ogc:PropertyIsBetween");this.writeNode("PropertyName",e,t);this.writeNode("LowerBoundary",e,t);this.writeNode("UpperBoundary",e,t);return t},PropertyName:function(e){return this.createElementNSPlus("ogc:PropertyName",{value:e.property})},Literal:function(e){var t=this.encodeLiteral||OpenLayers.Format.Filter.v1.prototype.encodeLiteral;return this.createElementNSPlus("ogc:Literal",{value:t(e)})},LowerBoundary:function(e){var t=this.createElementNSPlus("ogc:LowerBoundary");this.writeOgcExpression(e.lowerBoundary,t);return t},UpperBoundary:function(e){var t=this.createElementNSPlus("ogc:UpperBoundary");this.writeNode("Literal",e.upperBoundary,t);return t},INTERSECTS:function(e){return this.writeSpatial(e,"Intersects")},WITHIN:function(e){return this.writeSpatial(e,"Within")},CONTAINS:function(e){return this.writeSpatial(e,"Contains")},DWITHIN:function(e){var t=this.writeSpatial(e,"DWithin");this.writeNode("Distance",e,t);return t},Distance:function(e){return this.createElementNSPlus("ogc:Distance",{attributes:{units:e.distanceUnits},value:e.distance})},Function:function(e){var t=this.createElementNSPlus("ogc:Function",{attributes:{name:e.name}});var i=e.params;for(var r=0,a=i.length;r<a;r++){this.writeOgcExpression(i[r],t)}return t},PropertyIsNull:function(e){var t=this.createElementNSPlus("ogc:PropertyIsNull");this.writeNode("PropertyName",e,t);return t}}},getFilterType:function(e){var t=this.filterMap[e.type];if(!t){throw"Filter writing not supported for rule type: "+e.type}return t},filterMap:{"&&":"And","||":"Or","!":"Not","==":"PropertyIsEqualTo","!=":"PropertyIsNotEqualTo","<":"PropertyIsLessThan",">":"PropertyIsGreaterThan","<=":"PropertyIsLessThanOrEqualTo",">=":"PropertyIsGreaterThanOrEqualTo","..":"PropertyIsBetween","~":"PropertyIsLike",NULL:"PropertyIsNull",BBOX:"BBOX",DWITHIN:"DWITHIN",WITHIN:"WITHIN",CONTAINS:"CONTAINS",INTERSECTS:"INTERSECTS",FID:"_featureIds"},CLASS_NAME:"OpenLayers.Format.Filter.v1"});OpenLayers.Format.Filter.v1_0_0=OpenLayers.Class(OpenLayers.Format.GML.v2,OpenLayers.Format.Filter.v1,{VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/ogc/filter/1.0.0/filter.xsd",initialize:function(e){OpenLayers.Format.GML.v2.prototype.initialize.apply(this,[e])},readers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(e,t){var i=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO});this.readChildNodes(e,i);t.filters.push(i)},PropertyIsNotEqualTo:function(e,t){var i=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.NOT_EQUAL_TO});this.readChildNodes(e,i);t.filters.push(i)},PropertyIsLike:function(e,t){var i=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LIKE});this.readChildNodes(e,i);var r=e.getAttribute("wildCard");var a=e.getAttribute("singleChar");var s=e.getAttribute("escape");i.value2regex(r,a,s);t.filters.push(i)}},OpenLayers.Format.Filter.v1.prototype.readers["ogc"]),gml:OpenLayers.Format.GML.v2.prototype.readers["gml"],feature:OpenLayers.Format.GML.v2.prototype.readers["feature"]},writers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(e){var t=this.createElementNSPlus("ogc:PropertyIsEqualTo");this.writeNode("PropertyName",e,t);this.writeOgcExpression(e.value,t);return t},PropertyIsNotEqualTo:function(e){var t=this.createElementNSPlus("ogc:PropertyIsNotEqualTo");this.writeNode("PropertyName",e,t);this.writeOgcExpression(e.value,t);return t},PropertyIsLike:function(e){var t=this.createElementNSPlus("ogc:PropertyIsLike",{attributes:{wildCard:"*",singleChar:".",escape:"!"}});this.writeNode("PropertyName",e,t);this.writeNode("Literal",e.regex2value(),t);return t},BBOX:function(e){var t=this.createElementNSPlus("ogc:BBOX");e.property&&this.writeNode("PropertyName",e,t);var i=this.writeNode("gml:Box",e.value,t);if(e.projection){i.setAttribute("srsName",e.projection)}return t}},OpenLayers.Format.Filter.v1.prototype.writers["ogc"]),gml:OpenLayers.Format.GML.v2.prototype.writers["gml"],feature:OpenLayers.Format.GML.v2.prototype.writers["feature"]},writeSpatial:function(e,t){var i=this.createElementNSPlus("ogc:"+t);this.writeNode("PropertyName",e,i);if(e.value instanceof OpenLayers.Filter.Function){this.writeNode("Function",e.value,i)}else{var r;if(e.value instanceof OpenLayers.Geometry){r=this.writeNode("feature:_geometry",e.value).firstChild}else{r=this.writeNode("gml:Box",e.value)}if(e.projection){r.setAttribute("srsName",e.projection)}i.appendChild(r)}return i},CLASS_NAME:"OpenLayers.Format.Filter.v1_0_0"});OpenLayers.Format.SLD.v1=OpenLayers.Class(OpenLayers.Format.Filter.v1_0_0,{namespaces:{sld:"http://www.opengis.net/sld",ogc:"http://www.opengis.net/ogc",gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"sld",schemaLocation:null,multipleSymbolizers:false,featureTypeCounter:null,defaultSymbolizer:{fillColor:"#808080",fillOpacity:1,strokeColor:"#000000",strokeOpacity:1,strokeWidth:1,strokeDashstyle:"solid",pointRadius:3,graphicName:"square"},read:function(e,t){t=OpenLayers.Util.applyDefaults(t,this.options);var i={namedLayers:t.namedLayersAsArray===true?[]:{}};this.readChildNodes(e,i);return i},readers:OpenLayers.Util.applyDefaults({sld:{StyledLayerDescriptor:function(e,t){t.version=e.getAttribute("version");this.readChildNodes(e,t)},Name:function(e,t){t.name=this.getChildValue(e)},Title:function(e,t){t.title=this.getChildValue(e)},Abstract:function(e,t){t.description=this.getChildValue(e)},NamedLayer:function(e,t){var i={userStyles:[],namedStyles:[]};this.readChildNodes(e,i);for(var r=0,a=i.userStyles.length;r<a;++r){i.userStyles[r].layerName=i.name}if(OpenLayers.Util.isArray(t.namedLayers)){t.namedLayers.push(i)}else{t.namedLayers[i.name]=i}},NamedStyle:function(e,t){t.namedStyles.push(this.getChildName(e.firstChild))},UserStyle:function(e,t){var i={defaultsPerSymbolizer:true,rules:[]};this.featureTypeCounter=-1;this.readChildNodes(e,i);var r;if(this.multipleSymbolizers){delete i.defaultsPerSymbolizer;r=new OpenLayers.Style2(i)}else{r=new OpenLayers.Style(this.defaultSymbolizer,i)}t.userStyles.push(r)},IsDefault:function(e,t){if(this.getChildValue(e)=="1"){t.isDefault=true}},FeatureTypeStyle:function(e,t){++this.featureTypeCounter;var i={rules:this.multipleSymbolizers?t.rules:[]};this.readChildNodes(e,i);if(!this.multipleSymbolizers){t.rules=i.rules}},Rule:function(e,t){var i;if(this.multipleSymbolizers){i={symbolizers:[]}}var r=new OpenLayers.Rule(i);this.readChildNodes(e,r);t.rules.push(r)},ElseFilter:function(e,t){t.elseFilter=true},MinScaleDenominator:function(e,t){t.minScaleDenominator=parseFloat(this.getChildValue(e))},MaxScaleDenominator:function(e,t){t.maxScaleDenominator=parseFloat(this.getChildValue(e))},TextSymbolizer:function(e,t){var i={};this.readChildNodes(e,i);if(this.multipleSymbolizers){i.zIndex=this.featureTypeCounter;t.symbolizers.push(new OpenLayers.Symbolizer.Text(i))}else{t.symbolizer["Text"]=OpenLayers.Util.applyDefaults(i,t.symbolizer["Text"])}},LabelPlacement:function(e,t){this.readChildNodes(e,t)},PointPlacement:function(e,t){var i={};this.readChildNodes(e,i);i.labelRotation=i.rotation;delete i.rotation;var r,a=t.labelAnchorPointX,s=t.labelAnchorPointY;if(a<=1/3){r="l"}else if(a>1/3&&a<2/3){r="c"}else if(a>=2/3){r="r"}if(s<=1/3){r+="b"}else if(s>1/3&&s<2/3){r+="m"}else if(s>=2/3){r+="t"}i.labelAlign=r;OpenLayers.Util.applyDefaults(t,i)},AnchorPoint:function(e,t){this.readChildNodes(e,t)},AnchorPointX:function(e,t){var i=this.readers.ogc._expression.call(this,e);if(i){t.labelAnchorPointX=i}},AnchorPointY:function(e,t){var i=this.readers.ogc._expression.call(this,e);if(i){t.labelAnchorPointY=i}},Displacement:function(e,t){this.readChildNodes(e,t)},DisplacementX:function(e,t){var i=this.readers.ogc._expression.call(this,e);if(i){t.labelXOffset=i}},DisplacementY:function(e,t){var i=this.readers.ogc._expression.call(this,e);if(i){t.labelYOffset=i}},LinePlacement:function(e,t){this.readChildNodes(e,t)},PerpendicularOffset:function(e,t){var i=this.readers.ogc._expression.call(this,e);if(i){t.labelPerpendicularOffset=i}},Label:function(e,t){var i=this.readers.ogc._expression.call(this,e);if(i){t.label=i}},Font:function(e,t){this.readChildNodes(e,t)},Halo:function(e,t){var i={};this.readChildNodes(e,i);t.haloRadius=i.haloRadius;t.haloColor=i.fillColor;t.haloOpacity=i.fillOpacity},Radius:function(e,t){var i=this.readers.ogc._expression.call(this,e);if(i!=null){t.haloRadius=i}},RasterSymbolizer:function(e,t){var i={};this.readChildNodes(e,i);if(this.multipleSymbolizers){i.zIndex=this.featureTypeCounter;t.symbolizers.push(new OpenLayers.Symbolizer.Raster(i))}else{t.symbolizer["Raster"]=OpenLayers.Util.applyDefaults(i,t.symbolizer["Raster"])}},Geometry:function(e,t){t.geometry={};this.readChildNodes(e,t.geometry)},ColorMap:function(e,t){t.colorMap=[];this.readChildNodes(e,t.colorMap)},ColorMapEntry:function(e,t){var i=e.getAttribute("quantity");var r=e.getAttribute("opacity");t.push({color:e.getAttribute("color"),quantity:i!==null?parseFloat(i):undefined,label:e.getAttribute("label")||undefined,opacity:r!==null?parseFloat(r):undefined})},LineSymbolizer:function(e,t){var i={};this.readChildNodes(e,i);if(this.multipleSymbolizers){i.zIndex=this.featureTypeCounter;t.symbolizers.push(new OpenLayers.Symbolizer.Line(i))}else{t.symbolizer["Line"]=OpenLayers.Util.applyDefaults(i,t.symbolizer["Line"])}},PolygonSymbolizer:function(e,t){var i={fill:false,stroke:false};if(!this.multipleSymbolizers){i=t.symbolizer["Polygon"]||i}this.readChildNodes(e,i);if(this.multipleSymbolizers){i.zIndex=this.featureTypeCounter;t.symbolizers.push(new OpenLayers.Symbolizer.Polygon(i))}else{t.symbolizer["Polygon"]=i}},PointSymbolizer:function(e,t){var i={fill:false,stroke:false,graphic:false};if(!this.multipleSymbolizers){i=t.symbolizer["Point"]||i}this.readChildNodes(e,i);if(this.multipleSymbolizers){i.zIndex=this.featureTypeCounter;t.symbolizers.push(new OpenLayers.Symbolizer.Point(i))}else{t.symbolizer["Point"]=i}},Stroke:function(e,t){t.stroke=true;this.readChildNodes(e,t)},Fill:function(e,t){t.fill=true;this.readChildNodes(e,t)},CssParameter:function(e,t){var i=e.getAttribute("name");var r=this.cssMap[i];if(t.label){if(i==="fill"){r="fontColor"}else if(i==="fill-opacity"){r="fontOpacity"}}if(r){var a=this.readers.ogc._expression.call(this,e);if(a){t[r]=a}}},Graphic:function(e,t){t.graphic=true;var i={};this.readChildNodes(e,i);var r=["stroke","strokeColor","strokeWidth","strokeOpacity","strokeLinecap","fill","fillColor","fillOpacity","graphicName","rotation","graphicFormat"];var a,s;for(var n=0,o=r.length;n<o;++n){a=r[n];s=i[a];if(s!=undefined){t[a]=s}}if(i.opacity!=undefined){t.graphicOpacity=i.opacity}if(i.size!=undefined){var l=i.size/2;if(isNaN(l)){t.graphicWidth=i.size}else{t.pointRadius=i.size/2}}if(i.href!=undefined){t.externalGraphic=i.href}if(i.rotation!=undefined){t.rotation=i.rotation}},ExternalGraphic:function(e,t){this.readChildNodes(e,t)},Mark:function(e,t){this.readChildNodes(e,t)},WellKnownName:function(e,t){t.graphicName=this.getChildValue(e)},Opacity:function(e,t){var i=this.readers.ogc._expression.call(this,e);if(i){t.opacity=i}},Size:function(e,t){var i=this.readers.ogc._expression.call(this,e);if(i){t.size=i}},Rotation:function(e,t){var i=this.readers.ogc._expression.call(this,e);if(i){t.rotation=i}},OnlineResource:function(e,t){t.href=this.getAttributeNS(e,this.namespaces.xlink,"href")},Format:function(e,t){t.graphicFormat=this.getChildValue(e)}}},OpenLayers.Format.Filter.v1_0_0.prototype.readers),cssMap:{stroke:"strokeColor","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","stroke-linecap":"strokeLinecap","stroke-dasharray":"strokeDashstyle",fill:"fillColor","fill-opacity":"fillOpacity","font-family":"fontFamily","font-size":"fontSize","font-weight":"fontWeight","font-style":"fontStyle"},getCssProperty:function(e){var t=null;for(var i in this.cssMap){if(this.cssMap[i]==e){t=i;break}}return t},getGraphicFormat:function(e){var t,i;for(var r in this.graphicFormats){if(this.graphicFormats[r].test(e)){t=r;break}}return t||this.defaultGraphicFormat},defaultGraphicFormat:"image/png",graphicFormats:{"image/jpeg":/\.jpe?g$/i,"image/gif":/\.gif$/i,"image/png":/\.png$/i},write:function(e){return this.writers.sld.StyledLayerDescriptor.apply(this,[e])},writers:OpenLayers.Util.applyDefaults({sld:{_OGCExpression:function(e,t){var i=this.createElementNSPlus(e);var r=typeof t=="string"?t.split("${"):[t];i.appendChild(this.createTextNode(r[0]));var a,s;for(var n=1,o=r.length;n<o;n++){a=r[n];s=a.indexOf("}");if(s>0){this.writeNode("ogc:PropertyName",{property:a.substring(0,s)},i);i.appendChild(this.createTextNode(a.substring(++s)))}else{i.appendChild(this.createTextNode("${"+a))}}return i},StyledLayerDescriptor:function(e){var t=this.createElementNSPlus("sld:StyledLayerDescriptor",{attributes:{version:this.VERSION,"xsi:schemaLocation":this.schemaLocation}});t.setAttribute("xmlns:ogc",this.namespaces.ogc);t.setAttribute("xmlns:gml",this.namespaces.gml);if(e.name){this.writeNode("Name",e.name,t)}if(e.title){this.writeNode("Title",e.title,t)}if(e.description){this.writeNode("Abstract",e.description,t)}if(OpenLayers.Util.isArray(e.namedLayers)){for(var i=0,r=e.namedLayers.length;i<r;++i){this.writeNode("NamedLayer",e.namedLayers[i],t)}}else{for(var a in e.namedLayers){this.writeNode("NamedLayer",e.namedLayers[a],t)}}return t},Name:function(e){return this.createElementNSPlus("sld:Name",{value:e})},Title:function(e){return this.createElementNSPlus("sld:Title",{value:e})},Abstract:function(e){return this.createElementNSPlus("sld:Abstract",{value:e})},NamedLayer:function(e){var t=this.createElementNSPlus("sld:NamedLayer");this.writeNode("Name",e.name,t);if(e.namedStyles){for(var i=0,r=e.namedStyles.length;i<r;++i){this.writeNode("NamedStyle",e.namedStyles[i],t)}}if(e.userStyles){for(var i=0,r=e.userStyles.length;i<r;++i){this.writeNode("UserStyle",e.userStyles[i],t)}}return t},NamedStyle:function(e){var t=this.createElementNSPlus("sld:NamedStyle");this.writeNode("Name",e,t);return t},UserStyle:function(e){var t=this.createElementNSPlus("sld:UserStyle");if(e.name){this.writeNode("Name",e.name,t)}if(e.title){this.writeNode("Title",e.title,t)}if(e.description){this.writeNode("Abstract",e.description,t)}if(e.isDefault){this.writeNode("IsDefault",e.isDefault,t)}if(this.multipleSymbolizers&&e.rules){var i={0:[]};var r=[0];var a,s,n,o,l;for(var h=0,p=e.rules.length;h<p;++h){a=e.rules[h];if(a.symbolizers){s={};for(var u=0,c=a.symbolizers.length;u<c;++u){n=a.symbolizers[u];o=n.zIndex;if(!(o in s)){l=a.clone();l.symbolizers=[];s[o]=l}s[o].symbolizers.push(n.clone())}for(o in s){if(!(o in i)){r.push(o);i[o]=[]}i[o].push(s[o])}}else{i[0].push(a.clone())}}r.sort();var d;for(var h=0,p=r.length;h<p;++h){d=i[r[h]];if(d.length>0){l=e.clone();l.rules=i[r[h]];this.writeNode("FeatureTypeStyle",l,t)}}}else{this.writeNode("FeatureTypeStyle",e,t)}return t},IsDefault:function(e){return this.createElementNSPlus("sld:IsDefault",{value:e?"1":"0"})},FeatureTypeStyle:function(e){var t=this.createElementNSPlus("sld:FeatureTypeStyle");for(var i=0,r=e.rules.length;i<r;++i){this.writeNode("Rule",e.rules[i],t)}return t},Rule:function(e){var t=this.createElementNSPlus("sld:Rule");if(e.name){this.writeNode("Name",e.name,t)}if(e.title){this.writeNode("Title",e.title,t)}if(e.description){this.writeNode("Abstract",e.description,t)}if(e.elseFilter){this.writeNode("ElseFilter",null,t)}else if(e.filter){this.writeNode("ogc:Filter",e.filter,t)}if(e.minScaleDenominator!=undefined){this.writeNode("MinScaleDenominator",e.minScaleDenominator,t)}if(e.maxScaleDenominator!=undefined){this.writeNode("MaxScaleDenominator",e.maxScaleDenominator,t)}var i,r;if(this.multipleSymbolizers&&e.symbolizers){var r;for(var a=0,s=e.symbolizers.length;a<s;++a){r=e.symbolizers[a];i=r.CLASS_NAME.split(".").pop();this.writeNode(i+"Symbolizer",r,t)}}else{var n=OpenLayers.Style.SYMBOLIZER_PREFIXES;for(var a=0,o=n.length;a<o;++a){i=n[a];r=e.symbolizer[i];if(r){this.writeNode(i+"Symbolizer",r,t)}}}return t},ElseFilter:function(){return this.createElementNSPlus("sld:ElseFilter")},MinScaleDenominator:function(e){return this.createElementNSPlus("sld:MinScaleDenominator",{value:e})},MaxScaleDenominator:function(e){return this.createElementNSPlus("sld:MaxScaleDenominator",{value:e})},LineSymbolizer:function(e){var t=this.createElementNSPlus("sld:LineSymbolizer");this.writeNode("Stroke",e,t);return t},Stroke:function(e){var t=this.createElementNSPlus("sld:Stroke");if(e.strokeColor!=undefined){this.writeNode("CssParameter",{symbolizer:e,key:"strokeColor"},t)}if(e.strokeOpacity!=undefined){this.writeNode("CssParameter",{symbolizer:e,key:"strokeOpacity"},t)}if(e.strokeWidth!=undefined){this.writeNode("CssParameter",{symbolizer:e,key:"strokeWidth"},t)}if(e.strokeDashstyle!=undefined&&e.strokeDashstyle!=="solid"){this.writeNode("CssParameter",{symbolizer:e,key:"strokeDashstyle"},t)}if(e.strokeLinecap!=undefined){this.writeNode("CssParameter",{symbolizer:e,key:"strokeLinecap"},t)}return t},CssParameter:function(e){return this.createElementNSPlus("sld:CssParameter",{attributes:{name:this.getCssProperty(e.key)},value:e.symbolizer[e.key]})},TextSymbolizer:function(e){var t=this.createElementNSPlus("sld:TextSymbolizer");if(e.label!=null){this.writeNode("Label",e.label,t)}if(e.fontFamily!=null||e.fontSize!=null||e.fontWeight!=null||e.fontStyle!=null){this.writeNode("Font",e,t)}if(e.labelAnchorPointX!=null||e.labelAnchorPointY!=null||e.labelAlign!=null||e.labelXOffset!=null||e.labelYOffset!=null||e.labelRotation!=null||e.labelPerpendicularOffset!=null){this.writeNode("LabelPlacement",e,t)}if(e.haloRadius!=null||e.haloColor!=null||e.haloOpacity!=null){this.writeNode("Halo",e,t)}if(e.fontColor!=null||e.fontOpacity!=null){this.writeNode("Fill",{fillColor:e.fontColor,fillOpacity:e.fontOpacity},t)}return t},LabelPlacement:function(e){var t=this.createElementNSPlus("sld:LabelPlacement");if((e.labelAnchorPointX!=null||e.labelAnchorPointY!=null||e.labelAlign!=null||e.labelXOffset!=null||e.labelYOffset!=null||e.labelRotation!=null)&&e.labelPerpendicularOffset==null){this.writeNode("PointPlacement",e,t)}if(e.labelPerpendicularOffset!=null){this.writeNode("LinePlacement",e,t)}return t},LinePlacement:function(e){var t=this.createElementNSPlus("sld:LinePlacement");this.writeNode("PerpendicularOffset",e.labelPerpendicularOffset,t);return t},PerpendicularOffset:function(e){return this.createElementNSPlus("sld:PerpendicularOffset",{value:e})},PointPlacement:function(e){var t=this.createElementNSPlus("sld:PointPlacement");if(e.labelAnchorPointX!=null||e.labelAnchorPointY!=null||e.labelAlign!=null){this.writeNode("AnchorPoint",e,t)}if(e.labelXOffset!=null||e.labelYOffset!=null){this.writeNode("Displacement",e,t)}if(e.labelRotation!=null){this.writeNode("Rotation",e.labelRotation,t)}return t},AnchorPoint:function(e){var t=this.createElementNSPlus("sld:AnchorPoint");var i=e.labelAnchorPointX,r=e.labelAnchorPointY;if(i!=null){this.writeNode("AnchorPointX",i,t)}if(r!=null){this.writeNode("AnchorPointY",r,t)}if(i==null&&r==null){var a=e.labelAlign.substr(0,1),s=e.labelAlign.substr(1,1);if(a==="l"){i=0}else if(a==="c"){i=.5}else if(a==="r"){i=1}if(s==="b"){r=0}else if(s==="m"){r=.5}else if(s==="t"){r=1}this.writeNode("AnchorPointX",i,t);this.writeNode("AnchorPointY",r,t)}return t},AnchorPointX:function(e){return this.createElementNSPlus("sld:AnchorPointX",{value:e})},AnchorPointY:function(e){return this.createElementNSPlus("sld:AnchorPointY",{value:e})},Displacement:function(e){var t=this.createElementNSPlus("sld:Displacement");if(e.labelXOffset!=null){this.writeNode("DisplacementX",e.labelXOffset,t)}if(e.labelYOffset!=null){this.writeNode("DisplacementY",e.labelYOffset,t)}return t},DisplacementX:function(e){return this.createElementNSPlus("sld:DisplacementX",{value:e})},DisplacementY:function(e){return this.createElementNSPlus("sld:DisplacementY",{value:e})},Font:function(e){var t=this.createElementNSPlus("sld:Font");if(e.fontFamily){this.writeNode("CssParameter",{symbolizer:e,key:"fontFamily"},t)}if(e.fontSize){this.writeNode("CssParameter",{symbolizer:e,key:"fontSize"},t)}if(e.fontWeight){this.writeNode("CssParameter",{symbolizer:e,key:"fontWeight"},t)}if(e.fontStyle){this.writeNode("CssParameter",{symbolizer:e,key:"fontStyle"},t)}return t},Label:function(e){return this.writers.sld._OGCExpression.call(this,"sld:Label",e)},Halo:function(e){var t=this.createElementNSPlus("sld:Halo");if(e.haloRadius){this.writeNode("Radius",e.haloRadius,t)}if(e.haloColor||e.haloOpacity){this.writeNode("Fill",{fillColor:e.haloColor,fillOpacity:e.haloOpacity},t)}return t},Radius:function(e){return this.createElementNSPlus("sld:Radius",{value:e})},RasterSymbolizer:function(e){var t=this.createElementNSPlus("sld:RasterSymbolizer");if(e.geometry){this.writeNode("Geometry",e.geometry,t)}if(e.opacity){this.writeNode("Opacity",e.opacity,t)}if(e.colorMap){this.writeNode("ColorMap",e.colorMap,t)}return t},Geometry:function(e){var t=this.createElementNSPlus("sld:Geometry");if(e.property){this.writeNode("ogc:PropertyName",e,t)}return t},ColorMap:function(e){var t=this.createElementNSPlus("sld:ColorMap");for(var i=0,r=e.length;i<r;++i){this.writeNode("ColorMapEntry",e[i],t)}return t},ColorMapEntry:function(e){var t=this.createElementNSPlus("sld:ColorMapEntry");var i=e;t.setAttribute("color",i.color);i.opacity!==undefined&&t.setAttribute("opacity",parseFloat(i.opacity));i.quantity!==undefined&&t.setAttribute("quantity",parseFloat(i.quantity));i.label!==undefined&&t.setAttribute("label",i.label);return t},PolygonSymbolizer:function(e){var t=this.createElementNSPlus("sld:PolygonSymbolizer");if(e.fill!==false){this.writeNode("Fill",e,t)}if(e.stroke!==false){this.writeNode("Stroke",e,t)}return t},Fill:function(e){var t=this.createElementNSPlus("sld:Fill");if(e.fillColor){this.writeNode("CssParameter",{symbolizer:e,key:"fillColor"},t)}if(e.fillOpacity!=null){this.writeNode("CssParameter",{symbolizer:e,key:"fillOpacity"},t)}return t},PointSymbolizer:function(e){var t=this.createElementNSPlus("sld:PointSymbolizer");this.writeNode("Graphic",e,t);return t},Graphic:function(e){var t=this.createElementNSPlus("sld:Graphic");if(e.externalGraphic!=undefined){this.writeNode("ExternalGraphic",e,t)}else{this.writeNode("Mark",e,t)}if(e.graphicOpacity!=undefined){this.writeNode("Opacity",e.graphicOpacity,t)}if(e.pointRadius!=undefined){this.writeNode("Size",e.pointRadius*2,t)}else if(e.graphicWidth!=undefined){this.writeNode("Size",e.graphicWidth,t)}if(e.rotation!=undefined){this.writeNode("Rotation",e.rotation,t)}return t},ExternalGraphic:function(e){var t=this.createElementNSPlus("sld:ExternalGraphic");this.writeNode("OnlineResource",e.externalGraphic,t);var i=e.graphicFormat||this.getGraphicFormat(e.externalGraphic);this.writeNode("Format",i,t);return t},Mark:function(e){var t=this.createElementNSPlus("sld:Mark");if(e.graphicName){this.writeNode("WellKnownName",e.graphicName,t)}if(e.fill!==false){this.writeNode("Fill",e,t)}if(e.stroke!==false){this.writeNode("Stroke",e,t)}return t},WellKnownName:function(e){return this.createElementNSPlus("sld:WellKnownName",{value:e})},Opacity:function(e){return this.createElementNSPlus("sld:Opacity",{value:e})},Size:function(e){return this.writers.sld._OGCExpression.call(this,"sld:Size",e)},Rotation:function(e){return this.createElementNSPlus("sld:Rotation",{value:e})},OnlineResource:function(e){return this.createElementNSPlus("sld:OnlineResource",{attributes:{"xlink:type":"simple","xlink:href":e}})},Format:function(e){return this.createElementNSPlus("sld:Format",{value:e})}}},OpenLayers.Format.Filter.v1_0_0.prototype.writers),CLASS_NAME:"OpenLayers.Format.SLD.v1"});OpenLayers.Format.SLD.v1_0_0=OpenLayers.Class(OpenLayers.Format.SLD.v1,{VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/sld http://schemas.opengis.net/sld/1.0.0/StyledLayerDescriptor.xsd",CLASS_NAME:"OpenLayers.Format.SLD.v1_0_0"});OpenLayers.Protocol=OpenLayers.Class({format:null,options:null,autoDestroy:true,defaultFilter:null,initialize:function(e){e=e||{};OpenLayers.Util.extend(this,e);this.options=e},mergeWithDefaultFilter:function(e){var t;if(e&&this.defaultFilter){t=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,filters:[this.defaultFilter,e]})}else{t=e||this.defaultFilter||undefined}return t},destroy:function(){this.options=null;this.format=null},read:function(e){e=e||{};e.filter=this.mergeWithDefaultFilter(e.filter)},create:function(){},update:function(){},delete:function(){},commit:function(){},abort:function(e){},createCallback:function(e,t,i){return OpenLayers.Function.bind(function(){e.apply(this,[t,i])},this)},CLASS_NAME:"OpenLayers.Protocol"});OpenLayers.Protocol.Response=OpenLayers.Class({code:null,requestType:null,last:true,features:null,data:null,reqFeatures:null,priv:null,error:null,initialize:function(e){OpenLayers.Util.extend(this,e)},success:function(){return this.code>0},CLASS_NAME:"OpenLayers.Protocol.Response"});OpenLayers.Protocol.Response.SUCCESS=1;OpenLayers.Protocol.Response.FAILURE=0;OpenLayers.ProxyHost="";if(!OpenLayers.Request){OpenLayers.Request={}}OpenLayers.Util.extend(OpenLayers.Request,{DEFAULT_CONFIG:{method:"GET",url:window.location.href,async:true,user:undefined,password:undefined,params:null,proxy:OpenLayers.ProxyHost,headers:{},data:null,callback:function(){},success:null,failure:null,scope:null},URL_SPLIT_REGEX:/([^:]*:)\/\/([^:]*:?[^@]*@)?([^:\/\?]*):?([^\/\?]*)/,events:new OpenLayers.Events(this),makeSameOrigin:function(e,t){var i=e.indexOf("http")!==0;var r=!i&&e.match(this.URL_SPLIT_REGEX);if(r){var a=window.location;i=r[1]==a.protocol&&r[3]==a.hostname;var s=r[4],n=a.port;if(s!=80&&s!=""||n!="80"&&n!=""){i=i&&s==n}}if(!i){if(t){if(typeof t=="function"){e=t(e)}else{e=t+encodeURIComponent(e)}}}return e},issue:function(t){var e=OpenLayers.Util.extend(this.DEFAULT_CONFIG,{proxy:OpenLayers.ProxyHost});t=t||{};t.headers=t.headers||{};t=OpenLayers.Util.applyDefaults(t,e);t.headers=OpenLayers.Util.applyDefaults(t.headers,e.headers);var i=false,r;for(r in t.headers){if(t.headers.hasOwnProperty(r)){if(r.toLowerCase()==="x-requested-with"){i=true}}}if(i===false){t.headers["X-Requested-With"]="XMLHttpRequest"}var a=new OpenLayers.Request.XMLHttpRequest;var s=OpenLayers.Util.urlAppend(t.url,OpenLayers.Util.getParameterString(t.params||{}));s=OpenLayers.Request.makeSameOrigin(s,t.proxy);a.open(t.method,s,t.async,t.user,t.password);for(var n in t.headers){a.setRequestHeader(n,t.headers[n])}var o=this.events;var l=this;a.onreadystatechange=function(){if(a.readyState==OpenLayers.Request.XMLHttpRequest.DONE){var e=o.triggerEvent("complete",{request:a,config:t,requestUrl:s});if(e!==false){l.runCallbacks({request:a,config:t,requestUrl:s})}}};if(t.async===false){a.send(t.data)}else{window.setTimeout(function(){if(a.readyState!==0){a.send(t.data)}},0)}return a},runCallbacks:function(e){var t=e.request;var i=e.config;var r=i.scope?OpenLayers.Function.bind(i.callback,i.scope):i.callback;var a;if(i.success){a=i.scope?OpenLayers.Function.bind(i.success,i.scope):i.success}var s;if(i.failure){s=i.scope?OpenLayers.Function.bind(i.failure,i.scope):i.failure}if(OpenLayers.Util.createUrlObject(i.url).protocol=="file:"&&t.responseText){t.status=200}r(t);if(!t.status||t.status>=200&&t.status<300){this.events.triggerEvent("success",e);if(a){a(t)}}if(t.status&&(t.status<200||t.status>=300)){this.events.triggerEvent("failure",e);if(s){s(t)}}},GET:function(e){e=OpenLayers.Util.extend(e,{method:"GET"});return OpenLayers.Request.issue(e)},POST:function(e){e=OpenLayers.Util.extend(e,{method:"POST"});e.headers=e.headers?e.headers:{};if(!("CONTENT-TYPE"in OpenLayers.Util.upperCaseObject(e.headers))){e.headers["Content-Type"]="application/xml"}return OpenLayers.Request.issue(e)},PUT:function(e){e=OpenLayers.Util.extend(e,{method:"PUT"});e.headers=e.headers?e.headers:{};if(!("CONTENT-TYPE"in OpenLayers.Util.upperCaseObject(e.headers))){e.headers["Content-Type"]="application/xml"}return OpenLayers.Request.issue(e)},DELETE:function(e){e=OpenLayers.Util.extend(e,{method:"DELETE"});return OpenLayers.Request.issue(e)},HEAD:function(e){e=OpenLayers.Util.extend(e,{method:"HEAD"});return OpenLayers.Request.issue(e)},OPTIONS:function(e){e=OpenLayers.Util.extend(e,{method:"OPTIONS"});return OpenLayers.Request.issue(e)}});(function(){var e=window.XMLHttpRequest;var l=!!window.controllers,h=window.document.all&&!window.opera,t=h&&window.navigator.userAgent.match(/MSIE 7.0/);function i(){this._object=e&&!t?new e:new window.ActiveXObject("Microsoft.XMLHTTP");this._listeners=[]}function p(){return new i}p.prototype=i.prototype;if(l&&e.wrapped)p.wrapped=e.wrapped;p.UNSENT=0;p.OPENED=1;p.HEADERS_RECEIVED=2;p.LOADING=3;p.DONE=4;p.prototype.readyState=p.UNSENT;p.prototype.responseText="";p.prototype.responseXML=null;p.prototype.status=0;p.prototype.statusText="";p.prototype.priority="NORMAL";p.prototype.onreadystatechange=null;p.onreadystatechange=null;p.onopen=null;p.onsend=null;p.onabort=null;p.prototype.open=function(e,t,i,r,a){delete this._headers;if(arguments.length<3)i=true;this._async=i;var s=this,n=this.readyState,o;if(h&&i){o=function(){if(n!=p.DONE){d(s);s.abort()}};window.attachEvent("onunload",o)}if(p.onopen)p.onopen.apply(this,arguments);if(arguments.length>4)this._object.open(e,t,i,r,a);else if(arguments.length>3)this._object.open(e,t,i,r);else this._object.open(e,t,i);this.readyState=p.OPENED;u(this);this._object.onreadystatechange=function(){if(l&&!i)return;s.readyState=s._object.readyState;c(s);if(s._aborted){s.readyState=p.UNSENT;return}if(s.readyState==p.DONE){delete s._data;d(s);if(h&&i)window.detachEvent("onunload",o)}if(n!=s.readyState)u(s);n=s.readyState}};function r(e){e._object.send(e._data);if(l&&!e._async){e.readyState=p.OPENED;c(e);while(e.readyState<p.DONE){e.readyState++;u(e);if(e._aborted)return}}}p.prototype.send=function(e){if(p.onsend)p.onsend.apply(this,arguments);if(!arguments.length)e=null;if(e&&e.nodeType){e=window.XMLSerializer?(new window.XMLSerializer).serializeToString(e):e.xml;if(!this._headers["Content-Type"])this._object.setRequestHeader("Content-Type","application/xml")}this._data=e;r(this)};p.prototype.abort=function(){if(p.onabort)p.onabort.apply(this,arguments);if(this.readyState>p.UNSENT)this._aborted=true;this._object.abort();d(this);this.readyState=p.UNSENT;delete this._data};p.prototype.getAllResponseHeaders=function(){return this._object.getAllResponseHeaders()};p.prototype.getResponseHeader=function(e){return this._object.getResponseHeader(e)};p.prototype.setRequestHeader=function(e,t){if(!this._headers)this._headers={};this._headers[e]=t;return this._object.setRequestHeader(e,t)};p.prototype.addEventListener=function(e,t,i){for(var r=0,a;a=this._listeners[r];r++)if(a[0]==e&&a[1]==t&&a[2]==i)return;this._listeners.push([e,t,i])};p.prototype.removeEventListener=function(e,t,i){for(var r=0,a;a=this._listeners[r];r++)if(a[0]==e&&a[1]==t&&a[2]==i)break;if(a)this._listeners.splice(r,1)};p.prototype.dispatchEvent=function(e){var t={type:e.type,target:this,currentTarget:this,eventPhase:2,bubbles:e.bubbles,cancelable:e.cancelable,timeStamp:e.timeStamp,stopPropagation:function(){},preventDefault:function(){},initEvent:function(){}};if(t.type=="readystatechange"&&this.onreadystatechange)(this.onreadystatechange.handleEvent||this.onreadystatechange).apply(this,[t]);for(var i=0,r;r=this._listeners[i];i++)if(r[0]==t.type&&!r[2])(r[1].handleEvent||r[1]).apply(this,[t])};p.prototype.toString=function(){return"["+"object"+" "+"XMLHttpRequest"+"]"};p.toString=function(){return"["+"XMLHttpRequest"+"]"};function u(e){if(p.onreadystatechange)p.onreadystatechange.apply(e);e.dispatchEvent({type:"readystatechange",bubbles:false,cancelable:false,timeStamp:new Date+0})}function a(e){var t=e.responseXML,i=e.responseText;if(h&&i&&t&&!t.documentElement&&e.getResponseHeader("Content-Type").match(/[^\/]+\/[^\+]+\+xml/)){t=new window.ActiveXObject("Microsoft.XMLDOM");t.async=false;t.validateOnParse=false;t.loadXML(i)}if(t)if(h&&t.parseError!=0||!t.documentElement||t.documentElement&&t.documentElement.tagName=="parsererror")return null;return t}function c(e){try{e.responseText=e._object.responseText}catch(e){}try{e.responseXML=a(e._object)}catch(e){}try{e.status=e._object.status}catch(e){}try{e.statusText=e._object.statusText}catch(e){}}function d(e){e._object.onreadystatechange=new window.Function}if(!window.Function.prototype.apply){window.Function.prototype.apply=function(e,t){if(!t)t=[];e.__func=this;e.__func(t[0],t[1],t[2],t[3],t[4]);delete e.__func}}if(!OpenLayers.Request){OpenLayers.Request={}}OpenLayers.Request.XMLHttpRequest=p})();OpenLayers.Protocol.HTTP=OpenLayers.Class(OpenLayers.Protocol,{url:null,headers:null,params:null,callback:null,scope:null,readWithPOST:false,updateWithPOST:false,deleteWithPOST:false,wildcarded:false,srsInBBOX:false,initialize:function(e){e=e||{};this.params={};this.headers={};OpenLayers.Protocol.prototype.initialize.apply(this,arguments);if(!this.filterToParams&&OpenLayers.Format.QueryStringFilter){var i=new OpenLayers.Format.QueryStringFilter({wildcarded:this.wildcarded,srsInBBOX:this.srsInBBOX});this.filterToParams=function(e,t){return i.write(e,t)}}},destroy:function(){this.params=null;this.headers=null;OpenLayers.Protocol.prototype.destroy.apply(this)},read:function(e){OpenLayers.Protocol.prototype.read.apply(this,arguments);e=e||{};e.params=OpenLayers.Util.applyDefaults(e.params,this.options.params);e=OpenLayers.Util.applyDefaults(e,this.options);if(e.filter&&this.filterToParams){e.params=this.filterToParams(e.filter,e.params)}var t=e.readWithPOST!==undefined?e.readWithPOST:this.readWithPOST;var i=new OpenLayers.Protocol.Response({requestType:"read"});if(t){var r=e.headers||{};r["Content-Type"]="application/x-www-form-urlencoded";i.priv=OpenLayers.Request.POST({url:e.url,callback:this.createCallback(this.handleRead,i,e),data:OpenLayers.Util.getParameterString(e.params),headers:r})}else{i.priv=OpenLayers.Request.GET({url:e.url,callback:this.createCallback(this.handleRead,i,e),params:e.params,headers:e.headers})}return i},handleRead:function(e,t){this.handleResponse(e,t)},create:function(e,t){t=OpenLayers.Util.applyDefaults(t,this.options);var i=new OpenLayers.Protocol.Response({reqFeatures:e,requestType:"create"});i.priv=OpenLayers.Request.POST({url:t.url,callback:this.createCallback(this.handleCreate,i,t),headers:t.headers,data:this.format.write(e)});return i},handleCreate:function(e,t){this.handleResponse(e,t)},update:function(e,t){t=t||{};var i=t.url||e.url||this.options.url+"/"+e.fid;t=OpenLayers.Util.applyDefaults(t,this.options);var r=new OpenLayers.Protocol.Response({reqFeatures:e,requestType:"update"});var a=this.updateWithPOST?"POST":"PUT";r.priv=OpenLayers.Request[a]({url:i,callback:this.createCallback(this.handleUpdate,r,t),headers:t.headers,data:this.format.write(e)});return r},handleUpdate:function(e,t){this.handleResponse(e,t)},delete:function(e,t){t=t||{};var i=t.url||e.url||this.options.url+"/"+e.fid;t=OpenLayers.Util.applyDefaults(t,this.options);var r=new OpenLayers.Protocol.Response({reqFeatures:e,requestType:"delete"});var a=this.deleteWithPOST?"POST":"DELETE";var s={url:i,callback:this.createCallback(this.handleDelete,r,t),headers:t.headers};if(this.deleteWithPOST){s.data=this.format.write(e)}r.priv=OpenLayers.Request[a](s);return r},handleDelete:function(e,t){this.handleResponse(e,t)},handleResponse:function(e,t){var i=e.priv;if(t.callback){if(i.status>=200&&i.status<300){if(e.requestType!="delete"){e.features=this.parseFeatures(i)}e.code=OpenLayers.Protocol.Response.SUCCESS}else{e.code=OpenLayers.Protocol.Response.FAILURE}t.callback.call(t.scope,e)}},parseFeatures:function(e){var t=e.responseXML;if(!t||!t.documentElement){t=e.responseText}if(!t||t.length<=0){return null}return this.format.read(t)},commit:function(p,t){t=OpenLayers.Util.applyDefaults(t,this.options);var e=[],u=0;var i={};i[OpenLayers.State.INSERT]=[];i[OpenLayers.State.UPDATE]=[];i[OpenLayers.State.DELETE]=[];var r,a,c=[];for(var s=0,d=p.length;s<d;++s){r=p[s];a=i[r.state];if(a){a.push(r);c.push(r)}}var f=(i[OpenLayers.State.INSERT].length>0?1:0)+i[OpenLayers.State.UPDATE].length+i[OpenLayers.State.DELETE].length;var n=true;var o=new OpenLayers.Protocol.Response({reqFeatures:c});function y(e){var t=e.features?e.features.length:0;var i=new Array(t);for(var r=0;r<t;++r){i[r]=e.features[r].fid}o.insertIds=i;l.apply(this,[e])}function l(e){this.callUserCallback(e,t);n=n&&e.success();u++;if(u>=f){if(t.callback){o.code=n?OpenLayers.Protocol.Response.SUCCESS:OpenLayers.Protocol.Response.FAILURE;t.callback.apply(t.scope,[o])}}}var h=i[OpenLayers.State.INSERT];if(h.length>0){e.push(this.create(h,OpenLayers.Util.applyDefaults({callback:y,scope:this},t.create)))}h=i[OpenLayers.State.UPDATE];for(var s=h.length-1;s>=0;--s){e.push(this.update(h[s],OpenLayers.Util.applyDefaults({callback:l,scope:this},t.update)))}h=i[OpenLayers.State.DELETE];for(var s=h.length-1;s>=0;--s){e.push(this["delete"](h[s],OpenLayers.Util.applyDefaults({callback:l,scope:this},t["delete"])))}return e},abort:function(e){if(e){e.priv.abort()}},callUserCallback:function(e,t){var i=t[e.requestType];if(i&&i.callback){i.callback.call(i.scope,e)}},CLASS_NAME:"OpenLayers.Protocol.HTTP"});OpenLayers.Protocol.WFS=function(e){e=OpenLayers.Util.applyDefaults(e,OpenLayers.Protocol.WFS.DEFAULTS);var t=OpenLayers.Protocol.WFS["v"+e.version.replace(/\./g,"_")];if(!t){throw"Unsupported WFS version: "+e.version}return new t(e)};OpenLayers.Protocol.WFS.fromWMSLayer=function(e,t){var i,r;var a=e.params["LAYERS"];var s=(OpenLayers.Util.isArray(a)?a[0]:a).split(":");if(s.length>1){r=s[0]}i=s.pop();var n={url:typeof e.url==="string"?e.url:e.url[0],featureType:i,featurePrefix:r,srsName:e.projection&&e.projection.getCode()||e.map&&e.map.getProjectionObject().getCode(),version:"1.1.0"};return new OpenLayers.Protocol.WFS(OpenLayers.Util.applyDefaults(t,n))};OpenLayers.Protocol.WFS.DEFAULTS={version:"1.0.0"};OpenLayers.Protocol.WFS.v1=OpenLayers.Class(OpenLayers.Protocol,{version:null,srsName:"EPSG:4326",featureType:null,featureNS:null,geometryName:"the_geom",schema:null,featurePrefix:"feature",formatOptions:null,readFormat:null,readOptions:null,initialize:function(e){OpenLayers.Protocol.prototype.initialize.apply(this,[e]);if(!e.format){this.format=OpenLayers.Format.WFST(OpenLayers.Util.extend({version:this.version,featureType:this.featureType,featureNS:this.featureNS,featurePrefix:this.featurePrefix,geometryName:this.geometryName,srsName:this.srsName,schema:this.schema},this.formatOptions))}if(!e.geometryName&&parseFloat(this.format.version)>1){this.setGeometryName(null)}},destroy:function(){if(this.options&&!this.options.format){this.format.destroy()}this.format=null;OpenLayers.Protocol.prototype.destroy.apply(this)},read:function(e){OpenLayers.Protocol.prototype.read.apply(this,arguments);e=OpenLayers.Util.extend({},e);OpenLayers.Util.applyDefaults(e,this.options||{});var t=new OpenLayers.Protocol.Response({requestType:"read"});var i=OpenLayers.Format.XML.prototype.write.apply(this.format,[this.format.writeNode("wfs:GetFeature",e)]);t.priv=OpenLayers.Request.POST({url:e.url,callback:this.createCallback(this.handleRead,t,e),params:e.params,headers:e.headers,data:i});return t},setFeatureType:function(e){this.featureType=e;this.format.featureType=e},setGeometryName:function(e){this.geometryName=e;this.format.geometryName=e},handleRead:function(e,t){t=OpenLayers.Util.extend({},t);OpenLayers.Util.applyDefaults(t,this.options);if(t.callback){var i=e.priv;if(i.status>=200&&i.status<300){var r=this.parseResponse(i,t.readOptions);if(r&&r.success!==false){if(t.readOptions&&t.readOptions.output=="object"){OpenLayers.Util.extend(e,r)}else{e.features=r}e.code=OpenLayers.Protocol.Response.SUCCESS}else{e.code=OpenLayers.Protocol.Response.FAILURE;e.error=r}}else{e.code=OpenLayers.Protocol.Response.FAILURE}t.callback.call(t.scope,e)}},parseResponse:function(e,t){var i=e.responseXML;if(!i||!i.documentElement){i=e.responseText}if(!i||i.length<=0){return null}var r=this.readFormat!==null?this.readFormat.read(i):this.format.read(i,t);if(!this.featureNS){var a=this.readFormat||this.format;this.featureNS=a.featureNS;a.autoConfig=false;if(!this.geometryName){this.setGeometryName(a.geometryName)}}return r},commit:function(e,t){t=OpenLayers.Util.extend({},t);OpenLayers.Util.applyDefaults(t,this.options);var i=new OpenLayers.Protocol.Response({requestType:"commit",reqFeatures:e});i.priv=OpenLayers.Request.POST({url:t.url,headers:t.headers,data:this.format.write(e,t),callback:this.createCallback(this.handleCommit,i,t)});return i},handleCommit:function(e,t){if(t.callback){var i=e.priv;var r=i.responseXML;if(!r||!r.documentElement){r=i.responseText}var a=this.format.read(r)||{};e.insertIds=a.insertIds||[];if(a.success){e.code=OpenLayers.Protocol.Response.SUCCESS}else{e.code=OpenLayers.Protocol.Response.FAILURE;e.error=a}t.callback.call(t.scope,e)}},filterDelete:function(e,t){t=OpenLayers.Util.extend({},t);OpenLayers.Util.applyDefaults(t,this.options);var i=new OpenLayers.Protocol.Response({requestType:"commit"});var r=this.format.createElementNSPlus("wfs:Transaction",{attributes:{service:"WFS",version:this.version}});var a=this.format.createElementNSPlus("wfs:Delete",{attributes:{typeName:(t.featureNS?this.featurePrefix+":":"")+t.featureType}});if(t.featureNS){a.setAttribute("xmlns:"+this.featurePrefix,t.featureNS)}var s=this.format.writeNode("ogc:Filter",e);a.appendChild(s);r.appendChild(a);var n=OpenLayers.Format.XML.prototype.write.apply(this.format,[r]);return OpenLayers.Request.POST({url:this.url,callback:t.callback||function(){},data:n})},abort:function(e){if(e){e.priv.abort()}},CLASS_NAME:"OpenLayers.Protocol.WFS.v1"});OpenLayers.Format.WFST=function(e){e=OpenLayers.Util.applyDefaults(e,OpenLayers.Format.WFST.DEFAULTS);var t=OpenLayers.Format.WFST["v"+e.version.replace(/\./g,"_")];if(!t){throw"Unsupported WFST version: "+e.version}return new t(e)};OpenLayers.Format.WFST.DEFAULTS={version:"1.0.0"};OpenLayers.Format.WFST.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",wfs:"http://www.opengis.net/wfs",gml:"http://www.opengis.net/gml",ogc:"http://www.opengis.net/ogc",ows:"http://www.opengis.net/ows",xmlns:"http://www.w3.org/2000/xmlns/"},defaultPrefix:"wfs",version:null,schemaLocations:null,srsName:null,extractAttributes:true,xy:true,stateName:null,initialize:function(e){this.stateName={};this.stateName[OpenLayers.State.INSERT]="wfs:Insert";this.stateName[OpenLayers.State.UPDATE]="wfs:Update";this.stateName[OpenLayers.State.DELETE]="wfs:Delete";OpenLayers.Format.XML.prototype.initialize.apply(this,[e])},getSrsName:function(e,t){var i=t&&t.srsName;if(!i){if(e&&e.layer){i=e.layer.projection.getCode()}else{i=this.srsName}}return i},read:function(e,t){t=t||{};OpenLayers.Util.applyDefaults(t,{output:"features"});if(typeof e=="string"){e=OpenLayers.Format.XML.prototype.read.apply(this,[e])}if(e&&e.nodeType==9){e=e.documentElement}var i={};if(e){this.readNode(e,i,true)}if(i.features&&t.output==="features"){i=i.features}return i},readers:{wfs:{FeatureCollection:function(e,t){t.features=[];this.readChildNodes(e,t)}}},write:function(e,t){var i=this.writeNode("wfs:Transaction",{features:e,options:t});var r=this.schemaLocationAttr();if(r){this.setAttributeNS(i,this.namespaces["xsi"],"xsi:schemaLocation",r)}return OpenLayers.Format.XML.prototype.write.apply(this,[i])},writers:{wfs:{GetFeature:function(e){var t=this.createElementNSPlus("wfs:GetFeature",{attributes:{service:"WFS",version:this.version,handle:e&&e.handle,outputFormat:e&&e.outputFormat,maxFeatures:e&&e.maxFeatures,"xsi:schemaLocation":this.schemaLocationAttr(e)}});if(typeof this.featureType=="string"){this.writeNode("Query",e,t)}else{for(var i=0,r=this.featureType.length;i<r;i++){e.featureType=this.featureType[i];this.writeNode("Query",e,t)}}return t},Transaction:function(e){e=e||{};var t=e.options||{};var i=this.createElementNSPlus("wfs:Transaction",{attributes:{service:"WFS",version:this.version,handle:t.handle}});var r,a;var s=e.features;if(s){if(t.multi===true){OpenLayers.Util.extend(this.geometryTypes,{"OpenLayers.Geometry.Point":"MultiPoint","OpenLayers.Geometry.LineString":this.multiCurve===true?"MultiCurve":"MultiLineString","OpenLayers.Geometry.Polygon":this.multiSurface===true?"MultiSurface":"MultiPolygon"})}var n,o;for(r=0,a=s.length;r<a;++r){o=s[r];n=this.stateName[o.state];if(n){this.writeNode(n,{feature:o,options:t},i)}}if(t.multi===true){this.setGeometryTypes()}}if(t.nativeElements){for(r=0,a=t.nativeElements.length;r<a;++r){this.writeNode("wfs:Native",t.nativeElements[r],i)}}return i},Native:function(e){var t=this.createElementNSPlus("wfs:Native",{attributes:{vendorId:e.vendorId,safeToIgnore:e.safeToIgnore},value:e.value});return t},Insert:function(e){var t=e.feature;var i=e.options;var r=this.createElementNSPlus("wfs:Insert",{attributes:{handle:i&&i.handle}});this.srsName=this.getSrsName(t);this.writeNode("feature:_typeName",t,r);return r},Update:function(e){var t=e.feature;var i=e.options;var r=this.createElementNSPlus("wfs:Update",{attributes:{handle:i&&i.handle,typeName:(this.featureNS?this.featurePrefix+":":"")+this.featureType}});if(this.featureNS){this.setAttributeNS(r,this.namespaces.xmlns,"xmlns:"+this.featurePrefix,this.featureNS)}var a=t.modified;if(this.geometryName!==null&&(!a||a.geometry!==undefined)){this.srsName=this.getSrsName(t);this.writeNode("Property",{name:this.geometryName,value:t.geometry},r)}for(var s in t.attributes){if(t.attributes[s]!==undefined&&(!a||!a.attributes||a.attributes&&a.attributes[s]!==undefined)){this.writeNode("Property",{name:s,value:t.attributes[s]},r)}}this.writeNode("ogc:Filter",new OpenLayers.Filter.FeatureId({fids:[t.fid]}),r);return r},Property:function(e){var t=this.createElementNSPlus("wfs:Property");this.writeNode("Name",e.name,t);if(e.value!==null){this.writeNode("Value",e.value,t)}return t},Name:function(e){return this.createElementNSPlus("wfs:Name",{value:e})},Value:function(e){var t;if(e instanceof OpenLayers.Geometry){t=this.createElementNSPlus("wfs:Value");var i=this.writeNode("feature:_geometry",e).firstChild;t.appendChild(i)}else{t=this.createElementNSPlus("wfs:Value",{value:e})}return t},Delete:function(e){var t=e.feature;var i=e.options;var r=this.createElementNSPlus("wfs:Delete",{attributes:{handle:i&&i.handle,typeName:(this.featureNS?this.featurePrefix+":":"")+this.featureType}});if(this.featureNS){this.setAttributeNS(r,this.namespaces.xmlns,"xmlns:"+this.featurePrefix,this.featureNS)}this.writeNode("ogc:Filter",new OpenLayers.Filter.FeatureId({fids:[t.fid]}),r);return r}}},schemaLocationAttr:function(e){e=OpenLayers.Util.extend({featurePrefix:this.featurePrefix,schema:this.schema},e);var t=OpenLayers.Util.extend({},this.schemaLocations);if(e.schema){t[e.featurePrefix]=e.schema}var i=[];var r;for(var a in t){r=this.namespaces[a];if(r){i.push(r+" "+t[a])}}var s=i.join(" ")||undefined;return s},setFilterProperty:function(e){if(e.filters){for(var t=0,i=e.filters.length;t<i;++t){OpenLayers.Format.WFST.v1.prototype.setFilterProperty.call(this,e.filters[t])}}else{if(e instanceof OpenLayers.Filter.Spatial&&!e.property){e.property=this.geometryName}}},CLASS_NAME:"OpenLayers.Format.WFST.v1"});OpenLayers.Format.Filter.v1_1_0=OpenLayers.Class(OpenLayers.Format.GML.v3,OpenLayers.Format.Filter.v1,{VERSION:"1.1.0",schemaLocation:"http://www.opengis.net/ogc/filter/1.1.0/filter.xsd",initialize:function(e){OpenLayers.Format.GML.v3.prototype.initialize.apply(this,[e])},readers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(e,t){var i=e.getAttribute("matchCase");var r=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,matchCase:!(i==="false"||i==="0")});this.readChildNodes(e,r);t.filters.push(r)},PropertyIsNotEqualTo:function(e,t){var i=e.getAttribute("matchCase");var r=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.NOT_EQUAL_TO,matchCase:!(i==="false"||i==="0")});this.readChildNodes(e,r);t.filters.push(r)},PropertyIsLike:function(e,t){var i=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LIKE});this.readChildNodes(e,i);var r=e.getAttribute("wildCard");var a=e.getAttribute("singleChar");var s=e.getAttribute("escapeChar");i.value2regex(r,a,s);t.filters.push(i)}},OpenLayers.Format.Filter.v1.prototype.readers["ogc"]),gml:OpenLayers.Format.GML.v3.prototype.readers["gml"],feature:OpenLayers.Format.GML.v3.prototype.readers["feature"]},writers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(e){var t=this.createElementNSPlus("ogc:PropertyIsEqualTo",{attributes:{matchCase:e.matchCase}});this.writeNode("PropertyName",e,t);this.writeOgcExpression(e.value,t);return t},PropertyIsNotEqualTo:function(e){var t=this.createElementNSPlus("ogc:PropertyIsNotEqualTo",{attributes:{matchCase:e.matchCase}});this.writeNode("PropertyName",e,t);this.writeOgcExpression(e.value,t);return t},PropertyIsLike:function(e){var t=this.createElementNSPlus("ogc:PropertyIsLike",{attributes:{matchCase:e.matchCase,wildCard:"*",singleChar:".",escapeChar:"!"}});this.writeNode("PropertyName",e,t);this.writeNode("Literal",e.regex2value(),t);return t},BBOX:function(e){var t=this.createElementNSPlus("ogc:BBOX");e.property&&this.writeNode("PropertyName",e,t);var i=this.writeNode("gml:Envelope",e.value);if(e.projection){i.setAttribute("srsName",e.projection)}t.appendChild(i);return t},SortBy:function(e){var t=this.createElementNSPlus("ogc:SortBy");for(var i=0,r=e.length;i<r;i++){this.writeNode("ogc:SortProperty",e[i],t)}return t},SortProperty:function(e){var t=this.createElementNSPlus("ogc:SortProperty");this.writeNode("ogc:PropertyName",e,t);this.writeNode("ogc:SortOrder",e.order=="DESC"?"DESC":"ASC",t);return t},SortOrder:function(e){var t=this.createElementNSPlus("ogc:SortOrder",{value:e});return t}},OpenLayers.Format.Filter.v1.prototype.writers["ogc"]),gml:OpenLayers.Format.GML.v3.prototype.writers["gml"],feature:OpenLayers.Format.GML.v3.prototype.writers["feature"]},writeSpatial:function(e,t){var i=this.createElementNSPlus("ogc:"+t);this.writeNode("PropertyName",e,i);if(e.value instanceof OpenLayers.Filter.Function){this.writeNode("Function",e.value,i)}else{var r;if(e.value instanceof OpenLayers.Geometry){r=this.writeNode("feature:_geometry",e.value).firstChild}else{r=this.writeNode("gml:Envelope",e.value)}if(e.projection){r.setAttribute("srsName",e.projection)}i.appendChild(r)}return i},CLASS_NAME:"OpenLayers.Format.Filter.v1_1_0"});OpenLayers.Format.OWSCommon=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",getVersion:function(e,t){var i=this.version;if(!i){var r=e.getAttribute("xmlns:ows");if(r&&r.substring(r.lastIndexOf("/")+1)==="1.1"){i="1.1.0"}if(!i){i=this.defaultVersion}}return i},CLASS_NAME:"OpenLayers.Format.OWSCommon"});OpenLayers.Format.OWSCommon.v1=OpenLayers.Class(OpenLayers.Format.XML,{regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},read:function(e,t){t=OpenLayers.Util.applyDefaults(t,this.options);var i={};this.readChildNodes(e,i);return i},readers:{ows:{Exception:function(e,t){var i={code:e.getAttribute("exceptionCode"),locator:e.getAttribute("locator"),texts:[]};t.exceptions.push(i);this.readChildNodes(e,i)},ExceptionText:function(e,t){var i=this.getChildValue(e);t.texts.push(i)},ServiceIdentification:function(e,t){t.serviceIdentification={};this.readChildNodes(e,t.serviceIdentification)},Title:function(e,t){t.title=this.getChildValue(e)},Abstract:function(e,t){t["abstract"]=this.getChildValue(e)},Keywords:function(e,t){t.keywords={};this.readChildNodes(e,t.keywords)},Keyword:function(e,t){t[this.getChildValue(e)]=true},ServiceType:function(e,t){t.serviceType={codeSpace:e.getAttribute("codeSpace"),value:this.getChildValue(e)}},ServiceTypeVersion:function(e,t){t.serviceTypeVersion=this.getChildValue(e)},Fees:function(e,t){t.fees=this.getChildValue(e)},AccessConstraints:function(e,t){t.accessConstraints=this.getChildValue(e)},ServiceProvider:function(e,t){t.serviceProvider={};this.readChildNodes(e,t.serviceProvider)},ProviderName:function(e,t){t.providerName=this.getChildValue(e)},ProviderSite:function(e,t){t.providerSite=this.getAttributeNS(e,this.namespaces.xlink,"href")},ServiceContact:function(e,t){t.serviceContact={};this.readChildNodes(e,t.serviceContact)},IndividualName:function(e,t){t.individualName=this.getChildValue(e)},PositionName:function(e,t){t.positionName=this.getChildValue(e)},ContactInfo:function(e,t){t.contactInfo={};this.readChildNodes(e,t.contactInfo)},Phone:function(e,t){t.phone={};this.readChildNodes(e,t.phone)},Voice:function(e,t){t.voice=this.getChildValue(e)},Address:function(e,t){t.address={};this.readChildNodes(e,t.address)},DeliveryPoint:function(e,t){t.deliveryPoint=this.getChildValue(e)},City:function(e,t){t.city=this.getChildValue(e)},AdministrativeArea:function(e,t){t.administrativeArea=this.getChildValue(e)},PostalCode:function(e,t){t.postalCode=this.getChildValue(e)},Country:function(e,t){t.country=this.getChildValue(e)},ElectronicMailAddress:function(e,t){t.electronicMailAddress=this.getChildValue(e)},Role:function(e,t){t.role=this.getChildValue(e)},OperationsMetadata:function(e,t){t.operationsMetadata={};this.readChildNodes(e,t.operationsMetadata)},Operation:function(e,t){var i=e.getAttribute("name");t[i]={};this.readChildNodes(e,t[i])},DCP:function(e,t){t.dcp={};this.readChildNodes(e,t.dcp)},HTTP:function(e,t){t.http={};this.readChildNodes(e,t.http)},Get:function(e,t){if(!t.get){t.get=[]}var i={url:this.getAttributeNS(e,this.namespaces.xlink,"href")};this.readChildNodes(e,i);t.get.push(i)},Post:function(e,t){if(!t.post){t.post=[]}var i={url:this.getAttributeNS(e,this.namespaces.xlink,"href")};this.readChildNodes(e,i);t.post.push(i)},Parameter:function(e,t){if(!t.parameters){t.parameters={}}var i=e.getAttribute("name");t.parameters[i]={};this.readChildNodes(e,t.parameters[i])},Constraint:function(e,t){if(!t.constraints){t.constraints={}}var i=e.getAttribute("name");t.constraints[i]={};this.readChildNodes(e,t.constraints[i])},Value:function(e,t){t[this.getChildValue(e)]=true},OutputFormat:function(e,t){t.formats.push({value:this.getChildValue(e)});this.readChildNodes(e,t)},WGS84BoundingBox:function(e,t){var i={};i.crs=e.getAttribute("crs");if(t.BoundingBox){t.BoundingBox.push(i)}else{t.projection=i.crs;i=t}this.readChildNodes(e,i)},BoundingBox:function(e,t){this.readers["ows"]["WGS84BoundingBox"].apply(this,[e,t])},LowerCorner:function(e,t){var i=this.getChildValue(e).replace(this.regExes.trimSpace,"");i=i.replace(this.regExes.trimComma,",");var r=i.split(this.regExes.splitSpace);t.left=r[0];t.bottom=r[1]},UpperCorner:function(e,t){var i=this.getChildValue(e).replace(this.regExes.trimSpace,"");i=i.replace(this.regExes.trimComma,",");var r=i.split(this.regExes.splitSpace);t.right=r[0];t.top=r[1];t.bounds=new OpenLayers.Bounds(t.left,t.bottom,t.right,t.top);delete t.left;delete t.bottom;delete t.right;delete t.top},Language:function(e,t){t.language=this.getChildValue(e)}}},writers:{ows:{BoundingBox:function(e,t){var i=this.createElementNSPlus(t||"ows:BoundingBox",{attributes:{crs:e.projection}});this.writeNode("ows:LowerCorner",e,i);this.writeNode("ows:UpperCorner",e,i);return i},LowerCorner:function(e){var t=this.createElementNSPlus("ows:LowerCorner",{value:e.bounds.left+" "+e.bounds.bottom});return t},UpperCorner:function(e){var t=this.createElementNSPlus("ows:UpperCorner",{value:e.bounds.right+" "+e.bounds.top});return t},Identifier:function(e){var t=this.createElementNSPlus("ows:Identifier",{value:e});return t},Title:function(e){var t=this.createElementNSPlus("ows:Title",{value:e});return t},Abstract:function(e){var t=this.createElementNSPlus("ows:Abstract",{value:e});return t},OutputFormat:function(e){var t=this.createElementNSPlus("ows:OutputFormat",{value:e});return t}}},CLASS_NAME:"OpenLayers.Format.OWSCommon.v1"});OpenLayers.Format.OWSCommon.v1_0_0=OpenLayers.Class(OpenLayers.Format.OWSCommon.v1,{namespaces:{ows:"http://www.opengis.net/ows",xlink:"http://www.w3.org/1999/xlink"},readers:{ows:OpenLayers.Util.applyDefaults({ExceptionReport:function(e,t){t.success=false;t.exceptionReport={version:e.getAttribute("version"),language:e.getAttribute("language"),exceptions:[]};this.readChildNodes(e,t.exceptionReport)}},OpenLayers.Format.OWSCommon.v1.prototype.readers.ows)},writers:{ows:OpenLayers.Format.OWSCommon.v1.prototype.writers.ows},CLASS_NAME:"OpenLayers.Format.OWSCommon.v1_0_0"});OpenLayers.Format.WFST.v1_1_0=OpenLayers.Class(OpenLayers.Format.Filter.v1_1_0,OpenLayers.Format.WFST.v1,{version:"1.1.0",schemaLocations:{wfs:"http://schemas.opengis.net/wfs/1.1.0/wfs.xsd"},initialize:function(e){OpenLayers.Format.Filter.v1_1_0.prototype.initialize.apply(this,[e]);OpenLayers.Format.WFST.v1.prototype.initialize.apply(this,[e])},readNode:function(e,t,i){return OpenLayers.Format.GML.v3.prototype.readNode.apply(this,arguments)},readers:{wfs:OpenLayers.Util.applyDefaults({FeatureCollection:function(e,t){t.numberOfFeatures=parseInt(e.getAttribute("numberOfFeatures"));OpenLayers.Format.WFST.v1.prototype.readers["wfs"]["FeatureCollection"].apply(this,arguments)},TransactionResponse:function(e,t){t.insertIds=[];t.success=false;this.readChildNodes(e,t)},TransactionSummary:function(e,t){t.success=true},InsertResults:function(e,t){this.readChildNodes(e,t)},Feature:function(e,t){var i={fids:[]};this.readChildNodes(e,i);t.insertIds.push(i.fids[0])}},OpenLayers.Format.WFST.v1.prototype.readers["wfs"]),gml:OpenLayers.Format.GML.v3.prototype.readers["gml"],feature:OpenLayers.Format.GML.v3.prototype.readers["feature"],ogc:OpenLayers.Format.Filter.v1_1_0.prototype.readers["ogc"],ows:OpenLayers.Format.OWSCommon.v1_0_0.prototype.readers["ows"]},writers:{wfs:OpenLayers.Util.applyDefaults({GetFeature:function(e){var t=OpenLayers.Format.WFST.v1.prototype.writers["wfs"]["GetFeature"].apply(this,arguments);e&&this.setAttributes(t,{resultType:e.resultType,startIndex:e.startIndex,count:e.count});return t},Query:function(e){e=OpenLayers.Util.extend({featureNS:this.featureNS,featurePrefix:this.featurePrefix,featureType:this.featureType,srsName:this.srsName},e);var t=e.featurePrefix;var i=this.createElementNSPlus("wfs:Query",{attributes:{typeName:(t?t+":":"")+e.featureType,srsName:e.srsName}});if(e.featureNS){this.setAttributeNS(i,this.namespaces.xmlns,"xmlns:"+t,e.featureNS)}if(e.propertyNames){for(var r=0,a=e.propertyNames.length;r<a;r++){this.writeNode("wfs:PropertyName",{property:e.propertyNames[r]},i)}}if(e.filter){OpenLayers.Format.WFST.v1_1_0.prototype.setFilterProperty.call(this,e.filter);this.writeNode("ogc:Filter",e.filter,i)}return i},PropertyName:function(e){return this.createElementNSPlus("wfs:PropertyName",{value:e.property})}},OpenLayers.Format.WFST.v1.prototype.writers["wfs"]),gml:OpenLayers.Format.GML.v3.prototype.writers["gml"],feature:OpenLayers.Format.GML.v3.prototype.writers["feature"],ogc:OpenLayers.Format.Filter.v1_1_0.prototype.writers["ogc"]},CLASS_NAME:"OpenLayers.Format.WFST.v1_1_0"});OpenLayers.Protocol.WFS.v1_1_0=OpenLayers.Class(OpenLayers.Protocol.WFS.v1,{version:"1.1.0",initialize:function(e){OpenLayers.Protocol.WFS.v1.prototype.initialize.apply(this,arguments);if(this.outputFormat&&!this.readFormat){if(this.outputFormat.toLowerCase()=="gml2"){this.readFormat=new OpenLayers.Format.GML.v2({featureType:this.featureType,featureNS:this.featureNS,geometryName:this.geometryName})}else if(this.outputFormat.toLowerCase()=="json"){this.readFormat=new OpenLayers.Format.GeoJSON}}},CLASS_NAME:"OpenLayers.Protocol.WFS.v1_1_0"});Ext.namespace("GeoExt.data");GeoExt.data.LayerRecord=Ext.data.Record.create([{name:"layer"},{name:"title",type:"string",mapping:"name"}]);GeoExt.data.LayerRecord.prototype.getLayer=function(){return this.get("layer")};GeoExt.data.LayerRecord.prototype.setLayer=function(e){if(e!==this.data.layer){this.dirty=true;if(!this.modified){this.modified={}}if(this.modified.layer===undefined){this.modified.layer=this.data.layer}this.data.layer=e;if(!this.editing){this.afterEdit()}}};GeoExt.data.LayerRecord.prototype.clone=function(e){var t=this.getLayer()&&this.getLayer().clone();return new this.constructor(Ext.applyIf({layer:t},this.data),e||t.id)};GeoExt.data.LayerRecord.create=function(e){var t=Ext.extend(GeoExt.data.LayerRecord,{});var i=t.prototype;i.fields=new Ext.util.MixedCollection(false,function(e){return e.name});GeoExt.data.LayerRecord.prototype.fields.each(function(e){i.fields.add(e)});if(e){for(var r=0,a=e.length;r<a;r++){i.fields.add(new Ext.data.Field(e[r]))}}t.getField=function(e){return i.fields.get(e)};return t};Ext.namespace("GeoExt.data");GeoExt.data.AttributeStoreMixin=function(){return{constructor:function(e){e=e||{};arguments.callee.superclass.constructor.call(this,Ext.apply(e,{proxy:e.proxy||(!e.data?new Ext.data.HttpProxy({url:e.url,disableCaching:false,method:"GET"}):undefined),reader:new GeoExt.data.AttributeReader(e,e.fields||["name","type","restriction",{name:"nillable",type:"boolean"},"annotation"])}));if(this.feature){this.bind()}},bind:function(){this.on({update:this.onUpdate,load:this.onLoad,add:this.onAdd,scope:this});var t=[];this.each(function(e){t.push(e)});this.updateFeature(t)},onUpdate:function(e,t,i){this.updateFeature([t])},onLoad:function(e,t,i){if(!i||i.add!==true){this.updateFeature(t)}},onAdd:function(e,t,i){this.updateFeature(t)},updateFeature:function(e){var t=this.feature,i=t.layer;var r,a,s,n,o,l,h;for(r=0,a=e.length;r<a;r++){s=e[r];n=s.get("name");o=s.get("value");l=t.attributes[n];if(l!==o){h=true}}if(h&&i&&i.events&&i.events.triggerEvent("beforefeaturemodified",{feature:t})!==false){for(r=0,a=e.length;r<a;r++){s=e[r];n=s.get("name");o=s.get("value");t.attributes[n]=o}i.events.triggerEvent("featuremodified",{feature:t});i.drawFeature(t)}}}};GeoExt.data.AttributeStore=Ext.extend(Ext.data.Store,GeoExt.data.AttributeStoreMixin());Ext.namespace("GeoExt.data");GeoExt.data.AttributeReader=function(e,t){e=e||{};if(!e.format){e.format=new OpenLayers.Format.WFSDescribeFeatureType}GeoExt.data.AttributeReader.superclass.constructor.call(this,e,t||e.fields);if(e.feature){this.recordType.prototype.fields.add(new Ext.data.Field("value"))}};Ext.extend(GeoExt.data.AttributeReader,Ext.data.DataReader,{read:function(e){var t=e.responseXML;if(!t||!t.documentElement){t=e.responseText}return this.readRecords(t)},readRecords:function(e){var t;if(e instanceof Array){t=e}else{var i=this.meta.format.read(e);if(!!i.error){throw new Ext.data.DataReader.Error("invalid-response",i.error)}t=i.featureTypes[0].properties}var p=this.meta.feature;var u=this.recordType;var c=u.prototype.fields;var d=c.length;var f,r,a,y,s,n,o,l=[];for(var h=0,g=t.length;h<g;++h){s=false;f=t[h];r={};for(var m=0;m<d;++m){o=c.items[m];a=o.name;n=o.convert(f[a]);if(this.ignoreAttribute(a,n)){s=true;break}r[a]=n}if(p){n=p.attributes[r["name"]];if(n!==undefined){if(this.ignoreAttribute("value",n)){s=true}else{r["value"]=n}}}if(!s){l[l.length]=new u(r)}}return{success:true,records:l,totalRecords:l.length}},ignoreAttribute:function(e,t){var i=false;if(this.meta.ignore&&this.meta.ignore[e]){var r=this.meta.ignore[e];if(typeof r=="string"){i=r===t}else if(r instanceof Array){i=r.indexOf(t)>-1}else if(r instanceof RegExp){i=r.test(t)}}return i}});Ext.namespace("GeoExt","GeoExt.data");GeoExt.data.ProtocolProxy=function(e){Ext.apply(this,e);GeoExt.data.ProtocolProxy.superclass.constructor.apply(this,arguments)};Ext.extend(GeoExt.data.ProtocolProxy,Ext.data.DataProxy,{protocol:null,abortPrevious:true,setParamsAsOptions:false,response:null,load:function(e,t,i,r,a){if(this.fireEvent("beforeload",this,e)!==false){var s={params:e||{},request:{callback:i,scope:r,arg:a},reader:t};var n=OpenLayers.Function.bind(this.loadResponse,this,s);if(this.abortPrevious){this.abortRequest()}var o={params:e,callback:n,scope:this};Ext.applyIf(o,a);if(this.setParamsAsOptions===true){Ext.applyIf(o,o.params);delete o.params}this.response=this.protocol.read(o)}else{i.call(r||this,null,a,false)}},abortRequest:function(){if(this.response){this.protocol.abort(this.response);this.response=null}},loadResponse:function(t,i){if(i.success()){var e;try{e=t.reader.read(i)}catch(e){this.fireEvent("loadexception",this,t,i,e);this.fireEvent("exception",this,"response",null,t,i,e);t.request.callback.call(t.request.scope,null,t.request.arg,false);return}this.fireEvent("load",this,t,t.request.arg);t.request.callback.call(t.request.scope,e,t.request.arg,true)}else{this.fireEvent("loadexception",this,t,i);t.request.callback.call(t.request.scope,null,t.request.arg,false)}}});Ext.namespace("GeoExt.data");GeoExt.data.FeatureStoreMixin=function(){return{layer:null,reader:null,featureFilter:null,constructor:function(e){e=e||{};e.reader=e.reader||new GeoExt.data.FeatureReader({},e.fields);var t=e.layer;delete e.layer;if(e.features){e.data=e.features}delete e.features;var i={initDir:e.initDir};delete e.initDir;arguments.callee.superclass.constructor.call(this,e);if(t){this.bind(t,i)}},bind:function(e,t){if(this.layer){return}this.layer=e;t=t||{};var i=t.initDir;if(t.initDir==undefined){i=GeoExt.data.FeatureStore.LAYER_TO_STORE|GeoExt.data.FeatureStore.STORE_TO_LAYER}var r=e.features.slice(0);if(i&GeoExt.data.FeatureStore.STORE_TO_LAYER){var a=this.getRange();for(var s=a.length-1;s>=0;s--){this.layer.addFeatures([a[s].getFeature()])}}if(i&GeoExt.data.FeatureStore.LAYER_TO_STORE){this.loadData(r,true)}e.events.on({featuresadded:this.onFeaturesAdded,featuresremoved:this.onFeaturesRemoved,featuremodified:this.onFeatureModified,scope:this});this.on({load:this.onLoad,clear:this.onClear,add:this.onAdd,remove:this.onRemove,update:this.onUpdate,scope:this})},unbind:function(){if(this.layer){this.layer.events.un({featuresadded:this.onFeaturesAdded,featuresremoved:this.onFeaturesRemoved,featuremodified:this.onFeatureModified,scope:this});this.un("load",this.onLoad,this);this.un("clear",this.onClear,this);this.un("add",this.onAdd,this);this.un("remove",this.onRemove,this);this.un("update",this.onUpdate,this);this.layer=null}},getRecordFromFeature:function(e){return this.getByFeature(e)||null},getByFeature:function(t){var e;if(t.state!==OpenLayers.State.INSERT){e=this.getById(t.id)}else{var i=this.findBy(function(e){return e.getFeature()===t});if(i>-1){e=this.getAt(i)}}return e},onFeaturesAdded:function(e){if(!this._adding){var t=e.features,i=t;if(this.featureFilter){i=[];var r,a,s;for(var r=0,a=t.length;r<a;r++){s=t[r];if(this.featureFilter.evaluate(s)!==false){i.push(s)}}}this._adding=true;this.loadData(i,true);delete this._adding}},onFeaturesRemoved:function(e){if(!this._removing){var t=e.features,i,r,a;for(a=t.length-1;a>=0;a--){i=t[a];r=this.getByFeature(i);if(r!==undefined){this._removing=true;this.remove(r);delete this._removing}}}},onFeatureModified:function(e){if(!this._updating){var t=e.feature;var i=this.getByFeature(t);if(i!==undefined){i.beginEdit();var r=t.attributes;if(r){var a=this.recordType.prototype.fields;for(var s=0,n=a.length;s<n;s++){var o=a.items[s];var l=o.mapping||o.name;if(l in r){i.set(o.name,o.convert(r[l]))}}}i.set("state",t.state);i.set("fid",t.fid);i.setFeature(t);this._updating=true;i.endEdit();delete this._updating}}},addFeaturesToLayer:function(e){var t,i,r;r=new Array(i=e.length);for(t=0;t<i;t++){r[t]=e[t].getFeature()}if(r.length>0){this._adding=true;this.layer.addFeatures(r);delete this._adding}},onLoad:function(e,t,i){if(!i||i.add!==true){this._removing=true;this.layer.removeFeatures(this.layer.features);delete this._removing;this.addFeaturesToLayer(t)}},onClear:function(e){this._removing=true;this.layer.removeFeatures(this.layer.features);delete this._removing},onAdd:function(e,t,i){if(!this._adding){this.addFeaturesToLayer(t)}},onRemove:function(e,t,i){if(!this._removing){var r=t.getFeature();if(this.layer.getFeatureById(r.id)!=null){this._removing=true;this.layer.removeFeatures([t.getFeature()]);delete this._removing}}},onUpdate:function(e,i,t){if(!this._updating){var r=(new GeoExt.data.FeatureRecord).fields;var a=i.getFeature();if(a.state!==OpenLayers.State.INSERT){a.state=OpenLayers.State.UPDATE}if(i.fields){var s=this.layer.events.triggerEvent("beforefeaturemodified",{feature:a});if(s!==false){var n=a.attributes;i.fields.each(function(e){var t=e.mapping||e.name;if(!r.containsKey(t)){n[t]=i.get(e.name)}});this._updating=true;this.layer.events.triggerEvent("featuremodified",{feature:a});delete this._updating;if(this.layer.getFeatureById(a.id)!=null){this.layer.drawFeature(a)}}}}},destroy:function(){this.unbind();GeoExt.data.FeatureStore.superclass.destroy.call(this)}}};GeoExt.data.FeatureStore=Ext.extend(Ext.data.Store,new GeoExt.data.FeatureStoreMixin);GeoExt.data.FeatureStore.LAYER_TO_STORE=1;GeoExt.data.FeatureStore.STORE_TO_LAYER=2;Ext.namespace("GeoExt","GeoExt.data");GeoExt.data.FeatureReader=function(e,t){e=e||{};if(!(t instanceof Function)){t=GeoExt.data.FeatureRecord.create(t||e.fields||{})}GeoExt.data.FeatureReader.superclass.constructor.call(this,e,t)};Ext.extend(GeoExt.data.FeatureReader,Ext.data.DataReader,{totalRecords:null,read:function(e){return this.readRecords(e.features)},readRecords:function(e){var t=[];if(e){var i=this.recordType,r=i.prototype.fields;var a,p,s,u,n,o,l,h;for(a=0,p=e.length;a<p;a++){n=e[a];o={};if(n.attributes){for(s=0,u=r.length;s<u;s++){l=r.items[s];if(/[\[\.]/.test(l.mapping)){try{h=new Function("obj","return obj."+l.mapping)(n.attributes)}catch(e){h=l.defaultValue}}else{h=n.attributes[l.mapping||l.name]||l.defaultValue}if(l.convert){h=l.convert(h,n)}o[l.name]=h}}o.feature=n;o.state=n.state;o.fid=n.fid;var c=n.state===OpenLayers.State.INSERT?undefined:n.id;t[t.length]=new i(o,c)}}return{records:t,totalRecords:this.totalRecords!=null?this.totalRecords:t.length}}});Ext.namespace("GeoExt.data");GeoExt.data.FeatureRecord=Ext.data.Record.create([{name:"feature"},{name:"state"},{name:"fid"}]);GeoExt.data.FeatureRecord.prototype.getFeature=function(){return this.get("feature")};GeoExt.data.FeatureRecord.prototype.setFeature=function(e){if(e!==this.data.feature){this.dirty=true;if(!this.modified){this.modified={}}if(this.modified.feature===undefined){this.modified.feature=this.data.feature}this.data.feature=e;if(!this.editing){this.afterEdit()}}};GeoExt.data.FeatureRecord.create=function(e){var t=Ext.extend(GeoExt.data.FeatureRecord,{});var i=t.prototype;i.fields=new Ext.util.MixedCollection(false,function(e){return e.name});GeoExt.data.FeatureRecord.prototype.fields.each(function(e){i.fields.add(e)});if(e){for(var r=0,a=e.length;r<a;r++){i.fields.add(new Ext.data.Field(e[r]))}}t.getField=function(e){return i.fields.get(e)};return t};Ext.namespace("GeoExt.plugins");GeoExt.plugins.PrintPageField=Ext.extend(Ext.util.Observable,{printPage:null,target:null,constructor:function(e){this.initialConfig=e;Ext.apply(this,e);GeoExt.plugins.PrintPageField.superclass.constructor.apply(this,arguments)},init:function(e){this.target=e;var t={beforedestroy:this.onBeforeDestroy,scope:this};var i=e instanceof Ext.form.ComboBox?"select":e instanceof Ext.form.Checkbox?"check":"valid";t[i]=this.onFieldChange;e.on(t);this.printPage.on({change:this.onPageChange,scope:this});this.printPage.printProvider.on({layoutchange:this.onLayoutChange,scope:this});this.setValue(this.printPage)},onFieldChange:function(e,t){var i=this.printPage.printProvider;var r=e.getValue();this._updating=true;if(e.store===i.scales||e.name==="scale"){this.printPage.setScale(t)}else if(e.name=="rotation"){!isNaN(r)&&this.printPage.setRotation(r)}else{this.printPage.customParams[e.name]=r}delete this._updating},onPageChange:function(e){if(!this._updating){this.setValue(e)}},onLayoutChange:function(e,t){var i=this.target;i.name=="rotation"&&i.setDisabled(!t.get("rotation"))},setValue:function(e){var t=this.target;t.suspendEvents();if(t.store===e.printProvider.scales||t.name==="scale"){if(e.scale){t.setValue(e.scale.get(t.displayField))}}else if(t.name=="rotation"){t.setValue(e.rotation)}t.resumeEvents()},onBeforeDestroy:function(){this.target.un("beforedestroy",this.onBeforeDestroy,this);this.target.un("select",this.onFieldChange,this);this.target.un("valid",this.onFieldChange,this);this.printPage.un("change",this.onPageChange,this);this.printPage.printProvider.un("layoutchange",this.onLayoutChange,this)}});Ext.preg("gx_printpagefield",GeoExt.plugins.PrintPageField);Ext.namespace("GeoExt.plugins");GeoExt.plugins.PrintProviderField=Ext.extend(Ext.util.Observable,{target:null,constructor:function(e){this.initialConfig=e;Ext.apply(this,e);GeoExt.plugins.PrintProviderField.superclass.constructor.apply(this,arguments)},init:function(e){this.target=e;var t={scope:this,render:this.onRender,beforedestroy:this.onBeforeDestroy};t[e instanceof Ext.form.ComboBox?"select":"valid"]=this.onFieldChange;e.on(t)},onRender:function(e){var t=this.printProvider||e.ownerCt.printProvider;if(e.store===t.layouts){e.setValue(t.layout.get(e.displayField));t.on({layoutchange:this.onProviderChange,scope:this})}else if(e.store===t.dpis){e.setValue(t.dpi.get(e.displayField));t.on({dpichange:this.onProviderChange,scope:this})}else if(e.initialConfig.value===undefined){e.setValue(t.customParams[e.name])}},onFieldChange:function(e,t){var i=this.printProvider||e.ownerCt.printProvider;var r=e.getValue();this._updating=true;if(t){switch(e.store){case i.layouts:i.setLayout(t);break;case i.dpis:i.setDpi(t)}}else{i.customParams[e.name]=r}delete this._updating},onProviderChange:function(e,t){if(!this._updating){this.target.setValue(t.get(this.target.displayField))}},onBeforeDestroy:function(){var e=this.target;e.un("beforedestroy",this.onBeforeDestroy,this);e.un("render",this.onRender,this);e.un("select",this.onFieldChange,this);e.un("valid",this.onFieldChange,this);var t=this.printProvider||e.ownerCt.printProvider;t.un("layoutchange",this.onProviderChange,this);t.un("dpichange",this.onProviderChange,this)}});Ext.preg("gx_printproviderfield",GeoExt.plugins.PrintProviderField);OpenLayers.Control=OpenLayers.Class({id:null,map:null,div:null,type:null,allowSelection:false,displayClass:"",title:gettext(""),autoActivate:false,active:null,handlerOptions:null,handler:null,eventListeners:null,events:null,initialize:function(e){this.displayClass=this.CLASS_NAME.replace("OpenLayers.","ol").replace(/\./g,"");OpenLayers.Util.extend(this,e);this.events=new OpenLayers.Events(this);if(this.eventListeners instanceof Object){this.events.on(this.eventListeners)}if(this.id==null){this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")}},destroy:function(){if(this.events){if(this.eventListeners){this.events.un(this.eventListeners)}this.events.destroy();this.events=null}this.eventListeners=null;if(this.handler){this.handler.destroy();this.handler=null}if(this.handlers){for(var e in this.handlers){if(this.handlers.hasOwnProperty(e)&&typeof this.handlers[e].destroy=="function"){this.handlers[e].destroy()}}this.handlers=null}if(this.map){this.map.removeControl(this);this.map=null}this.div=null},setMap:function(e){this.map=e;if(this.handler){this.handler.setMap(e)}},draw:function(e){if(this.div==null){this.div=OpenLayers.Util.createDiv(this.id);this.div.className=this.displayClass;if(!this.allowSelection){this.div.className+=" olControlNoSelect";this.div.setAttribute("unselectable","on",0);this.div.onselectstart=OpenLayers.Function.False}if(this.title!=""){this.div.title=this.title}}if(e!=null){this.position=e.clone()}this.moveTo(this.position);return this.div},moveTo:function(e){if(e!=null&&this.div!=null){this.div.style.left=e.x+"px";this.div.style.top=e.y+"px"}},activate:function(){if(this.active){return false}if(this.handler){this.handler.activate()}this.active=true;if(this.map){OpenLayers.Element.addClass(this.map.viewPortDiv,this.displayClass.replace(/ /g,"")+"Active")}this.events.triggerEvent("activate");return true},deactivate:function(){if(this.active){if(this.handler){this.handler.deactivate()}this.active=false;if(this.map){OpenLayers.Element.removeClass(this.map.viewPortDiv,this.displayClass.replace(/ /g,"")+"Active")}this.events.triggerEvent("deactivate");return true}return false},CLASS_NAME:"OpenLayers.Control"});OpenLayers.Control.TYPE_BUTTON=1;OpenLayers.Control.TYPE_TOGGLE=2;OpenLayers.Control.TYPE_TOOL=3;Ext.namespace("GeoExt");GeoExt.Action=Ext.extend(Ext.Action,{control:null,activateOnEnable:false,deactivateOnDisable:false,map:null,uScope:null,uHandler:null,uToggleHandler:null,uCheckHandler:null,constructor:function(e){this.uScope=e.scope;this.uHandler=e.handler;this.uToggleHandler=e.toggleHandler;this.uCheckHandler=e.checkHandler;e.scope=this;e.handler=this.pHandler;e.toggleHandler=this.pToggleHandler;e.checkHandler=this.pCheckHandler;var t=this.control=e.control;delete e.control;this.activateOnEnable=!!e.activateOnEnable;delete e.activateOnEnable;this.deactivateOnDisable=!!e.deactivateOnDisable;delete e.deactivateOnDisable;if(t){if(e.map){e.map.addControl(t);delete e.map}if((e.pressed||e.checked)&&t.map){t.activate()}if(t.active){e.pressed=true;e.checked=true}t.events.on({activate:this.onCtrlActivate,deactivate:this.onCtrlDeactivate,scope:this})}arguments.callee.superclass.constructor.call(this,e)},pHandler:function(e){var t=this.control;if(t&&t.type==OpenLayers.Control.TYPE_BUTTON){t.trigger()}if(this.uHandler){this.uHandler.apply(this.uScope,arguments)}},pToggleHandler:function(e,t){this.changeControlState(t);if(this.uToggleHandler){this.uToggleHandler.apply(this.uScope,arguments)}},pCheckHandler:function(e,t){this.changeControlState(t);if(this.uCheckHandler){this.uCheckHandler.apply(this.uScope,arguments)}},changeControlState:function(e){if(e){if(!this._activating){this._activating=true;this.control.activate();this.initialConfig.pressed=true;this.initialConfig.checked=true;this._activating=false}}else{if(!this._deactivating){this._deactivating=true;this.control.deactivate();this.initialConfig.pressed=false;this.initialConfig.checked=false;this._deactivating=false}}},onCtrlActivate:function(){var e=this.control;if(e.type==OpenLayers.Control.TYPE_BUTTON){this.enable()}else{this.safeCallEach("toggle",[true]);this.safeCallEach("setChecked",[true])}},onCtrlDeactivate:function(){var e=this.control;if(e.type==OpenLayers.Control.TYPE_BUTTON){this.disable()}else{this.safeCallEach("toggle",[false]);this.safeCallEach("setChecked",[false])}},safeCallEach:function(e,t){var i=this.items;for(var r=0,a=i.length;r<a;r++){if(i[r][e]){i[r].rendered?i[r][e].apply(i[r],t):i[r].on({render:i[r][e].createDelegate(i[r],t),single:true})}}},setDisabled:function(e){if(!e&&this.activateOnEnable&&this.control&&!this.control.active){this.control.activate()}if(e&&this.deactivateOnDisable&&this.control&&this.control.active){this.control.deactivate()}return GeoExt.Action.superclass.setDisabled.apply(this,arguments)}});Ext.namespace("GeoExt.tree");GeoExt.tree.LayerContainer=Ext.extend(Ext.tree.AsyncTreeNode,{text:gettext("Layers"),constructor:function(e){e=Ext.applyIf(e||{},{text:this.text});this.loader=e.loader instanceof GeoExt.tree.LayerLoader?e.loader:new GeoExt.tree.LayerLoader(Ext.applyIf(e.loader||{},{store:e.layerStore}));GeoExt.tree.LayerContainer.superclass.constructor.call(this,e)},recordIndexToNodeIndex:function(e){var t=this.loader.store;var i=t.getCount();var r=this.childNodes.length;var a=-1;for(var s=i-1;s>=0;--s){if(this.loader.filter(t.getAt(s))===true){++a;if(e===s||a>r-1){break}}}return a},destroy:function(){delete this.layerStore;GeoExt.tree.LayerContainer.superclass.destroy.apply(this,arguments)}});Ext.tree.TreePanel.nodeTypes.gx_layercontainer=GeoExt.tree.LayerContainer;Ext.namespace("GeoExt.tree");GeoExt.tree.LayerLoader=function(e){Ext.apply(this,e);this.addEvents("beforeload","load");this.iconCls={};GeoExt.tree.LayerLoader.superclass.constructor.call(this)};Ext.extend(GeoExt.tree.LayerLoader,Ext.util.Observable,{store:null,filter:function(e){return e.getLayer().displayInLayerSwitcher==true},baseAttrs:null,uiProviders:null,load:function(t,e){if(this.fireEvent("beforeload",this,t)){this.removeStoreHandlers();while(t.firstChild){t.removeChild(t.firstChild)}if(!this.uiProviders){this.uiProviders=t.getOwnerTree().getLoader().uiProviders}if(!this.store){this.store=GeoExt.MapPanel.guess().layers}this.store.each(function(e){this.addLayerNode(t,e)},this);this.addStoreHandlers(t);if(typeof e=="function"){e()}this.fireEvent("load",this,t)}},onStoreAdd:function(e,t,i,r){if(!this._reordering){var a=r.recordIndexToNodeIndex(i+t.length-1);for(var s=0;s<t.length;++s){this.addLayerNode(r,t[s],a)}}},onStoreRemove:function(e,t,i,r){if(!this._reordering){this.removeLayerNode(r,t)}},addLayerNode:function(e,t,i){i=i||0;if(this.filter(t)===true){var r=this.createNode({nodeType:"gx_layer",layer:t.getLayer(),layerStore:this.store,iconCls:this.iconCls[t.id]});var a=e.item(i);if(a){e.insertBefore(r,a)}else{e.appendChild(r)}r.on("move",this.onChildMove,this)}},removeLayerNode:function(e,t){if(this.filter(t)===true){var i=e.findChildBy(function(e){return e.layer==t.getLayer()});if(i){i.un("move",this.onChildMove,this);i.remove();e.reload()}}},onChildMove:function(h,e,t,i,r){this._reordering=true;var a=this.store.getByLayer(e.layer);delete t.loader.iconCls[a.id];if(i instanceof GeoExt.tree.LayerContainer&&this.store===i.loader.store){i.loader._reordering=true;i.loader.iconCls[a.id]=e.attributes.iconCls;this.store.remove(a);var s;if(i.childNodes.length>1){var n=r===0?r+1:r-1;s=this.store.findBy(function(e){return i.childNodes[n].layer===e.getLayer()});r===0&&s++}else if(t.parentNode===i.parentNode){var o=i;do{o=o.previousSibling}while(o&&!(o instanceof GeoExt.tree.LayerContainer&&o.lastChild));if(o){s=this.store.findBy(function(e){return o.lastChild.layer===e.getLayer()})}else{var l=i;do{l=l.nextSibling}while(l&&!(l instanceof GeoExt.tree.LayerContainer&&l.firstChild));if(l){s=this.store.findBy(function(e){return l.firstChild.layer===e.getLayer()})}s++}}if(s!==undefined){this.store.insert(s,[a]);window.setTimeout(function(){i.reload();t.reload()})}else{this.store.insert(oldRecordIndex,[a])}delete i.loader._reordering}delete this._reordering},addStoreHandlers:function(e){if(!this._storeHandlers){this._storeHandlers={add:this.onStoreAdd.createDelegate(this,[e],true),remove:this.onStoreRemove.createDelegate(this,[e],true)};for(var t in this._storeHandlers){this.store.on(t,this._storeHandlers[t],this)}}},removeStoreHandlers:function(){if(this._storeHandlers){for(var e in this._storeHandlers){this.store.un(e,this._storeHandlers[e],this)}delete this._storeHandlers}},createNode:function(attr){if(this.baseAttrs){Ext.apply(attr,this.baseAttrs)}if(typeof attr.uiProvider=="string"){attr.uiProvider=this.uiProviders[attr.uiProvider]||eval(attr.uiProvider)}attr.nodeType=attr.nodeType||"gx_layer";return new Ext.tree.TreePanel.nodeTypes[attr.nodeType](attr)},destroy:function(){this.removeStoreHandlers();this.iconCls=null}});OpenLayers.Layer=OpenLayers.Class({id:null,name:null,div:null,opacity:1,alwaysInRange:null,RESOLUTION_PROPERTIES:["scales","resolutions","maxScale","minScale","maxResolution","minResolution","numZoomLevels","maxZoomLevel"],events:null,map:null,isBaseLayer:false,alpha:false,displayInLayerSwitcher:true,visibility:true,attribution:null,inRange:false,imageSize:null,options:null,eventListeners:null,gutter:0,projection:null,units:null,scales:null,resolutions:null,maxExtent:null,minExtent:null,maxResolution:null,minResolution:null,numZoomLevels:null,minScale:null,maxScale:null,displayOutsideMaxExtent:false,wrapDateLine:false,metadata:null,initialize:function(e,t){this.metadata={};t=OpenLayers.Util.extend({},t);if(this.alwaysInRange!=null){t.alwaysInRange=this.alwaysInRange}this.addOptions(t);this.name=e;if(this.id==null){this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_");this.div=OpenLayers.Util.createDiv(this.id);this.div.style.width="100%";this.div.style.height="100%";this.div.dir="ltr";this.events=new OpenLayers.Events(this,this.div);if(this.eventListeners instanceof Object){this.events.on(this.eventListeners)}}},destroy:function(e){if(e==null){e=true}if(this.map!=null){this.map.removeLayer(this,e)}this.projection=null;this.map=null;this.name=null;this.div=null;this.options=null;if(this.events){if(this.eventListeners){this.events.un(this.eventListeners)}this.events.destroy()}this.eventListeners=null;this.events=null},clone:function(e){if(e==null){e=new OpenLayers.Layer(this.name,this.getOptions())}OpenLayers.Util.applyDefaults(e,this);e.map=null;return e},getOptions:function(){var e={};for(var t in this.options){e[t]=this[t]}return e},setName:function(e){if(e!=this.name){this.name=e;if(this.map!=null){this.map.events.triggerEvent("changelayer",{layer:this,property:"name"})}}},addOptions:function(e,t){if(this.options==null){this.options={}}if(e){if(typeof e.projection=="string"){e.projection=new OpenLayers.Projection(e.projection)}if(e.projection){OpenLayers.Util.applyDefaults(e,OpenLayers.Projection.defaults[e.projection.getCode()])}if(e.maxExtent&&!(e.maxExtent instanceof OpenLayers.Bounds)){e.maxExtent=new OpenLayers.Bounds(e.maxExtent)}if(e.minExtent&&!(e.minExtent instanceof OpenLayers.Bounds)){e.minExtent=new OpenLayers.Bounds(e.minExtent)}}OpenLayers.Util.extend(this.options,e);OpenLayers.Util.extend(this,e);if(this.projection&&this.projection.getUnits()){this.units=this.projection.getUnits()}if(this.map){var i=this.map.getResolution();var r=this.RESOLUTION_PROPERTIES.concat(["projection","units","minExtent","maxExtent"]);for(var a in e){if(e.hasOwnProperty(a)&&OpenLayers.Util.indexOf(r,a)>=0){this.initResolutions();if(t&&this.map.baseLayer===this){this.map.setCenter(this.map.getCenter(),this.map.getZoomForResolution(i),false,true);this.map.events.triggerEvent("changebaselayer",{layer:this})}break}}}},onMapResize:function(){},redraw:function(){var e=false;if(this.map){this.inRange=this.calculateInRange();var t=this.getExtent();if(t&&this.inRange&&this.visibility){var i=true;this.moveTo(t,i,false);this.events.triggerEvent("moveend",{zoomChanged:i});e=true}}return e},moveTo:function(e,t,i){var r=this.visibility;if(!this.isBaseLayer){r=r&&this.inRange}this.display(r)},moveByPx:function(e,t){},setMap:function(e){if(this.map==null){this.map=e;this.maxExtent=this.maxExtent||this.map.maxExtent;this.minExtent=this.minExtent||this.map.minExtent;this.projection=this.projection||this.map.projection;if(typeof this.projection=="string"){this.projection=new OpenLayers.Projection(this.projection)}this.units=this.projection.getUnits()||this.units||this.map.units;this.initResolutions();if(!this.isBaseLayer){this.inRange=this.calculateInRange();var t=this.visibility&&this.inRange;this.div.style.display=t?"":"none"}this.setTileSize()}},afterAdd:function(){if(Ext.getCmp("dateOccurs")){var e=Ext.getCmp("dateOccurs").getValue().format("Y-m-d").split("-");reverse_date_opt=new Date(e[0],e[1]-1,e[2]);reverse_date_opt.setDate(reverse_date_opt.getDate()-1);date_array_reverse=reverse_date_opt.dateFormat("Y-m-d").split("-")}else{var e=(new Date).format("Y-m-d").split("-");reverse_date_opt=new Date(e[0],e[1]-1,e[2]);reverse_date_opt.setDate(reverse_date_opt.getDate()-1);date_array_reverse=reverse_date_opt.dateFormat("Y-m-d").split("-")}if(this.name=="Earthquake shakemap"&&Ext.getCmp("eventsEQSelection")){selIndex=Ext.getCmp("eventsEQSelection").selectedIndex;if(selIndex<0){selIndex=Ext.getCmp("eventsEQSelection").getStore().totalLength-1}selectedEQ=Ext.getCmp("eventsEQSelection").getStore().getAt(selIndex);if(selectedEQ)this.mergeNewParams({CQL_FILTER:"event_code='"+selectedEQ.data.event_code+"'"})}else if(this.name==gettext("Drought Prediction")){Ext.Ajax.request({url:"../../geoapi/getdroughtlayer/",method:"POST",params:Ext.encode({date:Ext.getCmp("dateOccurs").getValue().format("Y-m-d")}),headers:{"Content-Type":"application/json"},success:function(e){woy_data=Ext.decode(e.responseText);this.mergeNewParams({viewparams:"woy:"+woy_data.woy+";"})},scope:this})}else if(this.name==gettext("Historical Flood Prediction")){this.mergeNewParams({viewparams:"year:"+e[0]+";month:"+e[1]+";day:"+e[2]+";"})}else if(this.name==gettext("Flashflood Prediction")){this.mergeNewParams({viewparams:"year:"+e[0]+";month:"+e[1]+";day:"+e[2]+";"})}else if(this.name==gettext("Flood prediction")){this.mergeNewParams({viewparams:"year:"+e[0]+";month:"+e[1]+";day:"+e[2]+";"});var t=new OpenLayers.Layer.Vector("Glofas Points",{projection:"EPSG:4326",styleMap:new OpenLayers.StyleMap({default:new OpenLayers.Style({pointRadius:"${radius}",fillOpacity:.6,fillColor:"${get_color}",strokeColor:"#111111",graphicName:"circle"},{context:{radius:function(e){return Math.min(e.attributes.rl5_dis_percent,1)*1.5+2},get_color:function(e){var t=0;if(e.attributes.rl5_dis_percent>=100)t=e.attributes.rl5_avg_dis_percent;else t=e.attributes.rl5_dis_percent;if(t>160){return"#E2070E"}else if(t>120&&t<=160){return"#F96D09"}else if(t>90&&t<=120){return"#FCED15"}else if(t>70&&t<=90){return"#0FC87B"}else if(t>50&&t<=70){return"#92E7FA"}else if(t>25&&t<=50){return"#e4f4f8"}}}}),select:{fillColor:"#8aeeef"}}),strategies:[new OpenLayers.Strategy.Fixed],protocol:new OpenLayers.Protocol.HTTP({url:"/getOverviewMaps/getGlofasPointsJSON?date="+reverse_date_opt.dateFormat("Y-m-d"),format:new OpenLayers.Format.GeoJSON})});this.map.addLayers([t]);var i=new OpenLayers.Control.SelectFeature(t);this.map.addControl(i);i.activate();function r(e){popup=new GeoExt.Popup({title:"RL : "+Math.round(e.data.rl2)+"/"+Math.round(e.data.rl5)+"/"+Math.round(e.data.rl20)+" - RL % : "+e.data.rl2_dis_percent+"/"+e.data.rl5_dis_percent+"/"+e.data.rl20_dis_percent,location:e,width:403,height:342,html:'<img src="/getOverviewMaps/getGlofasChart?date='+reverse_date_opt.dateFormat("Ymd")+"&lon="+e.data.lon+"&lat="+e.data.lat+'" style="width:100%;height:100%;" />',maximizable:true,collapsible:true});popup.on({close:function(){if(OpenLayers.Util.indexOf(t.selectedFeatures,this.feature)>-1){t.unselect(this.feature)}}});popup.show()}function a(e){if(e.object.visibility){t.setVisibility(true)}else{t.setVisibility(false)}}t.events.on({featureselected:function(e){r(e.feature)}});this.events.register("visibilitychanged",this,a)}else if(this.name=="Flood likelihood 2 year return period (GLOFAS)"){this.mergeNewParams({viewparams:"year:"+date_array_reverse[0]+";month:"+date_array_reverse[1]+";day:"+date_array_reverse[2]+";"})}else if(this.name=="Flood likelihood 5 year return period (GLOFAS)"){this.mergeNewParams({viewparams:"year:"+date_array_reverse[0]+";month:"+date_array_reverse[1]+";day:"+date_array_reverse[2]+";"})}else if(this.name=="Flood likelihood 20 year return period (GLOFAS)"){this.mergeNewParams({viewparams:"year:"+date_array_reverse[0]+";month:"+date_array_reverse[1]+";day:"+date_array_reverse[2]+";"})}},removeMap:function(e){},getImageSize:function(e){return this.imageSize||this.tileSize},setTileSize:function(e){var t=e?e:this.tileSize?this.tileSize:this.map.getTileSize();this.tileSize=t;if(this.gutter){this.imageSize=new OpenLayers.Size(t.w+2*this.gutter,t.h+2*this.gutter)}},getVisibility:function(){return this.visibility},setVisibility:function(e){if(e!=this.visibility){this.visibility=e;this.display(e);this.redraw();if(this.map!=null){this.map.events.triggerEvent("changelayer",{layer:this,property:"visibility"})}this.events.triggerEvent("visibilitychanged")}},display:function(e){if(e!=(this.div.style.display!="none")){this.div.style.display=e&&this.calculateInRange()?"block":"none"}},calculateInRange:function(){var e=false;if(this.alwaysInRange){e=true}else{if(this.map){var t=this.map.getResolution();e=t>=this.minResolution&&t<=this.maxResolution}}return e},setIsBaseLayer:function(e){if(e!=this.isBaseLayer){this.isBaseLayer=e;if(this.map!=null){this.map.events.triggerEvent("changebaselayer",{layer:this})}}},initResolutions:function(){var e,t,i;var r={},a=true;for(e=0,t=this.RESOLUTION_PROPERTIES.length;e<t;e++){i=this.RESOLUTION_PROPERTIES[e];r[i]=this.options[i];if(a&&this.options[i]){a=false}}if(this.options.alwaysInRange==null){this.alwaysInRange=a}if(r.resolutions==null){r.resolutions=this.resolutionsFromScales(r.scales)}if(r.resolutions==null){r.resolutions=this.calculateResolutions(r)}if(r.resolutions==null){for(e=0,t=this.RESOLUTION_PROPERTIES.length;e<t;e++){i=this.RESOLUTION_PROPERTIES[e];r[i]=this.options[i]!=null?this.options[i]:this.map[i]}if(r.resolutions==null){r.resolutions=this.resolutionsFromScales(r.scales)}if(r.resolutions==null){r.resolutions=this.calculateResolutions(r)}}var s;if(this.options.maxResolution&&this.options.maxResolution!=="auto"){s=this.options.maxResolution}if(this.options.minScale){s=OpenLayers.Util.getResolutionFromScale(this.options.minScale,this.units)}var n;if(this.options.minResolution&&this.options.minResolution!=="auto"){n=this.options.minResolution}if(this.options.maxScale){n=OpenLayers.Util.getResolutionFromScale(this.options.maxScale,this.units)}if(r.resolutions){r.resolutions.sort(function(e,t){return t-e});if(!s){s=r.resolutions[0]}if(!n){var o=r.resolutions.length-1;n=r.resolutions[o]}}this.resolutions=r.resolutions;if(this.resolutions){t=this.resolutions.length;this.scales=new Array(t);for(e=0;e<t;e++){this.scales[e]=OpenLayers.Util.getScaleFromResolution(this.resolutions[e],this.units)}this.numZoomLevels=t}this.minResolution=n;if(n){this.maxScale=OpenLayers.Util.getScaleFromResolution(n,this.units)}this.maxResolution=s;if(s){this.minScale=OpenLayers.Util.getScaleFromResolution(s,this.units)}},resolutionsFromScales:function(e){if(e==null){return}var t,i,r;r=e.length;t=new Array(r);for(i=0;i<r;i++){t[i]=OpenLayers.Util.getResolutionFromScale(e[i],this.units)}return t},calculateResolutions:function(e){var t,i,r;var a=e.maxResolution;if(e.minScale!=null){a=OpenLayers.Util.getResolutionFromScale(e.minScale,this.units)}else if(a=="auto"&&this.maxExtent!=null){t=this.map.getSize();i=this.maxExtent.getWidth()/t.w;r=this.maxExtent.getHeight()/t.h;a=Math.max(i,r)}var s=e.minResolution;if(e.maxScale!=null){s=OpenLayers.Util.getResolutionFromScale(e.maxScale,this.units)}else if(e.minResolution=="auto"&&this.minExtent!=null){t=this.map.getSize();i=this.minExtent.getWidth()/t.w;r=this.minExtent.getHeight()/t.h;s=Math.max(i,r)}if(typeof a!=="number"&&typeof s!=="number"&&this.maxExtent!=null){var p=this.map.getTileSize();a=Math.max(this.maxExtent.getWidth()/p.w,this.maxExtent.getHeight()/p.h)}var u=e.maxZoomLevel;var n=e.numZoomLevels;if(typeof s==="number"&&typeof a==="number"&&n===undefined){var c=a/s;n=Math.floor(Math.log(c)/Math.log(2))+1}else if(n===undefined&&u!=null){n=u+1}if(typeof n!=="number"||n<=0||typeof a!=="number"&&typeof s!=="number"){return}var o=new Array(n);var l=2;if(typeof s=="number"&&typeof a=="number"){l=Math.pow(a/s,1/(n-1))}var h;if(typeof a==="number"){for(h=0;h<n;h++){o[h]=a/Math.pow(l,h)}}else{for(h=0;h<n;h++){o[n-1-h]=s*Math.pow(l,h)}}return o},getResolution:function(){var e=this.map.getZoom();return this.getResolutionForZoom(e)},getExtent:function(){return this.map.calculateBounds()},getZoomForExtent:function(e,t){var i=this.map.getSize();var r=Math.max(e.getWidth()/i.w,e.getHeight()/i.h);return this.getZoomForResolution(r,t)},getDataExtent:function(){},getResolutionForZoom:function(e){e=Math.max(0,Math.min(e,this.resolutions.length-1));var t;if(this.map.fractionalZoom){var i=Math.floor(e);var r=Math.ceil(e);t=this.resolutions[i]-(e-i)*(this.resolutions[i]-this.resolutions[r])}else{t=this.resolutions[Math.round(e)]}return t},getZoomForResolution:function(e,p){var t,i,r;if(this.map.fractionalZoom){var a=0;var s=this.resolutions.length-1;var n=this.resolutions[a];var o=this.resolutions[s];var l;for(i=0,r=this.resolutions.length;i<r;++i){l=this.resolutions[i];if(l>=e){n=l;a=i}if(l<=e){o=l;s=i;break}}var u=n-o;if(u>0){t=a+(n-e)/u}else{t=a}}else{var h;var c=Number.POSITIVE_INFINITY;for(i=0,r=this.resolutions.length;i<r;i++){if(p){h=Math.abs(this.resolutions[i]-e);if(h>c){break}c=h}else{if(this.resolutions[i]<e){break}}}t=Math.max(0,i-1)}return t},getLonLatFromViewPortPx:function(e){var t=null;var i=this.map;if(e!=null&&i.minPx){var r=i.getResolution();var a=i.getMaxExtent({restricted:true});var s=(e.x-i.minPx.x)*r+a.left;var n=(i.minPx.y-e.y)*r+a.top;t=new OpenLayers.LonLat(s,n);if(this.wrapDateLine){t=t.wrapDateLine(this.maxExtent)}}return t},getViewPortPxFromLonLat:function(e,t){var i=null;if(e!=null){t=t||this.map.getResolution();var r=this.map.calculateBounds(null,t);i=new OpenLayers.Pixel(1/t*(e.lon-r.left),1/t*(r.top-e.lat))}return i},setOpacity:function(e){if(e!=this.opacity){this.opacity=e;var t=this.div.childNodes;for(var i=0,r=t.length;i<r;++i){var a=t[i].firstChild||t[i];var s=t[i].lastChild;if(s&&s.nodeName.toLowerCase()==="iframe"){a=s.parentNode}OpenLayers.Util.modifyDOMElement(a,null,null,null,null,null,null,e)}if(this.map!=null){this.map.events.triggerEvent("changelayer",{layer:this,property:"opacity"})}}},getZIndex:function(){return this.div.style.zIndex},setZIndex:function(e){this.div.style.zIndex=e},adjustBounds:function(e){if(this.gutter){var t=this.gutter*this.map.getResolution();e=new OpenLayers.Bounds(e.left-t,e.bottom-t,e.right+t,e.top+t)}if(this.wrapDateLine){var i={rightTolerance:this.getResolution(),leftTolerance:this.getResolution()};e=e.wrapDateLine(this.maxExtent,i)}return e},CLASS_NAME:"OpenLayers.Layer"});Ext.namespace("GeoExt.tree");GeoExt.tree.LayerNodeUI=Ext.extend(Ext.tree.TreeNodeUI,{constructor:function(e){GeoExt.tree.LayerNodeUI.superclass.constructor.apply(this,arguments)},render:function(e){var t=this.node.attributes;if(t.checked===undefined){t.checked=this.node.layer.getVisibility()}if(t.disabled===undefined&&this.node.autoDisable){this.node.disabled=this.node.layer.inRange===false||!this.node.layer.calculateInRange()}GeoExt.tree.LayerNodeUI.superclass.render.apply(this,arguments);var i=this.checkbox;if(t.checkedGroup){var r=Ext.DomHelper.insertAfter(i,['<input type="radio" name="',t.checkedGroup,'_checkbox" class="',i.className,i.checked?'" checked="checked"':"",'"></input>'].join(""));r.defaultChecked=i.defaultChecked;Ext.get(i).remove();this.checkbox=r}this.enforceOneVisible()},onClick:function(e){if(e.getTarget(".x-tree-node-cb",1)){this.toggleCheck(this.isChecked())}else{GeoExt.tree.LayerNodeUI.superclass.onClick.apply(this,arguments)}},toggleCheck:function(e){e=e===undefined?!this.isChecked():e;GeoExt.tree.LayerNodeUI.superclass.toggleCheck.call(this,e);this.enforceOneVisible()},enforceOneVisible:function(){var i=this.node.attributes;var r=i.checkedGroup;if(r&&r!=="gx_baselayer"){var a=this.node.layer;var e=this.node.getOwnerTree().getChecked();var s=0;Ext.each(e,function(e){var t=e.layer;if(!e.hidden&&e.attributes.checkedGroup===r){s++;if(t!=a&&i.checked){t.setVisibility(false)}}});if(s===0&&i.checked==false){a.setVisibility(true)}}},appendDDGhost:function(e){var t=this.elNode.cloneNode(true);var i=Ext.DomQuery.select("input[type='radio']",t);Ext.each(i,function(e){e.name=e.name+"_clone"});e.appendChild(t)}});GeoExt.tree.LayerNode=Ext.extend(Ext.tree.AsyncTreeNode,{layer:null,autoDisable:null,layerStore:null,constructor:function(e){e.leaf=e.leaf||!(e.children||e.loader);if(!e.iconCls&&!e.children){e.iconCls="gx-tree-layer-icon"}if(e.loader&&!(e.loader instanceof Ext.tree.TreeLoader)){e.loader=new GeoExt.tree.LayerParamLoader(e.loader)}this.defaultUI=this.defaultUI||GeoExt.tree.LayerNodeUI;Ext.apply(this,{layer:e.layer,layerStore:e.layerStore,autoDisable:e.autoDisable});if(e.text){this.fixedText=true}GeoExt.tree.LayerNode.superclass.constructor.apply(this,arguments)},render:function(e){var t=this.layer instanceof OpenLayers.Layer&&this.layer;if(!t){if(!this.layerStore||this.layerStore=="auto"){this.layerStore=GeoExt.MapPanel.guess().layers}var i=this.layerStore.findBy(function(e){return e.get("title")==this.layer},this);if(i!=-1){t=this.layerStore.getAt(i).getLayer()}}if(!this.rendered||!t){var r=this.getUI();if(t){this.layer=t;if(t.isBaseLayer){this.draggable=false;Ext.applyIf(this.attributes,{checkedGroup:"gx_baselayer"})}this.autoDisable=!(this.autoDisable===false||this.layer.isBaseLayer||this.layer.alwaysInRange);if(!this.text){this.text=t.name}r.show();this.addVisibilityEventHandlers()}else{r.hide()}if(this.layerStore instanceof GeoExt.data.LayerStore){this.addStoreEventHandlers(t)}}GeoExt.tree.LayerNode.superclass.render.apply(this,arguments)},addVisibilityEventHandlers:function(){this.layer.events.on({visibilitychanged:this.onLayerVisibilityChanged,scope:this});this.on({checkchange:this.onCheckChange,scope:this});if(this.autoDisable){if(this.layer.map){this.layer.map.events.register("moveend",this,this.onMapMoveend)}else{this.layer.events.register("added",this,function e(){this.layer.events.unregister("added",this,e);this.layer.map.events.register("moveend",this,this.onMapMoveend)})}}},onLayerVisibilityChanged:function(){if(!this._visibilityChanging){this.getUI().toggleCheck(this.layer.getVisibility())}},onCheckChange:function(e,t){if(t!=this.layer.getVisibility()){this._visibilityChanging=true;var i=this.layer;if(t&&i.isBaseLayer&&i.map){i.map.setBaseLayer(i)}else{i.setVisibility(t)}delete this._visibilityChanging}},onMapMoveend:function(e){if(this.autoDisable){if(this.layer.inRange===false){this.disable()}else{this.enable()}}},addStoreEventHandlers:function(){this.layerStore.on({add:this.onStoreAdd,remove:this.onStoreRemove,update:this.onStoreUpdate,scope:this})},onStoreAdd:function(e,t,i){var r;for(var a=0;a<t.length;++a){r=t[a].getLayer();if(this.layer==r){this.getUI().show();break}else if(this.layer==r.name){this.render();break}}},onStoreRemove:function(e,t,i){if(this.layer==t.getLayer()){this.getUI().hide()}},onStoreUpdate:function(e,t,i){var r=t.getLayer();if(!this.fixedText&&(this.layer==r&&this.text!==r.name)){this.setText(r.name)}},destroy:function(){var e=this.layer;if(e instanceof OpenLayers.Layer){if(e.map){e.map.events.unregister("moveend",this,this.onMapMoveend)}e.events.un({visibilitychanged:this.onLayerVisibilityChanged,scope:this})}delete this.layer;var t=this.layerStore;if(t){t.un("add",this.onStoreAdd,this);t.un("remove",this.onStoreRemove,this);t.un("update",this.onStoreUpdate,this)}delete this.layerStore;this.un("checkchange",this.onCheckChange,this);GeoExt.tree.LayerNode.superclass.destroy.apply(this,arguments)}});Ext.tree.TreePanel.nodeTypes.gx_layer=GeoExt.tree.LayerNode;Ext.namespace("GeoExt.tree");GeoExt.tree.BaseLayerContainer=Ext.extend(GeoExt.tree.LayerContainer,{text:gettext("Base Layer"),constructor:function(e){e=Ext.applyIf(e||{},{text:this.text,loader:{}});e.loader=Ext.applyIf(e.loader,{baseAttrs:Ext.applyIf(e.loader.baseAttrs||{},{iconCls:"gx-tree-baselayer-icon",checkedGroup:"baselayer"}),filter:function(e){var t=e.getLayer();return t.displayInLayerSwitcher===true&&t.isBaseLayer===true}});GeoExt.tree.BaseLayerContainer.superclass.constructor.call(this,e)}});Ext.tree.TreePanel.nodeTypes.gx_baselayercontainer=GeoExt.tree.BaseLayerContainer;Ext.namespace("GeoExt.tree");GeoExt.tree.OverlayLayerContainer=Ext.extend(GeoExt.tree.LayerContainer,{text:gettext("Overlays"),constructor:function(e){e=Ext.applyIf(e||{},{text:this.text});e.loader=Ext.applyIf(e.loader||{},{filter:function(e){var t=e.getLayer();return t.displayInLayerSwitcher===true&&t.isBaseLayer===false}});GeoExt.tree.OverlayLayerContainer.superclass.constructor.call(this,e)}});Ext.tree.TreePanel.nodeTypes.gx_overlaylayercontainer=GeoExt.tree.OverlayLayerContainer;Ext.namespace("GeoExt.tree");GeoExt.tree.TreeNodeUIEventMixin=function(){return{constructor:function(e){e.addEvents("rendernode","rawclicknode");this.superclass=arguments.callee.superclass;this.superclass.constructor.apply(this,arguments)},render:function(e){if(!this.rendered){this.superclass.render.apply(this,arguments);this.fireEvent("rendernode",this.node)}},onClick:function(e){if(this.fireEvent("rawclicknode",this.node,e)!==false){this.superclass.onClick.apply(this,arguments)}}}};Ext.namespace("GeoExt");GeoExt.Popup=Ext.extend(Ext.Window,{anchored:true,map:null,panIn:true,unpinnable:true,location:null,insideViewport:null,animCollapse:false,draggable:false,shadow:false,popupCls:"gx-popup",ancCls:null,anchorPosition:"auto",initComponent:function(){if(this.map instanceof GeoExt.MapPanel){this.map=this.map.map}if(!this.map&&this.location instanceof OpenLayers.Feature.Vector&&this.location.layer){this.map=this.location.layer.map}if(this.location instanceof OpenLayers.Feature.Vector){this.location=this.location.geometry}if(this.location instanceof OpenLayers.Geometry){if(typeof this.location.getCentroid=="function"){this.location=this.location.getCentroid()}this.location=this.location.getBounds().getCenterLonLat()}else if(this.location instanceof OpenLayers.Pixel){this.location=this.map.getLonLatFromViewPortPx(this.location)}if(!(this.location instanceof OpenLayers.LonLat)){this.anchored=false}var e=this.map.getExtent();if(e&&this.location){this.insideViewport=e.containsLonLat(this.location)}if(this.anchored){this.addAnchorEvents();this.elements+=",anc"}else{this.unpinnable=false}this.baseCls=this.popupCls+" "+this.baseCls;GeoExt.Popup.superclass.initComponent.call(this)},onRender:function(e,t){GeoExt.Popup.superclass.onRender.call(this,e,t);if(this.anchored){this.ancCls=this.popupCls+"-anc";this.createElement("anc",this.el.dom)}else{this.makeDraggable()}},initTools:function(){if(this.unpinnable){this.addTool({id:"unpin",handler:this.unanchorPopup.createDelegate(this,[])})}GeoExt.Popup.superclass.initTools.call(this)},show:function(){GeoExt.Popup.superclass.show.apply(this,arguments);if(this.anchored){this.position();if(this.panIn&&!this._mapMove){this.panIntoView()}}},maximize:function(){if(!this.maximized&&this.anc){this.unanchorPopup()}GeoExt.Popup.superclass.maximize.apply(this,arguments)},setSize:function(e,t){if(this.anc){var i=this.anc.getSize();if(typeof e=="object"){t=e.height-i.height;e=e.width}else if(!isNaN(t)){t=t-i.height}}GeoExt.Popup.superclass.setSize.call(this,e,t)},position:function(){var e=this;if(e._mapMove===true){e.insideViewport=e.map.getExtent().containsLonLat(e.location);if(e.insideViewport!==e.isVisible()){e.setVisible(e.insideViewport)}}if(e.isVisible()){var t=e.map.getPixelFromLonLat(e.location),i=Ext.fly(e.map.div).getBox(true),r=t.y+i.y,a=t.x+i.x,s=e.el.getSize(),n=e.anc.getSize(),o=e.anchorPosition;if(o.indexOf("right")>-1||t.x>i.width/2){e.anc.addClass("right");var l=e.el.getX(true)+s.width-e.anc.getX(true)-n.width;a-=s.width-l-n.width/2}else{e.anc.removeClass("right");var h=e.anc.getLeft(true);a-=h+n.width/2}if(o.indexOf("bottom")>-1||t.y>i.height/2){e.anc.removeClass("top");r-=s.height+n.height}else{e.anc.addClass("top");r+=n.height}e.setPagePosition(a,r);window.setTimeout(function(){if(e.el.dom){e.setPagePosition(a,r)}},0)}},makeDraggable:function(){this.draggable=true;this.header.addClass("x-window-draggable");this.dd=new Ext.Window.DD(this)},unanchorPopup:function(){this.removeAnchorEvents();this.makeDraggable();this.anc.remove();this.anc=null;this.tools.unpin.hide()},panIntoView:function(){var e=Ext.fly(this.map.div).getBox(true);var t=this.getPosition(true);t[0]-=e.x;t[1]-=e.y;var i=[e.width,e.height];var r=this.getSize();var a=[t[0],t[1]];var s=this.map.paddingForPopups;if(t[0]<s.left){a[0]=s.left}else if(t[0]+r.width>i[0]-s.right){a[0]=i[0]-s.right-r.width}if(t[1]<s.top){a[1]=s.top}else if(t[1]+r.height>i[1]-s.bottom){a[1]=i[1]-s.bottom-r.height}var n=t[0]-a[0];var o=t[1]-a[1];this.map.pan(n,o)},onMapMove:function(){if(!(this.hidden&&this.insideViewport)){this._mapMove=true;this.position();delete this._mapMove}},addAnchorEvents:function(){this.map.events.on({move:this.onMapMove,scope:this});this.on({resize:this.position,collapse:this.position,expand:this.position,scope:this})},removeAnchorEvents:function(){this.map.events.un({move:this.onMapMove,scope:this});this.un("resize",this.position,this);this.un("collapse",this.position,this);this.un("expand",this.position,this)},beforeDestroy:function(){if(this.anchored){this.removeAnchorEvents()}GeoExt.Popup.superclass.beforeDestroy.call(this)}});Ext.reg("gx_popup",GeoExt.Popup);Ext.namespace("GeoExt");GeoExt.MapPanel=Ext.extend(Ext.Panel,{map:null,layers:null,center:null,zoom:null,extent:null,prettyStateKeys:false,stateEvents:["aftermapmove","afterlayervisibilitychange","afterlayeropacitychange","afterlayerorderchange","afterlayernamechange","afterlayeradd","afterlayerremove"],initComponent:function(){if(!(this.map instanceof OpenLayers.Map)){this.map=new OpenLayers.Map(Ext.applyIf(this.map||{},{allOverlays:true,fallThrough:true}))}var e=this.layers;if(!e||e instanceof Array){this.layers=new GeoExt.data.LayerStore({layers:e,map:this.map.layers.length>0?this.map:null})}if(typeof this.center=="string"){this.center=OpenLayers.LonLat.fromString(this.center)}else if(this.center instanceof Array){this.center=new OpenLayers.LonLat(this.center[0],this.center[1])}if(typeof this.extent=="string"){this.extent=OpenLayers.Bounds.fromString(this.extent)}else if(this.extent instanceof Array){this.extent=OpenLayers.Bounds.fromArray(this.extent)}GeoExt.MapPanel.superclass.initComponent.call(this);this.addEvents("aftermapmove","afterlayervisibilitychange","afterlayeropacitychange","afterlayerorderchange","afterlayernamechange","afterlayeradd","afterlayerremove");this.map.events.on({moveend:this.onMoveend,changelayer:this.onChangelayer,addlayer:this.onAddlayer,removelayer:this.onRemovelayer,scope:this});this.on("afterlayout",function(){if(typeof this.map.getViewport==="function"){this.items.each(function(e){if(typeof e.addToMapPanel==="function"){e.getEl().appendTo(this.map.getViewport())}},this)}},this)},onMoveend:function(){this.fireEvent("aftermapmove")},onChangelayer:function(e){if(e.property){if(e.property==="visibility"){this.fireEvent("afterlayervisibilitychange")}else if(e.property==="order"){this.fireEvent("afterlayerorderchange")}else if(e.property==="name"){this.fireEvent("afterlayernamechange")}else if(e.property==="opacity"){this.fireEvent("afterlayeropacitychange")}}},onAddlayer:function(){this.fireEvent("afterlayeradd")},onRemovelayer:function(){this.fireEvent("afterlayerremove")},applyState:function(e){this.center=new OpenLayers.LonLat(e.x,e.y);this.zoom=e.zoom;var t,i,r,a,s,n;var o=this.map.layers;for(t=0,i=o.length;t<i;t++){r=o[t];a=this.prettyStateKeys?r.name:r.id;s=e["visibility_"+a];if(s!==undefined){s=/^true$/i.test(s);if(r.isBaseLayer){if(s){this.map.setBaseLayer(r)}}else{r.setVisibility(s)}}n=e["opacity_"+a];if(n!==undefined){r.setOpacity(n)}}},getState:function(){var e;if(!this.map){return}var t=this.map.getCenter();e=t?{x:t.lon,y:t.lat,zoom:this.map.getZoom()}:{};var i,r,a,s,n=this.map.layers;for(i=0,r=n.length;i<r;i++){a=n[i];s=this.prettyStateKeys?a.name:a.id;e["visibility_"+s]=a.getVisibility();e["opacity_"+s]=a.opacity==null?1:a.opacity}return e},updateMapSize:function(){if(this.map){this.map.updateSize()}},renderMap:function(){var e=this.map;e.render(this.body.dom);this.layers.bind(e);if(e.layers.length>0){this.setInitialExtent()}else{this.layers.on("add",this.setInitialExtent,this,{single:true})}},setInitialExtent:function(){var e=this.map;if(this.center||this.zoom!=null){e.setCenter(this.center,this.zoom)}else if(this.extent){e.zoomToExtent(this.extent)}else{e.zoomToMaxExtent()}},afterRender:function(){GeoExt.MapPanel.superclass.afterRender.apply(this,arguments);if(!this.ownerCt){this.renderMap()}else{this.ownerCt.on("move",this.updateMapSize,this);this.ownerCt.on({afterlayout:this.afterLayout,scope:this})}},afterLayout:function(){var e=this.getInnerWidth()-this.body.getBorderWidth("lr");var t=this.getInnerHeight()-this.body.getBorderWidth("tb");if(e>0&&t>0){this.ownerCt.un("afterlayout",this.afterLayout,this);this.renderMap()}},onResize:function(){GeoExt.MapPanel.superclass.onResize.apply(this,arguments);this.updateMapSize()},onBeforeAdd:function(e){if(typeof e.addToMapPanel==="function"){e.addToMapPanel(this)}GeoExt.MapPanel.superclass.onBeforeAdd.apply(this,arguments)},remove:function(e,t){if(typeof e.removeFromMapPanel==="function"){e.removeFromMapPanel(this)}GeoExt.MapPanel.superclass.remove.apply(this,arguments)},beforeDestroy:function(){if(this.ownerCt){this.ownerCt.un("move",this.updateMapSize,this)}if(this.map&&this.map.events){this.map.events.un({moveend:this.onMoveend,changelayer:this.onChangelayer,addlayer:this.onAddlayer,removelayer:this.onRemovelayer,scope:this})}if(!this.initialConfig.map||!(this.initialConfig.map instanceof OpenLayers.Map)){if(this.map&&this.map.destroy){this.map.destroy()}}delete this.map;GeoExt.MapPanel.superclass.beforeDestroy.apply(this,arguments)}});GeoExt.MapPanel.guess=function(){return Ext.ComponentMgr.all.find(function(e){return e instanceof GeoExt.MapPanel})};Ext.reg("gx_mappanel",GeoExt.MapPanel);Ext.namespace("GeoExt.data");GeoExt.data.LayerStoreMixin=function(){return{map:null,reader:null,constructor:function(e){e=e||{};e.reader=e.reader||new GeoExt.data.LayerReader({},e.fields);delete e.fields;var t=e.map instanceof GeoExt.MapPanel?e.map.map:e.map;delete e.map;if(e.layers){e.data=e.layers}delete e.layers;var i={initDir:e.initDir};delete e.initDir;arguments.callee.superclass.constructor.call(this,e);this.addEvents("bind");if(t){this.bind(t,i)}},bind:function(e,t){if(this.map){return}this.map=e;t=t||{};var i=t.initDir;if(t.initDir==undefined){i=GeoExt.data.LayerStore.MAP_TO_STORE|GeoExt.data.LayerStore.STORE_TO_MAP}var r=e.layers.slice(0);if(i&GeoExt.data.LayerStore.STORE_TO_MAP){this.each(function(e){this.map.addLayer(e.getLayer())},this)}if(i&GeoExt.data.LayerStore.MAP_TO_STORE){this.loadData(r,true)}e.events.on({changelayer:this.onChangeLayer,addlayer:this.onAddLayer,removelayer:this.onRemoveLayer,scope:this});this.on({load:this.onLoad,clear:this.onClear,add:this.onAdd,remove:this.onRemove,update:this.onUpdate,scope:this});this.data.on({replace:this.onReplace,scope:this});this.fireEvent("bind",this,e)},unbind:function(){if(this.map){this.map.events.un({changelayer:this.onChangeLayer,addlayer:this.onAddLayer,removelayer:this.onRemoveLayer,scope:this});this.un("load",this.onLoad,this);this.un("clear",this.onClear,this);this.un("add",this.onAdd,this);this.un("remove",this.onRemove,this);this.data.un("replace",this.onReplace,this);this.map=null}},onChangeLayer:function(e){var i=e.layer;var t=this.findBy(function(e,t){return e.getLayer()===i});if(t>-1){var r=this.getAt(t);if(e.property==="order"){if(!this._adding&&!this._removing){var a=this.map.getLayerIndex(i);if(a!==t){this._removing=true;this.remove(r);delete this._removing;this._adding=true;this.insert(a,[r]);delete this._adding}}}else if(e.property==="name"){r.set("title",i.name)}else{this.fireEvent("update",this,r,Ext.data.Record.EDIT)}}},onAddLayer:function(e){if(!this._adding){var t=e.layer;this._adding=true;this.loadData([t],true);delete this._adding}},onRemoveLayer:function(e){if(this.map.unloadDestroy){if(!this._removing){var t=e.layer;this._removing=true;this.remove(this.getById(t.id));delete this._removing}}else{this.unbind()}},onLoad:function(e,t,i){if(!Ext.isArray(t)){t=[t]}if(i&&!i.add){this._removing=true;for(var r=this.map.layers.length-1;r>=0;r--){this.map.removeLayer(this.map.layers[r])}delete this._removing;var a=t.length;if(a>0){var s=new Array(a);for(var n=0;n<a;n++){s[n]=t[n].getLayer()}this._adding=true;this.map.addLayers(s);delete this._adding}}},onClear:function(e){this._removing=true;for(var t=this.map.layers.length-1;t>=0;t--){this.map.removeLayer(this.map.layers[t])}delete this._removing},onAdd:function(e,t,i){if(!this._adding){this._adding=true;var r;for(var a=t.length-1;a>=0;--a){r=t[a].getLayer();this.map.addLayer(r);if(i!==this.map.layers.length-1){this.map.setLayerIndex(r,i)}}delete this._adding}},onRemove:function(e,t,i){if(!this._removing){var r=t.getLayer();if(this.map.getLayer(r.id)!=null){this._removing=true;this.removeMapLayer(t);delete this._removing}}},onUpdate:function(e,t,i){if(i===Ext.data.Record.EDIT){if(t.modified&&t.modified.title){var r=t.getLayer();var a=t.get("title");if(a!==r.name){r.setName(a)}}}},removeMapLayer:function(e){this.map.removeLayer(e.getLayer())},onReplace:function(e,t,i){this.removeMapLayer(t)},getByLayer:function(t){var e=this.findBy(function(e){return e.getLayer()===t});if(e>-1){return this.getAt(e)}},destroy:function(){this.unbind();GeoExt.data.LayerStore.superclass.destroy.call(this)}}};GeoExt.data.LayerStore=Ext.extend(Ext.data.Store,new GeoExt.data.LayerStoreMixin);GeoExt.data.LayerStore.MAP_TO_STORE=1;GeoExt.data.LayerStore.STORE_TO_MAP=2;Ext.namespace("GeoExt","GeoExt.data");GeoExt.data.LayerReader=function(e,t){e=e||{};if(!(t instanceof Function)){t=GeoExt.data.LayerRecord.create(t||e.fields||{})}GeoExt.data.LayerReader.superclass.constructor.call(this,e,t)};Ext.extend(GeoExt.data.LayerReader,Ext.data.DataReader,{totalRecords:null,readRecords:function(e){var t=[];if(e){var i=this.recordType,r=i.prototype.fields;var a,p,s,u,n,o,l,h;for(a=0,p=e.length;a<p;a++){n=e[a];o={};for(s=0,u=r.length;s<u;s++){l=r.items[s];h=n[l.mapping||l.name]||l.defaultValue;h=l.convert(h);o[l.name]=h}o.layer=n;t[t.length]=new i(o,n.id)}}return{records:t,totalRecords:this.totalRecords!=null?this.totalRecords:t.length}}});Ext.namespace("GeoExt.data");GeoExt.data.ScaleStore=Ext.extend(Ext.data.Store,{map:null,constructor:function(e){var t=e.map instanceof GeoExt.MapPanel?e.map.map:e.map;delete e.map;e=Ext.applyIf(e,{reader:new Ext.data.JsonReader({},["level","resolution","scale"])});GeoExt.data.ScaleStore.superclass.constructor.call(this,e);if(t){this.bind(t)}},bind:function(e,t){this.map=e instanceof GeoExt.MapPanel?e.map:e;this.map.events.register("changebaselayer",this,this.populateFromMap);if(this.map.baseLayer){this.populateFromMap()}else{this.map.events.register("addlayer",this,this.populateOnAdd)}},unbind:function(){if(this.map){this.map.events.unregister("addlayer",this,this.populateOnAdd);this.map.events.unregister("changebaselayer",this,this.populateFromMap);delete this.map}},populateOnAdd:function(e){if(e.layer.isBaseLayer){this.populateFromMap();this.map.events.unregister("addlayer",this,this.populateOnAdd)}},populateFromMap:function(){var e=[];var t=this.map.baseLayer.resolutions;var i=this.map.baseLayer.units;for(var r=t.length-1;r>=0;r--){var a=t[r];e.push({level:r,resolution:a,scale:OpenLayers.Util.getScaleFromResolution(a,i)})}this.loadData(e)},destroy:function(){this.unbind();GeoExt.data.ScaleStore.superclass.destroy.apply(this,arguments)}});Ext.namespace("GeoExt.form");GeoExt.form.toFilter=function(e,t,i){if(e instanceof Ext.form.FormPanel){e=e.getForm()}var r=[],a=e.getValues(false);for(var s in a){var n=s.split("__");var o=a[s],l;if(n.length>1&&(l=GeoExt.form.toFilter.FILTER_MAP[n[1]])!==undefined){s=n[0]}else{l=OpenLayers.Filter.Comparison.EQUAL_TO}if(l===OpenLayers.Filter.Comparison.LIKE){switch(i){case GeoExt.form.ENDS_WITH:o=".*"+o;break;case GeoExt.form.STARTS_WITH:o+=".*";break;case GeoExt.form.CONTAINS:o=".*"+o+".*";break;default:break}}r.push(new OpenLayers.Filter.Comparison({type:l,value:o,property:s}))}return r.length==1&&t!=OpenLayers.Filter.Logical.NOT?r[0]:new OpenLayers.Filter.Logical({type:t||OpenLayers.Filter.Logical.AND,filters:r})};GeoExt.form.toFilter.FILTER_MAP={eq:OpenLayers.Filter.Comparison.EQUAL_TO,ne:OpenLayers.Filter.Comparison.NOT_EQUAL_TO,lt:OpenLayers.Filter.Comparison.LESS_THAN,le:OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO,gt:OpenLayers.Filter.Comparison.GREATER_THAN,ge:OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO,like:OpenLayers.Filter.Comparison.LIKE};GeoExt.form.ENDS_WITH=1;GeoExt.form.STARTS_WITH=2;GeoExt.form.CONTAINS=3;GeoExt.form.recordToField=function(e,t){t=t||{};var i=e.get("type");if(typeof i==="object"&&i.xtype){return i}i=i.split(":").pop();var r;var a=e.get("name");var s=e.get("restriction")||{};var p=e.get("nillable")||false;var n=e.get("label");var o=t.labelTpl;if(o){var u=o instanceof Ext.Template?o:new Ext.XTemplate(o);n=u.apply(e.data)}else if(n==null){n=a}var l={name:a,labelStyle:p?"":t.mandatoryFieldLabelStyle!=null?t.mandatoryFieldLabelStyle:"font-weight:bold;"};var h=GeoExt.form.recordToField.REGEXES;if(s.enumeration){r=Ext.apply({xtype:"combo",fieldLabel:n,mode:"local",forceSelection:true,triggerAction:"all",editable:false,store:s.enumeration},l)}else if(i.match(h["text"])){var c=s["maxLength"]!==undefined?parseFloat(s["maxLength"]):undefined;var d=s["minLength"]!==undefined?parseFloat(s["minLength"]):undefined;r=Ext.apply({xtype:"textfield",fieldLabel:n,maxLength:c,minLength:d},l)}else if(i.match(h["number"])){var f=s["maxInclusive"]!==undefined?parseFloat(s["maxInclusive"]):undefined;var y=s["minInclusive"]!==undefined?parseFloat(s["minInclusive"]):undefined;r=Ext.apply({xtype:"numberfield",fieldLabel:n,maxValue:f,minValue:y},l)}else if(i.match(h["boolean"])){r=Ext.apply({xtype:"checkbox"},l);var g=t.checkboxLabelProperty||"boxLabel";r[g]=n}else if(i.match(h["date"])){r=Ext.apply({xtype:"datefield",fieldLabel:n,format:"c"},l)}return r};GeoExt.form.recordToField.REGEXES={text:new RegExp("^(text|string)$","i"),number:new RegExp("^(number|float|decimal|double|int|long|integer|short)$","i"),boolean:new RegExp("^(boolean)$","i"),date:new RegExp("^(date|dateTime)$","i")};Ext.namespace("GeoExt");GeoExt.LegendPanel=Ext.extend(Ext.Panel,{dynamic:true,layerStore:null,preferredTypes:null,filter:function(e){return true},onRender:function(){GeoExt.LegendPanel.superclass.onRender.apply(this,arguments);if(!this.layerStore){this.layerStore=GeoExt.MapPanel.guess().layers}this.layerStore.each(function(e){this.addLegend(e)},this);if(this.dynamic){this.layerStore.on({add:this.onStoreAdd,remove:this.onStoreRemove,clear:this.onStoreClear,scope:this})}},recordIndexToPanelIndex:function(e){var t=this.layerStore;var i=t.getCount();var r=-1;var a=this.items?this.items.length:0;var s,n;for(var o=i-1;o>=0;--o){s=t.getAt(o);n=s.getLayer();var l=GeoExt.LayerLegend.getTypes(s);if(n.displayInLayerSwitcher&&l.length>0&&t.getAt(o).get("hideInLegend")!==true){++r;if(e===o||r>a-1){break}}}return r},getIdForLayer:function(e){return this.id+"-"+e.id},onStoreAdd:function(e,t,i){var r=this.recordIndexToPanelIndex(i+t.length-1);for(var a=0,s=t.length;a<s;a++){this.addLegend(t[a],r)}this.doLayout()},onStoreRemove:function(e,t,i){this.removeLegend(t)},removeLegend:function(e){if(this.items){var t=this.getComponent(this.getIdForLayer(e.getLayer()));if(t){this.remove(t,true);this.doLayout()}}},onStoreClear:function(e){this.removeAllLegends()},removeAllLegends:function(){this.removeAll(true);this.doLayout()},addLegend:function(e,t){if(this.filter(e)===true){var i=e.getLayer();t=t||0;var r;var a=GeoExt.LayerLegend.getTypes(e,this.preferredTypes);if(i.displayInLayerSwitcher&&!e.get("hideInLegend")&&a.length>0){this.insert(t,{xtype:a[0],id:this.getIdForLayer(i),layerRecord:e,hidden:!(!i.map&&i.visibility||i.getVisibility()&&i.calculateInRange())})}}},onDestroy:function(){if(this.layerStore){this.layerStore.un("add",this.onStoreAdd,this);this.layerStore.un("remove",this.onStoreRemove,this);this.layerStore.un("clear",this.onStoreClear,this)}GeoExt.LegendPanel.superclass.onDestroy.apply(this,arguments)}});Ext.reg("gx_legendpanel",GeoExt.LegendPanel);Ext.namespace("GeoExt");GeoExt.LayerLegend=Ext.extend(Ext.Container,{layerRecord:null,showTitle:true,legendTitle:null,labelCls:null,layerStore:null,initComponent:function(){GeoExt.LayerLegend.superclass.initComponent.call(this);this.autoEl={};this.add({xtype:"label",html:this.getLayerTitle(this.layerRecord),cls:"x-form-item x-form-item-label"+(this.labelCls?" "+this.labelCls:"")});if(this.layerRecord&&this.layerRecord.store){this.layerStore=this.layerRecord.store;this.layerStore.on("update",this.onStoreUpdate,this);this.layerStore.on("add",this.onStoreAdd,this);this.layerStore.on("remove",this.onStoreRemove,this)}},getLabel:function(){var e=this.items.get(0);return e.rendered?e.el.dom.innerHTML:e.html},onStoreRemove:function(e,t,i){},onStoreAdd:function(e,t,i){},onStoreUpdate:function(e,t,i){if(t===this.layerRecord&&this.items.getCount()>0){var r=t.getLayer();this.setVisible(r.getVisibility()&&r.calculateInRange()&&r.displayInLayerSwitcher&&!t.get("hideInLegend"));this.update()}},update:function(){var e=this.getLayerTitle(this.layerRecord);var t=this.items.itemAt(0);if(t instanceof Ext.form.Label&&this.getLabel()!==e){t.setText(e,false)}},getLayerTitle:function(e){var t=this.legendTitle||"";if(this.showTitle&&!t){if(e&&!e.get("hideTitle")){t=e.get("title")||e.get("name")||e.getLayer().name||""}}return t},beforeDestroy:function(){if(this.layerStore){this.layerStore.un("update",this.onStoreUpdate,this);this.layerStore.un("remove",this.onStoreRemove,this);this.layerStore.un("add",this.onStoreAdd,this)}GeoExt.LayerLegend.superclass.beforeDestroy.apply(this,arguments)},onDestroy:function(){this.layerRecord=null;this.layerStore=null;GeoExt.LayerLegend.superclass.onDestroy.apply(this,arguments)}});GeoExt.LayerLegend.getTypes=function(e,t){var i=(t||[]).concat(),r=[],a,s;for(s in GeoExt.LayerLegend.types){a=GeoExt.LayerLegend.types[s].supports(e);if(a>0){if(i.indexOf(s)==-1){r.push({type:s,score:a})}}else{i.remove(s)}}r.sort(function(e,t){return e.score<t.score?1:e.score==t.score?0:-1});var n=r.length,o=new Array(n);for(var l=0;l<n;++l){o[l]=r[l].type}return i.concat(o)};GeoExt.LayerLegend.supports=function(e){};GeoExt.LayerLegend.types={};Ext.namespace("GeoExt");GeoExt.LegendImage=Ext.extend(Ext.BoxComponent,{url:null,defaultImgSrc:null,imgCls:null,noImgCls:"gx-legend-noimage",initComponent:function(){GeoExt.LegendImage.superclass.initComponent.call(this);if(this.defaultImgSrc===null){this.defaultImgSrc=Ext.BLANK_IMAGE_URL}this.autoEl={tag:"img",class:this.imgCls?this.imgCls+" "+this.noImgCls:this.noImgCls,src:this.defaultImgSrc}},getImgEl:function(){return this.getEl()},setUrl:function(e){this.url=e;var t=this.getImgEl();if(t){t.un("load",this.onImageLoad,this);t.on("load",this.onImageLoad,this,{single:true});t.un("error",this.onImageLoadError,this);t.on("error",this.onImageLoadError,this,{single:true});t.dom.src=e}},onRender:function(e,t){GeoExt.LegendImage.superclass.onRender.call(this,e,t);if(this.url){this.setUrl(this.url)}},onDestroy:function(){var e=this.getImgEl();if(e){e.un("load",this.onImageLoad,this);e.un("error",this.onImageLoadError,this)}GeoExt.LegendImage.superclass.onDestroy.apply(this,arguments)},onImageLoadError:function(){var e=this.getImgEl();e.addClass(this.noImgCls);e.dom.src=this.defaultImgSrc},onImageLoad:function(){var e=this.getImgEl();if(!OpenLayers.Util.isEquivalentUrl(e.dom.src,this.defaultImgSrc)){e.removeClass(this.noImgCls)}}});Ext.reg("gx_legendimage",GeoExt.LegendImage);Ext.namespace("GeoExt");GeoExt.PrintMapPanel=Ext.extend(GeoExt.MapPanel,{sourceMap:null,printProvider:null,printPage:null,previewScales:null,center:null,zoom:null,extent:null,currentZoom:null,initComponent:function(){if(this.sourceMap instanceof GeoExt.MapPanel){this.sourceMap=this.sourceMap.map}if(!this.map){this.map={}}Ext.applyIf(this.map,{projection:this.sourceMap.getProjection(),maxExtent:this.sourceMap.getMaxExtent(),maxResolution:this.sourceMap.getMaxResolution(),units:this.sourceMap.getUnits()});if(!(this.printProvider instanceof GeoExt.data.PrintProvider)){this.printProvider=new GeoExt.data.PrintProvider(this.printProvider)}this.printPage=new GeoExt.data.PrintPage({printProvider:this.printProvider});this.previewScales=new Ext.data.Store;this.previewScales.add(this.printProvider.scales.getRange());this.layers=[];var e;Ext.each(this.sourceMap.layers,function(e){if(e.getVisibility()===true){if(e instanceof OpenLayers.Layer.Vector){var t=e.features,i=new Array(t.length),r=new OpenLayers.Layer.Vector(e.name,{renderers:["Canvas","VML"],styleMap:new OpenLayers.StyleMap({default:e.styleMap.styles.default})});for(var a=0,s=t.length;a<s;++a){i[a]=t[a].clone()}r.addFeatures(i,{silent:true});this.layers.push(r)}else{this.layers.push(e.clone())}}},this);this.sourceMap.raiseLayer(this.sourceMap.getLayersByName("Filter Layer")[0],1e4);this.sourceMap.raiseLayer(this.sourceMap.getLayersByName("Mask Layer")[0],9e4);this.sourceMap.raiseLayer(this.sourceMap.getLayersByName("Finder Layer")[0],1e4);this.extent=this.sourceMap.getExtent();GeoExt.PrintMapPanel.superclass.initComponent.call(this)},bind:function(){this.printPage.on("change",this.fitZoom,this);this.printProvider.on("layoutchange",this.syncSize,this);this.map.events.register("moveend",this,this.updatePage);this.printPage.fit(this.sourceMap);if(this.initialConfig.limitScales===true){this.on("resize",this.calculatePreviewScales,this);this.calculatePreviewScales()}},afterRender:function(){GeoExt.PrintMapPanel.superclass.afterRender.apply(this,arguments);this.syncSize();if(!this.ownerCt){this.bind()}else{this.ownerCt.on({afterlayout:{fn:this.bind,scope:this,single:true}})}},adjustSize:function(e,t){var i=this.printProvider.layout.get("size");var r=i.width/i.height;var a=this.ownerCt;var s=a&&a.autoWidth?0:e||this.initialConfig.width;var n=a&&a.autoHeight?0:t||this.initialConfig.height;if(s){t=s/r;if(n&&t>n){t=n;e=t*r}else{e=s}}else if(n){e=n*r;t=n}return{width:e,height:t}},fitZoom:function(){if(!this._updating&&this.printPage.scale){this._updating=true;var e=this.printPage.getPrintExtent(this.map);this.currentZoom=this.map.getZoomForExtent(e);this.map.zoomToExtent(e);delete this._updating}},updatePage:function(){if(!this._updating){var e=this.map.getZoom();this._updating=true;if(e===this.currentZoom){this.printPage.setCenter(this.map.getCenter())}else{this.printPage.fit(this.map)}delete this._updating;this.currentZoom=e}},calculatePreviewScales:function(){this.previewScales.removeAll();this.printPage.suspendEvents();var e=this.printPage.scale;var n=this.map.getSize();var o={};var l=[];this.printProvider.scales.each(function(e){this.printPage.setScale(e);var t=this.printPage.getPrintExtent(this.map);var i=this.map.getZoomForExtent(t);var r=Math.max(t.getWidth()/n.w,t.getHeight()/n.h);var a=this.map.getResolutionForZoom(i);var s=Math.abs(r-a);if(!(i in o)||o[i].diff>s){o[i]={rec:e,diff:s};l.indexOf(i)==-1&&l.push(i)}},this);for(var t=0,i=l.length;t<i;++t){this.previewScales.add(o[l[t]].rec)}e&&this.printPage.setScale(e);this.printPage.resumeEvents();if(e&&this.previewScales.getCount()>0){var r=this.previewScales.getAt(0);var a=this.previewScales.getAt(this.previewScales.getCount()-1);if(e.get("value")<a.get("value")){this.printPage.setScale(a)}else if(e.get("value")>r.get("value")){this.printPage.setScale(r)}}this.fitZoom()},print:function(e){this.printProvider.print(this.map,[this.printPage],e)},beforeDestroy:function(){this.map.events.unregister("moveend",this,this.updatePage);this.printPage.un("change",this.fitZoom,this);this.printProvider.un("layoutchange",this.syncSize,this);GeoExt.PrintMapPanel.superclass.beforeDestroy.apply(this,arguments)}});Ext.reg("gx_printmappanel",GeoExt.PrintMapPanel);OpenLayers.Format.JSON=OpenLayers.Class(OpenLayers.Format,{indent:"    ",space:" ",newline:"\n",level:0,pretty:false,nativeJSON:function(){return!!(window.JSON&&typeof JSON.parse=="function"&&typeof JSON.stringify=="function")}(),read:function(json,filter){var object;if(this.nativeJSON){object=JSON.parse(json,filter)}else try{if(/^[\],:{}\s]*$/.test(json.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){object=eval("("+json+")");if(typeof filter==="function"){function walk(e,t){if(t&&typeof t==="object"){for(var i in t){if(t.hasOwnProperty(i)){t[i]=walk(i,t[i])}}}return filter(e,t)}object=walk("",object)}}}catch(e){}if(this.keepData){this.data=object}return object},write:function(e,t){this.pretty=!!t;var i=null;var r=typeof e;if(this.serialize[r]){try{i=!this.pretty&&this.nativeJSON?JSON.stringify(e):this.serialize[r].apply(this,[e])}catch(e){OpenLayers.Console.error("Trouble serializing: "+e)}}return i},writeIndent:function(){var e=[];if(this.pretty){for(var t=0;t<this.level;++t){e.push(this.indent)}}return e.join("")},writeNewline:function(){return this.pretty?this.newline:""},writeSpace:function(){return this.pretty?this.space:""},serialize:{object:function(e){if(e==null){return"null"}if(e.constructor==Date){return this.serialize.date.apply(this,[e])}if(e.constructor==Array){return this.serialize.array.apply(this,[e])}var t=["{"];this.level+=1;var i,r,a;var s=false;for(i in e){if(e.hasOwnProperty(i)){r=OpenLayers.Format.JSON.prototype.write.apply(this,[i,this.pretty]);a=OpenLayers.Format.JSON.prototype.write.apply(this,[e[i],this.pretty]);if(r!=null&&a!=null){if(s){t.push(",")}t.push(this.writeNewline(),this.writeIndent(),r,":",this.writeSpace(),a);s=true}}}this.level-=1;t.push(this.writeNewline(),this.writeIndent(),"}");return t.join("")},array:function(e){var t;var i=["["];this.level+=1;for(var r=0,a=e.length;r<a;++r){t=OpenLayers.Format.JSON.prototype.write.apply(this,[e[r],this.pretty]);if(t!=null){if(r>0){i.push(",")}i.push(this.writeNewline(),this.writeIndent(),t)}}this.level-=1;i.push(this.writeNewline(),this.writeIndent(),"]");return i.join("")},string:function(e){var r={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};if(/["\\\x00-\x1f]/.test(e)){return'"'+e.replace(/([\x00-\x1f\\"])/g,function(e,t){var i=r[t];if(i){return i}i=t.charCodeAt();return"\\u00"+Math.floor(i/16).toString(16)+(i%16).toString(16)})+'"'}return'"'+e+'"'},number:function(e){return isFinite(e)?String(e):"null"},boolean:function(e){return String(e)},date:function(e){function t(e){return e<10?"0"+e:e}return'"'+e.getFullYear()+"-"+t(e.getMonth()+1)+"-"+t(e.getDate())+"T"+t(e.getHours())+":"+t(e.getMinutes())+":"+t(e.getSeconds())+'"'}},CLASS_NAME:"OpenLayers.Format.JSON"});OpenLayers.Format.GeoJSON=OpenLayers.Class(OpenLayers.Format.JSON,{ignoreExtraDims:false,read:function(e,t,i){t=t?t:"FeatureCollection";var r=null;var a=null;if(typeof e=="string"){a=OpenLayers.Format.JSON.prototype.read.apply(this,[e,i])}else{a=e}if(!a){OpenLayers.Console.error("Bad JSON: "+e)}else if(typeof a.type!="string"){OpenLayers.Console.error("Bad GeoJSON - no type: "+e)}else if(this.isValidType(a,t)){switch(t){case"Geometry":try{r=this.parseGeometry(a)}catch(e){OpenLayers.Console.error(e)}break;case"Feature":try{r=this.parseFeature(a);r.type="Feature"}catch(e){OpenLayers.Console.error(e)}break;case"FeatureCollection":r=[];switch(a.type){case"Feature":try{r.push(this.parseFeature(a))}catch(e){r=null;OpenLayers.Console.error(e)}break;case"FeatureCollection":for(var s=0,n=a.features.length;s<n;++s){try{r.push(this.parseFeature(a.features[s]))}catch(e){r=null;OpenLayers.Console.error(e)}}break;default:try{var o=this.parseGeometry(a);r.push(new OpenLayers.Feature.Vector(o))}catch(e){r=null;OpenLayers.Console.error(e)}}break}}return r},isValidType:function(e,t){var i=false;switch(t){case"Geometry":if(OpenLayers.Util.indexOf(["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon","Box","GeometryCollection"],e.type)==-1){OpenLayers.Console.error("Unsupported geometry type: "+e.type)}else{i=true}break;case"FeatureCollection":i=true;break;default:if(e.type==t){i=true}else{OpenLayers.Console.error("Cannot convert types from "+e.type+" to "+t)}}return i},parseFeature:function(e){var t,i,r,a;r=e.properties?e.properties:{};a=e.geometry&&e.geometry.bbox||e.bbox;try{i=this.parseGeometry(e.geometry)}catch(e){throw e}t=new OpenLayers.Feature.Vector(i,r);if(a){t.bounds=OpenLayers.Bounds.fromArray(a)}if(e.id){t.fid=e.id}return t},parseGeometry:function(e){if(e==null){return null}var t,i=false;if(e.type=="GeometryCollection"){if(!OpenLayers.Util.isArray(e.geometries)){throw"GeometryCollection must have geometries array: "+e}var r=e.geometries.length;var a=new Array(r);for(var s=0;s<r;++s){a[s]=this.parseGeometry.apply(this,[e.geometries[s]])}t=new OpenLayers.Geometry.Collection(a);i=true}else{if(!OpenLayers.Util.isArray(e.coordinates)){throw"Geometry must have coordinates array: "+e}if(!this.parseCoords[e.type.toLowerCase()]){throw"Unsupported geometry type: "+e.type}try{t=this.parseCoords[e.type.toLowerCase()].apply(this,[e.coordinates])}catch(e){throw e}}if(this.internalProjection&&this.externalProjection&&!i){t.transform(this.externalProjection,this.internalProjection)}return t},parseCoords:{point:function(e){if(this.ignoreExtraDims==false&&e.length!=2){throw"Only 2D points are supported: "+e}return new OpenLayers.Geometry.Point(e[0],e[1])},multipoint:function(e){var t=[];var i=null;for(var r=0,a=e.length;r<a;++r){try{i=this.parseCoords["point"].apply(this,[e[r]])}catch(e){throw e}t.push(i)}return new OpenLayers.Geometry.MultiPoint(t)},linestring:function(e){var t=[];var i=null;for(var r=0,a=e.length;r<a;++r){try{i=this.parseCoords["point"].apply(this,[e[r]])}catch(e){throw e}t.push(i)}return new OpenLayers.Geometry.LineString(t)},multilinestring:function(e){var t=[];var i=null;for(var r=0,a=e.length;r<a;++r){try{i=this.parseCoords["linestring"].apply(this,[e[r]])}catch(e){throw e}t.push(i)}return new OpenLayers.Geometry.MultiLineString(t)},polygon:function(e){var t=[];var i,r;for(var a=0,s=e.length;a<s;++a){try{r=this.parseCoords["linestring"].apply(this,[e[a]])}catch(e){throw e}i=new OpenLayers.Geometry.LinearRing(r.components);t.push(i)}return new OpenLayers.Geometry.Polygon(t)},multipolygon:function(e){var t=[];var i=null;for(var r=0,a=e.length;r<a;++r){try{i=this.parseCoords["polygon"].apply(this,[e[r]])}catch(e){throw e}t.push(i)}return new OpenLayers.Geometry.MultiPolygon(t)},box:function(e){if(e.length!=2){throw"GeoJSON box coordinates must have 2 elements"}return new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing([new OpenLayers.Geometry.Point(e[0][0],e[0][1]),new OpenLayers.Geometry.Point(e[1][0],e[0][1]),new OpenLayers.Geometry.Point(e[1][0],e[1][1]),new OpenLayers.Geometry.Point(e[0][0],e[1][1]),new OpenLayers.Geometry.Point(e[0][0],e[0][1])])])}},write:function(e,t){var i={type:null};if(OpenLayers.Util.isArray(e)){i.type="FeatureCollection";var r=e.length;i.features=new Array(r);for(var a=0;a<r;++a){var s=e[a];if(!s instanceof OpenLayers.Feature.Vector){var n="FeatureCollection only supports collections "+"of features: "+s;throw n}i.features[a]=this.extract.feature.apply(this,[s])}}else if(e.CLASS_NAME.indexOf("OpenLayers.Geometry")==0){i=this.extract.geometry.apply(this,[e])}else if(e instanceof OpenLayers.Feature.Vector){i=this.extract.feature.apply(this,[e]);if(e.layer&&e.layer.projection){i.crs=this.createCRSObject(e)}}return OpenLayers.Format.JSON.prototype.write.apply(this,[i,t])},createCRSObject:function(e){var t=e.layer.projection.toString();var i={};if(t.match(/epsg:/i)){var r=parseInt(t.substring(t.indexOf(":")+1));if(r==4326){i={type:"name",properties:{name:"urn:ogc:def:crs:OGC:1.3:CRS84"}}}else{i={type:"name",properties:{name:"EPSG:"+r}}}}return i},extract:{feature:function(e){var t=this.extract.geometry.apply(this,[e.geometry]);var i={type:"Feature",properties:e.attributes,geometry:t};if(e.fid!=null){i.id=e.fid}return i},geometry:function(e){if(e==null){return null}if(this.internalProjection&&this.externalProjection){e=e.clone();e.transform(this.internalProjection,this.externalProjection)}var t=e.CLASS_NAME.split(".")[2];var i=this.extract[t.toLowerCase()].apply(this,[e]);var r;if(t=="Collection"){r={type:"GeometryCollection",geometries:i}}else{r={type:t,coordinates:i}}return r},point:function(e){return[e.x,e.y]},multipoint:function(e){var t=[];for(var i=0,r=e.components.length;i<r;++i){t.push(this.extract.point.apply(this,[e.components[i]]))}return t},linestring:function(e){var t=[];for(var i=0,r=e.components.length;i<r;++i){t.push(this.extract.point.apply(this,[e.components[i]]))}return t},multilinestring:function(e){var t=[];for(var i=0,r=e.components.length;i<r;++i){t.push(this.extract.linestring.apply(this,[e.components[i]]))}return t},polygon:function(e){var t=[];for(var i=0,r=e.components.length;i<r;++i){t.push(this.extract.linestring.apply(this,[e.components[i]]))}return t},multipolygon:function(e){var t=[];for(var i=0,r=e.components.length;i<r;++i){t.push(this.extract.polygon.apply(this,[e.components[i]]))}return t},collection:function(e){var t=e.components.length;var i=new Array(t);for(var r=0;r<t;++r){i[r]=this.extract.geometry.apply(this,[e.components[r]])}return i}},CLASS_NAME:"OpenLayers.Format.GeoJSON"});Ext.namespace("GeoExt.data");GeoExt.data.PrintProvider=Ext.extend(Ext.util.Observable,{url:null,capabilities:null,method:"POST",encoding:document.charset||document.characterSet||"UTF-8",timeout:12e4,customParams:null,scales:null,dpis:null,layouts:null,dpi:null,layout:null,showRiskTable:false,constructor:function(e){this.initialConfig=e;Ext.apply(this,e);if(!this.customParams){this.customParams={}}this.addEvents("loadcapabilities","layoutchange","dpichange","beforeprint","print","printexception","beforeencodelayer","encodelayer","beforedownload","beforeencodelegend");GeoExt.data.PrintProvider.superclass.constructor.apply(this,arguments);this.scales=new Ext.data.JsonStore({root:"scales",sortInfo:{field:"value",direction:"DESC"},fields:["name",{name:"value",type:"float"}]});this.dpis=new Ext.data.JsonStore({root:"dpis",fields:["name",{name:"value",type:"float"}]});this.layouts=new Ext.data.JsonStore({root:"layouts",fields:["name",{name:"size",mapping:"map"},{name:"rotation",type:"boolean"}]});if(e.capabilities){this.loadStores()}else{if(this.url.split("/").pop()){this.url+="/"}this.initialConfig.autoLoad&&this.loadCapabilities()}},isStoreEmpty:function(){var e=_storeCalc.getStore();if(e==null){return true}else{return false}},setLayout:function(e){this.layout=e;this.fireEvent("layoutchange",this,e)},setDpi:function(e){this.dpi=e;this.fireEvent("dpichange",this,e)},statConfig:[{id:"1",nodeID:"1",pnodeID:"0",text:"Baseline",leaf:false,expanded:false,url:"?page=baseline&pdf=true",children:[{id:"11",nodeID:"11",pnodeID:"1",text:"Expand Population and area overview",leaf:true,_checked:"detail_base"},{id:"12",nodeID:"12",pnodeID:"1",text:"Expand Number of Health facilities",leaf:true,_checked:"detail_health"},{id:"13",nodeID:"13",pnodeID:"1",text:"Expand Road network overview and length",leaf:true,_checked:"detail_road"}]},{id:"2",nodeID:"2",pnodeID:"0",text:"Accessibility",leaf:false,expanded:false,url:"?page=accessibility&pdf=true",children:[{id:"21",nodeID:"21",pnodeID:"2",text:"Expand Travel Time to Nearest Airport",leaf:true,_checked:"detail_airport"},{id:"22",nodeID:"22",pnodeID:"2",text:"Expand Travel Time to Nearest Health Facilities Tier 1",leaf:true,_checked:"detail_tier1"},{id:"23",nodeID:"23",pnodeID:"2",text:"Expand Travel Time to Nearest Health Facilities Tier 2",leaf:true,_checked:"detail_tier2"},{id:"24",nodeID:"24",pnodeID:"2",text:"Expand Travel Time to Nearest Health Facilities Tier 3",leaf:true,_checked:"detail_tier3"},{id:"25",nodeID:"25",pnodeID:"2",text:"Expand Travel Time to Nearest Health Facilities Tier all",leaf:true,_checked:"detail_tierall"},{id:"26",nodeID:"26",pnodeID:"2",text:"Expand Travel Time to Its Province Capital",leaf:true,_checked:"detail_itsprov"},{id:"27",nodeID:"27",pnodeID:"2",text:"Expand Travel Time to Nearest Province Capital",leaf:true,_checked:"detail_nearprov"},{id:"28",nodeID:"28",pnodeID:"2",text:"Expand Travel Time to Nearest District Capital",leaf:true,_checked:"detail_neardist"}]},{id:"3",nodeID:"3",pnodeID:"0",text:"Flood forecast",leaf:false,expanded:false,url:"?page=floodforecast&pdf=true",children:[{id:"31",nodeID:"31",pnodeID:"3",text:"Expand Population living in flood prediction areas",leaf:true,_checked:"detail_base"}]},{id:"4",nodeID:"4",pnodeID:"0",text:"Flood risk",leaf:false,expanded:false,url:"?page=floodrisk&pdf=true",children:[{id:"41",nodeID:"41",pnodeID:"4",text:"Expand Population living in flood risk areas",leaf:true,_checked:"detail_base"}]},{id:"5",nodeID:"5",pnodeID:"0",text:"Avalanche Prediction",leaf:false,expanded:false,url:"?page=avalcheforecast&pdf=true",children:[{id:"51",nodeID:"51",pnodeID:"5",text:"Expand Population in predicted avalanche risk areas",leaf:true,_checked:"detail_base"}]},{id:"6",nodeID:"6",pnodeID:"0",text:"Avalanche risk",leaf:false,expanded:false,url:"?page=avalancherisk&pdf=true",children:[{id:"61",nodeID:"61",pnodeID:"6",text:"Expand Population in avalanche risk areas",leaf:true,_checked:"detail_base"}]},{id:"7",nodeID:"7",pnodeID:"0",text:"Earthquake",leaf:false,expanded:false,url:"?page=earthquake&pdf=true",children:[{id:"71",nodeID:"71",pnodeID:"7",text:"Expand Earthquake affected Population and settlement overview",leaf:true,_checked:"detail_base"}]},{id:"8",nodeID:"8",pnodeID:"0",text:"Humanitarian access",leaf:false,expanded:false,url:"?page=security&pdf=true",children:[{id:"81",nodeID:"81",pnodeID:"8",text:"Expand Number of incidents and casualties",leaf:true,_checked:"detail_base"}]},{id:"9",nodeID:"9",pnodeID:"0",text:"Landslide",leaf:false,expanded:false,url:"?page=landslide&pdf=true",children:[]},{id:"10",nodeID:"10",pnodeID:"0",text:"Drought",leaf:false,expanded:false,url:"?page=drought&pdf=true",children:[]}],print:function(t,e,a){if(t instanceof GeoExt.MapPanel){t=t.map}e=e instanceof Array?e:[e];a=a||{};var i=new Date;var p="iMMAP_AFG_"+this.customParams.mapTitle+"_"+this.layout.get("name")+"_map_"+i.getFullYear()+"-"+(i.getMonth()+1)+"-"+i.getDate();var u="iMMAP_AFG_"+this.customParams.mapTitle+"_"+this.layout.get("name")+"_map_and_statistics_"+i.getFullYear()+"-"+(i.getMonth()+1)+"-"+i.getDate();this.customParams.outputFilename='"'+p+'"';var s=Ext.apply({units:t.getUnits(),srs:t.baseLayer.projection.getCode(),layout:this.layout.get("name"),dpi:this.dpi.get("value")},this.customParams);var c=e[0].feature.layer;var r=[];var n=t.layers.concat();n.remove(t.baseLayer);n.unshift(t.baseLayer);Ext.each(n,function(e){if(e!==c&&e.getVisibility()===true){var t=this.encodeLayer(e);t&&r.push(t)}},this);Ext.each(r,function(e){if(e.baseURL=="http://asdc.immap.org/geoserver/gwc/service/wms")e.baseURL="http://asdc.immap.org/geoserver/wms"});s.layers=r;var d=_storeCalc;calcData=d.getStore();calcData={};if(calcData===null){calcData={}}var f=[];Ext.each(e,function(e){calcData.center=[e.center.lon,e.center.lat];calcData.scale=e.scale.get("value");calcData.bbox=e.getPrintExtent(t).toArray();calcData.rotation=e.rotation;f.push(Ext.apply(calcData,e.customParams))},this);s.pages=f;if(a.overview){var y=[];Ext.each(a.overview.layers,function(e){var t=this.encodeLayer(e);t&&y.push(t)},this);s.overviewLayers=y}if(a.legend&&!(this.fireEvent("beforeencodelegend",this,s,a.legend)===false)){var o=a.legend;var g=o.rendered;if(!g){o=o.cloneConfig({renderTo:document.body,hidden:true})}var m=[];o.items&&o.items.each(function(e){if(!e.hidden){var t=this.encoders.legends[e.getXType()];m=m.concat(t.call(this,e,s.pages[0].scale))}},this);if(!g){o.destroy()}s.legends=m}var v=e[0].getPrintExtent(t);v=v.transform(new OpenLayers.Projection("EPSG:900913"),new OpenLayers.Projection("EPSG:4326")).toGeometry();var x=v.toString();var l=x.substring(9,x.length-2);l=l.replace(new RegExp(" ","g"),"#");l=l.replace(new RegExp(",","g"),"&");l=l.replace(new RegExp("#","g"),",");l=l.replace(new RegExp("&","g")," ");l=encodeURI(l);s.selectedBox=l;s.showRiskTable=this.showRiskTable;var h=window.location.pathname;h=h.split("/");if(h.indexOf("v2")>-1){h=h[3]}else{h=h[2]}s.mapID=h;s.logo={data:[],columns:["logourl"]};var L=[];Ext.each(t.getControlsBy("displayClass","olControlAttribution")[0].div.children,function(e){if(e.src!=undefined){var t=e.src.split("/").slice(-1)[0];s.logo.data.push({logourl:t});L.push(e.alt)}});s.contributors=L.toString();var b=getUserLogo();s.userlogo_onpdf=b["onpdf"];s.userlogo_url=b["logo_url"];s.showMapComments=Ext.getCmp("map_comments").checked;if(this.method==="GET"){var E=Ext.urlAppend(this.capabilities.printURL,"spec="+encodeURIComponent(Ext.encode(s)));this.download(E)}else{var S=new Ext.ux.tree.CheckTreePanel({title:gettext("Export additional info"),id:"t3",autoWidth:true,height:250,autoScroll:true,rootVisible:false,deepestOnly:true,root:{nodeType:"async",id:"root",text:gettext("root"),children:this.statConfig,expanded:true,uiProvider:false},loader:new Ext.tree.TreeLoader,bbar:["->",{iconCls:"gxp-icon-stop",text:gettext("Abort"),handler:function(){O.close()}},{iconCls:"gxp-icon-play",text:gettext("Continue"),scope:this,handler:function(){selectedStatConfig=S.getChecked();var i=[];var r=[];selectedStatConfig.forEach(function(e){if(e.attributes.nodeID==3){r[e.attributes.nodeID]=Ext.getCmp("cb_rf_type").getValue()}if(e.attributes.url){i[e.id]=e.attributes.url}else{if(r[e.attributes.pnodeID])r[e.attributes.pnodeID]+=","+e.attributes._checked;else r[e.attributes.pnodeID]=e.attributes._checked}});i.forEach(function(e,t){i[t]+="&date="+Ext.getCmp("dateOccurs").getValue().format("Y-m-d");if(r[t]){i[t]+="&_checked="+encodeURIComponent(r[t])}if(_storeCalc.selectedFlag()=="entireAfg"){}else if(_storeCalc.selectedFlag()=="currentProvince"){if(_storeCalc.selectedAdminCode()||_storeCalc.selectedAdminCode()!=null)i[t]+="&code="+_storeCalc.selectedAdminCode()}else if(_storeCalc.selectedFlag()=="drawArea"){i[t]+="&flag=drawArea&filter="+encodeURIComponent(_storeCalc.selectedGeomFilter()[0])}else if(_storeCalc.selectedFlag()=="currentExtent"){i[t]+="&flag=currentExtent&filter="+encodeURIComponent(_storeCalc.selectedGeomFilter()[0])}});if(this.fireEvent("beforeprint",this,t,e,a)===false){return}Ext.Ajax.request({method:"POST",url:this.capabilities.createURL,timeout:this.timeout,jsonData:s,headers:{"Content-Type":"application/json; charset="+this.encoding},success:function(e){var t=Ext.decode(e.responseText).getURL;if(i.length>0){Ext.Ajax.request({method:"POST",url:"../../dashboard/multiple",timeout:this.timeout,headers:{"Content-Type":"application/json; charset="+this.encoding},jsonData:{urls:i,fileName:u,mapTitle:this.customParams.mapTitle,mapUrl:t},success:function(e){var t="../../dashboard/downloadPDFFile?filename="+Ext.decode(e.responseText).filename+"&filenameoutput="+u;console.log(e,t);this.download(t)},failure:function(e){console.log("failure response razinal");console.log(e);this.fireEvent("printexception",this,e)},scope:this})}else{this.download(t)}},failure:function(e){this.fireEvent("printexception",this,e)},params:this.initialConfig.baseParams,scope:this});O.close()}}]});var O=new Ext.Window({modal:true,border:false,closable:false,autoHeight:true,resizable:false,width:360,items:[S]}).show()}},downloadFile:function(e,t,i,r){var a=Ext.getBody();var h=a.createChild({tag:"iframe",cls:"x-hidden",id:"hiddenform-iframe",name:"iframe"});var s=a.createChild({tag:"form",cls:"x-hidden",id:"hiddenform-form",action:e,target:"iframe",method:"POST"});var n=document.createElement("input");Ext.fly(n).set({type:"hidden",value:t,name:"urls"});s.appendChild(n);var o=document.createElement("input");Ext.fly(o).set({type:"hidden",value:i,name:"fileName"});s.appendChild(o);var l=document.createElement("input");Ext.fly(l).set({type:"hidden",value:r,name:"mapTitle"});s.appendChild(l);s.dom.submit({timeout:this.timeout});this.fireEvent("print",this,e)},download:function(e){if(this.fireEvent("beforedownload",this,e)!==false){if(Ext.isOpera){window.open(e)}else{window.location.href=e}}this.fireEvent("print",this,e)},loadCapabilities:function(){if(!this.url){return}var e="http://asdc.immap.org/static/info.json";Ext.Ajax.request({url:e,method:"GET",disableCaching:false,success:function(e){this.capabilities=Ext.decode(e.responseText);this.loadStores()},params:this.initialConfig.baseParams,scope:this})},loadStores:function(){this.scales.loadData(this.capabilities);this.dpis.loadData(this.capabilities);this.layouts.loadData(this.capabilities);this.setLayout(this.layouts.getAt(0));this.setDpi(this.dpis.getAt(0));this.fireEvent("loadcapabilities",this,this.capabilities)},encodeLayer:function(e){var t;for(var i in this.encoders.layers){if(OpenLayers.Layer[i]&&e instanceof OpenLayers.Layer[i]){if(this.fireEvent("beforeencodelayer",this,e)===false){return}t=this.encoders.layers[i].call(this,e);this.fireEvent("encodelayer",this,e,t);break}}return t&&t.type?t:null},getAbsoluteUrl:function(e){if(Ext.isSafari){e=e.replace(/{/g,"%7B");e=e.replace(/}/g,"%7D")}var t;if(Ext.isIE6||Ext.isIE7||Ext.isIE8){t=document.createElement("<a href='"+e+"'/>");t.style.display="none";document.body.appendChild(t);t.href=t.href;document.body.removeChild(t)}else{t=document.createElement("a");t.href=e}return t.href},encoders:{layers:{Layer:function(e){var t={};if(e.options&&e.options.maxScale){t.minScaleDenominator=e.options.maxScale}if(e.options&&e.options.minScale){t.maxScaleDenominator=e.options.minScale}return t},WMS:function(e){var t=this.encoders.layers.HTTPRequest.call(this,e);t.singleTile=e.singleTile;Ext.apply(t,{type:"WMS",layers:[e.params.LAYERS].join(",").split(","),format:e.params.FORMAT,styles:[e.params.STYLES].join(",").split(","),singleTile:e.singleTile});var i;for(var r in e.params){i=r.toLowerCase();if(e.params[r]!=null&&!e.DEFAULT_PARAMS[i]&&"layers,styles,width,height,srs".indexOf(i)==-1){if(!t.customParams){t.customParams={}}t.customParams[r]=e.params[r]}}return t},Google:function(e){return{type:"tiledGoogle",baseURL:"http://maps.googleapis.com/maps/api/staticmap",customParams:{},maxExtent:e.maxExtent.toArray(),opacity:e.opacity!=null?e.opacity:1,tileSize:[256,256],resolutions:e.resolutions,extension:"png",format:"png32",sensor:"false",maptype:e.type,key:"duNjTUSlJeF5O75pYN1s7vopjgs=",signature:"nSeI3eoZTPs2E2h1QgFtYLHhm3I="}},OSM:function(e){var t=this.encoders.layers.TileCache.call(this,e);return Ext.apply(t,{type:"OSM",baseURL:t.baseURL.substr(0,t.baseURL.indexOf("$")),extension:"png"})},TMS:function(e){var t=this.encoders.layers.TileCache.call(this,e);return Ext.apply(t,{type:"TMS",format:e.type})},XYZ:function(e){var t=this.encoders.layers.TileCache.call(this,e);return Ext.apply(t,{type:"XYZ",baseURL:t.baseURL.substr(0,t.baseURL.indexOf("$")),extension:"png",tileOriginCorner:e.tileOriginCorner,path_format:"${z}/${y}/${x}"})},TileCache:function(e){var t=this.encoders.layers.HTTPRequest.call(this,e);return Ext.apply(t,{type:"TileCache",layer:e.layername,maxExtent:e.maxExtent.toArray(),tileSize:[e.tileSize.w,e.tileSize.h],extension:e.extension,resolutions:e.serverResolutions||e.resolutions})},WMTS:function(t){var i=this.encoders.layers.HTTPRequest.call(this,t);i=Ext.apply(i,{type:"WMTS",layer:t.layer,version:t.version,requestEncoding:t.requestEncoding,style:t.style,dimensions:t.dimensions,params:t.params,matrixSet:t.matrixSet});if(t.matrixIds){if(t.requestEncoding=="KVP"){i.format=t.format}i.matrixIds=[];Ext.each(t.matrixIds,function(e){i.matrixIds.push({identifier:e.identifier,matrixSize:[e.matrixWidth,e.matrixHeight],resolution:e.scaleDenominator*28e-5/OpenLayers.METERS_PER_INCH/OpenLayers.INCHES_PER_UNIT[t.units],tileSize:[e.tileWidth,e.tileHeight],topLeftCorner:[e.topLeftCorner.lon,e.topLeftCorner.lat]})});return i}else{return Ext.apply(i,{formatSuffix:t.formatSuffix,tileOrigin:[t.tileOrigin.lon,t.tileOrigin.lat],tileSize:[t.tileSize.w,t.tileSize.h],maxExtent:t.tileFullExtent!=null?t.tileFullExtent.toArray():t.maxExtent.toArray(),zoomOffset:t.zoomOffset,resolutions:t.serverResolutions||t.resolutions})}},KaMapCache:function(e){var t=this.encoders.layers.KaMap.call(this,e);return Ext.apply(t,{type:"KaMapCache",group:e.params["g"],metaTileWidth:e.params["metaTileSize"]["w"],metaTileHeight:e.params["metaTileSize"]["h"]})},KaMap:function(e){var t=this.encoders.layers.HTTPRequest.call(this,e);return Ext.apply(t,{type:"KaMap",map:e.params["map"],extension:e.params["i"],group:e.params["g"]||"",maxExtent:e.maxExtent.toArray(),tileSize:[e.tileSize.w,e.tileSize.h],resolutions:e.serverResolutions||e.resolutions})},HTTPRequest:function(e){var t=this.encoders.layers.Layer.call(this,e);return Ext.apply(t,{baseURL:this.getAbsoluteUrl(e.url instanceof Array?e.url[0]:e.url),opacity:e.opacity!=null?e.opacity:1})},Image:function(e){var t=this.encoders.layers.Layer.call(this,e);return Ext.apply(t,{type:"Image",baseURL:this.getAbsoluteUrl(e.getURL(e.extent)),opacity:e.opacity!=null?e.opacity:1,extent:e.extent.toArray(),pixelSize:[e.size.w,e.size.h],name:e.name})},Vector:function(e){if(!e.features.length){return}var t=[];var i={};var p=e.features;var u=new OpenLayers.Format.GeoJSON;var c=new OpenLayers.Format.JSON;var d=1;var f={};var r,a,s,n,o;for(var l=0,y=p.length;l<y;++l){r=p[l];a=r.style||e.style||e.styleMap.createSymbolizer(r,r.renderIntent);if(a.display=="none"){continue}s=c.write(a);n=f[s];if(n){o=n}else{f[s]=o=d++;if(a.externalGraphic){i[o]=Ext.applyIf({externalGraphic:this.getAbsoluteUrl(a.externalGraphic)},a)}else{i[o]=a}}var h=u.extract.feature.call(u,r);h.properties=OpenLayers.Util.extend({_gx_style:o},h.properties);t.push(h)}var g=this.encoders.layers.Layer.call(this,e);return Ext.apply(g,{type:"Vector",styles:i,styleProperty:"_gx_style",geoJson:{type:"FeatureCollection",features:t},name:e.name,opacity:e.opacity!=null?e.opacity:1})},Markers:function(e){var t=[];for(var i=0,r=e.markers.length;i<r;i++){var a=e.markers[i];var s=new OpenLayers.Geometry.Point(a.lonlat.lon,a.lonlat.lat);var n={externalGraphic:a.icon.url,graphicWidth:a.icon.size.w,graphicHeight:a.icon.size.h,graphicXOffset:a.icon.offset.x,graphicYOffset:a.icon.offset.y};var o=new OpenLayers.Feature.Vector(s,{},n);t.push(o)}var l=new OpenLayers.Layer.Vector(e.name);l.addFeatures(t);var h=this.encoders.layers.Vector.call(this,l);l.destroy();return h}},legends:{gx_wmslegend:function(e,t){var i=this.encoders.legends.base.call(this,e);var r=[];for(var a=1,s=e.items.getCount();a<s;++a){var n=e.items.get(a).url;var o=e.layerRecord.data.title;if(e.useScaleParameter===true&&n.toLowerCase().indexOf("request=getlegendgraphic")!=-1){var l=n.split("?");var h=Ext.urlDecode(l[1]);h["SCALE"]=t;h["legend_options"]="fontSize:5;dpi:300";h["width"]=12;h["height"]=12;n=l[0]+"?"+Ext.urlEncode(h)}r.push(this.getAbsoluteUrl(n))}i[0].classes[0]={name:"",icons:r};i[0].name=o;return i},gx_wmtslegend:function(e,t){return this.encoders.legends.gx_urllegend.call(this,e)},gx_urllegend:function(e){var t=this.encoders.legends.base.call(this,e);t[0].classes.push({name:"",icon:this.getAbsoluteUrl(e.items.get(1).url)});return t},base:function(e){return[{name:e.getLabel(),classes:[]}]}}}});Ext.namespace("GeoExt.data");GeoExt.data.PrintPage=Ext.extend(Ext.util.Observable,{printProvider:null,feature:null,center:null,scale:null,rotation:0,customParams:null,constructor:function(e){this.initialConfig=e;Ext.apply(this,e);if(!this.customParams){this.customParams={}}this.addEvents("change");GeoExt.data.PrintPage.superclass.constructor.apply(this,arguments);this.feature=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing([new OpenLayers.Geometry.Point(-1,-1),new OpenLayers.Geometry.Point(1,-1),new OpenLayers.Geometry.Point(1,1),new OpenLayers.Geometry.Point(-1,1)])]));if(this.printProvider.capabilities){this.setScale(this.printProvider.scales.getAt(0))}else{this.printProvider.on({loadcapabilities:function(){this.setScale(this.printProvider.scales.getAt(0))},scope:this,single:true})}this.printProvider.on({layoutchange:this.onLayoutChange,scope:this})},getPrintExtent:function(e){e=e instanceof GeoExt.MapPanel?e.map:e;return this.calculatePageBounds(this.scale,e.getUnits())},setScale:function(e,t){var i=this.calculatePageBounds(e,t);var r=i.toGeometry();var a=this.rotation;if(a!=0){r.rotate(-a,r.getCentroid())}this.updateFeature(r,{scale:e})},setCenter:function(e){var t=this.feature.geometry;var i=t.getBounds().getCenterLonLat();var r=e.lon-i.lon;var a=e.lat-i.lat;t.move(r,a);this.updateFeature(t,{center:e})},setRotation:function(e,t){if(t||this.printProvider.layout.get("rotation")===true){var i=this.feature.geometry;i.rotate(this.rotation-e,i.getCentroid());this.updateFeature(i,{rotation:e})}},fit:function(e,a){a=a||{};var t=e,s;if(e instanceof GeoExt.MapPanel){t=e.map}else if(e instanceof OpenLayers.Feature.Vector){t=e.layer.map;s=e.geometry.getBounds()}if(!s){s=t.getExtent();if(!s){return}}this._updating=true;var i=s.getCenterLonLat();this.setCenter(i);var n=t.getUnits();var o=this.printProvider.scales.getAt(0);var l=Number.POSITIVE_INFINITY;var h=s.getWidth();var p=s.getHeight();this.printProvider.scales.each(function(e){var t=this.calculatePageBounds(e,n);if(a.mode=="closest"){var i=Math.abs(t.getWidth()-h)+Math.abs(t.getHeight()-p);if(i<l){l=i;o=e}}else{var r=a.mode=="screen"?!s.containsBounds(t):t.containsBounds(s);if(r||a.mode=="screen"&&!r){o=e}return r}},this);this.setScale(o,n);delete this._updating;this.updateFeature(this.feature.geometry,{center:i,scale:o})},updateFeature:function(e,t){var i=this.feature;var r=i.geometry!==e;e.id=i.geometry.id;i.geometry=e;if(!this._updating){for(var a in t){if(t[a]===this[a]){delete t[a]}else{this[a]=t[a];r=true}}Ext.apply(this,t);i.layer&&i.layer.drawFeature(i);r&&this.fireEvent("change",this,t)}},calculatePageBounds:function(e,t){var i=e.get("value");var r=this.feature;var a=this.feature.geometry;var s=a.getBounds().getCenterLonLat();var n=this.printProvider.layout.get("size");var t=t||r.layer&&r.layer.map&&r.layer.map.getUnits()||"dd";var o=OpenLayers.INCHES_PER_UNIT[t];var l=n.width/72/o*i/2;var h=n.height/72/o*i/2;return new OpenLayers.Bounds(s.lon-l,s.lat-h,s.lon+l,s.lat+h)},onLayoutChange:function(){if(this.printProvider.layout.get("rotation")===false){this.setRotation(0,true)}this.scale&&this.setScale(this.scale)},destroy:function(){this.printProvider.un("layoutchange",this.onLayoutChange,this)}});OpenLayers.Layer.HTTPRequest=OpenLayers.Class(OpenLayers.Layer,{URL_HASH_FACTOR:(Math.sqrt(5)-1)/2,url:null,params:null,reproject:false,initialize:function(e,t,i,r){OpenLayers.Layer.prototype.initialize.apply(this,[e,r]);this.url=t;if(!this.params){this.params=OpenLayers.Util.extend({},i)}},destroy:function(){this.url=null;this.params=null;OpenLayers.Layer.prototype.destroy.apply(this,arguments)},clone:function(e){if(e==null){e=new OpenLayers.Layer.HTTPRequest(this.name,this.url,this.params,this.getOptions())}e=OpenLayers.Layer.prototype.clone.apply(this,[e]);return e},setUrl:function(e){this.url=e},mergeNewParams:function(e){this.params=OpenLayers.Util.extend(this.params,e);var t=this.redraw();if(this.map!=null){this.map.events.triggerEvent("changelayer",{layer:this,property:"params"})}return t},redraw:function(e){if(e){return this.mergeNewParams({_olSalt:Math.random()})}else{return OpenLayers.Layer.prototype.redraw.apply(this,[])}},selectUrl:function(e,t){var i=1;for(var r=0,a=e.length;r<a;r++){i*=e.charCodeAt(r)*this.URL_HASH_FACTOR;i-=Math.floor(i)}return t[Math.floor(i*t.length)]},getFullRequestString:function(e,t){var i=t||this.url;var r=OpenLayers.Util.extend({},this.params);r=OpenLayers.Util.extend(r,e);var a=OpenLayers.Util.getParameterString(r);if(OpenLayers.Util.isArray(i)){i=this.selectUrl(a,i)}var s=OpenLayers.Util.upperCaseObject(OpenLayers.Util.getParameters(i));for(var n in r){if(n.toUpperCase()in s){delete r[n]}}a=OpenLayers.Util.getParameterString(r);return OpenLayers.Util.urlAppend(i,a)},CLASS_NAME:"OpenLayers.Layer.HTTPRequest"});OpenLayers.Tile=OpenLayers.Class({events:null,eventListeners:null,id:null,layer:null,url:null,bounds:null,size:null,position:null,isLoading:false,initialize:function(e,t,i,r,a,s){this.layer=e;this.position=t.clone();this.setBounds(i);this.url=r;if(a){this.size=a.clone()}this.id=OpenLayers.Util.createUniqueID("Tile_");OpenLayers.Util.extend(this,s);this.events=new OpenLayers.Events(this);if(this.eventListeners instanceof Object){this.events.on(this.eventListeners)}},unload:function(){if(this.isLoading){this.isLoading=false;this.events.triggerEvent("unload")}},destroy:function(){this.layer=null;this.bounds=null;this.size=null;this.position=null;if(this.eventListeners){this.events.un(this.eventListeners)}this.events.destroy();this.eventListeners=null;this.events=null},draw:function(e){if(!e){this.clear()}var t=this.shouldDraw();if(t&&!e&&this.events.triggerEvent("beforedraw")===false){t=null}return t},shouldDraw:function(){var e=false,t=this.layer.maxExtent;if(t){var i=this.layer.map;var r=i.baseLayer.wrapDateLine&&i.getMaxExtent();if(this.bounds.intersectsBounds(t,{inclusive:false,worldBounds:r})){e=true}}return e||this.layer.displayOutsideMaxExtent},setBounds:function(e){e=e.clone();if(this.layer.map.baseLayer.wrapDateLine){var t=this.layer.map.getMaxExtent(),i=this.layer.map.getResolution();e=e.wrapDateLine(t,{leftTolerance:i,rightTolerance:i})}this.bounds=e},moveTo:function(e,t,i){if(i==null){i=true}this.setBounds(e);this.position=t.clone();if(i){this.draw()}},clear:function(e){},CLASS_NAME:"OpenLayers.Tile"});OpenLayers.Tile.Image=OpenLayers.Class(OpenLayers.Tile,{url:null,imgDiv:null,frame:null,imageReloadAttempts:null,layerAlphaHack:null,asyncRequestId:null,maxGetUrlLength:null,canvasContext:null,crossOriginKeyword:null,initialize:function(e,t,i,r,a,s){OpenLayers.Tile.prototype.initialize.apply(this,arguments);this.url=r;this.layerAlphaHack=this.layer.alpha&&OpenLayers.Util.alphaHack();if(this.maxGetUrlLength!=null||this.layer.gutter||this.layerAlphaHack){this.frame=document.createElement("div");this.frame.style.position="absolute";this.frame.style.overflow="hidden"}if(this.maxGetUrlLength!=null){OpenLayers.Util.extend(this,OpenLayers.Tile.Image.IFrame)}},destroy:function(){if(this.imgDiv){this.clear();this.imgDiv=null;this.frame=null}this.asyncRequestId=null;OpenLayers.Tile.prototype.destroy.apply(this,arguments)},draw:function(){var e=OpenLayers.Tile.prototype.draw.apply(this,arguments);if(e){if(this.layer!=this.layer.map.baseLayer&&this.layer.reproject){this.bounds=this.getBoundsFromBaseLayer(this.position)}if(this.isLoading){this._loadEvent="reload"}else{this.isLoading=true;this._loadEvent="loadstart"}this.renderTile();this.positionTile()}else if(e===false){this.unload()}return e},renderTile:function(){if(this.layer.async){var t=this.asyncRequestId=(this.asyncRequestId||0)+1;this.layer.getURLasync(this.bounds,function(e){if(t==this.asyncRequestId){this.url=e;this.initImage()}},this)}else{this.url=this.layer.getURL(this.bounds);this.initImage()}},positionTile:function(){var e=this.getTile().style,t=this.frame?this.size:this.layer.getImageSize(this.bounds),i=1;if(this.layer instanceof OpenLayers.Layer.Grid){i=this.layer.getServerResolution()/this.layer.map.getResolution()}e.left=this.position.x+"px";e.top=this.position.y+"px";e.width=Math.round(i*t.w)+"px";e.height=Math.round(i*t.h)+"px"},clear:function(){OpenLayers.Tile.prototype.clear.apply(this,arguments);var e=this.imgDiv;if(e){var t=this.getTile();if(t.parentNode===this.layer.div){this.layer.div.removeChild(t)}this.setImgSrc();if(this.layerAlphaHack===true){e.style.filter=""}OpenLayers.Element.removeClass(e,"olImageLoadError")}this.canvasContext=null},getImage:function(){if(!this.imgDiv){this.imgDiv=OpenLayers.Tile.Image.IMAGE.cloneNode(false);var e=this.imgDiv.style;if(this.frame){var t=0,i=0;if(this.layer.gutter){t=this.layer.gutter/this.layer.tileSize.w*100;i=this.layer.gutter/this.layer.tileSize.h*100}e.left=-t+"%";e.top=-i+"%";e.width=2*t+100+"%";e.height=2*i+100+"%"}e.visibility="hidden";e.opacity=0;if(this.layer.opacity<1){e.filter="alpha(opacity="+this.layer.opacity*100+")"}e.position="absolute";if(this.layerAlphaHack){e.paddingTop=e.height;e.height="0";e.width="100%"}if(this.frame){this.frame.appendChild(this.imgDiv)}}return this.imgDiv},setImage:function(e){this.imgDiv=e},initImage:function(){this.events.triggerEvent("beforeload");this.layer.div.appendChild(this.getTile());this.events.triggerEvent(this._loadEvent);var e=this.getImage();if(this.url&&OpenLayers.Util.isEquivalentUrl(e.src,this.url)){this._loadTimeout=window.setTimeout(OpenLayers.Function.bind(this.onImageLoad,this),0)}else{this.stopLoading();if(this.crossOriginKeyword){e.removeAttribute("crossorigin")}OpenLayers.Event.observe(e,"load",OpenLayers.Function.bind(this.onImageLoad,this));OpenLayers.Event.observe(e,"error",OpenLayers.Function.bind(this.onImageError,this));this.imageReloadAttempts=0;this.setImgSrc(this.url)}},setImgSrc:function(e){var t=this.imgDiv;if(e){t.style.visibility="hidden";t.style.opacity=0;if(this.crossOriginKeyword){if(e.substr(0,5)!=="data:"){t.setAttribute("crossorigin",this.crossOriginKeyword)}else{t.removeAttribute("crossorigin")}}t.src=e}else{this.stopLoading();this.imgDiv=null;if(t.parentNode){t.parentNode.removeChild(t)}}},getTile:function(){return this.frame?this.frame:this.getImage()},createBackBuffer:function(){if(!this.imgDiv||this.isLoading){return}var e;if(this.frame){e=this.frame.cloneNode(false);e.appendChild(this.imgDiv)}else{e=this.imgDiv}this.imgDiv=null;return e},onImageLoad:function(){var e=this.imgDiv;this.stopLoading();e.style.visibility="inherit";e.style.opacity=this.layer.opacity;this.isLoading=false;this.canvasContext=null;this.events.triggerEvent("loadend");if(this.layerAlphaHack===true){e.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+e.src+"', sizingMethod='scale')"}},onImageError:function(){var e=this.imgDiv;if(e.src!=null){this.imageReloadAttempts++;if(this.imageReloadAttempts<=OpenLayers.IMAGE_RELOAD_ATTEMPTS){this.setImgSrc(this.layer.getURL(this.bounds))}else{OpenLayers.Element.addClass(e,"olImageLoadError");this.events.triggerEvent("loaderror");this.onImageLoad()}}},stopLoading:function(){OpenLayers.Event.stopObservingElement(this.imgDiv);window.clearTimeout(this._loadTimeout);delete this._loadTimeout},getCanvasContext:function(){if(OpenLayers.CANVAS_SUPPORTED&&this.imgDiv&&!this.isLoading){if(!this.canvasContext){var e=document.createElement("canvas");e.width=this.size.w;e.height=this.size.h;this.canvasContext=e.getContext("2d");this.canvasContext.drawImage(this.imgDiv,0,0)}return this.canvasContext}},CLASS_NAME:"OpenLayers.Tile.Image"});OpenLayers.Tile.Image.IMAGE=function(){var e=new Image;e.className="olTileImage";e.galleryImg="no";return e}();OpenLayers.Layer.Grid=OpenLayers.Class(OpenLayers.Layer.HTTPRequest,{tileSize:null,tileOriginCorner:"bl",tileOrigin:null,tileOptions:null,tileClass:OpenLayers.Tile.Image,grid:null,singleTile:false,ratio:1.5,buffer:0,transitionEffect:"resize",numLoadingTiles:0,serverResolutions:null,loading:false,backBuffer:null,gridResolution:null,backBufferResolution:null,backBufferLonLat:null,backBufferTimerId:null,removeBackBufferDelay:null,className:null,gridLayout:null,rowSign:null,transitionendEvents:["transitionend","webkitTransitionEnd","otransitionend","oTransitionEnd"],initialize:function(e,t,i,r){OpenLayers.Layer.HTTPRequest.prototype.initialize.apply(this,arguments);this.grid=[];this._removeBackBuffer=OpenLayers.Function.bind(this.removeBackBuffer,this);this.initProperties();this.rowSign=this.tileOriginCorner.substr(0,1)==="t"?1:-1},initProperties:function(){if(this.options.removeBackBufferDelay===undefined){this.removeBackBufferDelay=this.singleTile?0:2500}if(this.options.className===undefined){this.className=this.singleTile?"olLayerGridSingleTile":"olLayerGrid"}},setMap:function(e){OpenLayers.Layer.HTTPRequest.prototype.setMap.call(this,e);OpenLayers.Element.addClass(this.div,this.className)},removeMap:function(e){this.removeBackBuffer()},destroy:function(){this.removeBackBuffer();this.clearGrid();this.grid=null;this.tileSize=null;OpenLayers.Layer.HTTPRequest.prototype.destroy.apply(this,arguments)},clearGrid:function(){if(this.grid){for(var e=0,t=this.grid.length;e<t;e++){var i=this.grid[e];for(var r=0,a=i.length;r<a;r++){var s=i[r];this.destroyTile(s)}}this.grid=[];this.gridResolution=null;this.gridLayout=null}},addOptions:function(e,t){var i=e.singleTile!==undefined&&e.singleTile!==this.singleTile;OpenLayers.Layer.HTTPRequest.prototype.addOptions.apply(this,arguments);if(this.map&&i){this.initProperties();this.clearGrid();this.tileSize=this.options.tileSize;this.setTileSize();this.moveTo(null,true)}},clone:function(e){if(e==null){e=new OpenLayers.Layer.Grid(this.name,this.url,this.params,this.getOptions())}e=OpenLayers.Layer.HTTPRequest.prototype.clone.apply(this,[e]);if(this.tileSize!=null){e.tileSize=this.tileSize.clone()}e.grid=[];e.gridResolution=null;e.backBuffer=null;e.backBufferTimerId=null;e.loading=false;e.numLoadingTiles=0;return e},moveTo:function(e,t,i){OpenLayers.Layer.HTTPRequest.prototype.moveTo.apply(this,arguments);e=e||this.map.getExtent();if(e!=null){var r=!this.grid.length||t;var a=this.getTilesBounds();var s=this.map.getResolution();var n=this.getServerResolution(s);if(this.singleTile){if(r||!i&&!a.containsBounds(e)){if(t&&this.transitionEffect!=="resize"){this.removeBackBuffer()}if(!t||this.transitionEffect==="resize"){this.applyBackBuffer(s)}this.initSingleTile(e)}}else{r=r||!a.intersectsBounds(e,{worldBounds:this.map.baseLayer.wrapDateLine&&this.map.getMaxExtent()});if(r){if(t&&(this.transitionEffect==="resize"||this.gridResolution===s)){this.applyBackBuffer(s)}this.initGriddedTiles(e)}else{this.moveGriddedTiles()}}}},getTileData:function(e){var t=null,i=e.lon,p=e.lat,r=this.grid.length;if(this.map&&r){var a=this.map.getResolution(),s=this.tileSize.w,n=this.tileSize.h,o=this.grid[0][0].bounds,l=o.left,u=o.top;if(i<l){if(this.map.baseLayer.wrapDateLine){var c=this.map.getMaxExtent().getWidth();var d=Math.ceil((l-i)/c);i+=c*d}}var f=(i-l)/(a*s);var y=(u-p)/(a*n);var g=Math.floor(f);var h=Math.floor(y);if(h>=0&&h<r){var m=this.grid[h][g];if(m){t={tile:m,i:Math.floor((f-g)*s),j:Math.floor((y-h)*n)}}}}return t},destroyTile:function(e){this.removeTileMonitoringHooks(e);e.destroy()},getServerResolution:function(e){var t=Number.POSITIVE_INFINITY;e=e||this.map.getResolution();if(this.serverResolutions&&OpenLayers.Util.indexOf(this.serverResolutions,e)===-1){var i,r,a,s;for(i=this.serverResolutions.length-1;i>=0;i--){a=this.serverResolutions[i];r=Math.abs(a-e);if(r>t){break}t=r;s=a}e=s}return e},getServerZoom:function(){var e=this.getServerResolution();return this.serverResolutions?OpenLayers.Util.indexOf(this.serverResolutions,e):this.map.getZoomForResolution(e)+(this.zoomOffset||0)},applyBackBuffer:function(e){if(this.backBufferTimerId!==null){this.removeBackBuffer()}var t=this.backBuffer;if(!t){t=this.createBackBuffer();if(!t){return}if(e===this.gridResolution){this.div.insertBefore(t,this.div.firstChild)}else{this.map.baseLayer.div.parentNode.insertBefore(t,this.map.baseLayer.div)}this.backBuffer=t;var i=this.grid[0][0].bounds;this.backBufferLonLat={lon:i.left,lat:i.top};this.backBufferResolution=this.gridResolution}var r=this.backBufferResolution/e;var a=t.childNodes,s;for(var n=a.length-1;n>=0;--n){s=a[n];s.style.top=(r*s._i*s._h|0)+"px";s.style.left=(r*s._j*s._w|0)+"px";s.style.width=Math.round(r*s._w)+"px";s.style.height=Math.round(r*s._h)+"px"}var o=this.getViewPortPxFromLonLat(this.backBufferLonLat,e);var l=this.map.layerContainerOriginPx.x;var h=this.map.layerContainerOriginPx.y;t.style.left=Math.round(o.x-l)+"px";t.style.top=Math.round(o.y-h)+"px"},createBackBuffer:function(){var e;if(this.grid.length>0){e=document.createElement("div");e.id=this.div.id+"_bb";e.className="olBackBuffer";e.style.position="absolute";var t=this.map;e.style.zIndex=this.transitionEffect==="resize"?this.getZIndex()-1:t.Z_INDEX_BASE.BaseLayer-(t.getNumLayers()-t.getLayerIndex(this));for(var i=0,r=this.grid.length;i<r;i++){for(var a=0,s=this.grid[i].length;a<s;a++){var n=this.grid[i][a],o=this.grid[i][a].createBackBuffer();if(o){o._i=i;o._j=a;o._w=n.size.w;o._h=n.size.h;o.id=n.id+"_bb";e.appendChild(o)}}}}return e},removeBackBuffer:function(){if(this._transitionElement){for(var e=this.transitionendEvents.length-1;e>=0;--e){OpenLayers.Event.stopObserving(this._transitionElement,this.transitionendEvents[e],this._removeBackBuffer)}delete this._transitionElement}if(this.backBuffer){if(this.backBuffer.parentNode){this.backBuffer.parentNode.removeChild(this.backBuffer)}this.backBuffer=null;this.backBufferResolution=null;if(this.backBufferTimerId!==null){window.clearTimeout(this.backBufferTimerId);this.backBufferTimerId=null}}},moveByPx:function(e,t){if(!this.singleTile){this.moveGriddedTiles()}},setTileSize:function(e){if(this.singleTile){e=this.map.getSize();e.h=parseInt(e.h*this.ratio,10);e.w=parseInt(e.w*this.ratio,10)}OpenLayers.Layer.HTTPRequest.prototype.setTileSize.apply(this,[e])},getTilesBounds:function(){var e=null;var t=this.grid.length;if(t){var i=this.grid[t-1][0].bounds,r=this.grid[0].length*i.getWidth(),a=this.grid.length*i.getHeight();e=new OpenLayers.Bounds(i.left,i.bottom,i.left+r,i.bottom+a)}return e},initSingleTile:function(e){this.events.triggerEvent("retile");var t=e.getCenterLonLat();var i=e.getWidth()*this.ratio;var r=e.getHeight()*this.ratio;var a=new OpenLayers.Bounds(t.lon-i/2,t.lat-r/2,t.lon+i/2,t.lat+r/2);var s=this.map.getLayerPxFromLonLat({lon:a.left,lat:a.top});if(!this.grid.length){this.grid[0]=[]}var n=this.grid[0][0];if(!n){n=this.addTile(a,s);this.addTileMonitoringHooks(n);n.draw();this.grid[0][0]=n}else{n.moveTo(a,s)}this.removeExcessTiles(1,1);this.gridResolution=this.getServerResolution()},calculateGridLayout:function(e,t,i){var r=i*this.tileSize.w;var a=i*this.tileSize.h;var s=e.left-t.lon;var n=Math.floor(s/r)-this.buffer;var o=this.rowSign;var l=o*(t.lat-e.top+a);var h=Math[~o?"floor":"ceil"](l/a)-this.buffer*o;return{tilelon:r,tilelat:a,startcol:n,startrow:h}},getTileOrigin:function(){var e=this.tileOrigin;if(!e){var t=this.getMaxExtent();var i={tl:["left","top"],tr:["right","top"],bl:["left","bottom"],br:["right","bottom"]}[this.tileOriginCorner];e=new OpenLayers.LonLat(t[i[0]],t[i[1]])}return e},getTileBoundsForGridIndex:function(e,t){var i=this.getTileOrigin();var r=this.gridLayout;var a=r.tilelon;var s=r.tilelat;var n=r.startcol;var o=r.startrow;var l=this.rowSign;return new OpenLayers.Bounds(i.lon+(n+t)*a,i.lat-(o+e*l)*s*l,i.lon+(n+t+1)*a,i.lat-(o+(e-1)*l)*s*l)},initGriddedTiles:function(e){this.events.triggerEvent("retile");var p=this.map.getSize();var u=this.getTileOrigin();var c=this.map.getResolution(),d=this.getServerResolution(),f=c/d,t={w:this.tileSize.w/f,h:this.tileSize.h/f};var y=Math.ceil(p.h/t.h)+2*this.buffer+1;var g=Math.ceil(p.w/t.w)+2*this.buffer+1;var m=this.calculateGridLayout(e,u,d);this.gridLayout=m;var v=m.tilelon;var x=m.tilelat;var L=this.map.layerContainerOriginPx.x;var b=this.map.layerContainerOriginPx.y;var i=this.getTileBoundsForGridIndex(0,0);var r=this.map.getViewPortPxFromLonLat(new OpenLayers.LonLat(i.left,i.top));r.x=Math.round(r.x)-L;r.y=Math.round(r.y)-b;var a=[],E=this.map.getCenter();var s=0;do{var n=this.grid[s];if(!n){n=[];this.grid.push(n)}var o=0;do{i=this.getTileBoundsForGridIndex(s,o);var l=r.clone();l.x=l.x+o*Math.round(t.w);l.y=l.y+s*Math.round(t.h);var h=n[o];if(!h){h=this.addTile(i,l);this.addTileMonitoringHooks(h);n.push(h)}else{h.moveTo(i,l,false)}var S=i.getCenterLonLat();a.push({tile:h,distance:Math.pow(S.lon-E.lon,2)+Math.pow(S.lat-E.lat,2)});o+=1}while(i.right<=e.right+v*this.buffer||o<g);s+=1}while(i.bottom>=e.bottom-x*this.buffer||s<y);this.removeExcessTiles(s,o);var c=this.getServerResolution();this.gridResolution=c;a.sort(function(e,t){return e.distance-t.distance});for(var O=0,C=a.length;O<C;++O){a[O].tile.draw()}},getMaxExtent:function(){return this.maxExtent},addTile:function(e,t){var i=new this.tileClass(this,t,e,null,this.tileSize,this.tileOptions);this.events.triggerEvent("addtile",{tile:i});return i},addTileMonitoringHooks:function(n){var o="olTileReplacing";n.onLoadStart=function(){if(this.loading===false){this.loading=true;this.events.triggerEvent("loadstart")}this.events.triggerEvent("tileloadstart",{tile:n});this.numLoadingTiles++;if(!this.singleTile&&this.backBuffer&&this.gridResolution===this.backBufferResolution){OpenLayers.Element.addClass(n.getTile(),o)}};n.onLoadEnd=function(e){this.numLoadingTiles--;var t=e.type==="unload";this.events.triggerEvent("tileloaded",{tile:n,aborted:t});if(!this.singleTile&&!t&&this.backBuffer&&this.gridResolution===this.backBufferResolution){var i=n.getTile();if(OpenLayers.Element.getStyle(i,"display")==="none"){var r=document.getElementById(n.id+"_bb");if(r){r.parentNode.removeChild(r)}}OpenLayers.Element.removeClass(i,o)}if(this.numLoadingTiles===0){if(this.backBuffer){if(this.backBuffer.childNodes.length===0){this.removeBackBuffer()}else{this._transitionElement=t?this.div.lastChild:n.imgDiv;var a=this.transitionendEvents;for(var s=a.length-1;s>=0;--s){OpenLayers.Event.observe(this._transitionElement,a[s],this._removeBackBuffer)}this.backBufferTimerId=window.setTimeout(this._removeBackBuffer,this.removeBackBufferDelay)}}this.loading=false;this.events.triggerEvent("loadend")}};n.onLoadError=function(){this.events.triggerEvent("tileerror",{tile:n})};n.events.on({loadstart:n.onLoadStart,loadend:n.onLoadEnd,unload:n.onLoadEnd,loaderror:n.onLoadError,scope:this})},removeTileMonitoringHooks:function(e){e.unload();e.events.un({loadstart:e.onLoadStart,loadend:e.onLoadEnd,unload:e.onLoadEnd,loaderror:e.onLoadError,scope:this})},moveGriddedTiles:function(){var e=this.buffer+1;while(true){var t=this.grid[0][0];var i={x:t.position.x+this.map.layerContainerOriginPx.x,y:t.position.y+this.map.layerContainerOriginPx.y};var r=this.getServerResolution()/this.map.getResolution();var a={w:Math.round(this.tileSize.w*r),h:Math.round(this.tileSize.h*r)};if(i.x>-a.w*(e-1)){this.shiftColumn(true,a)}else if(i.x<-a.w*e){this.shiftColumn(false,a)}else if(i.y>-a.h*(e-1)){this.shiftRow(true,a)}else if(i.y<-a.h*e){this.shiftRow(false,a)}else{break}}},shiftRow:function(e,t){var i=this.grid;var r=e?0:i.length-1;var a=e?-1:1;var s=this.rowSign;var n=this.gridLayout;n.startrow+=a*s;var p=i[r];var o=i[e?"pop":"shift"]();for(var l=0,u=o.length;l<u;l++){var c=o[l];var h=p[l].position.clone();h.y+=t.h*a;c.moveTo(this.getTileBoundsForGridIndex(r,l),h)}i[e?"unshift":"push"](o)},shiftColumn:function(e,t){var i=this.grid;var r=e?0:i[0].length-1;var a=e?-1:1;var s=this.gridLayout;s.startcol+=a;for(var n=0,p=i.length;n<p;n++){var o=i[n];var l=o[r].position.clone();var h=o[e?"pop":"shift"]();l.x+=t.w*a;h.moveTo(this.getTileBoundsForGridIndex(n,r),l);o[e?"unshift":"push"](h)}},removeExcessTiles:function(e,t){var i,r;while(this.grid.length>e){var a=this.grid.pop();for(i=0,r=a.length;i<r;i++){var s=a[i];this.destroyTile(s)}}for(i=0,r=this.grid.length;i<r;i++){while(this.grid[i].length>t){var a=this.grid[i];var s=a.pop();this.destroyTile(s)}}},onMapResize:function(){if(this.singleTile){this.clearGrid();this.setTileSize()}},getTileBounds:function(e){var t=this.maxExtent;var i=this.getResolution();var r=i*this.tileSize.w;var a=i*this.tileSize.h;var s=this.getLonLatFromViewPortPx(e);var n=t.left+r*Math.floor((s.lon-t.left)/r);var o=t.bottom+a*Math.floor((s.lat-t.bottom)/a);return new OpenLayers.Bounds(n,o,n+r,o+a)},CLASS_NAME:"OpenLayers.Layer.Grid"});OpenLayers.Layer.WMS=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{service:"WMS",version:"1.1.1",request:"GetMap",styles:"",format:"image/jpeg"},isBaseLayer:true,encodeBBOX:false,noMagic:false,yx:{},initialize:function(e,t,i,r){var a=[];i=OpenLayers.Util.upperCaseObject(i);if(parseFloat(i.VERSION)>=1.3&&!i.EXCEPTIONS){i.EXCEPTIONS="INIMAGE"}a.push(e,t,i,r);OpenLayers.Layer.Grid.prototype.initialize.apply(this,a);OpenLayers.Util.applyDefaults(this.params,OpenLayers.Util.upperCaseObject(this.DEFAULT_PARAMS));if(!this.noMagic&&this.params.TRANSPARENT&&this.params.TRANSPARENT.toString().toLowerCase()=="true"){if(r==null||!r.isBaseLayer){this.isBaseLayer=false}if(this.params.FORMAT=="image/jpeg"){this.params.FORMAT=OpenLayers.Util.alphaHack()?"image/gif":"image/png"}}},clone:function(e){if(e==null){e=new OpenLayers.Layer.WMS(this.name,this.url,this.params,this.getOptions())}e=OpenLayers.Layer.Grid.prototype.clone.apply(this,[e]);return e},reverseAxisOrder:function(){var e=this.projection.getCode();return parseFloat(this.params.VERSION)>=1.3&&!!(this.yx[e]||OpenLayers.Projection.defaults[e]&&OpenLayers.Projection.defaults[e].yx)},getURL:function(e){e=this.adjustBounds(e);var t=this.getImageSize();var i={};var r=this.reverseAxisOrder();i.BBOX=this.encodeBBOX?e.toBBOX(null,r):e.toArray(r);i.WIDTH=t.w;i.HEIGHT=t.h;var a=this.getFullRequestString(i);return a},mergeNewParams:function(e){var t=OpenLayers.Util.upperCaseObject(e);var i=[t];return OpenLayers.Layer.Grid.prototype.mergeNewParams.apply(this,i)},getFullRequestString:function(e,t){var i=this.map.getProjectionObject();var r=this.projection&&this.projection.equals(i)?this.projection.getCode():i.getCode();var a=r=="none"?null:r;if(parseFloat(this.params.VERSION)>=1.3){this.params.CRS=a}else{this.params.SRS=a}if(typeof this.params.TRANSPARENT=="boolean"){e.TRANSPARENT=this.params.TRANSPARENT?"TRUE":"FALSE"}return OpenLayers.Layer.Grid.prototype.getFullRequestString.apply(this,arguments)},CLASS_NAME:"OpenLayers.Layer.WMS"});Ext.namespace("GeoExt");GeoExt.WMSLegend=Ext.extend(GeoExt.LayerLegend,{defaultStyleIsFirst:true,useScaleParameter:true,baseParams:null,itemXType:"gx_legendimage",initComponent:function(){GeoExt.WMSLegend.superclass.initComponent.call(this);var e=this.layerRecord.getLayer();this._noMap=!e.map;e.events.register("moveend",this,this.onLayerMoveend);this.update()},onLayerMoveend:function(e){if(e.zoomChanged===true&&this.useScaleParameter===true||this._noMap){delete this._noMap;this.update()}},getLegendUrl:function(t,e){var i=this.layerRecord;var r;var a=i&&i.get("styles");var s=i.getLayer();e=e||[s.params.LAYERS].join(",").split(",");var n=s.params.STYLES&&[s.params.STYLES].join(",").split(",");var o=e.indexOf(t);var l=n&&n[o];if(a&&a.length>0){if(l){Ext.each(a,function(e){r=e.name==l&&e.legend&&e.legend.href;return!r})}else{if(!n&&!s.params.SLD&&!s.params.SLD_BODY){Ext.each(a,function(e){r=e.layerName==t&&e.legend&&e.legend.href;return!r});if(!r&&this.defaultStyleIsFirst===true){r=a[0].legend&&a[0].legend.href}}}if(r){r=decodeURIComponent(r)}}if(e[o]=="geonode:afg_rdsl"){l="afg_rdsl_legend_osm";r=null}if(!r){r=s.getFullRequestString({REQUEST:"GetLegendGraphic",WIDTH:null,HEIGHT:null,EXCEPTIONS:"application/vnd.ogc.se_xml",LAYER:t,LAYERS:null,STYLE:l!==""?l:null,STYLES:null,SRS:null,FORMAT:null,TIME:null})}var p=Ext.apply({},this.baseParams);if(s.params._OLSALT){p._OLSALT=s.params._OLSALT}var u=Ext.urlEncode(p);var h=/([&\?]?)format=[^&]*&?/i;if(h.test(u)&&h.test(r)){r=r.replace(h,"$1")}r=OpenLayers.Util.urlAppend(r,u);if(r.toLowerCase().indexOf("request=getlegendgraphic")!=-1){if(r.toLowerCase().indexOf("format=")==-1){r=Ext.urlAppend(r,"FORMAT=image%2Fgif")}if(this.useScaleParameter===true){var c=s.map.getScale();r=Ext.urlAppend(r,"SCALE="+c)}}return r},update:function(){var e=this.layerRecord.getLayer();if(!(e&&e.map)){return}GeoExt.WMSLegend.superclass.update.apply(this,arguments);var i,r,a,t;i=[e.params.LAYERS].join(",").split(",");var s=[];var n=this.items.find(function(e){return e.isXType("label")});this.items.each(function(e){a=i.indexOf(e.itemId);if(a<0&&e!=n){s.push(e)}else if(e!==n){r=i[a];var t=this.getLegendUrl(r,i);if(!OpenLayers.Util.isEquivalentUrl(t,e.url)){e.setUrl(t)}}},this);for(a=0,t=s.length;a<t;a++){var o=s[a];this.remove(o);o.destroy()}for(a=0,t=i.length;a<t;a++){r=i[a];if(!this.items||!this.getComponent(r)){this.add({xtype:this.itemXType,url:this.getLegendUrl(r,i),itemId:r})}}this.doLayout()},beforeDestroy:function(){if(this.useScaleParameter===true){var e=this.layerRecord.getLayer();e&&e.events&&e.events.unregister("moveend",this,this.onLayerMoveend)}GeoExt.WMSLegend.superclass.beforeDestroy.apply(this,arguments)}});GeoExt.WMSLegend.supports=function(e){return e.getLayer()instanceof OpenLayers.Layer.WMS?1:0};GeoExt.LayerLegend.types["gx_wmslegend"]=GeoExt.WMSLegend;Ext.reg("gx_wmslegend",GeoExt.WMSLegend);OpenLayers.Renderer=OpenLayers.Class({container:null,root:null,extent:null,locked:false,size:null,resolution:null,map:null,featureDx:0,initialize:function(e,t){this.container=OpenLayers.Util.getElement(e);OpenLayers.Util.extend(this,t)},destroy:function(){this.container=null;this.extent=null;this.size=null;this.resolution=null;this.map=null},supported:function(){return false},setExtent:function(e,t){this.extent=e.clone();if(this.map.baseLayer&&this.map.baseLayer.wrapDateLine){var i=e.getWidth()/this.map.getExtent().getWidth(),e=e.scale(1/i);this.extent=e.wrapDateLine(this.map.getMaxExtent()).scale(i)}if(t){this.resolution=null}return true},setSize:function(e){this.size=e.clone();this.resolution=null},getResolution:function(){this.resolution=this.resolution||this.map.getResolution();return this.resolution},drawFeature:function(e,t){if(t==null){t=e.style}if(e.geometry){var i=e.geometry.getBounds();if(i){var r;if(this.map.baseLayer&&this.map.baseLayer.wrapDateLine){r=this.map.getMaxExtent()}if(!i.intersectsBounds(this.extent,{worldBounds:r})){t={display:"none"}}else{this.calculateFeatureDx(i,r)}var a=this.drawGeometry(e.geometry,t,e.id);if(t.display!="none"&&t.label&&a!==false){var s=e.geometry.getCentroid();if(t.labelXOffset||t.labelYOffset){var n=isNaN(t.labelXOffset)?0:t.labelXOffset;var o=isNaN(t.labelYOffset)?0:t.labelYOffset;var l=this.getResolution();s.move(n*l,o*l)}this.drawText(e.id,t,s)}else{this.removeText(e.id)}return a}}},calculateFeatureDx:function(e,t){this.featureDx=0;if(t){var i=t.getWidth(),r=(this.extent.left+this.extent.right)/2,a=(e.left+e.right)/2,s=Math.round((a-r)/i);this.featureDx=s*i}},drawGeometry:function(e,t,i){},drawText:function(e,t,i){},removeText:function(e){},clear:function(){},getFeatureIdFromEvent:function(e){},eraseFeatures:function(e){if(!OpenLayers.Util.isArray(e)){e=[e]}for(var t=0,i=e.length;t<i;++t){var r=e[t];this.eraseGeometry(r.geometry,r.id);this.removeText(r.id)}},eraseGeometry:function(e,t){},moveRoot:function(e){},getRenderLayerId:function(){return this.container.id},applyDefaultSymbolizer:function(e){var t=OpenLayers.Util.extend({},OpenLayers.Renderer.defaultSymbolizer);if(e.stroke===false){delete t.strokeWidth;delete t.strokeColor}if(e.fill===false){delete t.fillColor}OpenLayers.Util.extend(t,e);return t},CLASS_NAME:"OpenLayers.Renderer"});OpenLayers.Renderer.defaultSymbolizer={fillColor:"#000000",strokeColor:"#000000",strokeWidth:2,fillOpacity:1,strokeOpacity:1,pointRadius:0,labelAlign:"cm"};OpenLayers.Renderer.symbol={star:[350,75,379,161,469,161,397,215,423,301,350,250,277,301,303,215,231,161,321,161,350,75],cross:[4,0,6,0,6,4,10,4,10,6,6,6,6,10,4,10,4,6,0,6,0,4,4,4,4,0],x:[0,0,25,0,50,35,75,0,100,0,65,50,100,100,75,100,50,65,25,100,0,100,35,50,0,0],square:[0,0,0,1,1,1,1,0,0,0],triangle:[0,10,10,10,5,0,0,10]};OpenLayers.StyleMap=OpenLayers.Class({styles:null,extendDefault:true,initialize:function(e,t){this.styles={default:new OpenLayers.Style(OpenLayers.Feature.Vector.style["default"]),select:new OpenLayers.Style(OpenLayers.Feature.Vector.style["select"]),temporary:new OpenLayers.Style(OpenLayers.Feature.Vector.style["temporary"]),delete:new OpenLayers.Style(OpenLayers.Feature.Vector.style["delete"])};if(e instanceof OpenLayers.Style){this.styles["default"]=e;this.styles["select"]=e;this.styles["temporary"]=e;this.styles["delete"]=e}else if(typeof e=="object"){for(var i in e){if(e[i]instanceof OpenLayers.Style){this.styles[i]=e[i]}else if(typeof e[i]=="object"){this.styles[i]=new OpenLayers.Style(e[i])}else{this.styles["default"]=new OpenLayers.Style(e);this.styles["select"]=new OpenLayers.Style(e);this.styles["temporary"]=new OpenLayers.Style(e);this.styles["delete"]=new OpenLayers.Style(e);break}}}OpenLayers.Util.extend(this,t)},destroy:function(){for(var e in this.styles){this.styles[e].destroy()}this.styles=null},createSymbolizer:function(e,t){if(!e){e=new OpenLayers.Feature.Vector}if(!this.styles[t]){t="default"}e.renderIntent=t;var i={};if(this.extendDefault&&t!="default"){i=this.styles["default"].createSymbolizer(e)}return OpenLayers.Util.extend(i,this.styles[t].createSymbolizer(e))},addUniqueValueRules:function(e,t,i,r){var a=[];for(var s in i){a.push(new OpenLayers.Rule({symbolizer:i[s],context:r,filter:new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:t,value:s})}))}this.styles[e].addRules(a)},CLASS_NAME:"OpenLayers.StyleMap"});OpenLayers.Layer.Vector=OpenLayers.Class(OpenLayers.Layer,{isBaseLayer:false,isFixed:false,features:null,filter:null,selectedFeatures:null,unrenderedFeatures:null,reportError:true,style:null,styleMap:null,strategies:null,protocol:null,renderers:["SVG","VML","Canvas"],renderer:null,rendererOptions:null,geometryType:null,drawn:false,ratio:1,initialize:function(e,t){OpenLayers.Layer.prototype.initialize.apply(this,arguments);if(!this.renderer||!this.renderer.supported()){this.assignRenderer()}if(!this.renderer||!this.renderer.supported()){this.renderer=null;this.displayError()}if(!this.styleMap){this.styleMap=new OpenLayers.StyleMap}this.features=[];this.selectedFeatures=[];this.unrenderedFeatures={};if(this.strategies){for(var i=0,r=this.strategies.length;i<r;i++){this.strategies[i].setLayer(this)}}},destroy:function(){if(this.strategies){var e,t,i;for(t=0,i=this.strategies.length;t<i;t++){e=this.strategies[t];if(e.autoDestroy){e.destroy()}}this.strategies=null}if(this.protocol){if(this.protocol.autoDestroy){this.protocol.destroy()}this.protocol=null}this.destroyFeatures();this.features=null;this.selectedFeatures=null;this.unrenderedFeatures=null;if(this.renderer){this.renderer.destroy()}this.renderer=null;this.geometryType=null;this.drawn=null;OpenLayers.Layer.prototype.destroy.apply(this,arguments)},clone:function(e){if(e==null){e=new OpenLayers.Layer.Vector(this.name,this.getOptions())}e=OpenLayers.Layer.prototype.clone.apply(this,[e]);var t=this.features;var i=t.length;var r=new Array(i);for(var a=0;a<i;++a){r[a]=t[a].clone()}e.features=r;return e},refresh:function(e){if(this.calculateInRange()&&this.visibility){this.events.triggerEvent("refresh",e)}},assignRenderer:function(){for(var e=0,t=this.renderers.length;e<t;e++){var i=this.renderers[e];var r=typeof i=="function"?i:OpenLayers.Renderer[i];if(r&&r.prototype.supported()){this.renderer=new r(this.div,this.rendererOptions);break}}},displayError:function(){if(this.reportError){OpenLayers.Console.userError(OpenLayers.i18n("browserNotSupported",{renderers:this.renderers.join("\n")}))}},setMap:function(e){OpenLayers.Layer.prototype.setMap.apply(this,arguments);if(!this.renderer){this.map.removeLayer(this)}else{this.renderer.map=this.map;var t=this.map.getSize();t.w=t.w*this.ratio;t.h=t.h*this.ratio;this.renderer.setSize(t)}},afterAdd:function(){if(this.strategies){var e,t,i;for(t=0,i=this.strategies.length;t<i;t++){e=this.strategies[t];if(e.autoActivate){e.activate()}}}},removeMap:function(e){this.drawn=false;if(this.strategies){var t,i,r;for(i=0,r=this.strategies.length;i<r;i++){t=this.strategies[i];if(t.autoActivate){t.deactivate()}}}},onMapResize:function(){OpenLayers.Layer.prototype.onMapResize.apply(this,arguments);var e=this.map.getSize();e.w=e.w*this.ratio;e.h=e.h*this.ratio;this.renderer.setSize(e)},moveTo:function(p,e,u){OpenLayers.Layer.prototype.moveTo.apply(this,arguments);var t=true;if(!u){this.renderer.root.style.visibility="hidden";var i=this.map.getSize(),r=i.w,a=i.h,s=r/2*this.ratio-r/2,n=a/2*this.ratio-a/2;s+=this.map.layerContainerOriginPx.x;s=-Math.round(s);n+=this.map.layerContainerOriginPx.y;n=-Math.round(n);this.div.style.left=s+"px";this.div.style.top=n+"px";var c=this.map.getExtent().scale(this.ratio);t=this.renderer.setExtent(c,e);this.renderer.root.style.visibility="visible";if(OpenLayers.IS_GECKO===true){this.div.scrollLeft=this.div.scrollLeft}if(!e&&t){for(var o in this.unrenderedFeatures){var l=this.unrenderedFeatures[o];this.drawFeature(l)}}}if(!this.drawn||e||!t){this.drawn=true;var l;for(var o=0,h=this.features.length;o<h;o++){this.renderer.locked=o!==h-1;l=this.features[o];this.drawFeature(l)}}},display:function(e){OpenLayers.Layer.prototype.display.apply(this,arguments);var t=this.div.style.display;if(t!=this.renderer.root.style.display){this.renderer.root.style.display=t}},addFeatures:function(e,t){if(!OpenLayers.Util.isArray(e)){e=[e]}var i=!t||!t.silent;if(i){var r={features:e};var a=this.events.triggerEvent("beforefeaturesadded",r);if(a===false){return}e=r.features}var s=[];for(var n=0,o=e.length;n<o;n++){if(n!=e.length-1){this.renderer.locked=true}else{this.renderer.locked=false}var l=e[n];if(this.geometryType&&!(l.geometry instanceof this.geometryType)){throw new TypeError("addFeatures: component should be an "+this.geometryType.prototype.CLASS_NAME)}l.layer=this;if(!l.style&&this.style){l.style=OpenLayers.Util.extend({},this.style)}if(i){if(this.events.triggerEvent("beforefeatureadded",{feature:l})===false){continue}this.preFeatureInsert(l)}s.push(l);this.features.push(l);this.drawFeature(l);if(i){this.events.triggerEvent("featureadded",{feature:l});this.onFeatureInsert(l)}}if(i){this.events.triggerEvent("featuresadded",{features:s})}},removeFeatures:function(e,t){if(!e||e.length===0){return}if(e===this.features){return this.removeAllFeatures(t)}if(!OpenLayers.Util.isArray(e)){e=[e]}if(e===this.selectedFeatures){e=e.slice()}var i=!t||!t.silent;if(i){this.events.triggerEvent("beforefeaturesremoved",{features:e})}for(var r=e.length-1;r>=0;r--){if(r!=0&&e[r-1].geometry){this.renderer.locked=true}else{this.renderer.locked=false}var a=e[r];delete this.unrenderedFeatures[a.id];if(i){this.events.triggerEvent("beforefeatureremoved",{feature:a})}this.features=OpenLayers.Util.removeItem(this.features,a);a.layer=null;if(a.geometry){this.renderer.eraseFeatures(a)}if(OpenLayers.Util.indexOf(this.selectedFeatures,a)!=-1){OpenLayers.Util.removeItem(this.selectedFeatures,a)}if(i){this.events.triggerEvent("featureremoved",{feature:a})}}if(i){this.events.triggerEvent("featuresremoved",{features:e})}},removeAllFeatures:function(e){var t=!e||!e.silent;var i=this.features;if(t){this.events.triggerEvent("beforefeaturesremoved",{features:i})}var r;for(var a=i.length-1;a>=0;a--){r=i[a];if(t){this.events.triggerEvent("beforefeatureremoved",{feature:r})}r.layer=null;if(t){this.events.triggerEvent("featureremoved",{feature:r})}}this.renderer.clear();this.features=[];this.unrenderedFeatures={};this.selectedFeatures=[];if(t){this.events.triggerEvent("featuresremoved",{features:i})}},destroyFeatures:function(e,t){var i=e==undefined;if(i){e=this.features}if(e){this.removeFeatures(e,t);for(var r=e.length-1;r>=0;r--){e[r].destroy()}}},drawFeature:function(e,t){if(!this.drawn){return}if(typeof t!="object"){if(!t&&e.state===OpenLayers.State.DELETE){t="delete"}var i=t||e.renderIntent;t=e.style||this.style;if(!t){t=this.styleMap.createSymbolizer(e,i)}}var r=this.renderer.drawFeature(e,t);if(r===false||r===null){this.unrenderedFeatures[e.id]=e}else{delete this.unrenderedFeatures[e.id]}},eraseFeatures:function(e){this.renderer.eraseFeatures(e)},getFeatureFromEvent:function(e){if(!this.renderer){throw new Error("getFeatureFromEvent called on layer with no "+"renderer. This usually means you destroyed a "+"layer, but not some handler which is associated "+"with it.")}var t=null;var i=this.renderer.getFeatureIdFromEvent(e);if(i){if(typeof i==="string"){t=this.getFeatureById(i)}else{t=i}}return t},getFeatureBy:function(e,t){var i=null;for(var r=0,a=this.features.length;r<a;++r){if(this.features[r][e]==t){i=this.features[r];break}}return i},getFeatureById:function(e){return this.getFeatureBy("id",e)},getFeatureByFid:function(e){return this.getFeatureBy("fid",e)},getFeaturesByAttribute:function(e,t){var i,r,a=this.features.length,s=[];for(i=0;i<a;i++){r=this.features[i];if(r&&r.attributes){if(r.attributes[e]===t){s.push(r)}}}return s},onFeatureInsert:function(e){},preFeatureInsert:function(e){},getDataExtent:function(){var e=null;var t=this.features;if(t&&t.length>0){var i=null;for(var r=0,a=t.length;r<a;r++){i=t[r].geometry;if(i){if(e===null){e=new OpenLayers.Bounds}e.extend(i.getBounds())}}}return e},CLASS_NAME:"OpenLayers.Layer.Vector"});Ext.namespace("GeoExt");GeoExt.VectorLegend=Ext.extend(GeoExt.LayerLegend,{layerRecord:null,layer:null,rules:null,symbolType:null,untitledPrefix:"Untitled ",clickableSymbol:false,clickableTitle:false,selectOnClick:false,enableDD:false,bodyBorder:false,feature:null,selectedRule:null,currentScaleDenominator:null,initComponent:function(){GeoExt.VectorLegend.superclass.initComponent.call(this);if(this.layerRecord){this.layer=this.layerRecord.getLayer();if(this.layer.map){this.map=this.layer.map;this.currentScaleDenominator=this.layer.map.getScale();this.layer.map.events.on({zoomend:this.onMapZoom,scope:this})}}if(!this.symbolType){if(this.feature){this.symbolType=this.symbolTypeFromFeature(this.feature)}else if(this.layer){if(this.layer.features.length>0){var e;for(var t=0,i=this.layer.features.length;t<i;t++){if(this.layer.features[t].geometry!==null){e=this.layer.features[t].clone();break}}e.attributes={};this.feature=e;this.symbolType=this.symbolTypeFromFeature(this.feature)}else{this.layer.events.on({featuresadded:this.onFeaturesAdded,scope:this})}}}if(this.layer&&this.feature&&!this.rules){this.setRules()}this.rulesContainer=new Ext.Container({autoEl:{}});this.add(this.rulesContainer);this.addEvents("titleclick","symbolclick","ruleclick","ruleselected","ruleunselected","rulemoved");this.update()},onMapZoom:function(){this.setCurrentScaleDenominator(this.layer.map.getScale())},symbolTypeFromFeature:function(e){var t=e.geometry.CLASS_NAME.match(/Point|Line|Polygon/);return t&&t[0]||"Point"},onFeaturesAdded:function(e){for(var t=0,i=e.features.length;t<i;++t){if(e.features[t].geometry!==null){this.layer.events.un({featuresadded:this.onFeaturesAdded,scope:this});var r=e.features[t].clone();r.attributes={};this.feature=r;this.symbolType=this.symbolTypeFromFeature(this.feature);if(!this.rules){this.setRules()}this.update();break}}},setRules:function(){var e=this.layer.styleMap&&this.layer.styleMap.styles["default"];if(!e){e=new OpenLayers.Style}if(e.rules.length===0){this.rules=[new OpenLayers.Rule({title:e.title,symbolizer:e.createSymbolizer(this.feature)})]}else{this.rules=e.rules}},setCurrentScaleDenominator:function(e){if(e!==this.currentScaleDenominator){this.currentScaleDenominator=e;this.update()}},getRuleEntry:function(e){return this.rulesContainer.items.get(this.rules.indexOf(e))},addRuleEntry:function(e,t){this.rulesContainer.add(this.createRuleEntry(e));if(!t){this.doLayout()}},removeRuleEntry:function(e,t){var i=this.getRuleEntry(e);if(i){this.rulesContainer.remove(i);if(!t){this.doLayout()}}},selectRuleEntry:function(e){var t=e!=this.selectedRule;if(this.selectedRule){this.unselect()}if(t){var i=this.getRuleEntry(e);i.body.addClass("x-grid3-row-selected");this.selectedRule=e;this.fireEvent("ruleselected",this,e)}},unselect:function(){this.rulesContainer.items.each(function(e,t){if(this.rules[t]==this.selectedRule){e.body.removeClass("x-grid3-row-selected");this.selectedRule=null;this.fireEvent("ruleunselected",this,this.rules[t])}},this)},createRuleEntry:function(t){var e=true;if(this.currentScaleDenominator!=null){if(t.minScaleDenominator){e=e&&this.currentScaleDenominator>=t.minScaleDenominator}if(t.maxScaleDenominator){e=e&&this.currentScaleDenominator<t.maxScaleDenominator}}return{xtype:"panel",layout:"column",border:false,hidden:!e,bodyStyle:this.selectOnClick?{cursor:"pointer"}:undefined,defaults:{border:false},items:[this.createRuleRenderer(t),this.createRuleTitle(t)],listeners:{render:function(e){this.selectOnClick&&e.getEl().on({click:function(e){this.selectRuleEntry(t)},scope:this});if(this.enableDD==true){this.addDD(e)}},scope:this}}},createRuleRenderer:function(e){var t=[this.symbolType,"Point","Line","Polygon"];var i,r,a,s,p;var n=e.symbolizers;if(!n){var o=e.symbolizer;for(a=0,s=t.length;a<s;++a){i=t[a];if(o[i]){o=o[i];r=true;break}}n=[o]}else{var l;e:for(a=0,p=t.length;a<p;++a){i=t[a];l=OpenLayers.Symbolizer[i];if(l){for(var h=0,u=n.length;h<u;++h){if(n[h]instanceof l){r=true;break e}}}}}return{xtype:"gx_renderer",labelText:gettext("Ab"),symbolType:r?i:this.symbolType,symbolizers:n,style:this.clickableSymbol?{cursor:"pointer"}:undefined,listeners:{click:function(){if(this.clickableSymbol){this.fireEvent("symbolclick",this,e);this.fireEvent("ruleclick",this,e)}},scope:this}}},createRuleTitle:function(t){return{cls:"x-form-item",style:"padding: 0.2em 0.5em 0;",bodyStyle:Ext.applyIf({background:"transparent"},this.clickableTitle?{cursor:"pointer"}:undefined),html:this.getRuleTitle(t),listeners:{render:function(e){this.clickableTitle&&e.getEl().on({click:function(){this.fireEvent("titleclick",this,t);this.fireEvent("ruleclick",this,t)},scope:this})},scope:this}}},addDD:function(n){var o=n.ownerCt;var i=this;new Ext.dd.DragSource(n.getEl(),{ddGroup:o.id,onDragOut:function(e,t){var i=Ext.getCmp(t);i.removeClass("gx-ruledrag-insert-above");i.removeClass("gx-ruledrag-insert-below");return Ext.dd.DragZone.prototype.onDragOut.apply(this,arguments)},onDragEnter:function(e,t){var i=Ext.getCmp(t);var r;var a=o.items.indexOf(n);var s=o.items.indexOf(i);if(a>s){r="gx-ruledrag-insert-above"}else if(a<s){r="gx-ruledrag-insert-below"}r&&i.addClass(r);return Ext.dd.DragZone.prototype.onDragEnter.apply(this,arguments)},onDragDrop:function(e,t){i.moveRule(o.items.indexOf(n),o.items.indexOf(Ext.getCmp(t)));return Ext.dd.DragZone.prototype.onDragDrop.apply(this,arguments)},getDragData:function(e){var t=e.getTarget(".x-column-inner");if(t){var i=t.cloneNode(true);i.id=Ext.id();return{sourceEl:t,repairXY:Ext.fly(t).getXY(),ddel:i}}}});new Ext.dd.DropTarget(n.getEl(),{ddGroup:o.id,notifyDrop:function(){return true}})},update:function(){GeoExt.VectorLegend.superclass.update.apply(this,arguments);var e,t;if(this.symbolType&&this.rules){if(this.rulesContainer.items){var i;for(e=this.rulesContainer.items.length-1;e>=0;--e){i=this.rulesContainer.getComponent(e);this.rulesContainer.remove(i,true)}}for(e=0,t=this.rules.length;e<t;++e){this.addRuleEntry(this.rules[e],true)}this.doLayout();if(this.selectedRule){this.getRuleEntry(this.selectedRule).body.addClass("x-grid3-row-selected")}}},updateRuleEntry:function(e){var t=this.getRuleEntry(e);if(t){t.removeAll();t.add(this.createRuleRenderer(e));t.add(this.createRuleTitle(e));t.doLayout()}},moveRule:function(e,t){var i=this.rules[e];this.rules.splice(e,1);this.rules.splice(t,0,i);this.update();this.fireEvent("rulemoved",this,i)},getRuleTitle:function(e){var t=e.title||e.name||"";if(!t&&this.untitledPrefix){t=this.untitledPrefix+(this.rules.indexOf(e)+1)}return t},beforeDestroy:function(){if(this.layer){if(this.layer.events){this.layer.events.un({featuresadded:this.onFeaturesAdded,scope:this})}if(this.layer.map&&this.layer.map.events){this.layer.map.events.un({zoomend:this.onMapZoom,scope:this})}}delete this.layer;delete this.map;delete this.rules;GeoExt.VectorLegend.superclass.beforeDestroy.apply(this,arguments)},onStoreRemove:function(e,t,i){if(t.getLayer()===this.layer){if(this.map&&this.map.events){this.map.events.un({zoomend:this.onMapZoom,scope:this})}}},onStoreAdd:function(e,t,i){for(var r=0,a=t.length;r<a;r++){var s=t[r];if(s.getLayer()===this.layer){if(this.layer.map&&this.layer.map.events){this.layer.map.events.on({zoomend:this.onMapZoom,scope:this})}}}}});GeoExt.VectorLegend.supports=function(e){return e.getLayer()instanceof OpenLayers.Layer.Vector?1:0};GeoExt.LayerLegend.types["gx_vectorlegend"]=GeoExt.VectorLegend;Ext.reg("gx_vectorlegend",GeoExt.VectorLegend);Ext.namespace("GeoExt");GeoExt.FeatureRenderer=Ext.extend(Ext.BoxComponent,{feature:undefined,symbolizers:[OpenLayers.Feature.Vector.style["default"]],symbolType:"Polygon",labelText:null,resolution:1,minWidth:20,minHeight:20,renderers:["SVG","VML","Canvas"],rendererOptions:null,pointFeature:undefined,lineFeature:undefined,polygonFeature:undefined,textFeature:undefined,renderer:null,initComponent:function(){GeoExt.FeatureRenderer.superclass.initComponent.apply(this,arguments);Ext.applyIf(this,{pointFeature:new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(0,0)),lineFeature:new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString([new OpenLayers.Geometry.Point(-8,-3),new OpenLayers.Geometry.Point(-3,3),new OpenLayers.Geometry.Point(3,-3),new OpenLayers.Geometry.Point(8,3)])),polygonFeature:new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing([new OpenLayers.Geometry.Point(-8,-4),new OpenLayers.Geometry.Point(-6,-6),new OpenLayers.Geometry.Point(6,-6),new OpenLayers.Geometry.Point(8,-4),new OpenLayers.Geometry.Point(8,4),new OpenLayers.Geometry.Point(6,6),new OpenLayers.Geometry.Point(-6,6),new OpenLayers.Geometry.Point(-8,4)])])),textFeature:new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(0,0))});if(!this.feature){this.setFeature(null,{draw:false})}this.addEvents("click")},initCustomEvents:function(){this.clearCustomEvents();this.el.on("click",this.onClick,this)},clearCustomEvents:function(){if(this.el&&this.el.removeAllListeners){this.el.removeAllListeners()}},onClick:function(){this.fireEvent("click",this)},onRender:function(e,t){if(!this.el){this.el=document.createElement("div");this.el.id=this.getId()}if(!this.renderer||!this.renderer.supported()){this.assignRenderer()}this.renderer.map={getResolution:function(){return this.resolution}.createDelegate(this)};GeoExt.FeatureRenderer.superclass.onRender.apply(this,arguments);this.drawFeature()},afterRender:function(){GeoExt.FeatureRenderer.superclass.afterRender.apply(this,arguments);this.initCustomEvents()},onResize:function(e,t){this.setRendererDimensions();GeoExt.FeatureRenderer.superclass.onResize.apply(this,arguments)},setRendererDimensions:function(){var e=this.feature.geometry.getBounds();var t=e.getWidth();var i=e.getHeight();var r=this.initialConfig.resolution;if(!r){r=Math.max(t/this.width||0,i/this.height||0)||1}this.resolution=r;var a=Math.max(this.width||this.minWidth,t/r);var s=Math.max(this.height||this.minHeight,i/r);var n=e.getCenterPixel();var o=a*r/2;var l=s*r/2;var h=new OpenLayers.Bounds(n.x-o,n.y-l,n.x+o,n.y+l);this.renderer.setSize(new OpenLayers.Size(Math.round(a),Math.round(s)));this.renderer.setExtent(h,true)},assignRenderer:function(){for(var e=0,t=this.renderers.length;e<t;++e){var i=OpenLayers.Renderer[this.renderers[e]];if(i&&i.prototype.supported()){this.renderer=new i(this.el,this.rendererOptions);break}}},setSymbolizers:function(e,t){this.symbolizers=e;if(!t||t.draw){this.drawFeature()}},setSymbolType:function(e,t){this.symbolType=e;this.setFeature(null,t)},setFeature:function(e,t){this.feature=e||this[this.symbolType.toLowerCase()+"Feature"];if(!t||t.draw){this.drawFeature()}},drawFeature:function(){this.renderer.clear();this.setRendererDimensions();var e,t,i;for(var r=0,a=this.symbolizers.length;r<a;++r){e=this.symbolizers[r];t=this.feature;if(e instanceof OpenLayers.Symbolizer){e=e.clone();if(OpenLayers.Symbolizer.Text&&e instanceof OpenLayers.Symbolizer.Text&&e.graphic===false){e.fill=e.stroke=false}if(!this.initialConfig.feature){i=e.CLASS_NAME.split(".").pop().toLowerCase();t=this[i+"Feature"]}}else{e=Ext.apply({},e)}if(e.label!==undefined&&this.labelText!==null){e.label=this.labelText}this.renderer.drawFeature(t.clone(),e)}},update:function(e){e=e||{};if(e.feature){this.setFeature(e.feature,{draw:false})}else if(e.symbolType){this.setSymbolType(e.symbolType,{draw:false})}if(e.symbolizers){this.setSymbolizers(e.symbolizers,{draw:false})}this.drawFeature()},beforeDestroy:function(){this.clearCustomEvents();if(this.renderer){this.renderer.destroy()}}});Ext.reg("gx_renderer",GeoExt.FeatureRenderer);(function(){var n=function(t,i){return function(e){if(i&&i[t]){i[t].call(i.scope||window,Ext.applyIf({argument:i.argument},e))}}};Ext.apply(Ext.lib.Ajax,{request:function(e,t,i,r,a){a=a||{};e=e||a.method;var s=a.headers;if(a.xmlData){if(!s||!s["Content-Type"]){s=s||{};s["Content-Type"]="text/xml"}e=e||"POST";r=a.xmlData}else if(a.jsonData){if(!s||!s["Content-Type"]){s=s||{};s["Content-Type"]="application/json"}e=e||"POST";r=typeof a.jsonData=="object"?Ext.encode(a.jsonData):a.jsonData}if(e&&e.toLowerCase()=="post"&&(a.form||a.params)&&(!s||!s["Content-Type"])){s=s||{};s["Content-Type"]="application/x-www-form-urlencoded"}return OpenLayers.Request.issue({success:n("success",i),failure:n("failure",i),method:e,headers:s,data:r,url:t})},isCallInProgress:function(e){return true},abort:function(e){e.abort()}})})();(function(){Ext.util.Observable.observeClass(Ext.form.TextField);Ext.form.TextField.on("specialkey",function(e,t){if(e.hasFocus&&t.getKey()===t.ENTER){e.blur.defer(10,e)}})})();Ext.namespace("gxp");gxp.util={_uniqueNames:{},getOGCExceptionText:function(e){var t;if(e&&e.exceptions){t=[];Ext.each(e.exceptions,function(e){Ext.each(e.texts,function(e){t.push(e)})});t=t.join("\n")}else{t="Unknown error (no exception report)."}return t},dispatch:function(t,e,i){e=e||Ext.emptyFn;i=i||this;var r=t.length;var a=0;var s={};function n(){++a;if(a===r){e.call(i,s)}}function o(e){window.setTimeout(function(){t[e].apply(i,[n,s])})}for(var l=0;l<r;++l){o(l)}},uniqueName:function(e,t){t=t||" ";var i=new RegExp(t+"[0-9]*$");var r=e.replace(i,"");var a=i.exec(e);var s=this._uniqueNames[r]!==undefined?this._uniqueNames[r]:a instanceof Array?Number(a[0]):undefined;var n=r;if(s!==undefined){s++;n+=t+s}this._uniqueNames[r]=s||0;return n},getAbsoluteUrl:function(e){var t;if(Ext.isIE6||Ext.isIE7||Ext.isIE8){t=document.createElement("<a href='"+e+"'/>");t.style.display="none";document.body.appendChild(t);t.href=t.href;document.body.removeChild(t)}else{t=document.createElement("a");t.href=e}return t.href},throttle:function(){var r=function(e,t,i){var r,a,s,n,o=function(){e.apply(i||this,s);r=(new Date).getTime()};return function(){a=(new Date).getTime()-r;s=arguments;clearTimeout(n);if(!r||a>=t){o()}else{n=setTimeout(o,t-a)}}};return function(e,t,i){return r(e,t,i)}}(),md5:function(){var f=[0,3614090360,3905402710,606105819,3250441966,4118548399,1200080426,2821735955,4249261313,1770035416,2336552879,4294925233,2304563134,1804603682,4254626195,2792965006,1236535329,4129170786,3225465664,643717713,3921069994,3593408605,38016083,3634488961,3889429448,568446438,3275163606,4107603335,1163531501,2850285829,4243563512,1735328473,2368359562,4294588738,2272392833,1839030562,4259657740,2763975236,1272893353,4139469664,3200236656,681279174,3936430074,3572445317,76029189,3654602809,3873151461,530742520,3299628645,4096336452,1126891415,2878612391,4237533241,1700485571,2399980690,4293915773,2240044497,1873313359,4264355552,2734768916,1309151649,4149444226,3174756917,718787259,3951481745];var e=[[0,7,1],[1,12,2],[2,17,3],[3,22,4],[4,7,5],[5,12,6],[6,17,7],[7,22,8],[8,7,9],[9,12,10],[10,17,11],[11,22,12],[12,7,13],[13,12,14],[14,17,15],[15,22,16]];var t=[[1,5,17],[6,9,18],[11,14,19],[0,20,20],[5,5,21],[10,9,22],[15,14,23],[4,20,24],[9,5,25],[14,9,26],[3,14,27],[8,20,28],[13,5,29],[2,9,30],[7,14,31],[12,20,32]];var i=[[5,4,33],[8,11,34],[11,16,35],[14,23,36],[1,4,37],[4,11,38],[7,16,39],[10,23,40],[13,4,41],[0,11,42],[3,16,43],[6,23,44],[9,4,45],[12,11,46],[15,16,47],[2,23,48]];var r=[[0,6,49],[7,10,50],[14,15,51],[5,21,52],[12,6,53],[3,10,54],[10,15,55],[1,21,56],[8,6,57],[15,10,58],[6,15,59],[13,21,60],[4,6,61],[11,10,62],[2,15,63],[9,21,64]];function a(e,t,i){return e&t|~e&i}function s(e,t,i){return e&i|t&~i}function n(e,t,i){return e^t^i}function o(e,t,i){return t^(e|~i)}var y=[[a,e],[s,t],[n,i],[o,r]];function g(e){return String.fromCharCode(e&255)+String.fromCharCode(e>>>8&255)+String.fromCharCode(e>>>16&255)+String.fromCharCode(e>>>24&255)}function l(e){return e.charCodeAt(0)|e.charCodeAt(1)<<8|e.charCodeAt(2)<<16|e.charCodeAt(3)<<24}function m(e){while(e<0){e+=4294967296}while(e>4294967295){e-=4294967296}return e}function v(p,e,u,t,i){var r,a,s,n;var o,l,c;var h,d;r=t[0];a=t[1];s=t[2];n=t[3];o=i[0];l=i[1];c=i[2];d=u(e[a],e[s],e[n]);h=e[r]+d+p[o]+f[c];h=m(h);h=h<<l|h>>>32-l;h+=e[a];e[r]=m(h)}function h(e){var t,p,i,r;var a,s,n,u,c;var o,l,h;var d;i=[1732584193,4023233417,2562383102,271733878];a=e.length;s=a&63;n=s<56?56-s:120-s;if(n>0){e+="Â";for(o=0;o<n-1;o++){e+="\0"}}e+=g(a*8);e+=g(0);a+=n+8;t=[0,1,2,3];p=[16];r=[4];for(h=0;h<a;h+=64){for(o=0,l=h;o<16;o++,l+=4){p[o]=e.charCodeAt(l)|e.charCodeAt(l+1)<<8|e.charCodeAt(l+2)<<16|e.charCodeAt(l+3)<<24}for(o=0;o<4;o++){r[o]=i[o]}for(o=0;o<4;o++){u=y[o][0];c=y[o][1];for(l=0;l<16;l++){v(p,r,u,t,c[l]);d=t[0];t[0]=t[3];t[3]=t[2];t[2]=t[1];t[1]=d}}for(o=0;o<4;o++){i[o]+=r[o];i[o]=m(i[o])}}return g(i[0])+g(i[1])+g(i[2])+g(i[3])}function p(e){var t,i,r;var a;a=h(e);i="";for(t=0;t<16;t++){r=a.charCodeAt(t);i+="0123456789abcdef".charAt(r>>4&15);i+="0123456789abcdef".charAt(r&15)}return i}return function(e){return p(e)}}()};Ext.namespace("gxp.menu");gxp.menu.LayerMenu=Ext.extend(Ext.menu.Menu,{layerText:gettext("Layer"),layers:null,initComponent:function(){gxp.menu.LayerMenu.superclass.initComponent.apply(this,arguments);this.layers.on("add",this.onLayerAdd,this);this.onLayerAdd()},onRender:function(e,t){gxp.menu.LayerMenu.superclass.onRender.apply(this,arguments)},beforeDestroy:function(){if(this.layers&&this.layers.on){this.layers.un("add",this.onLayerAdd,this)}delete this.layers;gxp.menu.LayerMenu.superclass.beforeDestroy.apply(this,arguments)},onLayerAdd:function(){this.removeAll();this.add({iconCls:"gxp-layer-visibility",text:this.layerText,canActivate:false},"-");this.layers.each(function(i){var e=i.getLayer();if(e.displayInLayerSwitcher){var t=new Ext.menu.CheckItem({text:i.get("title"),checked:i.getLayer().getVisibility(),group:i.get("group"),listeners:{checkchange:function(e,t){i.getLayer().setVisibility(t)}}});if(this.items.getCount()>2){this.insert(2,t)}else{this.add(t)}}},this)}});Ext.reg("gxp_layermenu",gxp.menu.LayerMenu);Ext.namespace("gxp");gxp.CrumbPanel=Ext.extend(Ext.TabPanel,{widths:null,enableTabScroll:true,initComponent:function(){gxp.CrumbPanel.superclass.initComponent.apply(this,arguments);this.widths={}},onBeforeAdd:function(e){gxp.CrumbPanel.superclass.onBeforeAdd.apply(this,arguments);if(e.shortTitle){e.title=e.shortTitle}},onAdd:function(e){gxp.CrumbPanel.superclass.onAdd.apply(this,arguments);this.setActiveTab(this.items.getCount()-1);e.on("hide",this.onCmpHide,this);e.getEl().dom.style.display=""},onRemove:function(e){gxp.CrumbPanel.superclass.onRemove.apply(this,arguments);e.un("hide",this.onCmpHide,this);var t=this.widths[this.get(this.items.getCount()-1).id];if(t&&t<this.getWidth()){this.setWidth(t);if(this.ownerCt){this.ownerCt.syncSize()}}e.getEl().dom.style.display="none";this.activeTab.doLayout()},onRender:function(e){if(!this.initialConfig.itemTpl){this.itemTpl=new Ext.Template('<li class="{cls} gxp-crumb" id="{id}"><div class="gxp-crumb-separator">Â»</div>','<a class="x-tab-right" href="#"><em class="x-tab-left">','<span class="x-tab-strip-inner"><span class="x-tab-strip-text {iconCls}">{text}</span></span>',"</em></a></li>")}gxp.CrumbPanel.superclass.onRender.apply(this,arguments);this.getEl().down("div").addClass("gxp-crumbpanel-header")},onCmpHide:function(e){var t=this.items.getCount()-1;if(this.items.indexOf(e)===t){this.setActiveTab(this.get(--t))}},setActiveTab:function(e){var t;if(Ext.isNumber(e)){t=e;e=this.get(t)}else{t=this.items.indexOf(e)}if(~t){var i,r;for(r=this.items.getCount()-1;r>t;--r){i=this.get(r);this.remove(i,i.closeAction!=="hide")}}var a=e.initialConfig.minWidth||e.initialConfig.width,s=this.getWidth();if(a>s){this.widths[this.get(t-1).id]=s;this.setWidth(a);if(this.ownerCt){this.ownerCt.syncSize()}}gxp.CrumbPanel.superclass.setActiveTab.apply(this,arguments)}});Ext.reg("gxp_crumbpanel",gxp.CrumbPanel);Ext.namespace("gxp");gxp.LayerUploadPanel=Ext.extend(Ext.FormPanel,{titleLabel:gettext("Title"),titleEmptyText:gettext("Layer title"),abstractLabel:gettext("Description"),abstractEmptyText:gettext("Layer description"),fileLabel:gettext("Data"),fieldEmptyText:gettext("Browse for data archive..."),uploadText:gettext("Upload"),uploadFailedText:gettext("Upload failed"),processingUploadText:gettext("Processing upload..."),waitMsgText:gettext("Uploading your data..."),invalidFileExtensionText:gettext("File extension must be one of: "),optionsText:gettext("Options"),workspaceLabel:gettext("Workspace"),workspaceEmptyText:gettext("Default workspace"),dataStoreLabel:gettext("Store"),dataStoreEmptyText:gettext("Choose a store"),dataStoreNewText:gettext("Create new store"),crsLabel:gettext("CRS"),crsEmptyText:gettext("Coordinate Reference System ID"),invalidCrsText:gettext("CRS identifier should be an EPSG code (e.g. EPSG:4326)"),fileUpload:true,validFileExtensions:[".zip",".tif",".tiff",".gz",".tar.bz2",".tar",".tgz",".tbz2"],defaultDataStore:null,constructor:function(e){e.errorReader={read:e.handleUploadResponse||this.handleUploadResponse.createDelegate(this)};gxp.LayerUploadPanel.superclass.constructor.call(this,e)},selectedWorkspace:null,initComponent:function(){this.items=[{xtype:"textfield",name:"title",fieldLabel:this.titleLabel,emptyText:this.titleEmptyText,allowBlank:true},{xtype:"textarea",name:"abstract",fieldLabel:this.abstractLabel,emptyText:this.abstractEmptyText,allowBlank:true},{xtype:"fileuploadfield",id:"file",anchor:"90%",emptyText:this.fieldEmptyText,fieldLabel:this.fileLabel,name:"file",buttonText:gettext(""),buttonCfg:{iconCls:"gxp-icon-filebrowse"},listeners:{fileselected:function(e,t){e.setValue(t.split(/[/\\]/).pop())}},validator:this.fileNameValidator.createDelegate(this)},{xtype:"fieldset",ref:"optionsFieldset",title:this.optionsText,checkboxToggle:true,collapsed:true,hidden:this.workspace!=undefined&&this.store!=undefined&&this.crs!=undefined,hideMode:"offsets",defaults:{anchor:"97%"},items:[this.createWorkspacesCombo(),this.createDataStoresCombo(),{xtype:"textfield",name:"nativeCRS",fieldLabel:this.crsLabel,emptyText:this.crsEmptyText,allowBlank:true,regex:/^epsg:\d+$/i,regexText:this.invalidCrsText}],listeners:{collapse:function(e){e.items.each(function(e){e.reset()})}}}];this.buttons=[{text:this.uploadText,handler:function(){var t=this.getForm();if(t.isValid()){var e=t.getFieldValues(),i={import:{}};if(e.workspace){i["import"].targetWorkspace={workspace:{name:e.workspace}}}if(Ext.isEmpty(e.store)&&this.defaultDataStore){i["import"].targetStore={dataStore:{name:this.defaultDataStore}}}else if(!Ext.isEmpty(e.store)&&e.store!==this.dataStoreNewText){i["import"].targetStore={dataStore:{name:e.store}}}Ext.Ajax.request({url:this.getUploadUrl(),method:"POST",jsonData:i,success:function(e){this._import=e.getResponseHeader("Location");this.optionsFieldset.expand();t.submit({url:this._import+"/tasks?expand=all",waitMsg:this.waitMsgText,waitMsgTarget:true,reset:true,scope:this})},scope:this})}},scope:this}];this.addEvents("workspaceselected","datastoreselected","uploadcomplete");this.getDefaultDataStore("default");gxp.LayerUploadPanel.superclass.initComponent.call(this)},fileNameValidator:function(e){var t=false;var i,r=e.length;for(var a=0,s=this.validFileExtensions.length;a<s;++a){i=this.validFileExtensions[a];if(e.slice(-i.length).toLowerCase()===i){t=true;break}}return t||this.invalidFileExtensionText+"<br/>"+this.validFileExtensions.join(", ")},createWorkspacesCombo:function(){return{xtype:"combo",name:"workspace",ref:"../workspace",fieldLabel:this.workspaceLabel,store:new Ext.data.JsonStore({url:this.getWorkspacesUrl(),autoLoad:true,root:"workspaces.workspace",fields:["name","href"]}),displayField:"name",valueField:"name",mode:"local",allowBlank:true,triggerAction:"all",forceSelection:true,listeners:{select:function(e,t,i){this.getDefaultDataStore(t.get("name"));this.fireEvent("workspaceselected",this,t)},scope:this}}},createDataStoresCombo:function(){var r=new Ext.data.JsonStore({autoLoad:false,root:"dataStores.dataStore",fields:["name","href"]});this.on({workspaceselected:function(e,t){s.reset();var i=t.get("href");r.removeAll();r.proxy=new Ext.data.HttpProxy({url:i.split(".json").shift()+"/datastores.json"});r.proxy.on("loadexception",a,this);r.load()},scope:this});var a=function(){var e={name:this.dataStoreNewText};var t=new r.recordType(e);r.insert(0,t);r.proxy&&r.proxy.un("loadexception",a,this)};r.on("load",a,this);var s=new Ext.form.ComboBox({name:"store",ref:"../dataStore",emptyText:this.dataStoreEmptyText,fieldLabel:this.dataStoreLabel,store:r,displayField:"name",valueField:"name",mode:"local",allowBlank:true,triggerAction:"all",forceSelection:true,listeners:{select:function(e,t,i){this.fireEvent("datastoreselected",this,t)},scope:this}});return s},getDefaultDataStore:function(o){Ext.Ajax.request({url:this.url+"/workspaces/"+o+"/datastores/default.json",callback:function(e,t,i){this.defaultDataStore=null;if(i.status===200){var r=Ext.decode(i.responseText);if(o==="default"&&r.dataStore&&r.dataStore.workspace){this.workspace.setValue(r.dataStore.workspace.name);var a=this.workspace.store;var s={name:r.dataStore.workspace.name,href:r.dataStore.workspace.href};var n=new a.recordType(s);this.fireEvent("workspaceselected",this,n)}if(r.dataStore&&r.dataStore.enabled===true&&!/file/i.test(r.dataStore.type)){this.defaultDataStore=r.dataStore.name;this.dataStore.setValue(this.defaultDataStore)}}},scope:this})},getUploadUrl:function(){return this.url+"/imports"},getWorkspacesUrl:function(){return this.url+"/workspaces.json"},handleUploadResponse:function(e){var t=this.parseResponseText(e.responseText),i,r,a,s,n,o=this.getForm().getFieldValues(),l=!!t;if(t){if(typeof t==="string"){l=false;s=t}else{r=t.tasks||[t.task];if(r.length===0){l=false;s="Upload contains no suitable files."}else{for(n=r.length-1;n>=0;--n){a=r[n];if(!a){l=false;s="Unknown upload error"}else if(a.state==="NO_FORMAT"){l=false;s="Upload contains no suitable files."}else if(a.state==="NO_CRS"&&!o.nativeCRS){l=false;s="Coordinate Reference System (CRS) of source file "+a.data.file+" could not be determined. Please specify manually."}}}}}if(!l){i=[{data:{id:"file",msg:s||this.uploadFailedText}}]}else{var h=!!(o.title||o["abstract"]||o.nativeCRS);if(h&&r[0].target.dataStore){this.waitMsg=new Ext.LoadMask((this.ownerCt||this).getEl(),{msg:this.processingUploadText});this.waitMsg.show();var p={title:o.title||undefined,abstract:o["abstract"]||undefined,srs:o.nativeCRS||undefined};Ext.Ajax.request({method:"PUT",url:r[0].layer.href,jsonData:p,success:this.finishUpload,failure:function(t){if(this.waitMsg){this.waitMsg.hide()}var i=[];try{var e=Ext.decode(t.responseText);if(e.errors){for(var r=0,a=e.errors.length;r<a;++r){i.push({id:~e.errors[r].indexOf("SRS")?"nativeCRS":"file",msg:e.errors[r]})}}}catch(e){i.push({id:"file",msg:t.responseText})}this.getForm().markInvalid(i)},scope:this})}else{this.finishUpload()}}return{success:false,records:i}},finishUpload:function(){Ext.Ajax.request({method:"POST",url:this._import,failure:this.handleFailure,success:this.handleUploadSuccess,scope:this})},parseResponseText:function(t){var i;try{i=Ext.decode(t)}catch(e){var r=t.match(/^\s*<pre[^>]*>(.*)<\/pre>\s*/);if(r){try{i=Ext.decode(r[1])}catch(e){i=r[1]}}}return i},handleUploadSuccess:function(e){Ext.Ajax.request({method:"GET",url:this._import+"?expand=all",failure:this.handleFailure,success:function(e){if(this.waitMsg){this.waitMsg.hide()}this.getForm().reset();var t=Ext.decode(e.responseText);this.fireEvent("uploadcomplete",this,t);delete this._import},scope:this})},handleFailure:function(e){if(e&&e.status===1223){this.handleUploadSuccess(e)}else{if(this.waitMsg){this.waitMsg.hide()}this.getForm().markInvalid([{file:this.uploadFailedText}])}}});Ext.reg("gxp_layeruploadpanel",gxp.LayerUploadPanel);OpenLayers.Format.WKT=OpenLayers.Class(OpenLayers.Format,{initialize:function(e){this.regExes={typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,spaces:/\s+/,parenComma:/\)\s*,\s*\(/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,trimParens:/^\s*\(?(.*?)\)?\s*$/};OpenLayers.Format.prototype.initialize.apply(this,[e])},read:function(e){var t,i,r;e=e.replace(/[\n\r]/g," ");var a=this.regExes.typeStr.exec(e);if(a){i=a[1].toLowerCase();r=a[2];if(this.parse[i]){t=this.parse[i].apply(this,[r])}if(this.internalProjection&&this.externalProjection){if(t&&t.CLASS_NAME=="OpenLayers.Feature.Vector"){t.geometry.transform(this.externalProjection,this.internalProjection)}else if(t&&i!="geometrycollection"&&typeof t=="object"){for(var s=0,n=t.length;s<n;s++){var o=t[s];o.geometry.transform(this.externalProjection,this.internalProjection)}}}}return t},write:function(e){var t,i,r;if(e.constructor==Array){t=e;r=true}else{t=[e];r=false}var a=[];if(r){a.push("GEOMETRYCOLLECTION(")}for(var s=0,n=t.length;s<n;++s){if(r&&s>0){a.push(",")}i=t[s].geometry;a.push(this.extractGeometry(i))}if(r){a.push(")")}return a.join("")},extractGeometry:function(e){var t=e.CLASS_NAME.split(".")[2].toLowerCase();if(!this.extract[t]){return null}if(this.internalProjection&&this.externalProjection){e=e.clone();e.transform(this.internalProjection,this.externalProjection)}var i=t=="collection"?"GEOMETRYCOLLECTION":t.toUpperCase();var r=i+"("+this.extract[t].apply(this,[e])+")";return r},extract:{point:function(e){return e.x+" "+e.y},multipoint:function(e){var t=[];for(var i=0,r=e.components.length;i<r;++i){t.push("("+this.extract.point.apply(this,[e.components[i]])+")")}return t.join(",")},linestring:function(e){var t=[];for(var i=0,r=e.components.length;i<r;++i){t.push(this.extract.point.apply(this,[e.components[i]]))}return t.join(",")},multilinestring:function(e){var t=[];for(var i=0,r=e.components.length;i<r;++i){t.push("("+this.extract.linestring.apply(this,[e.components[i]])+")")}return t.join(",")},polygon:function(e){var t=[];for(var i=0,r=e.components.length;i<r;++i){t.push("("+this.extract.linestring.apply(this,[e.components[i]])+")")}return t.join(",")},multipolygon:function(e){var t=[];for(var i=0,r=e.components.length;i<r;++i){t.push("("+this.extract.polygon.apply(this,[e.components[i]])+")")}return t.join(",")},collection:function(e){var t=[];for(var i=0,r=e.components.length;i<r;++i){t.push(this.extractGeometry.apply(this,[e.components[i]]))}return t.join(",")}},parse:{point:function(e){var t=OpenLayers.String.trim(e).split(this.regExes.spaces);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(t[0],t[1]))},multipoint:function(e){var t;var i=OpenLayers.String.trim(e).split(",");var r=[];for(var a=0,s=i.length;a<s;++a){t=i[a].replace(this.regExes.trimParens,"$1");r.push(this.parse.point.apply(this,[t]).geometry)}return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.MultiPoint(r))},linestring:function(e){var t=OpenLayers.String.trim(e).split(",");var i=[];for(var r=0,a=t.length;r<a;++r){i.push(this.parse.point.apply(this,[t[r]]).geometry)}return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString(i))},multilinestring:function(e){var t;var i=OpenLayers.String.trim(e).split(this.regExes.parenComma);var r=[];for(var a=0,s=i.length;a<s;++a){t=i[a].replace(this.regExes.trimParens,"$1");r.push(this.parse.linestring.apply(this,[t]).geometry)}return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.MultiLineString(r))},polygon:function(e){var t,i,r;var a=OpenLayers.String.trim(e).split(this.regExes.parenComma);var s=[];for(var n=0,o=a.length;n<o;++n){t=a[n].replace(this.regExes.trimParens,"$1");i=this.parse.linestring.apply(this,[t]).geometry;r=new OpenLayers.Geometry.LinearRing(i.components);s.push(r)}return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon(s))},multipolygon:function(e){var t;var i=OpenLayers.String.trim(e).split(this.regExes.doubleParenComma);var r=[];for(var a=0,s=i.length;a<s;++a){t=i[a].replace(this.regExes.trimParens,"$1");r.push(this.parse.polygon.apply(this,[t]).geometry)}return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.MultiPolygon(r))},geometrycollection:function(e){e=e.replace(/,\s*([A-Za-z])/g,"|$1");var t=OpenLayers.String.trim(e).split("|");var i=[];for(var r=0,a=t.length;r<a;++r){i.push(OpenLayers.Format.WKT.prototype.read.apply(this,[t[r]]))}return i}},CLASS_NAME:"OpenLayers.Format.WKT"});OpenLayers.Format.CQL=function(){var t=["PROPERTY","COMPARISON","VALUE","LOGICAL"],p={PROPERTY:/^[_a-zA-Z]\w*/,COMPARISON:/^(=|<>|<=|<|>=|>|LIKE)/i,IS_NULL:/^IS NULL/i,COMMA:/^,/,LOGICAL:/^(AND|OR)/i,VALUE:/^('([^']|'')*'|\d+(\.\d*)?|\.\d+)/,LPAREN:/^\(/,RPAREN:/^\)/,SPATIAL:/^(BBOX|INTERSECTS|DWITHIN|WITHIN|CONTAINS)/i,NOT:/^NOT/i,BETWEEN:/^BETWEEN/i,GEOMETRY:function(e){var t=/^(POINT|LINESTRING|POLYGON|MULTIPOINT|MULTILINESTRING|MULTIPOLYGON|GEOMETRYCOLLECTION)/.exec(e);if(t){var i=e.length;var r=e.indexOf("(",t[0].length);if(r>-1){var a=1;while(r<i&&a>0){r++;switch(e.charAt(r)){case"(":a++;break;case")":a--;break;default:}}}return[e.substr(0,r+1)]}},END:/^$/},a={LPAREN:["GEOMETRY","SPATIAL","PROPERTY","VALUE","LPAREN"],RPAREN:["NOT","LOGICAL","END","RPAREN"],PROPERTY:["COMPARISON","BETWEEN","COMMA","IS_NULL"],BETWEEN:["VALUE"],IS_NULL:["END"],COMPARISON:["VALUE"],COMMA:["GEOMETRY","VALUE","PROPERTY"],VALUE:["LOGICAL","COMMA","RPAREN","END"],SPATIAL:["LPAREN"],LOGICAL:["NOT","VALUE","SPATIAL","PROPERTY","LPAREN"],NOT:["PROPERTY","LPAREN"],GEOMETRY:["COMMA","RPAREN"]},m={"=":OpenLayers.Filter.Comparison.EQUAL_TO,"<>":OpenLayers.Filter.Comparison.NOT_EQUAL_TO,"<":OpenLayers.Filter.Comparison.LESS_THAN,"<=":OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO,">":OpenLayers.Filter.Comparison.GREATER_THAN,">=":OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO,LIKE:OpenLayers.Filter.Comparison.LIKE,BETWEEN:OpenLayers.Filter.Comparison.BETWEEN,"IS NULL":OpenLayers.Filter.Comparison.IS_NULL},s={},v={AND:OpenLayers.Filter.Logical.AND,OR:OpenLayers.Filter.Logical.OR},n={},o={RPAREN:3,LOGICAL:2,COMPARISON:1};var e;for(e in m){if(m.hasOwnProperty(e)){s[m[e]]=e}}for(e in v){if(v.hasOwnProperty(e)){n[v[e]]=e}}function u(e,t){if(t instanceof RegExp){return t.exec(e)}else{return t(e)}}function l(e,t){var i,r,a=t.length;for(i=0;i<a;i++){r=t[i];var s=p[r];var n=u(e,s);if(n){var o=n[0];var l=e.substr(o.length).replace(/^\s*/,"");return{type:r,text:o,remainder:l}}}var h="ERROR: In parsing: ["+e+"], expected one of: ";for(i=0;i<a;i++){r=t[i];h+="\n    "+r+": "+p[r]}throw new Error(h)}function i(e){var t=[];var i,r=["NOT","GEOMETRY","SPATIAL","PROPERTY","LPAREN"];do{i=l(e,r);e=i.remainder;r=a[i.type];if(i.type!="END"&&!r){throw new Error("No follows list for "+i.type)}t.push(i)}while(i.type!="END");return t}function r(e){var t=[],y=[];while(e.length){var i=e.shift();switch(i.type){case"PROPERTY":case"GEOMETRY":case"VALUE":y.push(i);break;case"COMPARISON":case"BETWEEN":case"IS_NULL":case"LOGICAL":var r=o[i.type];while(t.length>0&&o[t[t.length-1].type]<=r){y.push(t.pop())}t.push(i);break;case"SPATIAL":case"NOT":case"LPAREN":t.push(i);break;case"RPAREN":while(t.length>0&&t[t.length-1].type!="LPAREN"){y.push(t.pop())}t.pop();if(t.length>0&&t[t.length-1].type=="SPATIAL"){y.push(t.pop())}case"COMMA":case"END":break;default:throw new Error("Unknown token type "+i.type)}}while(t.length>0){y.push(t.pop())}function g(){var e=y.pop();switch(e.type){case"LOGICAL":var t=g(),i=g();return new OpenLayers.Filter.Logical({filters:[i,t],type:v[e.text.toUpperCase()]});case"NOT":var r=g();return new OpenLayers.Filter.Logical({filters:[r],type:OpenLayers.Filter.Logical.NOT});case"BETWEEN":var a,s,n;y.pop();s=g();a=g();n=g();return new OpenLayers.Filter.Comparison({property:n,lowerBoundary:a,upperBoundary:s,type:OpenLayers.Filter.Comparison.BETWEEN});case"COMPARISON":var o=g(),n=g();return new OpenLayers.Filter.Comparison({property:n,value:o,type:m[e.text.toUpperCase()]});case"IS_NULL":var n=g();return new OpenLayers.Filter.Comparison({property:n,type:m[e.text.toUpperCase()]});case"VALUE":var l=e.text.match(/^'(.*)'$/);if(l){return l[1].replace(/''/g,"'")}else{return Number(e.text)}case"SPATIAL":switch(e.text.toUpperCase()){case"BBOX":var h=g(),p=g(),u=g(),c=g(),d=g();return new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.BBOX,property:d,value:OpenLayers.Bounds.fromArray([c,u,p,h])});case"INTERSECTS":var o=g(),n=g();return new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.INTERSECTS,property:n,value:o});case"WITHIN":var o=g(),n=g();return new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.WITHIN,property:n,value:o});case"CONTAINS":var o=g(),n=g();return new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.CONTAINS,property:n,value:o});case"DWITHIN":var f=g(),o=g(),n=g();return new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.DWITHIN,value:o,property:n,distance:Number(f)})}case"GEOMETRY":return OpenLayers.Geometry.fromWKT(e.text);default:return e.text}}var a=g();if(y.length>0){var s="Remaining tokens after building AST: \n";for(var n=y.length-1;n>=0;n--){s+=y[n].type+": "+y[n].text+"\n"}throw new Error(s)}return a}return OpenLayers.Class(OpenLayers.Format,{read:function(e){var t=r(i(e));if(this.keepData){this.data=t}return t},write:function(e){if(e instanceof OpenLayers.Geometry){return e.toString()}switch(e.CLASS_NAME){case"OpenLayers.Filter.Spatial":switch(e.type){case OpenLayers.Filter.Spatial.BBOX:return"BBOX("+e.property+","+e.value.toBBOX()+")";case OpenLayers.Filter.Spatial.DWITHIN:return"DWITHIN("+e.property+", "+this.write(e.value)+", "+e.distance+")";case OpenLayers.Filter.Spatial.WITHIN:return"WITHIN("+e.property+", "+this.write(e.value)+")";case OpenLayers.Filter.Spatial.INTERSECTS:return"INTERSECTS("+e.property+", "+this.write(e.value)+")";case OpenLayers.Filter.Spatial.CONTAINS:return"CONTAINS("+e.property+", "+this.write(e.value)+")";default:throw new Error("Unknown spatial filter type: "+e.type)}case"OpenLayers.Filter.Logical":if(e.type==OpenLayers.Filter.Logical.NOT){return"NOT ("+this.write(e.filters[0])+")"}else{var t="(";var i=true;for(var r=0;r<e.filters.length;r++){if(i){i=false}else{t+=") "+n[e.type]+" ("}t+=this.write(e.filters[r])}return t+")"}case"OpenLayers.Filter.Comparison":if(e.type==OpenLayers.Filter.Comparison.BETWEEN){return e.property+" BETWEEN "+this.write(e.lowerBoundary)+" AND "+this.write(e.upperBoundary)}else{return e.value!==null?e.property+" "+s[e.type]+" "+this.write(e.value):e.property+" "+s[e.type]}case undefined:if(typeof e==="string"){return"'"+e.replace(/'/g,"''")+"'"}else if(typeof e==="number"){return String(e)}default:throw new Error("Can't encode: "+e.CLASS_NAME+" "+e)}},CLASS_NAME:"OpenLayers.Format.CQL"})}();Ext.namespace("gxp");gxp.FilterBuilder=Ext.extend(Ext.Container,{builderTypeNames:["any","all","none","not all"],allowedBuilderTypes:null,allowBlank:false,caseInsensitiveMatch:false,preComboText:gettext("Match"),postComboText:gettext("of the following:"),cls:"gxp-filterbuilder",builderType:null,childFilterContainer:null,customizeFilterOnInit:true,addConditionText:gettext("add condition"),addGroupText:gettext("add group"),removeConditionText:gettext("remove condition"),allowGroups:true,initComponent:function(){var e={defaultBuilderType:gxp.FilterBuilder.ANY_OF};Ext.applyIf(this,e);if(this.customizeFilterOnInit){this.filter=this.customizeFilter(this.filter)}this.builderType=this.getBuilderType();this.items=[{xtype:"container",layout:"form",ref:"form",defaults:{anchor:"100%"},hideLabels:true,items:[{xtype:"compositefield",style:"padding-left: 2px",items:[{xtype:"label",style:"padding-top: 0.3em",text:this.preComboText},this.createBuilderTypeCombo(),{xtype:"label",style:"padding-top: 0.3em",text:this.postComboText}]},this.createChildFiltersPanel(),{xtype:"toolbar",items:this.createToolBar()}]}];this.addEvents("change");gxp.FilterBuilder.superclass.initComponent.call(this)},createToolBar:function(){var e=[{text:this.addConditionText,iconCls:"add",handler:function(){this.addCondition()},scope:this}];if(this.allowGroups){e.push({text:this.addGroupText,iconCls:"add",handler:function(){this.addCondition(true)},scope:this})}return e},getFilter:function(){var e;if(this.filter){e=this.filter.clone();if(e instanceof OpenLayers.Filter.Logical){e=this.cleanFilter(e)}}return e},cleanFilter:function(e){if(e instanceof OpenLayers.Filter.Logical){if(e.type!==OpenLayers.Filter.Logical.NOT&&e.filters.length===1){e=this.cleanFilter(e.filters[0])}else{var t;for(var i=0,r=e.filters.length;i<r;++i){t=e.filters[i];if(t instanceof OpenLayers.Filter.Logical){t=this.cleanFilter(t);if(t){e.filters[i]=t}else{e=t;break}}else if(!t||t.type===null||t.property===null||t[e.type===OpenLayers.Filter.Comparison.BETWEEN?"lowerBoundary":"value"]===null){e=false;break}}}}else{if(!e||e.type===null||e.property===null||e[e.type===OpenLayers.Filter.Comparison.BETWEEN?"lowerBoundary":"value"]===null){e=false}}return e},customizeFilter:function(e){if(!e){e=this.wrapFilter(this.createDefaultFilter())}else{e=this.cleanFilter(e);var t,i,r;switch(e.type){case OpenLayers.Filter.Logical.AND:case OpenLayers.Filter.Logical.OR:if(!e.filters||e.filters.length===0){e.filters=[this.createDefaultFilter()]}else{for(i=0,r=e.filters.length;i<r;++i){t=e.filters[i];if(t instanceof OpenLayers.Filter.Logical){e.filters[i]=this.customizeFilter(t)}}}e=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.OR,filters:[e]});break;case OpenLayers.Filter.Logical.NOT:if(!e.filters||e.filters.length===0){e.filters=[new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.OR,filters:[this.createDefaultFilter()]})]}else{t=e.filters[0];if(t instanceof OpenLayers.Filter.Logical){if(t.type!==OpenLayers.Filter.Logical.NOT){var a;for(i=0,r=t.filters.length;i<r;++i){a=t.filters[i];if(a instanceof OpenLayers.Filter.Logical){t.filters[i]=this.customizeFilter(a)}}}else{if(t.filters&&t.filters.length>0){e=this.customizeFilter(t.filters[0])}else{e=this.wrapFilter(this.createDefaultFilter())}}}else{var s;if(this.defaultBuilderType===gxp.FilterBuilder.NOT_ALL_OF){s=OpenLayers.Filter.Logical.AND}else{s=OpenLayers.Filter.Logical.OR}e.filters=[new OpenLayers.Filter.Logical({type:s,filters:[t]})]}}break;default:e=this.wrapFilter(e);break}}return e},createDefaultFilter:function(){return new OpenLayers.Filter.Comparison({matchCase:!this.caseInsensitiveMatch})},wrapFilter:function(e){var t;if(this.defaultBuilderType===gxp.FilterBuilder.ALL_OF){t=OpenLayers.Filter.Logical.AND}else{t=OpenLayers.Filter.Logical.OR}return new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.OR,filters:[new OpenLayers.Filter.Logical({type:t,filters:[e]})]})},addCondition:function(e){var t,i;if(e){i="gxp_filterbuilder";t=this.wrapFilter(this.createDefaultFilter())}else{i="gxp_filterfield";t=this.createDefaultFilter()}var r=this.newRow({xtype:i,filter:t,columnWidth:1,attributes:this.attributes,allowBlank:e?undefined:this.allowBlank,customizeFilterOnInit:e&&false,caseInsensitiveMatch:this.caseInsensitiveMatch,listeners:{change:function(){this.fireEvent("change",this)},scope:this}});this.childFilterContainer.add(r);this.filter.filters[0].filters.push(t);this.childFilterContainer.doLayout()},removeCondition:function(e,t){var i=this.filter.filters[0].filters;if(i.length>0){i.remove(t);this.childFilterContainer.remove(e,true)}if(i.length===0){this.addCondition()}this.fireEvent("change",this)},createBuilderTypeCombo:function(){var e=this.allowedBuilderTypes||[gxp.FilterBuilder.ANY_OF,gxp.FilterBuilder.ALL_OF,gxp.FilterBuilder.NONE_OF];var t=e.length;var i=new Array(t);var r;for(var a=0;a<t;++a){r=e[a];i[a]=[r,this.builderTypeNames[r]]}return{xtype:"combo",store:new Ext.data.SimpleStore({data:i,fields:["value","name"]}),value:this.builderType,ref:"../../builderTypeCombo",displayField:"name",valueField:"value",triggerAction:"all",mode:"local",listeners:{select:function(e,t){this.changeBuilderType(t.get("value"));this.fireEvent("change",this)},scope:this},width:60}},changeBuilderType:function(e){if(e!==this.builderType){this.builderType=e;var t=this.filter.filters[0];switch(e){case gxp.FilterBuilder.ANY_OF:this.filter.type=OpenLayers.Filter.Logical.OR;t.type=OpenLayers.Filter.Logical.OR;break;case gxp.FilterBuilder.ALL_OF:this.filter.type=OpenLayers.Filter.Logical.OR;t.type=OpenLayers.Filter.Logical.AND;break;case gxp.FilterBuilder.NONE_OF:this.filter.type=OpenLayers.Filter.Logical.NOT;t.type=OpenLayers.Filter.Logical.OR;break;case gxp.FilterBuilder.NOT_ALL_OF:this.filter.type=OpenLayers.Filter.Logical.NOT;t.type=OpenLayers.Filter.Logical.AND;break}}},createChildFiltersPanel:function(){this.childFilterContainer=new Ext.Container;var e=this.filter.filters[0].filters;var t;for(var i=0,r=e.length;i<r;++i){t=e[i];var a={xtype:"gxp_filterfield",allowBlank:this.allowBlank,columnWidth:1,filter:t,attributes:this.attributes,listeners:{change:function(){this.fireEvent("change",this)},scope:this}};var s=Ext.applyIf(t instanceof OpenLayers.Filter.Logical?{xtype:"gxp_filterbuilder"}:{xtype:"container",layout:"form",hideLabels:true,items:a},a);this.childFilterContainer.add(this.newRow(s))}return this.childFilterContainer},newRow:function(t){var i=new Ext.Container({layout:"column",items:[{xtype:"container",width:28,height:26,style:"padding-left: 2px",items:{xtype:"button",tooltip:this.removeConditionText,iconCls:"delete",handler:function(e){this.removeCondition(i,t.filter)},scope:this}},t]});return i},getBuilderType:function(){var e=this.defaultBuilderType;if(this.filter){var t=this.filter.filters[0];if(this.filter.type===OpenLayers.Filter.Logical.NOT){switch(t.type){case OpenLayers.Filter.Logical.OR:e=gxp.FilterBuilder.NONE_OF;break;case OpenLayers.Filter.Logical.AND:e=gxp.FilterBuilder.NOT_ALL_OF;break}}else{switch(t.type){case OpenLayers.Filter.Logical.OR:e=gxp.FilterBuilder.ANY_OF;break;case OpenLayers.Filter.Logical.AND:e=gxp.FilterBuilder.ALL_OF;break}}}return e},setFilter:function(e){this.filter=this.customizeFilter(e);this.changeBuilderType(this.getBuilderType());this.builderTypeCombo.setValue(this.builderType);this.form.remove(this.childFilterContainer);this.form.insert(1,this.createChildFiltersPanel());this.form.doLayout();this.fireEvent("change",this)}});gxp.FilterBuilder.ANY_OF=0;gxp.FilterBuilder.ALL_OF=1;gxp.FilterBuilder.NONE_OF=2;gxp.FilterBuilder.NOT_ALL_OF=3;Ext.reg("gxp_filterbuilder",gxp.FilterBuilder);Ext.namespace("gxp");gxp.WMSLayerPanel=Ext.extend(Ext.TabPanel,{layerRecord:null,source:null,styling:true,sameOriginStyling:true,rasterStyling:false,transparent:null,editableStyles:false,activeTab:0,border:false,imageFormats:/png|gif|jpe?g/i,aboutText:gettext("About"),titleText:gettext("Title"),attributionText:gettext("Attribution"),nameText:gettext("Name"),descriptionText:gettext("Description"),displayText:gettext("Display"),opacityText:gettext("Opacity"),formatText:gettext("Tile format"),infoFormatText:gettext("Info format"),infoFormatEmptyText:gettext("Select a format"),transparentText:gettext("Transparent"),cacheText:gettext("Caching"),cacheFieldText:gettext("Use cached tiles"),stylesText:gettext("Available Styles"),displayOptionsText:gettext("Display options"),queryText:gettext("Limit with filters"),scaleText:gettext("Limit by scale"),minScaleText:gettext("Min scale"),maxScaleText:gettext("Max scale"),switchToFilterBuilderText:gettext("Switch back to filter builder"),cqlPrefixText:gettext("or "),cqlText:gettext("use CQL filter instead"),singleTileText:gettext("Single tile"),singleTileFieldText:gettext("Use a single tile"),initComponent:function(){this.cqlFormat=new OpenLayers.Format.CQL;if(this.source){this.source.getSchema(this.layerRecord,function(e){if(e!==false){var t=this.layerRecord.getLayer().params.CQL_FILTER;this.filterBuilder=new gxp.FilterBuilder({filter:t&&this.cqlFormat.read(t),allowGroups:false,listeners:{afterrender:function(){this.filterBuilder.cascade(function(e){if(e.getXType()==="toolbar"){e.addText(this.cqlPrefixText);e.addButton({text:this.cqlText,handler:this.switchToCQL,scope:this})}},this)},change:function(e){var t=e.getFilter();var i=null;if(t!==false){i=this.cqlFormat.write(t)}this.layerRecord.getLayer().mergeNewParams({CQL_FILTER:i})},scope:this},attributes:e});this.filterFieldset.add(this.filterBuilder);this.filterFieldset.doLayout()}},this)}this.addEvents("change");this.items=[this.createAboutPanel(),this.createDisplayPanel()];if(this.styling&&gxp.WMSStylesDialog&&this.layerRecord.get("styles")){var e=this.layerRecord.get("restUrl");if(!e){e=(this.source||this.layerRecord.get("layer")).url.split("?").shift().replace(/\/(wms|ows)\/?$/,"/rest")}if(this.sameOriginStyling){this.editableStyles=e.charAt(0)==="/"}else{this.editableStyles=true}this.items.push(this.createStylesPanel(e))}gxp.WMSLayerPanel.superclass.initComponent.call(this)},switchToCQL:function(){var e=this.filterBuilder.getFilter();var t="";if(e!==false){t=this.cqlFormat.write(e)}this.filterBuilder.hide();this.cqlField.setValue(t);this.cqlField.show();this.cqlToolbar.show()},switchToFilterBuilder:function(){var e=null;try{e=this.cqlFormat.read(this.cqlField.getValue())}catch(e){}this.cqlField.hide();this.cqlToolbar.hide();this.filterBuilder.show();if(e!==null){this.filterBuilder.setFilter(e)}},createStylesPanel:function(e){var t=gxp.WMSStylesDialog.createGeoServerStylerConfig(this.layerRecord,e);if(this.rasterStyling===true){t.plugins.push({ptype:"gxp_wmsrasterstylesdialog"})}var i=this.ownerCt;if(!(i.ownerCt instanceof Ext.Window)){t.dialogCls=Ext.Panel;t.showDlg=function(e){e.layout="fit";e.autoHeight=false;i.add(e)}}return Ext.apply(t,{title:this.stylesText,style:"padding: 10px",editable:false})},createAboutPanel:function(){return{title:this.aboutText,bodyStyle:{padding:"10px"},defaults:{border:false},items:[{layout:"form",labelWidth:70,items:[{xtype:"textfield",fieldLabel:this.titleText,anchor:"99%",value:this.layerRecord.get("title"),listeners:{change:function(e){this.layerRecord.set("title",e.getValue());this.layerRecord.commit();this.fireEvent("change")},scope:this}},{xtype:"textfield",fieldLabel:this.nameText,anchor:"99%",value:this.layerRecord.get("name"),readOnly:true},{xtype:"textfield",fieldLabel:this.attributionText,anchor:"99%",listeners:{change:function(e){var t=this.layerRecord.getLayer();t.attribution=e.getValue();t.map.events.triggerEvent("changelayer",{layer:t,property:"attribution"});this.fireEvent("change")},scope:this},value:this.layerRecord.getLayer().attribution}]},{layout:"form",labelAlign:"top",items:[{xtype:"textarea",fieldLabel:this.descriptionText,grow:true,growMax:150,anchor:"99%",value:this.layerRecord.get("abstract"),readOnly:true}]}]}},onFormatChange:function(e){var t=this.layerRecord.getLayer();var i=e.getValue();t.mergeNewParams({format:i});var r=this.transparentCb;if(i=="image/jpeg"){this.transparent=r.getValue();r.setValue(false)}else if(this.transparent!==null){r.setValue(this.transparent);this.transparent=null}r.setDisabled(i=="image/jpeg");this.fireEvent("change")},addScaleOptions:function(e,t){e.alwaysInRange=null;e.addOptions(t);e.display();e.redraw()},createDisplayPanel:function(){var i=this.layerRecord;var r=i.getLayer();var e=r.opacity;if(e==null){e=1}var t=[];var a=r.params["FORMAT"].toLowerCase();Ext.each(i.get("formats"),function(e){if(this.imageFormats.test(e)){t.push(e.toLowerCase())}},this);if(t.indexOf(a)===-1){t.push(a)}var s=r.params["TRANSPARENT"];s=s==="true"||s===true;return{title:this.displayText,layout:"form",bodyStyle:{padding:"10px"},defaults:{labelWidth:70},items:[{xtype:"fieldset",title:this.displayOptionsText,items:[{xtype:"gx_opacityslider",name:"opacity",anchor:"99%",isFormField:true,fieldLabel:this.opacityText,listeners:{change:function(){this.fireEvent("change")},scope:this},layer:this.layerRecord},{xtype:"compositefield",fieldLabel:this.formatText,anchor:"99%",items:[{xtype:"combo",width:90,listWidth:150,store:t,value:a,mode:"local",triggerAction:"all",editable:false,listeners:{select:this.onFormatChange,scope:this}},{xtype:"checkbox",ref:"../../../transparentCb",checked:s,listeners:{check:function(e,t){r.mergeNewParams({transparent:t?"true":"false"});this.fireEvent("change")},scope:this}},{xtype:"label",cls:"gxp-layerproperties-label",text:this.transparentText}]},{xtype:"compositefield",fieldLabel:this.singleTileText,anchor:"99%",items:[{xtype:"checkbox",checked:this.layerRecord.get("layer").singleTile,listeners:{check:function(e,t){r.addOptions({singleTile:t});this.fireEvent("change")},scope:this}},{xtype:"label",cls:"gxp-layerproperties-label",text:this.singleTileFieldText}]},{xtype:"compositefield",anchor:"99%",hidden:this.layerRecord.get("layer").params.TILED==null,fieldLabel:this.cacheText,items:[{xtype:"checkbox",checked:this.layerRecord.get("layer").params.TILED===true,listeners:{check:function(e,t){var i=this.layerRecord.get("layer");i.mergeNewParams({TILED:t});this.fireEvent("change")},scope:this}},{xtype:"label",cls:"gxp-layerproperties-label",text:this.cacheFieldText}]},{xtype:"combo",fieldLabel:this.infoFormatText,emptyText:this.infoFormatEmptyText,store:i.get("infoFormats"),value:i.get("infoFormat"),hidden:i.get("infoFormats")===undefined,mode:"local",listWidth:150,triggerAction:"all",editable:false,anchor:"99%",listeners:{select:function(e){var t=e.getValue();i.set("infoFormat",t);this.fireEvent("change")}},scope:this}]},{xtype:"fieldset",title:this.queryText,hideLabels:true,ref:"../filterFieldset",listeners:{expand:function(){this.layerRecord.getLayer().mergeNewParams({CQL_FILTER:this.cqlFilter})},collapse:function(){this.cqlFilter=this.layerRecord.getLayer().params.CQL_FILTER;this.layerRecord.getLayer().mergeNewParams({CQL_FILTER:null})},scope:this},hidden:this.source===null,checkboxToggle:true,collapsed:!this.layerRecord.getLayer().params.CQL_FILTER,items:[{xtype:"textarea",value:this.layerRecord.getLayer().params.CQL_FILTER,grow:true,anchor:"99%",width:"100%",growMax:100,ref:"../../cqlField",hidden:true}],buttons:[{ref:"../../../cqlToolbar",hidden:true,text:this.switchToFilterBuilderText,handler:this.switchToFilterBuilder,scope:this}]},{xtype:"fieldset",title:this.scaleText,listeners:{expand:function(){var e=this.layerRecord.getLayer();if(this.minScale!==undefined||this.maxScale!==undefined){this.addScaleOptions(e,{minScale:this.maxScale,maxScale:this.minScale})}},collapse:function(){var e=this.layerRecord.getLayer();this.minScale=e.options.maxScale;this.maxScale=e.options.minScale;this.addScaleOptions(e,{minScale:null,maxScale:null})},scope:this},checkboxToggle:true,collapsed:this.layerRecord.getLayer().options.maxScale==null&&this.layerRecord.getLayer().options.minScale==null,items:[{xtype:"compositefield",fieldLabel:this.minScaleText,items:[{xtype:"label",text:gettext("1:"),cls:"gxp-layerproperties-label"},{xtype:"numberfield",anchor:"99%",width:"85%",listeners:{change:function(e){var t={maxScale:parseInt(e.getValue())};var i=this.layerRecord.getLayer();this.addScaleOptions(i,t)},scope:this},value:this.layerRecord.getLayer().options.maxScale}]},{xtype:"compositefield",fieldLabel:this.maxScaleText,items:[{xtype:"label",text:gettext("1:"),cls:"gxp-layerproperties-label"},{xtype:"numberfield",anchor:"99%",width:"85%",listeners:{change:function(e){var t={minScale:parseInt(e.getValue())};var i=this.layerRecord.getLayer();this.addScaleOptions(i,t)},scope:this},value:this.layerRecord.getLayer().options.minScale}]}]}]}}});Ext.reg("gxp_wmslayerpanel",gxp.WMSLayerPanel);Ext.namespace("gxp.form");gxp.form.FilterField=Ext.extend(Ext.form.CompositeField,{lowerBoundaryTip:gettext("lower boundary"),upperBoundaryTip:gettext("upper boundary"),caseInsensitiveMatch:false,filter:null,attributes:null,attributesComboConfig:null,initComponent:function(){if(!this.filter){this.filter=this.createDefaultFilter()}var e="remote",i=new GeoExt.data.AttributeStore;if(this.attributes){if(this.attributes.getCount()!=0){e="local";this.attributes.each(function(e){var t=/gml:((Multi)?(Point|Line|Polygon|Curve|Surface|Geometry)).*/.exec(e.get("type"));t||i.add([e])})}else{i=this.attributes}}var t={xtype:"combo",store:i,editable:e=="local",typeAhead:true,forceSelection:true,mode:e,triggerAction:"all",ref:"property",allowBlank:this.allowBlank,displayField:"name",valueField:"name",value:this.filter.property,listeners:{select:function(e,t){this.items.get(1).enable();this.filter.property=t.get("name");this.fireEvent("change",this.filter,this)},blur:function(e){var t=e.store.findExact("name",e.getValue());if(t!=-1){e.fireEvent("select",e,e.store.getAt(t))}else if(e.startValue!=null){e.setValue(e.startValue)}},scope:this},width:120};this.attributesComboConfig=this.attributesComboConfig||{};Ext.applyIf(this.attributesComboConfig,t);this.items=this.createFilterItems();this.addEvents("change");gxp.form.FilterField.superclass.initComponent.call(this)},validateValue:function(e,t){if(this.filter.type===OpenLayers.Filter.Comparison.BETWEEN){return this.filter.property!==null&&this.filter.upperBoundary!==null&&this.filter.lowerBoundary!==null}else{return this.filter.property!==null&&this.filter.value!==null&&this.filter.type!==null}},createDefaultFilter:function(){return new OpenLayers.Filter.Comparison({matchCase:!this.caseInsensitiveMatch})},createFilterItems:function(){var e=this.filter.type===OpenLayers.Filter.Comparison.BETWEEN;return[this.attributesComboConfig,Ext.applyIf({xtype:"gxp_comparisoncombo",ref:"type",disabled:this.filter.property==null,allowBlank:this.allowBlank,value:this.filter.type,listeners:{select:function(e,t){this.items.get(2).enable();this.items.get(3).enable();this.items.get(4).enable();this.setFilterType(t.get("value"));this.fireEvent("change",this.filter,this)},scope:this}},this.comparisonComboConfig),{xtype:"textfield",disabled:this.filter.type==null,hidden:e,ref:"value",value:this.filter.value,width:50,grow:true,growMin:50,anchor:"100%",allowBlank:this.allowBlank,listeners:{change:function(e,t){this.filter.value=t;this.fireEvent("change",this.filter,this)},scope:this}},{xtype:"textfield",disabled:this.filter.type==null,hidden:!e,value:this.filter.lowerBoundary,tooltip:this.lowerBoundaryTip,grow:true,growMin:30,ref:"lowerBoundary",anchor:"100%",allowBlank:this.allowBlank,listeners:{change:function(e,t){this.filter.lowerBoundary=t;this.fireEvent("change",this.filter,this)},render:function(e){Ext.QuickTips.register({target:e.getEl(),text:this.lowerBoundaryTip})},autosize:function(e,t){e.setWidth(t);e.ownerCt.doLayout()},scope:this}},{xtype:"textfield",disabled:this.filter.type==null,hidden:!e,grow:true,growMin:30,ref:"upperBoundary",value:this.filter.upperBoundary,allowBlank:this.allowBlank,listeners:{change:function(e,t){this.filter.upperBoundary=t;this.fireEvent("change",this.filter,this)},render:function(e){Ext.QuickTips.register({target:e.getEl(),text:this.upperBoundaryTip})},scope:this}}]},setFilterType:function(e){this.filter.type=e;if(e===OpenLayers.Filter.Comparison.BETWEEN){this.items.get(2).hide();this.items.get(3).show();this.items.get(4).show()}else{this.items.get(2).show();this.items.get(3).hide();this.items.get(4).hide()}this.doLayout()},setFilter:function(e){var t=this.filter.type;this.filter=e;if(t!==e.type){this.setFilterType(e.type)}this["property"].setValue(e.property);this["type"].setValue(e.type);if(e.type===OpenLayers.Filter.Comparison.BETWEEN){this["lowerBoundary"].setValue(e.lowerBoundary);this["upperBoundary"].setValue(e.upperBoundary)}else{this["value"].setValue(e.value)}this.fireEvent("change",this.filter,this)}});Ext.reg("gxp_filterfield",gxp.form.FilterField);Ext.namespace("gxp.form");gxp.form.ComparisonComboBox=Ext.extend(Ext.form.ComboBox,{allowedTypes:[[OpenLayers.Filter.Comparison.EQUAL_TO,"="],[OpenLayers.Filter.Comparison.NOT_EQUAL_TO,"<>"],[OpenLayers.Filter.Comparison.LESS_THAN,"<"],[OpenLayers.Filter.Comparison.GREATER_THAN,">"],[OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO,"<="],[OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO,">="],[OpenLayers.Filter.Comparison.LIKE,"like"],[OpenLayers.Filter.Comparison.BETWEEN,"between"]],allowBlank:false,mode:"local",typeAhead:true,forceSelection:true,triggerAction:"all",width:50,editable:true,initComponent:function(){var e={displayField:"name",valueField:"value",store:new Ext.data.SimpleStore({data:this.allowedTypes,fields:["value","name"]}),value:this.value===undefined?this.allowedTypes[0][0]:this.value,listeners:{blur:function(){var e=this.store.findExact("value",this.getValue());if(e!=-1){this.fireEvent("select",this,this.store.getAt(e))}else if(this.startValue!=null){this.setValue(this.startValue)}}}};Ext.applyIf(this,e);gxp.form.ComparisonComboBox.superclass.initComponent.call(this)}});Ext.reg("gxp_comparisoncombo",gxp.form.ComparisonComboBox);Ext.namespace("GeoExt");GeoExt.LayerOpacitySlider=Ext.extend(Ext.slider.SingleSlider,{layer:null,complementaryLayer:null,delay:5,changeVisibilityDelay:5,aggressive:false,changeVisibility:false,value:null,inverse:false,constructor:function(e){if(e.layer){this.layer=this.getLayer(e.layer);this.bind();this.complementaryLayer=this.getLayer(e.complementaryLayer);if(e.inverse!==undefined){this.inverse=e.inverse}e.value=e.value!==undefined?e.value:this.getOpacityValue(this.layer);delete e.layer;delete e.complementaryLayer}GeoExt.LayerOpacitySlider.superclass.constructor.call(this,e)},bind:function(){if(this.layer&&this.layer.map){this.layer.map.events.on({changelayer:this.update,scope:this})}},unbind:function(){if(this.layer&&this.layer.map&&this.layer.map.events){this.layer.map.events.un({changelayer:this.update,scope:this})}},update:function(e){if(e.property==="opacity"&&e.layer==this.layer&&!this._settingOpacity){this.setValue(this.getOpacityValue(this.layer))}},setLayer:function(e){this.unbind();this.layer=this.getLayer(e);this.setValue(this.getOpacityValue(e));this.bind()},getOpacityValue:function(e){var t;if(e&&e.opacity!==null){t=parseInt(e.opacity*(this.maxValue-this.minValue))}else{t=this.maxValue}if(this.inverse===true){t=this.maxValue-this.minValue-t}return t},getLayer:function(e){if(e instanceof OpenLayers.Layer){return e}else if(e instanceof GeoExt.data.LayerRecord){return e.getLayer()}},initComponent:function(){GeoExt.LayerOpacitySlider.superclass.initComponent.call(this);if(this.changeVisibility&&this.layer&&(this.layer.opacity==0||this.inverse===false&&this.value==this.minValue||this.inverse===true&&this.value==this.maxValue)){this.layer.setVisibility(false)}if(this.complementaryLayer&&(this.layer&&this.layer.opacity==1||this.inverse===false&&this.value==this.maxValue||this.inverse===true&&this.value==this.minValue)){this.complementaryLayer.setVisibility(false)}if(this.aggressive===true){this.on("change",this.changeLayerOpacity,this,{buffer:this.delay})}else{this.on("changecomplete",this.changeLayerOpacity,this)}if(this.changeVisibility===true){this.on("change",this.changeLayerVisibility,this,{buffer:this.changeVisibilityDelay})}if(this.complementaryLayer){this.on("change",this.changeComplementaryLayerVisibility,this,{buffer:this.changeVisibilityDelay})}this.on("beforedestroy",this.unbind,this)},changeLayerOpacity:function(e,t){if(this.layer){t=t/(this.maxValue-this.minValue);if(this.inverse===true){t=1-t}this._settingOpacity=true;this.layer.setOpacity(t);delete this._settingOpacity}},changeLayerVisibility:function(e,t){var i=this.layer.getVisibility();if(this.inverse===false&&t==this.minValue||this.inverse===true&&t==this.maxValue&&i===true){this.layer.setVisibility(false)}else if(this.inverse===false&&t>this.minValue||this.inverse===true&&t<this.maxValue&&i==false){this.layer.setVisibility(true)}},changeComplementaryLayerVisibility:function(e,t){var i=this.complementaryLayer.getVisibility();if(this.inverse===false&&t==this.maxValue||this.inverse===true&&t==this.minValue&&i===true){this.complementaryLayer.setVisibility(false)}else if(this.inverse===false&&t<this.maxValue||this.inverse===true&&t>this.minValue&&i==false){this.complementaryLayer.setVisibility(true)}},addToMapPanel:function(t){this.on({render:function(){var e=this.getEl();e.setStyle({position:"absolute",zIndex:t.map.Z_INDEX_BASE.Control});e.on({mousedown:this.stopMouseEvents,click:this.stopMouseEvents})},scope:this})},removeFromMapPanel:function(e){var t=this.getEl();t.un({mousedown:this.stopMouseEvents,click:this.stopMouseEvents,scope:this});this.unbind()},stopMouseEvents:function(e){e.stopEvent()}});Ext.reg("gx_opacityslider",GeoExt.LayerOpacitySlider);Ext.namespace("GeoExt");GeoExt.SliderTip=Ext.extend(Ext.slider.Tip,{hover:true,minWidth:10,offsets:[0,-10],dragging:false,init:function(e){GeoExt.SliderTip.superclass.init.apply(this,arguments);if(this.hover){e.on("render",this.registerThumbListeners,this)}this.slider=e},registerThumbListeners:function(){var e,t;for(var i=0,r=this.slider.thumbs.length;i<r;++i){e=this.slider.thumbs[i];t=e.tracker.el;(function(t,e){e.on({mouseover:function(e){this.onSlide(this.slider,e,t);this.dragging=false},mouseout:function(){if(!this.dragging){this.hide.apply(this,arguments)}},scope:this})}).apply(this,[e,t])}},onSlide:function(e,t,i){this.dragging=true;return GeoExt.SliderTip.superclass.onSlide.apply(this,arguments)}});Ext.namespace("GeoExt");GeoExt.LayerOpacitySliderTip=Ext.extend(GeoExt.SliderTip,{template:"<div>{opacity}%</div>",compiledTemplate:null,init:function(e){this.compiledTemplate=new Ext.Template(this.template);GeoExt.LayerOpacitySliderTip.superclass.init.call(this,e)},getText:function(e){var t={opacity:e.value};return this.compiledTemplate.apply(t)}});Ext.namespace("gxp");gxp.GoogleEarthPanel=Ext.extend(Ext.Panel,{HORIZONTAL_FIELD_OF_VIEW:30*Math.PI/180,map:null,mapPanel:null,layers:null,earth:null,projection:null,layerCache:null,initComponent:function(){this.addEvents("beforeadd","pluginfailure","pluginready");gxp.GoogleEarthPanel.superclass.initComponent.call(this);var e=this.mapPanel;if(e&&!(e instanceof GeoExt.MapPanel)){e=Ext.getCmp(e)}if(!e){throw new Error("Could not get map panel from config: "+this.mapPanel)}this.map=e.map;this.layers=e.layers;this.projection=new OpenLayers.Projection("EPSG:4326");this.on("render",this.onRenderEvent,this);this.on("show",this.onShowEvent,this);this.on("hide",function(){if(this.earth!=null){this.updateMap()}this.body.dom.innerHTML="";this.earth=null},this)},onEarthReady:function(e){this.earth=e;if(this.flyToSpeed===undefined){this.earth.getOptions().setFlyToSpeed(this.earth.SPEED_TELEPORT)}else if(this.flyToSpeed!==null){this.earth.getOptions().setFlyToSpeed(this.flyToSpeed)}this.resetCamera();this.setExtent(this.map.getExtent());this.earth.getNavigationControl().setVisibility(this.earth.VISIBILITY_SHOW);var t=this.earth.getNavigationControl().getScreenXY();t.setXUnits(this.earth.UNITS_PIXELS);t.setYUnits(this.earth.UNITS_INSET_PIXELS);this.earth.getWindow().setVisibility(true);this.layers.each(function(e){this.addLayer(e)},this);this.layers.on("remove",this.updateLayers,this);this.layers.on("update",this.updateLayers,this);this.layers.on("add",this.updateLayers,this);this.fireEvent("pluginready",this.earth)},onRenderEvent:function(){var e=this.ownerCt&&this.ownerCt.layout instanceof Ext.layout.CardLayout;if(!this.hidden&&!e){this.onShowEvent()}},onShowEvent:function(){if(this.rendered){this.layerCache={};google.earth.createInstance(this.body.dom,this.onEarthReady.createDelegate(this),function(e){this.fireEvent("pluginfailure",this,e)}.createDelegate(this))}},beforeDestroy:function(){this.layers.un("remove",this.updateLayers,this);this.layers.un("update",this.updateLayers,this);this.layers.un("add",this.updateLayers,this);gxp.GoogleEarthPanel.superclass.beforeDestroy.call(this)},updateLayers:function(){if(!this.earth)return;var e=this.earth.getFeatures();var t=e.getFirstChild();while(t!=null){e.removeChild(t);t=e.getFirstChild()}this.layers.each(function(e){this.addLayer(e)},this)},addLayer:function(e,t){var i=e.getLayer();var r=i&&i.url;if(this.earth&&i instanceof OpenLayers.Layer.WMS&&typeof r=="string"){var a=this.fireEvent("beforeadd",e);if(a!==false){var s=i.id;var n;if(this.layerCache[s]){n=this.layerCache[s]}else{var o=this.earth.createLink("kl_"+s);r=r.replace(/\?.*/,"");var l=i.params;var h="/kml?mode=refresh&layers="+l.LAYERS+"&styles="+l.STYLES;o.setHref(r+h);n=this.earth.createNetworkLink("nl_"+s);n.setName(s);n.set(o,false,false);this.layerCache[s]=n}n.setVisibility(i.getVisibility());if(t!==undefined&&t<this.earth.getFeatures().getChildNodes().getLength()){this.earth.getFeatures().insertBefore(this.earth.getFeatures().getChildNodes().item(t))}else{this.earth.getFeatures().appendChild(n)}}}},setExtent:function(e){e=e.transform(this.map.getProjectionObject(),this.projection);var t=e.getCenterLonLat();var i=this.getExtentWidth(e);var r=i/(2*Math.tan(this.HORIZONTAL_FIELD_OF_VIEW));var a=this.earth.getView().copyAsLookAt(this.earth.ALTITUDE_RELATIVE_TO_GROUND);a.setLatitude(t.lat);a.setLongitude(t.lon);a.setRange(r);this.earth.getView().setAbstractView(a)},resetCamera:function(){var e=this.earth.getView().copyAsCamera(this.earth.ALTITUDE_RELATIVE_TO_GROUND);e.setRoll(0);e.setHeading(0);e.setTilt(0);this.earth.getView().setAbstractView(e)},getExtent:function(){var e=this.earth.getView().getViewportGlobeBounds();var t=new OpenLayers.Bounds(e.getWest(),e.getSouth(),e.getEast(),e.getNorth());return t},updateMap:function(){var e=this.earth.getView().copyAsLookAt(this.earth.ALTITUDE_RELATIVE_TO_GROUND);var t=this.reprojectToMap(new OpenLayers.LonLat(e.getLongitude(),e.getLatitude()));var i=this.reprojectToMap(this.getExtent());this.map.zoomToExtent(i,true);this.map.setCenter(t);var r=e.getRange();var a=2*r*Math.tan(this.HORIZONTAL_FIELD_OF_VIEW);var s=this.map.getResolutionForZoom(this.map.getZoom()+1);var n=this.map.getExtent();var o=new OpenLayers.Bounds(t.lon-this.map.getSize().w/2*s,t.lat+this.map.getSize().h/2*s,t.lon+this.map.getSize().w/2*s,t.lat-this.map.getSize().h/2*s);var l=Math.abs(this.getExtentWidth(n)-a);var h=Math.abs(this.getExtentWidth(o)-a);if(h<l){this.map.zoomTo(this.map.getZoom()+1)}},getExtentWidth:function(e){var t=e.getCenterLonLat();var i=new OpenLayers.LonLat(e.left,t.lat);var r=new OpenLayers.LonLat(e.right,t.lat);return OpenLayers.Util.distVincenty(i,r)*1e3},reprojectToGE:function(e){return e.clone().transform(this.map.getProjectionObject(),this.projection)},reprojectToMap:function(e){return e.clone().transform(this.projection,this.map.getProjectionObject())}});Ext.reg("gxp_googleearthpanel",gxp.GoogleEarthPanel);OpenLayers.Control.Attribution=OpenLayers.Class(OpenLayers.Control,{separator:" ",template:"${layers}",destroy:function(){this.map.events.un({removelayer:this.updateAttribution,addlayer:this.updateAttribution,changelayer:this.updateAttribution,changebaselayer:this.updateAttribution,scope:this});OpenLayers.Control.prototype.destroy.apply(this,arguments)},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);this.map.events.on({changebaselayer:this.updateAttribution,changelayer:this.updateAttribution,addlayer:this.updateAttribution,removelayer:this.updateAttribution,scope:this});this.updateAttribution();return this.div},updateAttribution:function(){var e=[];if(this.map&&this.map.layers){for(var t=0,i=this.map.layers.length;t<i;t++){var r=this.map.layers[t];if(r.attribution&&r.getVisibility()){if(OpenLayers.Util.indexOf(e,r.attribution)===-1){e.push(r.attribution)}}}this.div.innerHTML=OpenLayers.String.format(this.template,{layers:e.join(this.separator)})}},CLASS_NAME:"OpenLayers.Control.Attribution"});OpenLayers.Events.buttonclick=OpenLayers.Class({target:null,events:["mousedown","mouseup","click","dblclick","touchstart","touchmove","touchend","keydown"],startRegEx:/^mousedown|touchstart$/,cancelRegEx:/^touchmove$/,completeRegEx:/^mouseup|touchend$/,initialize:function(e){this.target=e;for(var t=this.events.length-1;t>=0;--t){this.target.register(this.events[t],this,this.buttonClick,{extension:true})}},destroy:function(){for(var e=this.events.length-1;e>=0;--e){this.target.unregister(this.events[e],this,this.buttonClick)}delete this.target},getPressedButton:function(e){var t=3,i;do{if(OpenLayers.Element.hasClass(e,"olButton")){i=e;break}e=e.parentNode}while(--t>0&&e);return i},ignore:function(e){var t=3,i=false;do{if(e.nodeName.toLowerCase()==="a"){i=true;break}e=e.parentNode}while(--t>0&&e);return i},buttonClick:function(e){var t=true,i=OpenLayers.Event.element(e);if(i&&(OpenLayers.Event.isLeftClick(e)||!~e.type.indexOf("mouse"))){var r=this.getPressedButton(i);if(r){if(e.type==="keydown"){switch(e.keyCode){case OpenLayers.Event.KEY_RETURN:case OpenLayers.Event.KEY_SPACE:this.target.triggerEvent("buttonclick",{buttonElement:r});OpenLayers.Event.stop(e);t=false;break}}else if(this.startEvt){if(this.completeRegEx.test(e.type)){var a=OpenLayers.Util.pagePosition(r);var s=OpenLayers.Util.getViewportElement();var n=window.pageYOffset||s.scrollTop;var o=window.pageXOffset||s.scrollLeft;a[0]=a[0]-o;a[1]=a[1]-n;this.target.triggerEvent("buttonclick",{buttonElement:r,buttonXY:{x:this.startEvt.clientX-a[0],y:this.startEvt.clientY-a[1]}})}if(this.cancelRegEx.test(e.type)){delete this.startEvt}OpenLayers.Event.stop(e);t=false}if(this.startRegEx.test(e.type)){this.startEvt=e;OpenLayers.Event.stop(e);t=false}}else{t=!this.ignore(OpenLayers.Event.element(e));delete this.startEvt}}return t}});OpenLayers.Control.Panel=OpenLayers.Class(OpenLayers.Control,{controls:null,autoActivate:true,defaultControl:null,saveState:false,allowDepress:false,activeState:null,initialize:function(e){OpenLayers.Control.prototype.initialize.apply(this,[e]);this.controls=[];this.activeState={}},destroy:function(){if(this.map){this.map.events.unregister("buttonclick",this,this.onButtonClick)}OpenLayers.Control.prototype.destroy.apply(this,arguments);for(var e,t=this.controls.length-1;t>=0;t--){e=this.controls[t];if(e.events){e.events.un({activate:this.iconOn,deactivate:this.iconOff})}e.panel_div=null}this.activeState=null},activate:function(){if(OpenLayers.Control.prototype.activate.apply(this,arguments)){var e;for(var t=0,i=this.controls.length;t<i;t++){e=this.controls[t];if(e===this.defaultControl||this.saveState&&this.activeState[e.id]){e.activate()}}if(this.saveState===true){this.defaultControl=null}this.redraw();return true}else{return false}},deactivate:function(){if(OpenLayers.Control.prototype.deactivate.apply(this,arguments)){var e;for(var t=0,i=this.controls.length;t<i;t++){e=this.controls[t];this.activeState[e.id]=e.deactivate()}this.redraw();return true}else{return false}},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);if(this.outsideViewport){this.events.attachToElement(this.div);this.events.register("buttonclick",this,this.onButtonClick)}else{this.map.events.register("buttonclick",this,this.onButtonClick)}this.addControlsToMap(this.controls);return this.div},redraw:function(){for(var e=this.div.childNodes.length,t=e-1;t>=0;t--){this.div.removeChild(this.div.childNodes[t])}this.div.innerHTML="";if(this.active){for(var t=0,i=this.controls.length;t<i;t++){this.div.appendChild(this.controls[t].panel_div)}}},activateControl:function(e){if(!this.active){return false}if(e.type==OpenLayers.Control.TYPE_BUTTON){e.trigger();return}if(e.type==OpenLayers.Control.TYPE_TOGGLE){if(e.active){e.deactivate()}else{e.activate()}return}if(this.allowDepress&&e.active){e.deactivate()}else{var t;for(var i=0,r=this.controls.length;i<r;i++){t=this.controls[i];if(t!=e&&(t.type===OpenLayers.Control.TYPE_TOOL||t.type==null)){t.deactivate()}}e.activate()}},addControls:function(e){if(!OpenLayers.Util.isArray(e)){e=[e]}this.controls=this.controls.concat(e);for(var t=0,i=e.length;t<i;t++){var r=e[t],a=this.createControlMarkup(r);OpenLayers.Element.addClass(a,r.displayClass+"ItemInactive");OpenLayers.Element.addClass(a,"olButton");if(r.title!=""&&!a.title){a.title=r.title}r.panel_div=a}if(this.map){this.addControlsToMap(e);this.redraw()}},createControlMarkup:function(e){return document.createElement("div")},addControlsToMap:function(e){var t;for(var i=0,r=e.length;i<r;i++){t=e[i];if(t.autoActivate===true){t.autoActivate=false;this.map.addControl(t);t.autoActivate=true}else{this.map.addControl(t);t.deactivate()}t.events.on({activate:this.iconOn,deactivate:this.iconOff})}},iconOn:function(){var e=this.panel_div;var t=new RegExp("\\b("+this.displayClass+"Item)Inactive\\b");e.className=e.className.replace(t,"$1Active")},iconOff:function(){var e=this.panel_div;var t=new RegExp("\\b("+this.displayClass+"Item)Active\\b");e.className=e.className.replace(t,"$1Inactive")},onButtonClick:function(e){var t=this.controls,i=e.buttonElement;for(var r=t.length-1;r>=0;--r){if(t[r].panel_div===i){this.activateControl(t[r]);break}}},getControlsBy:function(t,i){var r=typeof i.test=="function";var e=OpenLayers.Array.filter(this.controls,function(e){return e[t]==i||r&&i.test(e[t])});return e},getControlsByName:function(e){return this.getControlsBy("name",e)},getControlsByClass:function(e){return this.getControlsBy("CLASS_NAME",e)},CLASS_NAME:"OpenLayers.Control.Panel"});OpenLayers.Control.Button=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_BUTTON,trigger:function(){},CLASS_NAME:"OpenLayers.Control.Button"});OpenLayers.Control.ZoomIn=OpenLayers.Class(OpenLayers.Control.Button,{trigger:function(){if(this.map){this.map.zoomIn()}},CLASS_NAME:"OpenLayers.Control.ZoomIn"});OpenLayers.Control.ZoomOut=OpenLayers.Class(OpenLayers.Control.Button,{trigger:function(){if(this.map){this.map.zoomOut()}},CLASS_NAME:"OpenLayers.Control.ZoomOut"});OpenLayers.Control.ZoomToMaxExtent=OpenLayers.Class(OpenLayers.Control.Button,{trigger:function(){if(this.map){this.map.zoomToMaxExtent()}},CLASS_NAME:"OpenLayers.Control.ZoomToMaxExtent"});OpenLayers.Control.ZoomPanel=OpenLayers.Class(OpenLayers.Control.Panel,{initialize:function(e){OpenLayers.Control.Panel.prototype.initialize.apply(this,[e]);this.addControls([new OpenLayers.Control.ZoomIn,new OpenLayers.Control.ZoomToMaxExtent,new OpenLayers.Control.ZoomOut])},CLASS_NAME:"OpenLayers.Control.ZoomPanel"});OpenLayers.Handler=OpenLayers.Class({id:null,control:null,map:null,keyMask:null,active:false,evt:null,touch:false,initialize:function(e,t,i){OpenLayers.Util.extend(this,i);this.control=e;this.callbacks=t;var r=this.map||e.map;if(r){this.setMap(r)}this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},setMap:function(e){this.map=e},checkModifiers:function(e){if(this.keyMask==null){return true}var t=(e.shiftKey?OpenLayers.Handler.MOD_SHIFT:0)|(e.ctrlKey?OpenLayers.Handler.MOD_CTRL:0)|(e.altKey?OpenLayers.Handler.MOD_ALT:0)|(e.metaKey?OpenLayers.Handler.MOD_META:0);return t==this.keyMask},activate:function(){if(this.active){return false}var e=OpenLayers.Events.prototype.BROWSER_EVENTS;for(var t=0,i=e.length;t<i;t++){if(this[e[t]]){this.register(e[t],this[e[t]])}}this.active=true;return true},deactivate:function(){if(!this.active){return false}var e=OpenLayers.Events.prototype.BROWSER_EVENTS;for(var t=0,i=e.length;t<i;t++){if(this[e[t]]){this.unregister(e[t],this[e[t]])}}this.touch=false;this.active=false;return true},startTouch:function(){if(!this.touch){this.touch=true;var e=["mousedown","mouseup","mousemove","click","dblclick","mouseout"];for(var t=0,i=e.length;t<i;t++){if(this[e[t]]){this.unregister(e[t],this[e[t]])}}}},callback:function(e,t){if(e&&this.callbacks[e]){this.callbacks[e].apply(this.control,t)}},register:function(e,t){this.map.events.registerPriority(e,this,t);this.map.events.registerPriority(e,this,this.setEvent)},unregister:function(e,t){this.map.events.unregister(e,this,t);this.map.events.unregister(e,this,this.setEvent)},setEvent:function(e){this.evt=e;return true},destroy:function(){this.deactivate();this.control=this.map=null},CLASS_NAME:"OpenLayers.Handler"});OpenLayers.Handler.MOD_NONE=0;OpenLayers.Handler.MOD_SHIFT=1;OpenLayers.Handler.MOD_CTRL=2;OpenLayers.Handler.MOD_ALT=4;OpenLayers.Handler.MOD_META=8;OpenLayers.Handler.Drag=OpenLayers.Class(OpenLayers.Handler,{started:false,stopDown:true,dragging:false,last:null,start:null,lastMoveEvt:null,oldOnselectstart:null,interval:0,timeoutId:null,documentDrag:false,documentEvents:null,initialize:function(e,t,i){OpenLayers.Handler.prototype.initialize.apply(this,arguments);if(this.documentDrag===true){var r=this;this._docMove=function(e){r.mousemove({xy:{x:e.clientX,y:e.clientY},element:document})};this._docUp=function(e){r.mouseup({xy:{x:e.clientX,y:e.clientY}})}}},dragstart:function(e){var t=true;this.dragging=false;if(this.checkModifiers(e)&&(OpenLayers.Event.isLeftClick(e)||OpenLayers.Event.isSingleTouch(e))){this.started=true;this.start=e.xy;this.last=e.xy;OpenLayers.Element.addClass(this.map.viewPortDiv,"olDragDown");this.down(e);this.callback("down",[e.xy]);OpenLayers.Event.preventDefault(e);if(!this.oldOnselectstart){this.oldOnselectstart=document.onselectstart?document.onselectstart:OpenLayers.Function.True}document.onselectstart=OpenLayers.Function.False;t=!this.stopDown}else{this.started=false;this.start=null;this.last=null}return t},dragmove:function(e){this.lastMoveEvt=e;if(this.started&&!this.timeoutId&&(e.xy.x!=this.last.x||e.xy.y!=this.last.y)){if(this.documentDrag===true&&this.documentEvents){if(e.element===document){this.adjustXY(e);this.setEvent(e)}else{this.removeDocumentEvents()}}if(this.interval>0){this.timeoutId=setTimeout(OpenLayers.Function.bind(this.removeTimeout,this),this.interval)}this.dragging=true;this.move(e);this.callback("move",[e.xy]);if(!this.oldOnselectstart){this.oldOnselectstart=document.onselectstart;document.onselectstart=OpenLayers.Function.False}this.last=e.xy}return true},dragend:function(e){if(this.started){if(this.documentDrag===true&&this.documentEvents){this.adjustXY(e);this.removeDocumentEvents()}var t=this.start!=this.last;this.started=false;this.dragging=false;OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown");this.up(e);this.callback("up",[e.xy]);if(t){this.callback("done",[e.xy])}document.onselectstart=this.oldOnselectstart}return true},down:function(e){},move:function(e){},up:function(e){},out:function(e){},mousedown:function(e){return this.dragstart(e)},touchstart:function(e){this.startTouch();return this.dragstart(e)},mousemove:function(e){return this.dragmove(e)},touchmove:function(e){return this.dragmove(e)},removeTimeout:function(){this.timeoutId=null;if(this.dragging){this.mousemove(this.lastMoveEvt)}},mouseup:function(e){return this.dragend(e)},touchend:function(e){e.xy=this.last;return this.dragend(e)},mouseout:function(e){if(this.started&&OpenLayers.Util.mouseLeft(e,this.map.viewPortDiv)){if(this.documentDrag===true){this.addDocumentEvents()}else{var t=this.start!=this.last;this.started=false;this.dragging=false;OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown");this.out(e);this.callback("out",[]);if(t){this.callback("done",[e.xy])}if(document.onselectstart){document.onselectstart=this.oldOnselectstart}}}return true},click:function(e){return this.start==this.last},activate:function(){var e=false;if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){this.dragging=false;e=true}return e},deactivate:function(){var e=false;if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){this.started=false;this.dragging=false;this.start=null;this.last=null;e=true;OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown")}return e},adjustXY:function(e){var t=OpenLayers.Util.pagePosition(this.map.viewPortDiv);e.xy.x-=t[0];e.xy.y-=t[1]},addDocumentEvents:function(){OpenLayers.Element.addClass(document.body,"olDragDown");this.documentEvents=true;OpenLayers.Event.observe(document,"mousemove",this._docMove);OpenLayers.Event.observe(document,"mouseup",this._docUp)},removeDocumentEvents:function(){OpenLayers.Element.removeClass(document.body,"olDragDown");this.documentEvents=false;OpenLayers.Event.stopObserving(document,"mousemove",this._docMove);OpenLayers.Event.stopObserving(document,"mouseup",this._docUp)},CLASS_NAME:"OpenLayers.Handler.Drag"});OpenLayers.Handler.Box=OpenLayers.Class(OpenLayers.Handler,{dragHandler:null,boxDivClassName:"olHandlerBoxZoomBox",boxOffsets:null,initialize:function(e,t,i){OpenLayers.Handler.prototype.initialize.apply(this,arguments);this.dragHandler=new OpenLayers.Handler.Drag(this,{down:this.startBox,move:this.moveBox,out:this.removeBox,up:this.endBox},{keyMask:this.keyMask})},destroy:function(){OpenLayers.Handler.prototype.destroy.apply(this,arguments);if(this.dragHandler){this.dragHandler.destroy();this.dragHandler=null}},setMap:function(e){OpenLayers.Handler.prototype.setMap.apply(this,arguments);if(this.dragHandler){this.dragHandler.setMap(e)}},startBox:function(e){this.callback("start",[]);this.zoomBox=OpenLayers.Util.createDiv("zoomBox",{x:-9999,y:-9999});this.zoomBox.className=this.boxDivClassName;this.zoomBox.style.zIndex=this.map.Z_INDEX_BASE["Popup"]-1;this.map.viewPortDiv.appendChild(this.zoomBox);OpenLayers.Element.addClass(this.map.viewPortDiv,"olDrawBox")},moveBox:function(e){var t=this.dragHandler.start.x;var i=this.dragHandler.start.y;var r=Math.abs(t-e.x);var a=Math.abs(i-e.y);var s=this.getBoxOffsets();this.zoomBox.style.width=r+s.width+1+"px";this.zoomBox.style.height=a+s.height+1+"px";this.zoomBox.style.left=(e.x<t?t-r-s.left:t-s.left)+"px";this.zoomBox.style.top=(e.y<i?i-a-s.top:i-s.top)+"px"},endBox:function(e){var t;if(Math.abs(this.dragHandler.start.x-e.x)>5||Math.abs(this.dragHandler.start.y-e.y)>5){var i=this.dragHandler.start;var r=Math.min(i.y,e.y);var a=Math.max(i.y,e.y);var s=Math.min(i.x,e.x);var n=Math.max(i.x,e.x);t=new OpenLayers.Bounds(s,a,n,r)}else{t=this.dragHandler.start.clone()}this.removeBox();this.callback("done",[t])},removeBox:function(){this.map.viewPortDiv.removeChild(this.zoomBox);this.zoomBox=null;this.boxOffsets=null;OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDrawBox")},activate:function(){if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){this.dragHandler.activate();return true}else{return false}},deactivate:function(){if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){if(this.dragHandler.deactivate()){if(this.zoomBox){this.removeBox()}}return true}else{return false}},getBoxOffsets:function(){if(!this.boxOffsets){var e=document.createElement("div");e.style.position="absolute";e.style.border="1px solid black";e.style.width="3px";document.body.appendChild(e);var t=e.clientWidth==3;document.body.removeChild(e);var i=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-left-width"));var r=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-right-width"));var a=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-top-width"));var s=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-bottom-width"));this.boxOffsets={left:i,right:r,top:a,bottom:s,width:t===false?i+r:0,height:t===false?a+s:0}}return this.boxOffsets},CLASS_NAME:"OpenLayers.Handler.Box"});OpenLayers.Control.ZoomBox=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,out:false,keyMask:null,alwaysZoom:false,zoomOnClick:true,draw:function(){this.handler=new OpenLayers.Handler.Box(this,{done:this.zoomBox},{keyMask:this.keyMask})},zoomBox:function(e){if(e instanceof OpenLayers.Bounds){var t,i=e.getCenterPixel();if(!this.out){var r=this.map.getLonLatFromPixel({x:e.left,y:e.bottom});var a=this.map.getLonLatFromPixel({x:e.right,y:e.top});t=new OpenLayers.Bounds(r.lon,r.lat,a.lon,a.lat)}else{var p=e.right-e.left;var u=e.bottom-e.top;var s=Math.min(this.map.size.h/u,this.map.size.w/p);var n=this.map.getExtent();var o=this.map.getLonLatFromPixel(i);var c=o.lon-n.getWidth()/2*s;var d=o.lon+n.getWidth()/2*s;var f=o.lat-n.getHeight()/2*s;var y=o.lat+n.getHeight()/2*s;t=new OpenLayers.Bounds(c,f,d,y)}var g=this.map.getZoom(),m=this.map.getSize(),v={x:m.w/2,y:m.h/2},x=this.map.getZoomForExtent(t),l=this.map.getResolution(),h=this.map.getResolutionForZoom(x);if(l==h){this.map.setCenter(this.map.getLonLatFromPixel(i))}else{var L={x:(l*i.x-h*v.x)/(l-h),y:(l*i.y-h*v.y)/(l-h)};this.map.zoomTo(x,L)}if(g==this.map.getZoom()&&this.alwaysZoom==true){this.map.zoomTo(g+(this.out?-1:1))}}else if(this.zoomOnClick){if(!this.out){this.map.zoomTo(this.map.getZoom()+1,e)}else{this.map.zoomTo(this.map.getZoom()-1,e)}}},CLASS_NAME:"OpenLayers.Control.ZoomBox"});OpenLayers.Control.DragPan=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,panned:false,interval:0,documentDrag:false,kinetic:null,enableKinetic:true,kineticInterval:10,draw:function(){if(this.enableKinetic&&OpenLayers.Kinetic){var e={interval:this.kineticInterval};if(typeof this.enableKinetic==="object"){e=OpenLayers.Util.extend(e,this.enableKinetic)}this.kinetic=new OpenLayers.Kinetic(e)}this.handler=new OpenLayers.Handler.Drag(this,{move:this.panMap,done:this.panMapDone,down:this.panMapStart},{interval:this.interval,documentDrag:this.documentDrag})},panMapStart:function(){if(this.kinetic){this.kinetic.begin()}},panMap:function(e){if(this.kinetic){this.kinetic.update(e)}this.panned=true;this.map.pan(this.handler.last.x-e.x,this.handler.last.y-e.y,{dragging:true,animate:false})},panMapDone:function(e){if(this.panned){var t=null;if(this.kinetic){t=this.kinetic.end(e)}this.map.pan(this.handler.last.x-e.x,this.handler.last.y-e.y,{dragging:!!t,animate:false});if(t){var r=this;this.kinetic.move(t,function(e,t,i){r.map.pan(e,t,{dragging:!i,animate:false})})}this.panned=false}},CLASS_NAME:"OpenLayers.Control.DragPan"});OpenLayers.Handler.MouseWheel=OpenLayers.Class(OpenLayers.Handler,{wheelListener:null,interval:0,maxDelta:Number.POSITIVE_INFINITY,delta:0,cumulative:true,initialize:function(e,t,i){OpenLayers.Handler.prototype.initialize.apply(this,arguments);this.wheelListener=OpenLayers.Function.bindAsEventListener(this.onWheelEvent,this)},destroy:function(){OpenLayers.Handler.prototype.destroy.apply(this,arguments);this.wheelListener=null},onWheelEvent:function(e){if(!this.map||!this.checkModifiers(e)){return}var t=false;var i=false;var r=false;var a=OpenLayers.Event.element(e);while(a!=null&&!r&&!t){if(!t){try{var s;if(a.currentStyle){s=a.currentStyle["overflow"]}else{var n=document.defaultView.getComputedStyle(a,null);s=n.getPropertyValue("overflow")}t=s&&s=="auto"||s=="scroll"}catch(e){}}if(!i){i=OpenLayers.Element.hasClass(a,"olScrollable");if(!i){for(var o=0,p=this.map.layers.length;o<p;o++){var l=this.map.layers[o];if(a==l.div||a==l.pane){i=true;break}}}}r=a==this.map.div;a=a.parentNode}if(!t&&r){if(i){var h=0;if(e.wheelDelta){h=e.wheelDelta;if(h%160===0){h=h*.75}h=h/120}else if(e.detail){h=-(e.detail/Math.abs(e.detail))}this.delta+=h;window.clearTimeout(this._timeoutId);if(this.interval&&Math.abs(this.delta)<this.maxDelta){var u=OpenLayers.Util.extend({},e);this._timeoutId=window.setTimeout(OpenLayers.Function.bind(function(){this.wheelZoom(u)},this),this.interval)}else{this.wheelZoom(e)}}OpenLayers.Event.stop(e)}},wheelZoom:function(e){var t=this.delta;this.delta=0;if(t){e.xy=this.map.events.getMousePosition(e);if(t<0){this.callback("down",[e,this.cumulative?Math.max(-this.maxDelta,t):-1])}else{this.callback("up",[e,this.cumulative?Math.min(this.maxDelta,t):1])}}},activate:function(e){if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){var t=this.wheelListener;OpenLayers.Event.observe(window,"DOMMouseScroll",t);OpenLayers.Event.observe(window,"mousewheel",t);OpenLayers.Event.observe(document,"mousewheel",t);return true}else{return false}},deactivate:function(e){if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){var t=this.wheelListener;OpenLayers.Event.stopObserving(window,"DOMMouseScroll",t);OpenLayers.Event.stopObserving(window,"mousewheel",t);OpenLayers.Event.stopObserving(document,"mousewheel",t);return true}else{return false}},CLASS_NAME:"OpenLayers.Handler.MouseWheel"});OpenLayers.Handler.Click=OpenLayers.Class(OpenLayers.Handler,{delay:300,single:true,double:false,pixelTolerance:0,dblclickTolerance:13,stopSingle:false,stopDouble:false,timerId:null,down:null,last:null,first:null,rightclickTimerId:null,touchstart:function(e){this.startTouch();this.down=this.getEventInfo(e);this.last=this.getEventInfo(e);return true},touchmove:function(e){this.last=this.getEventInfo(e);return true},touchend:function(e){if(this.down){e.xy=this.last.xy;e.lastTouches=this.last.touches;this.handleSingle(e);this.down=null}return true},mousedown:function(e){this.down=this.getEventInfo(e);this.last=this.getEventInfo(e);return true},mouseup:function(e){var t=true;if(this.checkModifiers(e)&&this.control.handleRightClicks&&OpenLayers.Event.isRightClick(e)){t=this.rightclick(e)}return t},rightclick:function(e){if(this.passesTolerance(e)){if(this.rightclickTimerId!=null){this.clearTimer();this.callback("dblrightclick",[e]);return!this.stopDouble}else{var t=this["double"]?OpenLayers.Util.extend({},e):this.callback("rightclick",[e]);var i=OpenLayers.Function.bind(this.delayedRightCall,this,t);this.rightclickTimerId=window.setTimeout(i,this.delay)}}return!this.stopSingle},delayedRightCall:function(e){this.rightclickTimerId=null;if(e){this.callback("rightclick",[e])}},click:function(e){if(!this.last){this.last=this.getEventInfo(e)}this.handleSingle(e);return!this.stopSingle},dblclick:function(e){this.handleDouble(e);return!this.stopDouble},handleDouble:function(e){if(this.passesDblclickTolerance(e)){if(this["double"]){this.callback("dblclick",[e])}this.clearTimer()}},handleSingle:function(e){if(this.passesTolerance(e)){if(this.timerId!=null){if(this.last.touches&&this.last.touches.length===1){if(this["double"]){OpenLayers.Event.preventDefault(e)}this.handleDouble(e)}if(!this.last.touches||this.last.touches.length!==2){this.clearTimer()}}else{this.first=this.getEventInfo(e);var t=this.single?OpenLayers.Util.extend({},e):null;this.queuePotentialClick(t)}}},queuePotentialClick:function(e){this.timerId=window.setTimeout(OpenLayers.Function.bind(this.delayedCall,this,e),this.delay)},passesTolerance:function(e){var t=true;if(this.pixelTolerance!=null&&this.down&&this.down.xy){t=this.pixelTolerance>=this.down.xy.distanceTo(e.xy);if(t&&this.touch&&this.down.touches.length===this.last.touches.length){for(var i=0,r=this.down.touches.length;i<r;++i){if(this.getTouchDistance(this.down.touches[i],this.last.touches[i])>this.pixelTolerance){t=false;break}}}}return t},getTouchDistance:function(e,t){return Math.sqrt(Math.pow(e.clientX-t.clientX,2)+Math.pow(e.clientY-t.clientY,2))},passesDblclickTolerance:function(e){var t=true;if(this.down&&this.first){t=this.down.xy.distanceTo(this.first.xy)<=this.dblclickTolerance}return t},clearTimer:function(){if(this.timerId!=null){window.clearTimeout(this.timerId);this.timerId=null}if(this.rightclickTimerId!=null){window.clearTimeout(this.rightclickTimerId);this.rightclickTimerId=null}},delayedCall:function(e){this.timerId=null;if(e){this.callback("click",[e])}},getEventInfo:function(e){var t;if(e.touches){var i=e.touches.length;t=new Array(i);var r;for(var a=0;a<i;a++){r=e.touches[a];t[a]={clientX:r.olClientX,clientY:r.olClientY}}}return{xy:e.xy,touches:t}},deactivate:function(){var e=false;if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){this.clearTimer();this.down=null;this.first=null;this.last=null;e=true}return e},CLASS_NAME:"OpenLayers.Handler.Click"});OpenLayers.Control.Navigation=OpenLayers.Class(OpenLayers.Control,{dragPan:null,dragPanOptions:null,pinchZoom:null,pinchZoomOptions:null,documentDrag:false,zoomBox:null,zoomBoxEnabled:true,zoomWheelEnabled:true,mouseWheelOptions:null,handleRightClicks:false,zoomBoxKeyMask:OpenLayers.Handler.MOD_SHIFT,autoActivate:true,initialize:function(e){this.handlers={};OpenLayers.Control.prototype.initialize.apply(this,arguments)},destroy:function(){this.deactivate();if(this.dragPan){this.dragPan.destroy()}this.dragPan=null;if(this.zoomBox){this.zoomBox.destroy()}this.zoomBox=null;if(this.pinchZoom){this.pinchZoom.destroy()}this.pinchZoom=null;OpenLayers.Control.prototype.destroy.apply(this,arguments)},activate:function(){this.dragPan.activate();if(this.zoomWheelEnabled){this.handlers.wheel.activate()}this.handlers.click.activate();if(this.zoomBoxEnabled){this.zoomBox.activate()}if(this.pinchZoom){this.pinchZoom.activate()}return OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){if(this.pinchZoom){this.pinchZoom.deactivate()}this.zoomBox.deactivate();this.dragPan.deactivate();this.handlers.click.deactivate();this.handlers.wheel.deactivate();return OpenLayers.Control.prototype.deactivate.apply(this,arguments)},draw:function(){if(this.handleRightClicks){this.map.viewPortDiv.oncontextmenu=OpenLayers.Function.False}var e={click:this.defaultClick,dblclick:this.defaultDblClick,dblrightclick:this.defaultDblRightClick};var t={double:true,stopDouble:true};this.handlers.click=new OpenLayers.Handler.Click(this,e,t);this.dragPan=new OpenLayers.Control.DragPan(OpenLayers.Util.extend({map:this.map,documentDrag:this.documentDrag},this.dragPanOptions));this.zoomBox=new OpenLayers.Control.ZoomBox({map:this.map,keyMask:this.zoomBoxKeyMask});this.dragPan.draw();this.zoomBox.draw();var i=this.map.fractionalZoom?{}:{cumulative:true,interval:250,maxDelta:6};this.handlers.wheel=new OpenLayers.Handler.MouseWheel(this,{up:this.wheelUp,down:this.wheelDown},OpenLayers.Util.extend(i,this.mouseWheelOptions));if(OpenLayers.Control.PinchZoom){this.pinchZoom=new OpenLayers.Control.PinchZoom(OpenLayers.Util.extend({map:this.map},this.pinchZoomOptions))}},defaultClick:function(e){if(e.lastTouches&&e.lastTouches.length==2){this.map.zoomOut()}},defaultDblClick:function(e){this.map.zoomTo(this.map.zoom+1,e.xy)},defaultDblRightClick:function(e){this.map.zoomTo(this.map.zoom-1,e.xy)},wheelChange:function(e,t){if(!this.map.fractionalZoom){t=Math.round(t)}var i=this.map.getZoom(),r=i+t;r=Math.max(r,0);r=Math.min(r,this.map.getNumZoomLevels());if(r===i){return}this.map.zoomTo(r,e.xy)},wheelUp:function(e,t){this.wheelChange(e,t||1)},wheelDown:function(e,t){this.wheelChange(e,t||-1)},disableZoomBox:function(){this.zoomBoxEnabled=false;this.zoomBox.deactivate()},enableZoomBox:function(){this.zoomBoxEnabled=true;if(this.active){this.zoomBox.activate()}},disableZoomWheel:function(){this.zoomWheelEnabled=false;this.handlers.wheel.deactivate()},enableZoomWheel:function(){this.zoomWheelEnabled=true;if(this.active){this.handlers.wheel.activate()}},CLASS_NAME:"OpenLayers.Control.Navigation"});OpenLayers.Kinetic=OpenLayers.Class({threshold:0,deceleration:.0035,nbPoints:100,delay:200,points:undefined,timerId:undefined,initialize:function(e){OpenLayers.Util.extend(this,e)},begin:function(){OpenLayers.Animation.stop(this.timerId);this.timerId=undefined;this.points=[]},update:function(e){this.points.unshift({xy:e,tick:(new Date).getTime()});if(this.points.length>this.nbPoints){this.points.pop()}},end:function(e){var t,i=(new Date).getTime();for(var r=0,a=this.points.length,s;r<a;r++){s=this.points[r];if(i-s.tick>this.delay){break}t=s}if(!t){return}var n=(new Date).getTime()-t.tick;var o=Math.sqrt(Math.pow(e.x-t.xy.x,2)+Math.pow(e.y-t.xy.y,2));var l=o/n;if(l==0||l<this.threshold){return}var h=Math.asin((e.y-t.xy.y)/o);if(t.xy.x<=e.x){h=Math.PI-h}return{speed:l,theta:h}},move:function(e,n){var o=e.speed;var l=Math.cos(e.theta);var h=-Math.sin(e.theta);var p=(new Date).getTime();var u=0;var c=0;var t=function(){if(this.timerId==null){return}var e=(new Date).getTime()-p;var t=-this.deceleration*Math.pow(e,2)/2+o*e;var i=t*l;var r=t*h;var a={};a.end=false;var s=-this.deceleration*e+o;if(s<=0){OpenLayers.Animation.stop(this.timerId);this.timerId=null;a.end=true}a.x=i-u;a.y=r-c;u=i;c=r;n(a.x,a.y,a.end)};this.timerId=OpenLayers.Animation.start(OpenLayers.Function.bind(t,this))},CLASS_NAME:"OpenLayers.Kinetic"});OpenLayers.Control.Pan=OpenLayers.Class(OpenLayers.Control.Button,{slideFactor:50,slideRatio:null,direction:null,initialize:function(e,t){this.direction=e;this.CLASS_NAME+=this.direction;OpenLayers.Control.prototype.initialize.apply(this,[t])},trigger:function(){if(this.map){var e=OpenLayers.Function.bind(function(e){return this.slideRatio?this.map.getSize()[e]*this.slideRatio:this.slideFactor},this);switch(this.direction){case OpenLayers.Control.Pan.NORTH:this.map.pan(0,-e("h"));break;case OpenLayers.Control.Pan.SOUTH:this.map.pan(0,e("h"));break;case OpenLayers.Control.Pan.WEST:this.map.pan(-e("w"),0);break;case OpenLayers.Control.Pan.EAST:this.map.pan(e("w"),0);break}}},CLASS_NAME:"OpenLayers.Control.Pan"});OpenLayers.Control.Pan.NORTH="North";OpenLayers.Control.Pan.SOUTH="South";OpenLayers.Control.Pan.EAST="East";OpenLayers.Control.Pan.WEST="West";OpenLayers.Control.PanPanel=OpenLayers.Class(OpenLayers.Control.Panel,{slideFactor:50,slideRatio:null,initialize:function(e){OpenLayers.Control.Panel.prototype.initialize.apply(this,[e]);var e={slideFactor:this.slideFactor,slideRatio:this.slideRatio};this.addControls([new OpenLayers.Control.Pan(OpenLayers.Control.Pan.NORTH,e),new OpenLayers.Control.Pan(OpenLayers.Control.Pan.SOUTH,e),new OpenLayers.Control.Pan(OpenLayers.Control.Pan.EAST,e),new OpenLayers.Control.Pan(OpenLayers.Control.Pan.WEST,e)])},CLASS_NAME:"OpenLayers.Control.PanPanel"});Ext.namespace("GeoExt");GeoExt.ZoomSlider=Ext.extend(Ext.slider.SingleSlider,{map:null,baseCls:"gx-zoomslider",aggressive:false,updating:false,initComponent:function(){GeoExt.ZoomSlider.superclass.initComponent.call(this);if(this.map){if(this.map instanceof GeoExt.MapPanel){this.map=this.map.map}this.bind(this.map)}if(this.aggressive===true){this.on("change",this.changeHandler,this)}else{this.on("changecomplete",this.changeHandler,this)}this.on("beforedestroy",this.unbind,this)},onRender:function(){GeoExt.ZoomSlider.superclass.onRender.apply(this,arguments);this.el.addClass(this.baseCls)},afterRender:function(){Ext.slider.SingleSlider.superclass.afterRender.apply(this,arguments);this.update()},addToMapPanel:function(t){this.on({render:function(){var e=this.getEl();e.setStyle({position:"absolute",zIndex:t.map.Z_INDEX_BASE.Control});e.on({mousedown:this.stopMouseEvents,click:this.stopMouseEvents})},afterrender:function(){this.bind(t.map)},scope:this})},stopMouseEvents:function(e){e.stopEvent()},removeFromMapPanel:function(e){var t=this.getEl();t.un("mousedown",this.stopMouseEvents,this);t.un("click",this.stopMouseEvents,this);this.unbind()},bind:function(e){this.map=e;this.map.events.on({zoomend:this.onZoomEnd,updatesize:this.initZoomValues,changebaselayer:this.initZoomValues,scope:this});this.initZoomValues()},onZoomEnd:function(){this.update()},unbind:function(){if(this.map&&this.map.events){this.map.events.un({zoomend:this.onZoomEnd,updatesize:this.initZoomValues,changebaselayer:this.initZoomValues,scope:this})}},initZoomValues:function(){var e=this.map.baseLayer;if(e){if(this.initialConfig.minValue===undefined){var t=this.map.getMinZoom?this.map.getMinZoom():0;this.minValue=Math.max(t,e.minZoomLevel||0)}if(this.initialConfig.maxValue===undefined){this.maxValue=e.minZoomLevel==null?e.numZoomLevels-1:e.maxZoomLevel}this.update(true)}},getZoom:function(){return this.getValue()},getScale:function(){return OpenLayers.Util.getScaleFromResolution(this.map.getResolutionForZoom(this.getValue()),this.map.getUnits())},getResolution:function(){return this.map.getResolutionForZoom(this.getValue())},changeHandler:function(){if(this.map&&!this.updating){this.map.zoomTo(this.getValue())}},update:function(e){if(this.rendered&&this.map){this.updating=true;if(e){this.thumbs[0].value=null}this.setValue(this.map.getZoom());this.updating=false}}});Ext.reg("gx_zoomslider",GeoExt.ZoomSlider);Ext.namespace("GeoExt");GeoExt.ZoomSliderTip=Ext.extend(GeoExt.SliderTip,{template:"<div>Zoom Level: {zoom}</div>"+"<div>Resolution: {resolution}</div>"+"<div>Scale: 1 : {scale}</div>",compiledTemplate:null,init:function(e){this.compiledTemplate=new Ext.Template(this.template);GeoExt.ZoomSliderTip.superclass.init.call(this,e)},getText:function(e){var t={zoom:e.value,resolution:this.slider.getResolution(),scale:Math.round(this.slider.getScale())};return this.compiledTemplate.apply(t)}});Ext.namespace("gxp");gxp.Viewer=Ext.extend(Ext.util.Observable,{defaultToolType:"gxp_tool",tools:null,selectedLayer:null,authenticate:null,saveErrorText:gettext("Trouble saving: "),gwcAvailable:[],constructor:function(e){this.addEvents("ready","beforecreateportal","portalready","beforelayerselectionchange","layerselectionchange","featureedit","authorizationchange","beforesave","save","beforehashchange");Ext.apply(this,{layerSources:{},portalItems:[]});this.createLayerRecordQueue=[];(e.loadConfig||this.loadConfig).call(this,e,this.applyConfig);gxp.Viewer.superclass.constructor.apply(this,arguments)},selectLayer:function(e){e=e||null;var t=false;var i=this.fireEvent("beforelayerselectionchange",e);if(i!==false){t=true;if(this.selectedLayer){this.selectedLayer.set("selected",false)}this.selectedLayer=e;if(this.selectedLayer){this.selectedLayer.set("selected",true)}this.fireEvent("layerselectionchange",e)}return t},initGWCAvalaible:function(){var e=new Ext.data.Connection;e.request({url:"http://asdc.immap.org/static/gwclayers.xml",scope:this,callback:function(e,t,r){if(t){var a=Ext.DomQuery;var s=r.responseXML;var n=a.selectNode("layers",s);data=n.getElementsByTagName("name");for(i=0;i<data.length;i++){this.gwcAvailable.push(data[i].childNodes[0].nodeValue)}this.addLayers();this.checkLayerRecordQueue();this.fireEvent("ready")}}})},loadConfig:function(e){this.applyConfig(e)},applyConfig:function(e){this.initialConfig=Ext.apply({},e);Ext.apply(this,this.initialConfig);this.load()},load:function(){if(this.proxy){OpenLayers.ProxyHost=this.proxy}this.initMapPanel();this.initTools();var e,t=[];for(var i in this.sources){t.push(this.createSourceLoader(i))}t.push(function(e){Ext.onReady(function(){this.initPortal();e()},this)});gxp.util.dispatch(t,this.activate,this)},createSourceLoader:function(t){return function(r){var e=this.sources[t];e.projection=this.initialConfig.map.projection;this.addLayerSource({id:t,config:e,callback:r,fallback:function(e,t,i){r()},scope:this})}},addLayerSource:function(t){var i=t.id||Ext.id(null,"gxp-source-");var e;var r=t.config;r.id=i;try{e=Ext.ComponentMgr.createPlugin(r,this.defaultSourceType)}catch(e){throw new Error("Could not create new source plugin with ptype: "+t.config.ptype)}e.on({ready:{fn:function(){var e=t.callback||Ext.emptyFn;e.call(t.scope||this,i)},scope:this,single:true},failure:{fn:function(){var e=t.fallback||Ext.emptyFn;delete this.layerSources[i];e.apply(t.scope||this,arguments)},scope:this,single:true}});this.layerSources[i]=e;e.init(this);return e},initMapPanel:function(){var e=Ext.apply({},this.initialConfig.map);var t={};var i={wrapDateLine:e.wrapDateLine!==undefined?e.wrapDateLine:true,maxResolution:e.maxResolution,numZoomLevels:e.numZoomLevels,displayInLayerSwitcher:false};if(this.initialConfig.map){var r="theme,controls,resolutions,projection,units,maxExtent,restrictedExtent,maxResolution,numZoomLevels,panMethod".split(",");var a;for(var s=r.length-1;s>=0;--s){a=r[s];if(a in e){t[a]=e[a];delete e[a]}}}this.mapPanel=Ext.ComponentMgr.create(Ext.applyIf({xtype:e.xtype||"gx_mappanel",map:Ext.applyIf({theme:t.theme||null,controls:t.controls||[new OpenLayers.Control.Navigation({zoomWheelOptions:{interval:250},dragPanOptions:{enableKinetic:true}}),new OpenLayers.Control.PanPanel,new OpenLayers.Control.ZoomPanel,new OpenLayers.Control.Attribution],maxExtent:t.maxExtent&&OpenLayers.Bounds.fromArray(t.maxExtent),restrictedExtent:t.restrictedExtent&&OpenLayers.Bounds.fromArray(t.restrictedExtent),numZoomLevels:t.numZoomLevels||20},t),center:e.center&&new OpenLayers.LonLat(e.center[0],e.center[1]),resolutions:e.resolutions,forceInitialExtent:true,layers:[new OpenLayers.Layer(null,i)],items:this.mapItems,plugins:this.mapPlugins,tbar:e.tbar||new Ext.Toolbar({hidden:true})},e));this.mapPanel.getTopToolbar().on({afterlayout:this.mapPanel.map.updateSize,show:this.mapPanel.map.updateSize,hide:this.mapPanel.map.updateSize,scope:this.mapPanel.map});this.mapPanel.layers.on({add:function(e,t){var i;for(var r=t.length-1;r>=0;r--){i=t[r];if(i.get("selected")===true){this.selectLayer(i)}}},remove:function(e,t){if(t.get("selected")===true){this.selectLayer()}},scope:this})},initTools:function(){this.tools={};if(this.initialConfig.tools&&this.initialConfig.tools.length>0){var e;for(var t=0,i=this.initialConfig.tools.length;t<i;t++){try{e=Ext.ComponentMgr.createPlugin(this.initialConfig.tools[t],this.defaultToolType)}catch(e){throw new Error("Could not create tool plugin with ptype: "+this.initialConfig.tools[t].ptype)}e.init(this)}}},initPortal:function(){var e=Ext.apply({},this.portalConfig);if(this.portalItems.length===0){this.mapPanel.region="center";this.portalItems.push(this.mapPanel)}this.fireEvent("beforecreateportal");this.portal=Ext.ComponentMgr.create(Ext.applyIf(e,{layout:"fit",hideBorders:true,items:{layout:"border",deferredRender:false,items:this.portalItems}}),e.renderTo?"panel":"viewport");this.fireEvent("portalready")},activate:function(){Ext.QuickTips.init();this.initGWCAvalaible()},addLayers:function(){var e=this.initialConfig.map;if(e&&e.layers){var t,i,r,a=[],s=[];for(var n=0;n<e.layers.length;++n){t=e.layers[n];i=this.layerSources[t.source];if(i){r=i.createLayerRecord(t);if(r){if(r.get("group")==="background"){a.push(r)}else{if(!!~this.gwcAvailable.indexOf(r.json.name)){var o=["http://asdc.immap.org/geoserver/gwc/service/wms","http://map1.asdc.immap.org/geoserver/gwc/service/wms","http://map2.asdc.immap.org/geoserver/gwc/service/wms","http://map3.asdc.immap.org/geoserver/gwc/service/wms","http://map4.asdc.immap.org/geoserver/gwc/service/wms","http://map5.asdc.immap.org/geoserver/gwc/service/wms","http://map6.asdc.immap.org/geoserver/gwc/service/wms","http://map7.asdc.immap.org/geoserver/gwc/service/wms","http://map8.asdc.immap.org/geoserver/gwc/service/wms"];r.data.layer.url=o}s.push(r)}}}else if(window.console){console.warn("Non-existing source '"+t.source+"' referenced in layer config.")}}var l=this.mapPanel;var p=l.map;var h=a.concat(s);if(h.length){l.layers.add(h)}}},getLayerRecordFromMap:function(t){var i=null;if(this.mapPanel){this.mapPanel.layers.each(function(e){if(e.get("source")==t.source&&e.get("name")==t.name){i=e;return false}})}return i},createLayerRecord:function(e,t,i){this.createLayerRecordQueue.push({config:e,callback:t,scope:i});this.checkLayerRecordQueue()},checkLayerRecordQueue:function(){var e,t,i,r,a;var s=[];for(var n=0,o=this.createLayerRecordQueue.length;n<o;++n){a=false;e=this.createLayerRecordQueue[n];i=e.config.source;if(i in this.layerSources){t=this.layerSources[i];r=t.createLayerRecord(e.config);if(r){(function(e,t){window.setTimeout(function(){e.callback.call(e.scope,t)},0)})(e,r);a=true}else if(t.lazy){t.store.load({callback:this.checkLayerRecordQueue,scope:this})}}if(!a){s.push(e)}}this.createLayerRecordQueue=s},getSource:function(e){return e&&this.layerSources[e.get("source")]},getState:function(){var a=Ext.apply({},this.initialConfig);var e=this.mapPanel.map.getCenter();Ext.apply(a.map,{center:[e.lon,e.lat],zoom:this.mapPanel.map.zoom,layers:[]});var s={};this.mapPanel.layers.each(function(e){var t=e.getLayer();if(t.displayInLayerSwitcher&&!(t instanceof OpenLayers.Layer.Vector)){var i=e.get("source");var r=this.layerSources[i];if(!r){throw new Error("Could not find source for record '"+e.get("name")+" and layer "+t.name+"'")}a.map.layers.push(r.getConfigForRecord(e));if(!s[i]){s[i]=r.getState()}}},this);Ext.apply(this.sources,s);a.tools=[];Ext.iterate(this.tools,function(e,t,i){if(t.getState!=gxp.plugins.Tool.prototype.getState){a.tools.push(t.getState())}});return a},isAuthorized:function(e){var t=true;if(this.authorizedRoles){t=false;if(!e){e="ROLE_ADMINISTRATOR"}if(!Ext.isArray(e)){e=[e]}for(var i=e.length-1;i>=0;--i){if(~this.authorizedRoles.indexOf(e[i])){t=true;break}}}return t},setAuthorizedRoles:function(e){this.authorizedRoles=e;this.fireEvent("authorizationchange")},cancelAuthentication:function(){if(this._authFn){this.un("authorizationchange",this._authFn,this)}this.fireEvent("authorizationchange")},isAuthenticated:function(e){return!this.authorizedRoles||this.authorizedRoles.length>0},doAuthorized:function(t,i,r){if(this.isAuthorized(t)||!this.authenticate){window.setTimeout(function(){i.call(r)},0)}else{this.authenticate();this._authFn=function e(){delete this._authFn;this.doAuthorized(t,i,r,true)};this.on("authorizationchange",this._authFn,this,{single:true})}},save:function(t,i){var e=Ext.util.JSON.encode(this.getState());var r,a;if(this.id){r="PUT";a="../maps/"+this.id}else{r="POST";a="../maps/"}var s={method:r,url:a,data:e};if(this.fireEvent("beforesave",s,t)!==false){OpenLayers.Request.issue(Ext.apply(s,{callback:function(e){this.handleSave(e);if(t){t.call(i||this,e)}},scope:this}))}},handleSave:function(e){if(e.status==200){var t=Ext.util.JSON.decode(e.responseText);var i=t.id;if(i){this.id=i;var r="#maps/"+i;if(this.fireEvent("beforehashchange",r)!==false){window.location.hash=r}this.fireEvent("save",this.id)}}else{if(window.console){console.warn(this.saveErrorText+e.responseText)}}},destroy:function(){this.mapPanel.destroy();this.portal&&this.portal.destroy()}});(function(){OpenLayers.DOTS_PER_INCH=25.4/.28})();Ext.namespace("gxp");gxp.EmbedMapDialog=Ext.extend(Ext.Container,{url:null,url:null,publishMessage:gettext("Your map is ready to be published to the web! Simply copy the following HTML to embed the map in your website:"),heightLabel:gettext("Height"),widthLabel:gettext("Width"),mapSizeLabel:gettext("Map Size"),miniSizeLabel:gettext("Mini"),smallSizeLabel:gettext("Small"),premiumSizeLabel:gettext("Premium"),largeSizeLabel:gettext("Large"),snippetArea:null,heightField:null,widthField:null,initComponent:function(){Ext.apply(this,this.getConfig());gxp.EmbedMapDialog.superclass.initComponent.call(this)},getIframeHTML:function(){return this.snippetArea.getValue()},updateSnippet:function(){this.snippetArea.setValue('<iframe style="border: none;" height="'+this.heightField.getValue()+'" width="'+this.widthField.getValue()+'" src="'+gxp.util.getAbsoluteUrl(this.url)+'"></iframe>');if(this.snippetArea.isVisible()===true){this.snippetArea.focus(true,100)}},getConfig:function(){this.snippetArea=new Ext.form.TextArea({height:70,selectOnFocus:true,readOnly:true});var e={change:this.updateSnippet,specialkey:function(e,t){t.getKey()==t.ENTER&&this.updateSnippet()},scope:this};this.heightField=new Ext.form.NumberField({width:50,value:400,listeners:e});this.widthField=new Ext.form.NumberField({width:50,value:600,listeners:e});var t=new Ext.Container({layout:"column",defaults:{border:false,xtype:"box"},items:[{autoEl:{cls:"gxp-field-label",html:this.mapSizeLabel}},new Ext.form.ComboBox({editable:false,width:75,store:new Ext.data.SimpleStore({fields:["name","height","width"],data:[[this.miniSizeLabel,100,100],[this.smallSizeLabel,200,300],[this.largeSizeLabel,400,600],[this.premiumSizeLabel,600,800]]}),triggerAction:"all",displayField:"name",value:this.largeSizeLabel,mode:"local",listeners:{select:function(e,t,i){this.widthField.setValue(t.get("width"));this.heightField.setValue(t.get("height"));this.updateSnippet()},scope:this}}),{autoEl:{cls:"gxp-field-label",html:this.heightLabel}},this.heightField,{autoEl:{cls:"gxp-field-label",html:this.widthLabel}},this.widthField]});return{border:false,defaults:{border:false,cls:"gxp-export-section",xtype:"container",layout:"fit"},items:[{items:[t]},{xtype:"box",autoEl:{tag:"p",html:this.publishMessage}},{items:[this.snippetArea]}],listeners:{afterrender:this.updateSnippet,scope:this}}}});Ext.reg("gxp_embedmapdialog",gxp.EmbedMapDialog);Ext.namespace("gxp");gxp.RulePanel=Ext.extend(Ext.TabPanel,{fonts:undefined,symbolType:"Point",rule:null,attributes:null,nestedFilters:true,minScaleDenominatorLimit:Math.pow(.5,19)*40075016.68*39.3701*OpenLayers.DOTS_PER_INCH/256,maxScaleDenominatorLimit:40075016.68*39.3701*OpenLayers.DOTS_PER_INCH/256,scaleLevels:20,scaleSliderTemplate:"{scaleType} Scale 1:{scale}",modifyScaleTipContext:Ext.emptyFn,labelFeaturesText:gettext("Label Features"),labelsText:gettext("Labels"),basicText:gettext("Basic"),advancedText:gettext("Advanced"),limitByScaleText:gettext("Limit by scale"),limitByConditionText:gettext("Limit by condition"),symbolText:gettext("Symbol"),nameText:gettext("Name"),initComponent:function(){var e={plain:true,border:false};Ext.applyIf(this,e);if(!this.rule){this.rule=new OpenLayers.Rule({name:this.uniqueRuleName()})}else{if(!this.initialConfig.symbolType){this.symbolType=this.getSymbolTypeFromRule(this.rule)||this.symbolType}}this.activeTab=0;this.textSymbolizer=new gxp.TextSymbolizer({symbolizer:this.getTextSymbolizer(),attributes:this.attributes,fonts:this.fonts,listeners:{change:function(e){this.fireEvent("change",this,this.rule)},scope:this}});this.scaleLimitPanel=new gxp.ScaleLimitPanel({maxScaleDenominator:this.rule.maxScaleDenominator||undefined,limitMaxScaleDenominator:!!this.rule.maxScaleDenominator,maxScaleDenominatorLimit:this.maxScaleDenominatorLimit,minScaleDenominator:this.rule.minScaleDenominator||undefined,limitMinScaleDenominator:!!this.rule.minScaleDenominator,minScaleDenominatorLimit:this.minScaleDenominatorLimit,scaleLevels:this.scaleLevels,scaleSliderTemplate:this.scaleSliderTemplate,modifyScaleTipContext:this.modifyScaleTipContext,listeners:{change:function(e,t,i){this.rule.minScaleDenominator=t;this.rule.maxScaleDenominator=i;this.fireEvent("change",this,this.rule)},scope:this}});this.filterBuilder=new gxp.FilterBuilder({allowGroups:this.nestedFilters,filter:this.rule&&this.rule.filter&&this.rule.filter.clone(),attributes:this.attributes,listeners:{change:function(e){var t=e.getFilter();this.rule.filter=t;this.fireEvent("change",this,this.rule)},scope:this}});this.items=[{title:this.labelsText,autoScroll:true,bodyStyle:{padding:"10px"},items:[{xtype:"fieldset",title:this.labelFeaturesText,autoHeight:true,checkboxToggle:true,collapsed:!this.hasTextSymbolizer(),items:[this.textSymbolizer],listeners:{collapse:function(){OpenLayers.Util.removeItem(this.rule.symbolizers,this.getTextSymbolizer());this.fireEvent("change",this,this.rule)},expand:function(){this.setTextSymbolizer(this.textSymbolizer.symbolizer);this.fireEvent("change",this,this.rule)},scope:this}}]}];if(this.getSymbolTypeFromRule(this.rule)||this.symbolType){this.items=[{title:this.basicText,autoScroll:true,items:[this.createHeaderPanel(),this.createSymbolizerPanel()]},this.items[0],{title:this.advancedText,defaults:{style:{margin:"7px"}},autoScroll:true,items:[{xtype:"fieldset",title:this.limitByScaleText,checkboxToggle:true,collapsed:!(this.rule&&(this.rule.minScaleDenominator||this.rule.maxScaleDenominator)),autoHeight:true,items:[this.scaleLimitPanel],listeners:{collapse:function(){delete this.rule.minScaleDenominator;delete this.rule.maxScaleDenominator;this.fireEvent("change",this,this.rule)},expand:function(){var e=this.getActiveTab();this.activeTab=null;this.setActiveTab(e);var t=false;if(this.scaleLimitPanel.limitMinScaleDenominator){this.rule.minScaleDenominator=this.scaleLimitPanel.minScaleDenominator;t=true}if(this.scaleLimitPanel.limitMaxScaleDenominator){this.rule.maxScaleDenominator=this.scaleLimitPanel.maxScaleDenominator;t=true}if(t){this.fireEvent("change",this,this.rule)}},scope:this}},{xtype:"fieldset",title:this.limitByConditionText,checkboxToggle:true,collapsed:!(this.rule&&this.rule.filter),autoHeight:true,items:[this.filterBuilder],listeners:{collapse:function(){delete this.rule.filter;this.fireEvent("change",this,this.rule)},expand:function(){var e=false;this.rule.filter=this.filterBuilder.getFilter();this.fireEvent("change",this,this.rule)},scope:this}}]}]}this.items[0].autoHeight=true;this.addEvents("change");this.on({tabchange:function(e,t){t.doLayout()},scope:this});gxp.RulePanel.superclass.initComponent.call(this)},hasTextSymbolizer:function(){var e,t;for(var i=0,r=this.rule.symbolizers.length;i<r;++i){e=this.rule.symbolizers[i];if(e instanceof OpenLayers.Symbolizer.Text){t=e;break}}return t},getTextSymbolizer:function(){var e=this.hasTextSymbolizer();if(!e){e=new OpenLayers.Symbolizer.Text({graphic:false})}return e},setTextSymbolizer:function(e){var t;for(var i=0,r=this.rule.symbolizers.length;i<r;++i){candidate=this.rule.symbolizers[i];if(this.rule.symbolizers[i]instanceof OpenLayers.Symbolizer.Text){this.rule.symbolizers[i]=e;t=true;break}}if(!t){this.rule.symbolizers.push(e)}},uniqueRuleName:function(){return OpenLayers.Util.createUniqueID("rule_")},createHeaderPanel:function(){this.symbolizerSwatch=new GeoExt.FeatureRenderer({symbolType:this.symbolType,isFormField:true,fieldLabel:this.symbolText});return{xtype:"form",border:false,labelAlign:"top",defaults:{border:false},style:{padding:"0.3em 0 0 1em"},items:[{layout:"column",defaults:{border:false,style:{"padding-right":"1em"}},items:[{layout:"form",width:150,items:[{xtype:"textfield",fieldLabel:this.nameText,anchor:"95%",value:this.rule&&(this.rule.title||this.rule.name||""),listeners:{change:function(e,t){this.rule.title=t;this.fireEvent("change",this,this.rule)},scope:this}}]},{layout:"form",width:70,items:[this.symbolizerSwatch]}]}]}},createSymbolizerPanel:function(){var e,t;var i=OpenLayers.Symbolizer[this.symbolType];var r=false;if(i){for(var a=0,s=this.rule.symbolizers.length;a<s;++a){e=this.rule.symbolizers[a];if(e instanceof i){r=true;t=e;break}}if(!t){t=new i({fill:false,stroke:false})}}else{throw new Error("Appropriate symbolizer type not included in build: "+this.symbolType)}this.symbolizerSwatch.setSymbolizers([t],{draw:this.symbolizerSwatch.rendered});var n={xtype:"gxp_"+this.symbolType.toLowerCase()+"symbolizer",symbolizer:t,bodyStyle:{padding:"10px"},border:false,labelWidth:70,defaults:{labelWidth:70},listeners:{change:function(e){this.symbolizerSwatch.setSymbolizers([e],{draw:this.symbolizerSwatch.rendered});if(!r){this.rule.symbolizers.push(e);r=true}this.fireEvent("change",this,this.rule)},scope:this}};if(this.symbolType==="Point"&&this.pointGraphics){n.pointGraphics=this.pointGraphics}return n},getSymbolTypeFromRule:function(e){var t,i;for(var r=0,a=e.symbolizers.length;r<a;++r){t=e.symbolizers[r];if(!(t instanceof OpenLayers.Symbolizer.Text)){i=t.CLASS_NAME.split(".").pop();break}}return i}});Ext.reg("gxp_rulepanel",gxp.RulePanel);Ext.namespace("gxp");gxp.StylePropertiesDialog=Ext.extend(Ext.Container,{titleText:gettext("General"),nameFieldText:gettext("Name"),titleFieldText:gettext("Title"),abstractFieldText:gettext("Abstract"),userStyle:null,initComponent:function(){var e={change:function(e,t){this.userStyle[e.name]=t;this.fireEvent("change",this,this.userStyle)},scope:this};var t={layout:"form",items:[{xtype:"fieldset",title:this.titleText,labelWidth:75,defaults:{xtype:"textfield",anchor:"100%",listeners:e},items:[{xtype:this.initialConfig.nameEditable?"textfield":"displayfield",fieldLabel:this.nameFieldText,name:"name",value:this.userStyle.name,maskRe:/[A-Za-z0-9_]/},{fieldLabel:this.titleFieldText,name:"title",value:this.userStyle.title},{xtype:"textarea",fieldLabel:this.abstractFieldText,name:"description",value:this.userStyle.description}]}]};Ext.applyIf(this,t);this.addEvents("change");gxp.StylePropertiesDialog.superclass.initComponent.apply(this,arguments)}});Ext.reg("gxp_stylepropertiesdialog",gxp.StylePropertiesDialog);OpenLayers.ElementsIndexer=OpenLayers.Class({maxZIndex:null,order:null,indices:null,compare:null,initialize:function(e){this.compare=e?OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER_Y_ORDER:OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER_DRAWING_ORDER;this.clear()},insert:function(e){if(this.exists(e)){this.remove(e)}var t=e.id;this.determineZIndex(e);var i=-1;var r=this.order.length;var a;while(r-i>1){a=parseInt((i+r)/2);var s=this.compare(this,e,OpenLayers.Util.getElement(this.order[a]));if(s>0){i=a}else{r=a}}this.order.splice(r,0,t);this.indices[t]=this.getZIndex(e);return this.getNextElement(r)},remove:function(e){var t=e.id;var i=OpenLayers.Util.indexOf(this.order,t);if(i>=0){this.order.splice(i,1);delete this.indices[t];if(this.order.length>0){var r=this.order[this.order.length-1];this.maxZIndex=this.indices[r]}else{this.maxZIndex=0}}},clear:function(){this.order=[];this.indices={};this.maxZIndex=0},exists:function(e){return this.indices[e.id]!=null},getZIndex:function(e){return e._style.graphicZIndex},determineZIndex:function(e){var t=e._style.graphicZIndex;if(t==null){t=this.maxZIndex;e._style.graphicZIndex=t}else if(t>this.maxZIndex){this.maxZIndex=t}},getNextElement:function(e){var t=e+1;if(t<this.order.length){var i=OpenLayers.Util.getElement(this.order[t]);if(i==undefined){i=this.getNextElement(t)}return i}else{return null}},CLASS_NAME:"OpenLayers.ElementsIndexer"});OpenLayers.ElementsIndexer.IndexingMethods={Z_ORDER:function(e,t,i){var r=e.getZIndex(t);var a=0;if(i){var s=e.getZIndex(i);a=r-s}return a},Z_ORDER_DRAWING_ORDER:function(e,t,i){var r=OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER(e,t,i);if(i&&r==0){r=1}return r},Z_ORDER_Y_ORDER:function(e,t,i){var r=OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER(e,t,i);if(i&&r===0){var a=i._boundsBottom-t._boundsBottom;r=a===0?1:a}return r}};OpenLayers.Renderer.Elements=OpenLayers.Class(OpenLayers.Renderer,{rendererRoot:null,root:null,vectorRoot:null,textRoot:null,xmlns:null,xOffset:0,indexer:null,BACKGROUND_ID_SUFFIX:"_background",LABEL_ID_SUFFIX:"_label",LABEL_OUTLINE_SUFFIX:"_outline",initialize:function(e,t){OpenLayers.Renderer.prototype.initialize.apply(this,arguments);this.rendererRoot=this.createRenderRoot();this.root=this.createRoot("_root");this.vectorRoot=this.createRoot("_vroot");this.textRoot=this.createRoot("_troot");this.root.appendChild(this.vectorRoot);this.root.appendChild(this.textRoot);this.rendererRoot.appendChild(this.root);this.container.appendChild(this.rendererRoot);if(t&&(t.zIndexing||t.yOrdering)){this.indexer=new OpenLayers.ElementsIndexer(t.yOrdering)}},destroy:function(){this.clear();this.rendererRoot=null;this.root=null;this.xmlns=null;OpenLayers.Renderer.prototype.destroy.apply(this,arguments)},clear:function(){var e;var t=this.vectorRoot;if(t){while(e=t.firstChild){t.removeChild(e)}}t=this.textRoot;if(t){while(e=t.firstChild){t.removeChild(e)}}if(this.indexer){this.indexer.clear()}},setExtent:function(e,t){var i=OpenLayers.Renderer.prototype.setExtent.apply(this,arguments);var r=this.getResolution();if(this.map.baseLayer&&this.map.baseLayer.wrapDateLine){var a,s=e.getWidth()/this.map.getExtent().getWidth(),e=e.scale(1/s),n=this.map.getMaxExtent();if(n.right>e.left&&n.right<e.right){a=true}else if(n.left>e.left&&n.left<e.right){a=false}if(a!==this.rightOfDateLine||t){i=false;this.xOffset=a===true?n.getWidth()/r:0}this.rightOfDateLine=a}return i},getNodeType:function(e,t){},drawGeometry:function(e,t,i){var r=e.CLASS_NAME;var a=true;if(r=="OpenLayers.Geometry.Collection"||r=="OpenLayers.Geometry.MultiPoint"||r=="OpenLayers.Geometry.MultiLineString"||r=="OpenLayers.Geometry.MultiPolygon"){for(var s=0,n=e.components.length;s<n;s++){a=this.drawGeometry(e.components[s],t,i)&&a}return a}a=false;var o=false;if(t.display!="none"){if(t.backgroundGraphic){this.redrawBackgroundNode(e.id,e,t,i)}else{o=true}a=this.redrawNode(e.id,e,t,i)}if(a==false){var l=document.getElementById(e.id);if(l){if(l._style.backgroundGraphic){o=true}l.parentNode.removeChild(l)}}if(o){var l=document.getElementById(e.id+this.BACKGROUND_ID_SUFFIX);if(l){l.parentNode.removeChild(l)}}return a},redrawNode:function(e,t,i,r){i=this.applyDefaultSymbolizer(i);var a=this.nodeFactory(e,this.getNodeType(t,i));a._featureId=r;a._boundsBottom=t.getBounds().bottom;a._geometryClass=t.CLASS_NAME;a._style=i;var s=this.drawGeometryNode(a,t,i);if(s===false){return false}a=s.node;if(this.indexer){var n=this.indexer.insert(a);if(n){this.vectorRoot.insertBefore(a,n)}else{this.vectorRoot.appendChild(a)}}else{if(typeof a=="undefined")return;if(a.parentNode!==this.vectorRoot){this.vectorRoot.appendChild(a)}}this.postDraw(a);return s.complete},redrawBackgroundNode:function(e,t,i,r){var a=OpenLayers.Util.extend({},i);a.externalGraphic=a.backgroundGraphic;a.graphicXOffset=a.backgroundXOffset;a.graphicYOffset=a.backgroundYOffset;a.graphicZIndex=a.backgroundGraphicZIndex;a.graphicWidth=a.backgroundWidth||a.graphicWidth;a.graphicHeight=a.backgroundHeight||a.graphicHeight;a.backgroundGraphic=null;a.backgroundXOffset=null;a.backgroundYOffset=null;a.backgroundGraphicZIndex=null;return this.redrawNode(e+this.BACKGROUND_ID_SUFFIX,t,a,null)},drawGeometryNode:function(e,t,i){i=i||e._style;var r={isFilled:i.fill===undefined?true:i.fill,isStroked:i.stroke===undefined?!!i.strokeWidth:i.stroke};var a;switch(t.CLASS_NAME){case"OpenLayers.Geometry.Point":if(i.graphic===false){r.isFilled=false;r.isStroked=false}a=this.drawPoint(e,t);break;case"OpenLayers.Geometry.LineString":r.isFilled=false;a=this.drawLineString(e,t);break;case"OpenLayers.Geometry.LinearRing":a=this.drawLinearRing(e,t);break;case"OpenLayers.Geometry.Polygon":a=this.drawPolygon(e,t);break;case"OpenLayers.Geometry.Rectangle":a=this.drawRectangle(e,t);break;default:break}e._options=r;if(a!=false){return{node:this.setStyle(e,i,r,t),complete:a}}else{return false}},postDraw:function(e){},drawPoint:function(e,t){},drawLineString:function(e,t){},drawLinearRing:function(e,t){},drawPolygon:function(e,t){},drawRectangle:function(e,t){},drawCircle:function(e,t){},removeText:function(e){var t=document.getElementById(e+this.LABEL_ID_SUFFIX);if(t){this.textRoot.removeChild(t)}var i=document.getElementById(e+this.LABEL_OUTLINE_SUFFIX);if(i){this.textRoot.removeChild(i)}},getFeatureIdFromEvent:function(e){var t=e.target;var i=t&&t.correspondingUseElement;var r=i?i:t||e.srcElement;return r._featureId},eraseGeometry:function(e,t){if(e.CLASS_NAME=="OpenLayers.Geometry.MultiPoint"||e.CLASS_NAME=="OpenLayers.Geometry.MultiLineString"||e.CLASS_NAME=="OpenLayers.Geometry.MultiPolygon"||e.CLASS_NAME=="OpenLayers.Geometry.Collection"){for(var i=0,r=e.components.length;i<r;i++){this.eraseGeometry(e.components[i],t)}}else{var a=OpenLayers.Util.getElement(e.id);if(a&&a.parentNode){if(a.geometry){a.geometry.destroy();a.geometry=null}a.parentNode.removeChild(a);if(this.indexer){this.indexer.remove(a)}if(a._style.backgroundGraphic){var s=e.id+this.BACKGROUND_ID_SUFFIX;var n=OpenLayers.Util.getElement(s);if(n&&n.parentNode){n.parentNode.removeChild(n)}}}}},nodeFactory:function(e,t){var i=OpenLayers.Util.getElement(e);if(i){if(!this.nodeTypeCompare(i,t)){i.parentNode.removeChild(i);i=this.nodeFactory(e,t)}}else{i=this.createNode(t,e)}return i},nodeTypeCompare:function(e,t){},createNode:function(e,t){},moveRoot:function(e){var t=this.root;if(e.root.parentNode==this.rendererRoot){t=e.root}t.parentNode.removeChild(t);e.rendererRoot.appendChild(t)},getRenderLayerId:function(){return this.root.parentNode.parentNode.id},isComplexSymbol:function(e){return e!="circle"&&!!e},CLASS_NAME:"OpenLayers.Renderer.Elements"});OpenLayers.Renderer.SVG=OpenLayers.Class(OpenLayers.Renderer.Elements,{xmlns:"http://www.w3.org/2000/svg",xlinkns:"http://www.w3.org/1999/xlink",MAX_PIXEL:15e3,translationParameters:null,symbolMetrics:null,initialize:function(e){if(!this.supported()){return}OpenLayers.Renderer.Elements.prototype.initialize.apply(this,arguments);this.translationParameters={x:0,y:0};this.symbolMetrics={}},supported:function(){var e="http://www.w3.org/TR/SVG11/feature#";return document.implementation&&(document.implementation.hasFeature("org.w3c.svg","1.0")||document.implementation.hasFeature(e+"SVG","1.1")||document.implementation.hasFeature(e+"BasicStructure","1.1"))},inValidRange:function(e,t,i){var r=e+(i?0:this.translationParameters.x);var a=t+(i?0:this.translationParameters.y);return r>=-this.MAX_PIXEL&&r<=this.MAX_PIXEL&&a>=-this.MAX_PIXEL&&a<=this.MAX_PIXEL},setExtent:function(e,t){var i=OpenLayers.Renderer.Elements.prototype.setExtent.apply(this,arguments);var r=this.getResolution(),a=-e.left/r,s=e.top/r;if(t){this.left=a;this.top=s;var n="0 0 "+this.size.w+" "+this.size.h;this.rendererRoot.setAttributeNS(null,"viewBox",n);this.translate(this.xOffset,0);return true}else{var o=this.translate(a-this.left+this.xOffset,s-this.top);if(!o){this.setExtent(e,true)}return i&&o}},translate:function(e,t){if(!this.inValidRange(e,t,true)){return false}else{var i="";if(e||t){i="translate("+e+","+t+")"}this.root.setAttributeNS(null,"transform",i);this.translationParameters={x:e,y:t};return true}},setSize:function(e){OpenLayers.Renderer.prototype.setSize.apply(this,arguments);this.rendererRoot.setAttributeNS(null,"width",this.size.w);this.rendererRoot.setAttributeNS(null,"height",this.size.h)},getNodeType:function(e,t){var i=null;switch(e.CLASS_NAME){case"OpenLayers.Geometry.Point":if(t.externalGraphic){i="image"}else if(this.isComplexSymbol(t.graphicName)){i="svg"}else{i="circle"}break;case"OpenLayers.Geometry.Rectangle":i="rect";break;case"OpenLayers.Geometry.LineString":i="polyline";break;case"OpenLayers.Geometry.LinearRing":i="polygon";break;case"OpenLayers.Geometry.Polygon":case"OpenLayers.Geometry.Curve":i="path";break;default:break}return i},setStyle:function(e,t,i){t=t||e._style;i=i||e._options;var r=t.title||t.graphicTitle;if(r){e.setAttributeNS(null,"title",r);var p=e.getElementsByTagName("title");if(p.length>0){p[0].firstChild.textContent=r}else{var u=this.nodeFactory(null,"title");u.textContent=r;e.appendChild(u)}}var c=parseFloat(e.getAttributeNS(null,"r"));var d=1;var a;if(e._geometryClass=="OpenLayers.Geometry.Point"&&c){e.style.visibility="";if(t.graphic===false){e.style.visibility="hidden"}else if(t.externalGraphic){a=this.getPosition(e);if(t.graphicWidth&&t.graphicHeight){e.setAttributeNS(null,"preserveAspectRatio","none")}var s=t.graphicWidth||t.graphicHeight;var n=t.graphicHeight||t.graphicWidth;s=s?s:t.pointRadius*2;n=n?n:t.pointRadius*2;var f=t.graphicXOffset!=undefined?t.graphicXOffset:-(.5*s);var y=t.graphicYOffset!=undefined?t.graphicYOffset:-(.5*n);var g=t.graphicOpacity||t.fillOpacity;e.setAttributeNS(null,"x",(a.x+f).toFixed());e.setAttributeNS(null,"y",(a.y+y).toFixed());e.setAttributeNS(null,"width",s);e.setAttributeNS(null,"height",n);e.setAttributeNS(this.xlinkns,"xlink:href",t.externalGraphic);e.setAttributeNS(null,"style","opacity: "+g);e.onclick=OpenLayers.Event.preventDefault}else if(this.isComplexSymbol(t.graphicName)){if(t.graphicName.substring(0,6)=="ttf://")return;var m=t.pointRadius*3;var v=m*2;var o=this.importSymbol(t.graphicName);a=this.getPosition(e);d=this.symbolMetrics[o.id][0]*3/v;var l=e.parentNode;var x=e.nextSibling;if(l){l.removeChild(e)}e.firstChild&&e.removeChild(e.firstChild);e.appendChild(o.firstChild.cloneNode(true));e.setAttributeNS(null,"viewBox",o.getAttributeNS(null,"viewBox"));e.setAttributeNS(null,"width",v);e.setAttributeNS(null,"height",v);e.setAttributeNS(null,"x",a.x-m);e.setAttributeNS(null,"y",a.y-m);if(x){l.insertBefore(e,x)}else if(l){l.appendChild(e)}}else{e.setAttributeNS(null,"r",t.pointRadius)}var h=t.rotation;if((h!==undefined||e._rotation!==undefined)&&a){e._rotation=h;h|=0;if(e.nodeName!=="svg"){e.setAttributeNS(null,"transform","rotate("+h+" "+a.x+" "+a.y+")")}else{var L=this.symbolMetrics[o.id];e.firstChild.setAttributeNS(null,"transform","rotate("+h+" "+L[1]+" "+L[2]+")")}}}if(i.isFilled){e.setAttributeNS(null,"fill",t.fillColor);e.setAttributeNS(null,"fill-opacity",t.fillOpacity)}else{e.setAttributeNS(null,"fill","none")}if(i.isStroked){e.setAttributeNS(null,"stroke",t.strokeColor);e.setAttributeNS(null,"stroke-opacity",t.strokeOpacity);e.setAttributeNS(null,"stroke-width",t.strokeWidth*d);e.setAttributeNS(null,"stroke-linecap",t.strokeLinecap||"round");e.setAttributeNS(null,"stroke-linejoin","round");t.strokeDashstyle&&e.setAttributeNS(null,"stroke-dasharray",this.dashStyle(t,d))}else{e.setAttributeNS(null,"stroke","none")}if(t.pointerEvents){e.setAttributeNS(null,"pointer-events",t.pointerEvents)}if(t.cursor!=null){e.setAttributeNS(null,"cursor",t.cursor)}return e},dashStyle:function(e,t){var i=e.strokeWidth*t;var r=e.strokeDashstyle;switch(r){case"solid":return"none";case"dot":return[1,4*i].join();case"dash":return[4*i,4*i].join();case"dashdot":return[4*i,4*i,1,4*i].join();case"longdash":return[8*i,4*i].join();case"longdashdot":return[8*i,4*i,1,4*i].join();default:return OpenLayers.String.trim(r).replace(/\s+/g,",")}},createNode:function(e,t){var i=document.createElementNS(this.xmlns,e);if(t){i.setAttributeNS(null,"id",t)}return i},nodeTypeCompare:function(e,t){return t==e.nodeName},createRenderRoot:function(){var e=this.nodeFactory(this.container.id+"_svgRoot","svg");e.style.display="block";return e},createRoot:function(e){return this.nodeFactory(this.container.id+e,"g")},createDefs:function(){var e=this.nodeFactory(this.container.id+"_defs","defs");this.rendererRoot.appendChild(e);return e},drawPoint:function(e,t){return this.drawCircle(e,t,1)},drawCircle:function(e,t,i){var r=this.getResolution();var a=(t.x-this.featureDx)/r+this.left;var s=this.top-t.y/r;if(this.inValidRange(a,s)){e.setAttributeNS(null,"cx",a);e.setAttributeNS(null,"cy",s);e.setAttributeNS(null,"r",i);return e}else{return false}},drawLineString:function(e,t){var i=this.getComponentsString(t.components);if(i.path){e.setAttributeNS(null,"points",i.path);return i.complete?e:null}else{return false}},drawLinearRing:function(e,t){var i=this.getComponentsString(t.components);if(i.path){e.setAttributeNS(null,"points",i.path);return i.complete?e:null}else{return false}},drawPolygon:function(e,t){var i="";var r=true;var a=true;var s,n;for(var o=0,l=t.components.length;o<l;o++){i+=" M";s=this.getComponentsString(t.components[o].components," ");n=s.path;if(n){i+=" "+n;a=s.complete&&a}else{r=false}}i+=" z";if(r){e.setAttributeNS(null,"d",i);e.setAttributeNS(null,"fill-rule","evenodd");return a?e:null}else{return false}},drawRectangle:function(e,t){var i=this.getResolution();var r=(t.x-this.featureDx)/i+this.left;var a=this.top-t.y/i;if(this.inValidRange(r,a)){e.setAttributeNS(null,"x",r);e.setAttributeNS(null,"y",a);e.setAttributeNS(null,"width",t.width/i);e.setAttributeNS(null,"height",t.height/i);return e}else{return false}},drawText:function(e,t,i){var p=!!t.labelOutlineWidth;if(p){var r=OpenLayers.Util.extend({},t);r.fontColor=r.labelOutlineColor;r.fontStrokeColor=r.labelOutlineColor;r.fontStrokeWidth=t.labelOutlineWidth;if(t.labelOutlineOpacity){r.fontOpacity=t.labelOutlineOpacity}delete r.labelOutlineWidth;this.drawText(e,r,i)}var u=this.getResolution();var c=(i.x-this.featureDx)/u+this.left;var d=i.y/u-this.top;var f=p?this.LABEL_OUTLINE_SUFFIX:this.LABEL_ID_SUFFIX;var a=this.nodeFactory(e+f,"text");a.setAttributeNS(null,"x",c);a.setAttributeNS(null,"y",-d);if(t.fontColor){a.setAttributeNS(null,"fill",t.fontColor)}if(t.fontStrokeColor){a.setAttributeNS(null,"stroke",t.fontStrokeColor)}if(t.fontStrokeWidth){a.setAttributeNS(null,"stroke-width",t.fontStrokeWidth)}if(t.fontOpacity){a.setAttributeNS(null,"opacity",t.fontOpacity)}if(t.fontFamily){a.setAttributeNS(null,"font-family",t.fontFamily)}if(t.fontSize){a.setAttributeNS(null,"font-size",t.fontSize)}if(t.fontWeight){a.setAttributeNS(null,"font-weight",t.fontWeight)}if(t.fontStyle){a.setAttributeNS(null,"font-style",t.fontStyle)}if(t.labelSelect===true){a.setAttributeNS(null,"pointer-events","visible");a._featureId=e}else{a.setAttributeNS(null,"pointer-events","none")}var s=t.labelAlign||OpenLayers.Renderer.defaultSymbolizer.labelAlign;a.setAttributeNS(null,"text-anchor",OpenLayers.Renderer.SVG.LABEL_ALIGN[s[0]]||"middle");if(OpenLayers.IS_GECKO===true){a.setAttributeNS(null,"dominant-baseline",OpenLayers.Renderer.SVG.LABEL_ALIGN[s[1]]||"central")}var n=t.label.split("\n");var o=n.length;while(a.childNodes.length>o){a.removeChild(a.lastChild)}for(var l=0;l<o;l++){var h=this.nodeFactory(e+f+"_tspan_"+l,"tspan");if(t.labelSelect===true){h._featureId=e;h._geometry=i;h._geometryClass=i.CLASS_NAME}if(OpenLayers.IS_GECKO===false){h.setAttributeNS(null,"baseline-shift",OpenLayers.Renderer.SVG.LABEL_VSHIFT[s[1]]||"-35%")}h.setAttribute("x",c);if(l==0){var y=OpenLayers.Renderer.SVG.LABEL_VFACTOR[s[1]];if(y==null){y=-.5}h.setAttribute("dy",y*(o-1)+"em")}else{h.setAttribute("dy","1em")}h.textContent=n[l]===""?" ":n[l];if(!h.parentNode){a.appendChild(h)}}if(!a.parentNode){this.textRoot.appendChild(a)}},getComponentsString:function(e,t){var i=[];var r=true;var a=e.length;var s=[];var n,o;for(var l=0;l<a;l++){o=e[l];i.push(o);n=this.getShortString(o);if(n){s.push(n)}else{if(l>0){if(this.getShortString(e[l-1])){s.push(this.clipLine(e[l],e[l-1]))}}if(l<a-1){if(this.getShortString(e[l+1])){s.push(this.clipLine(e[l],e[l+1]))}}r=false}}return{path:s.join(t||","),complete:r}},clipLine:function(e,t){if(t.equals(e)){return""}var i=this.getResolution();var r=this.MAX_PIXEL-this.translationParameters.x;var a=this.MAX_PIXEL-this.translationParameters.y;var s=(t.x-this.featureDx)/i+this.left;var n=this.top-t.y/i;var o=(e.x-this.featureDx)/i+this.left;var l=this.top-e.y/i;var h;if(o<-r||o>r){h=(l-n)/(o-s);o=o<0?-r:r;l=n+(o-s)*h}if(l<-a||l>a){h=(o-s)/(l-n);l=l<0?-a:a;o=s+(l-n)*h}return o+","+l},getShortString:function(e){var t=this.getResolution();var i=(e.x-this.featureDx)/t+this.left;var r=this.top-e.y/t;if(this.inValidRange(i,r)){return i+","+r}else{return false}},getPosition:function(e){return{x:parseFloat(e.getAttributeNS(null,"cx")),y:parseFloat(e.getAttributeNS(null,"cy"))}},importSymbol:function(e){if(!this.defs){this.defs=this.createDefs()}var t=this.container.id+"-"+e;var p=document.getElementById(t);if(p!=null){return p}if(e.substring(0,6)=="ttf://")return;var i=OpenLayers.Renderer.symbol[e];if(!i){throw new Error(e+" is not a valid symbol name")}var r=this.nodeFactory(t,"symbol");var u=this.nodeFactory(null,"polygon");r.appendChild(u);var a=new OpenLayers.Bounds(Number.MAX_VALUE,Number.MAX_VALUE,0,0);var c=[];var s,n;for(var o=0;o<i.length;o=o+2){s=i[o];n=i[o+1];a.left=Math.min(a.left,s);a.bottom=Math.min(a.bottom,n);a.right=Math.max(a.right,s);a.top=Math.max(a.top,n);c.push(s,",",n)}u.setAttributeNS(null,"points",c.join(" "));var l=a.getWidth();var h=a.getHeight();var d=[a.left-l,a.bottom-h,l*3,h*3];r.setAttributeNS(null,"viewBox",d.join(" "));this.symbolMetrics[t]=[Math.max(l,h),a.getCenterLonLat().lon,a.getCenterLonLat().lat];this.defs.appendChild(r);return r},getFeatureIdFromEvent:function(e){var t=OpenLayers.Renderer.Elements.prototype.getFeatureIdFromEvent.apply(this,arguments);if(!t){var i=e.target;t=i.parentNode&&i!=this.rendererRoot?i.parentNode._featureId:undefined}return t},CLASS_NAME:"OpenLayers.Renderer.SVG"});OpenLayers.Renderer.SVG.LABEL_ALIGN={l:"start",r:"end",b:"bottom",t:"hanging"};OpenLayers.Renderer.SVG.LABEL_VSHIFT={t:"-70%",b:"0"};OpenLayers.Renderer.SVG.LABEL_VFACTOR={t:0,b:-1};OpenLayers.Renderer.SVG.preventDefault=function(e){OpenLayers.Event.preventDefault(e)};OpenLayers.Renderer.VML=OpenLayers.Class(OpenLayers.Renderer.Elements,{xmlns:"urn:schemas-microsoft-com:vml",symbolCache:{},offset:null,initialize:function(e){if(!this.supported()){return}if(!document.namespaces.olv){document.namespaces.add("olv",this.xmlns);var t=document.createStyleSheet();var i=["shape","rect","oval","fill","stroke","imagedata","group","textbox"];for(var r=0,a=i.length;r<a;r++){t.addRule("olv\\:"+i[r],"behavior: url(#default#VML); "+"position: absolute; display: inline-block;")}}OpenLayers.Renderer.Elements.prototype.initialize.apply(this,arguments)},supported:function(){return!!document.namespaces},setExtent:function(e,t){var i=OpenLayers.Renderer.Elements.prototype.setExtent.apply(this,arguments);var r=this.getResolution();var a=e.left/r|0;var s=e.top/r-this.size.h|0;if(t||!this.offset){this.offset={x:a,y:s};a=0;s=0}else{a=a-this.offset.x;s=s-this.offset.y}var h=a-this.xOffset+" "+s;this.root.coordorigin=h;var n=[this.root,this.vectorRoot,this.textRoot];var o;for(var l=0,p=n.length;l<p;++l){o=n[l];var u=this.size.w+" "+this.size.h;o.coordsize=u}this.root.style.flip="y";return i},setSize:function(e){OpenLayers.Renderer.prototype.setSize.apply(this,arguments);var t=[this.rendererRoot,this.root,this.vectorRoot,this.textRoot];var i=this.size.w+"px";var r=this.size.h+"px";var a;for(var s=0,n=t.length;s<n;++s){a=t[s];a.style.width=i;a.style.height=r}},getNodeType:function(e,t){var i=null;switch(e.CLASS_NAME){case"OpenLayers.Geometry.Point":if(t.externalGraphic){i="olv:rect"}else if(this.isComplexSymbol(t.graphicName)){i="olv:shape"}else{i="olv:oval"}break;case"OpenLayers.Geometry.Rectangle":i="olv:rect";break;case"OpenLayers.Geometry.LineString":case"OpenLayers.Geometry.LinearRing":case"OpenLayers.Geometry.Polygon":case"OpenLayers.Geometry.Curve":i="olv:shape";break;default:break}return i},setStyle:function(e,t,i,r){t=t||e._style;i=i||e._options;var p=t.fillColor;var u=t.title||t.graphicTitle;if(u){e.title=u}if(e._geometryClass==="OpenLayers.Geometry.Point"){if(t.externalGraphic){i.isFilled=true;var a=t.graphicWidth||t.graphicHeight;var s=t.graphicHeight||t.graphicWidth;a=a?a:t.pointRadius*2;s=s?s:t.pointRadius*2;var c=this.getResolution();var d=t.graphicXOffset!=undefined?t.graphicXOffset:-(.5*a);var f=t.graphicYOffset!=undefined?t.graphicYOffset:-(.5*s);e.style.left=((r.x-this.featureDx)/c-this.offset.x+d|0)+"px";e.style.top=(r.y/c-this.offset.y-(f+s)|0)+"px";e.style.width=a+"px";e.style.height=s+"px";e.style.flip="y";p="none";i.isStroked=false}else if(this.isComplexSymbol(t.graphicName)){var n=this.importSymbol(t.graphicName);e.path=n.path;e.coordorigin=n.left+","+n.bottom;var y=n.size;e.coordsize=y+","+y;this.drawCircle(e,r,t.pointRadius);e.style.flip="y"}else{this.drawCircle(e,r,t.pointRadius)}}if(i.isFilled){e.fillcolor=p}else{e.filled="false"}var g=e.getElementsByTagName("fill");var o=g.length==0?null:g[0];if(!i.isFilled){if(o){e.removeChild(o)}}else{if(!o){o=this.createNode("olv:fill",e.id+"_fill")}o.opacity=t.fillOpacity;if(e._geometryClass==="OpenLayers.Geometry.Point"&&t.externalGraphic){if(t.graphicOpacity){o.opacity=t.graphicOpacity}o.src=t.externalGraphic;o.type="frame";if(!(t.graphicWidth&&t.graphicHeight)){o.aspect="atmost"}}if(o.parentNode!=e){e.appendChild(o)}}var l=t.rotation;if(l!==undefined||e._rotation!==undefined){e._rotation=l;if(t.externalGraphic){this.graphicRotate(e,d,f,t);o.opacity=0}else if(e._geometryClass==="OpenLayers.Geometry.Point"){e.style.rotation=l||0}}var m=e.getElementsByTagName("stroke");var h=m.length==0?null:m[0];if(!i.isStroked){e.stroked=false;if(h){h.on=false}}else{if(!h){h=this.createNode("olv:stroke",e.id+"_stroke");e.appendChild(h)}h.on=true;h.color=t.strokeColor;h.weight=t.strokeWidth+"px";h.opacity=t.strokeOpacity;h.endcap=t.strokeLinecap=="butt"?"flat":t.strokeLinecap||"round";if(t.strokeDashstyle){h.dashstyle=this.dashStyle(t)}}if(t.cursor!="inherit"&&t.cursor!=null){e.style.cursor=t.cursor}return e},graphicRotate:function(e,t,p,i){var i=i||e._style;var u=i.rotation||0;var r,a;if(!(i.graphicWidth&&i.graphicHeight)){var s=new Image;s.onreadystatechange=OpenLayers.Function.bind(function(){if(s.readyState=="complete"||s.readyState=="interactive"){r=s.width/s.height;a=Math.max(i.pointRadius*2,i.graphicWidth||0,i.graphicHeight||0);t=t*r;i.graphicWidth=a*r;i.graphicHeight=a;this.graphicRotate(e,t,p,i)}},this);s.src=i.externalGraphic;return}else{a=Math.max(i.graphicWidth,i.graphicHeight);r=i.graphicWidth/i.graphicHeight}var n=Math.round(i.graphicWidth||a*r);var o=Math.round(i.graphicHeight||a);e.style.width=n+"px";e.style.height=o+"px";var l=document.getElementById(e.id+"_image");if(!l){l=this.createNode("olv:imagedata",e.id+"_image");e.appendChild(l)}l.style.width=n+"px";l.style.height=o+"px";l.src=i.externalGraphic;l.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader("+"src='', sizingMethod='scale')";var c=u*Math.PI/180;var d=Math.sin(c);var f=Math.cos(c);var y="progid:DXImageTransform.Microsoft.Matrix(M11="+f+",M12="+-d+",M21="+d+",M22="+f+",SizingMethod='auto expand')\n";var h=i.graphicOpacity||i.fillOpacity;if(h&&h!=1){y+="progid:DXImageTransform.Microsoft.BasicImage(opacity="+h+")\n"}e.style.filter=y;var g=new OpenLayers.Geometry.Point(-t,-p);var m=new OpenLayers.Bounds(0,0,n,o).toGeometry();m.rotate(i.rotation,g);var v=m.getBounds();e.style.left=Math.round(parseInt(e.style.left)+v.left)+"px";e.style.top=Math.round(parseInt(e.style.top)-v.bottom)+"px"},postDraw:function(e){e.style.visibility="visible";var t=e._style.fillColor;var i=e._style.strokeColor;if(t=="none"&&e.fillcolor!=t){e.fillcolor=t}if(i=="none"&&e.strokecolor!=i){e.strokecolor=i}},setNodeDimension:function(e,t){var i=t.getBounds();if(i){var r=this.getResolution();var a=new OpenLayers.Bounds((i.left-this.featureDx)/r-this.offset.x|0,i.bottom/r-this.offset.y|0,(i.right-this.featureDx)/r-this.offset.x|0,i.top/r-this.offset.y|0);e.style.left=a.left+"px";e.style.top=a.top+"px";e.style.width=a.getWidth()+"px";e.style.height=a.getHeight()+"px";e.coordorigin=a.left+" "+a.top;e.coordsize=a.getWidth()+" "+a.getHeight()}},dashStyle:function(e){var t=e.strokeDashstyle;switch(t){case"solid":case"dot":case"dash":case"dashdot":case"longdash":case"longdashdot":return t;default:var i=t.split(/[ ,]/);if(i.length==2){if(1*i[0]>=2*i[1]){return"longdash"}return i[0]==1||i[1]==1?"dot":"dash"}else if(i.length==4){return 1*i[0]>=2*i[1]?"longdashdot":"dashdot"}return"solid"}},createNode:function(e,t){var i=document.createElement(e);if(t){i.id=t}i.unselectable="on";i.onselectstart=OpenLayers.Function.False;return i},nodeTypeCompare:function(e,t){var i=t;var r=i.indexOf(":");if(r!=-1){i=i.substr(r+1)}var a=e.nodeName;r=a.indexOf(":");if(r!=-1){a=a.substr(r+1)}return i==a},createRenderRoot:function(){return this.nodeFactory(this.container.id+"_vmlRoot","div")},createRoot:function(e){return this.nodeFactory(this.container.id+e,"olv:group")},drawPoint:function(e,t){return this.drawCircle(e,t,1)},drawCircle:function(e,t,i){if(!isNaN(t.x)&&!isNaN(t.y)){var r=this.getResolution();e.style.left=((t.x-this.featureDx)/r-this.offset.x|0)-i+"px";e.style.top=(t.y/r-this.offset.y|0)-i+"px";var a=i*2;e.style.width=a+"px";e.style.height=a+"px";return e}return false},drawLineString:function(e,t){return this.drawLine(e,t,false)},drawLinearRing:function(e,t){return this.drawLine(e,t,true)},drawLine:function(e,t,i){this.setNodeDimension(e,t);var r=this.getResolution();var a=t.components.length;var s=new Array(a);var n,o,l;for(var h=0;h<a;h++){n=t.components[h];o=(n.x-this.featureDx)/r-this.offset.x|0;l=n.y/r-this.offset.y|0;s[h]=" "+o+","+l+" l "}var p=i?" x e":" e";e.path="m"+s.join("")+p;return e},drawPolygon:function(e,t){this.setNodeDimension(e,t);var p=this.getResolution();var i=[];var r,u,a,s,n,o,l,c,d,h,f,y;for(r=0,u=t.components.length;r<u;r++){i.push("m");a=t.components[r].components;s=r===0;n=null;o=null;for(l=0,c=a.length;l<c;l++){d=a[l];f=(d.x-this.featureDx)/p-this.offset.x|0;y=d.y/p-this.offset.y|0;h=" "+f+","+y;i.push(h);if(l==0){i.push(" l")}if(!s){if(!n){n=h}else if(n!=h){if(!o){o=h}else if(o!=h){s=true}}}}i.push(s?" x ":" ")}i.push("e");e.path=i.join("");return e},drawRectangle:function(e,t){var i=this.getResolution();e.style.left=((t.x-this.featureDx)/i-this.offset.x|0)+"px";e.style.top=(t.y/i-this.offset.y|0)+"px";e.style.width=(t.width/i|0)+"px";e.style.height=(t.height/i|0)+"px";return e},drawText:function(e,t,i){var r=this.nodeFactory(e+this.LABEL_ID_SUFFIX,"olv:rect");var a=this.nodeFactory(e+this.LABEL_ID_SUFFIX+"_textbox","olv:textbox");var s=this.getResolution();r.style.left=((i.x-this.featureDx)/s-this.offset.x|0)+"px";r.style.top=(i.y/s-this.offset.y|0)+"px";r.style.flip="y";a.innerText=t.label;if(t.cursor!="inherit"&&t.cursor!=null){a.style.cursor=t.cursor}if(t.fontColor){a.style.color=t.fontColor}if(t.fontOpacity){a.style.filter="alpha(opacity="+t.fontOpacity*100+")"}if(t.fontFamily){a.style.fontFamily=t.fontFamily}if(t.fontSize){a.style.fontSize=t.fontSize}if(t.fontWeight){a.style.fontWeight=t.fontWeight}if(t.fontStyle){a.style.fontStyle=t.fontStyle}if(t.labelSelect===true){r._featureId=e;a._featureId=e;a._geometry=i;a._geometryClass=i.CLASS_NAME}a.style.whiteSpace="nowrap";a.inset="1px,0px,0px,0px";if(!r.parentNode){r.appendChild(a);this.textRoot.appendChild(r)}var n=t.labelAlign||"cm";if(n.length==1){n+="m"}var o=a.clientWidth*OpenLayers.Renderer.VML.LABEL_SHIFT[n.substr(0,1)];var l=a.clientHeight*OpenLayers.Renderer.VML.LABEL_SHIFT[n.substr(1,1)];r.style.left=parseInt(r.style.left)-o-1+"px";r.style.top=parseInt(r.style.top)+l+"px"},moveRoot:function(e){var t=this.map.getLayer(e.container.id);if(t instanceof OpenLayers.Layer.Vector.RootContainer){t=this.map.getLayer(this.container.id)}t&&t.renderer.clear();OpenLayers.Renderer.Elements.prototype.moveRoot.apply(this,arguments);t&&t.redraw()},importSymbol:function(e){var t=this.container.id+"-"+e;var i=this.symbolCache[t];if(i){return i}var r=OpenLayers.Renderer.symbol[e];if(!r){throw new Error(e+" is not a valid symbol name")}var a=new OpenLayers.Bounds(Number.MAX_VALUE,Number.MAX_VALUE,0,0);var s=["m"];for(var n=0;n<r.length;n=n+2){var o=r[n];var l=r[n+1];a.left=Math.min(a.left,o);a.bottom=Math.min(a.bottom,l);a.right=Math.max(a.right,o);a.top=Math.max(a.top,l);s.push(o);s.push(l);if(n==0){s.push("l")}}s.push("x e");var p=s.join(" ");var h=(a.getWidth()-a.getHeight())/2;if(h>0){a.bottom=a.bottom-h;a.top=a.top+h}else{a.left=a.left+h;a.right=a.right-h}i={path:p,size:a.getWidth(),left:a.left,bottom:a.bottom};this.symbolCache[t]=i;return i},CLASS_NAME:"OpenLayers.Renderer.VML"});OpenLayers.Renderer.VML.LABEL_SHIFT={l:0,c:.5,r:1,t:0,m:.5,b:1};OpenLayers.Renderer.Canvas=OpenLayers.Class(OpenLayers.Renderer,{hitDetection:true,hitOverflow:0,canvas:null,features:null,pendingRedraw:false,cachedSymbolBounds:{},initialize:function(e,t){OpenLayers.Renderer.prototype.initialize.apply(this,arguments);this.root=document.createElement("canvas");this.container.appendChild(this.root);this.canvas=this.root.getContext("2d");this.features={};if(this.hitDetection){this.hitCanvas=document.createElement("canvas");this.hitContext=this.hitCanvas.getContext("2d")}},setExtent:function(){OpenLayers.Renderer.prototype.setExtent.apply(this,arguments);return false},eraseGeometry:function(e,t){this.eraseFeatures(this.features[t][0])},supported:function(){return OpenLayers.CANVAS_SUPPORTED},setSize:function(e){this.size=e.clone();var t=this.root;t.style.width=e.w+"px";t.style.height=e.h+"px";t.width=e.w;t.height=e.h;this.resolution=null;if(this.hitDetection){var i=this.hitCanvas;i.style.width=e.w+"px";i.style.height=e.h+"px";i.width=e.w;i.height=e.h}},drawFeature:function(e,t){var i;if(e.geometry){t=this.applyDefaultSymbolizer(t||e.style);var r=e.geometry.getBounds();var a;if(this.map.baseLayer&&this.map.baseLayer.wrapDateLine){a=this.map.getMaxExtent()}var s=r&&r.intersectsBounds(this.extent,{worldBounds:a});i=t.display!=="none"&&!!r&&s;if(i){this.features[e.id]=[e,t]}else{delete this.features[e.id]}this.pendingRedraw=true}if(this.pendingRedraw&&!this.locked){this.redraw();this.pendingRedraw=false}return i},drawGeometry:function(e,t,i){var r=e.CLASS_NAME;if(r=="OpenLayers.Geometry.Collection"||r=="OpenLayers.Geometry.MultiPoint"||r=="OpenLayers.Geometry.MultiLineString"||r=="OpenLayers.Geometry.MultiPolygon"){for(var a=0;a<e.components.length;a++){this.drawGeometry(e.components[a],t,i)}return}switch(e.CLASS_NAME){case"OpenLayers.Geometry.Point":this.drawPoint(e,t,i);break;case"OpenLayers.Geometry.LineString":this.drawLineString(e,t,i);break;case"OpenLayers.Geometry.LinearRing":this.drawLinearRing(e,t,i);break;case"OpenLayers.Geometry.Polygon":this.drawPolygon(e,t,i);break;default:break}},drawExternalGraphic:function(o,e,l){var h=new Image;var t=e.title||e.graphicTitle;if(t){h.title=t}var p=e.graphicWidth||e.graphicHeight;var u=e.graphicHeight||e.graphicWidth;p=p?p:e.pointRadius*2;u=u?u:e.pointRadius*2;var c=e.graphicXOffset!=undefined?e.graphicXOffset:-(.5*p);var d=e.graphicYOffset!=undefined?e.graphicYOffset:-(.5*u);var f=e.graphicOpacity||e.fillOpacity;var i=function(){if(!this.features[l]){return}var e=this.getLocalXY(o);var t=e[0];var i=e[1];if(!isNaN(t)&&!isNaN(i)){var r=t+c|0;var a=i+d|0;var s=this.canvas;s.globalAlpha=f;var n=OpenLayers.Renderer.Canvas.drawImageScaleFactor||(OpenLayers.Renderer.Canvas.drawImageScaleFactor=/android 2.1/.test(navigator.userAgent.toLowerCase())?320/window.screen.width:1);s.drawImage(h,r*n,a*n,p*n,u*n);if(this.hitDetection){this.setHitContextStyle("fill",l);this.hitContext.fillRect(r,a,p,u)}}};h.onload=OpenLayers.Function.bind(i,this);h.src=e.externalGraphic},drawNamedSymbol:function(p,e,u){var t,i,r,a,s,n,o,l;var c;var d=Math.PI/180;var h=OpenLayers.Renderer.symbol[e.graphicName];if(!h){throw new Error(e.graphicName+" is not a valid symbol name")}if(!h.length||h.length<2)return;var f=this.getLocalXY(p);var y=f[0];var g=f[1];if(isNaN(y)||isNaN(g))return;this.canvas.lineCap="round";this.canvas.lineJoin="round";if(this.hitDetection){this.hitContext.lineCap="round";this.hitContext.lineJoin="round"}if(e.graphicName in this.cachedSymbolBounds){n=this.cachedSymbolBounds[e.graphicName]}else{n=new OpenLayers.Bounds;for(s=0;s<h.length;s+=2){n.extend(new OpenLayers.LonLat(h[s],h[s+1]))}this.cachedSymbolBounds[e.graphicName]=n}this.canvas.save();if(this.hitDetection){this.hitContext.save()}this.canvas.translate(y,g);if(this.hitDetection){this.hitContext.translate(y,g)}l=d*e.rotation;if(!isNaN(l)){this.canvas.rotate(l);if(this.hitDetection){this.hitContext.rotate(l)}}o=2*e.pointRadius/Math.max(n.getWidth(),n.getHeight());this.canvas.scale(o,o);if(this.hitDetection){this.hitContext.scale(o,o)}r=n.getCenterLonLat().lon;a=n.getCenterLonLat().lat;this.canvas.translate(-r,-a);if(this.hitDetection){this.hitContext.translate(-r,-a)}c=e.strokeWidth;e.strokeWidth=c/o;if(e.fill!==false){this.setCanvasStyle("fill",e);this.canvas.beginPath();for(s=0;s<h.length;s=s+2){t=h[s];i=h[s+1];if(s==0)this.canvas.moveTo(t,i);this.canvas.lineTo(t,i)}this.canvas.closePath();this.canvas.fill();if(this.hitDetection){this.setHitContextStyle("fill",u,e);this.hitContext.beginPath();for(s=0;s<h.length;s=s+2){t=h[s];i=h[s+1];if(s==0)this.canvas.moveTo(t,i);this.hitContext.lineTo(t,i)}this.hitContext.closePath();this.hitContext.fill()}}if(e.stroke!==false){this.setCanvasStyle("stroke",e);this.canvas.beginPath();for(s=0;s<h.length;s=s+2){t=h[s];i=h[s+1];if(s==0)this.canvas.moveTo(t,i);this.canvas.lineTo(t,i)}this.canvas.closePath();this.canvas.stroke();if(this.hitDetection){this.setHitContextStyle("stroke",u,e,o);this.hitContext.beginPath();for(s=0;s<h.length;s=s+2){t=h[s];i=h[s+1];if(s==0)this.hitContext.moveTo(t,i);this.hitContext.lineTo(t,i)}this.hitContext.closePath();this.hitContext.stroke()}}e.strokeWidth=c;this.canvas.restore();if(this.hitDetection){this.hitContext.restore()}this.setCanvasStyle("reset")},setCanvasStyle:function(e,t){if(e==="fill"){this.canvas.globalAlpha=t["fillOpacity"];this.canvas.fillStyle=t["fillColor"]}else if(e==="stroke"){this.canvas.globalAlpha=t["strokeOpacity"];this.canvas.strokeStyle=t["strokeColor"];this.canvas.lineWidth=t["strokeWidth"]}else{this.canvas.globalAlpha=0;this.canvas.lineWidth=1}},featureIdToHex:function(e){var t=Number(e.split("_").pop())+1;if(t>=16777216){this.hitOverflow=t-16777215;t=t%16777216+1}var i="000000"+t.toString(16);var r=i.length;i="#"+i.substring(r-6,r);return i},setHitContextStyle:function(e,t,i,r){var a=this.featureIdToHex(t);if(e=="fill"){this.hitContext.globalAlpha=1;this.hitContext.fillStyle=a}else if(e=="stroke"){this.hitContext.globalAlpha=1;this.hitContext.strokeStyle=a;if(typeof r==="undefined"){this.hitContext.lineWidth=i.strokeWidth+2}else{if(!isNaN(r)){this.hitContext.lineWidth=i.strokeWidth+2/r}}}else{this.hitContext.globalAlpha=0;this.hitContext.lineWidth=1}},drawPoint:function(e,t,i){if(t.graphic!==false){if(t.externalGraphic){this.drawExternalGraphic(e,t,i)}else if(t.graphicName&&t.graphicName!="circle"){this.drawNamedSymbol(e,t,i)}else{var r=this.getLocalXY(e);var a=r[0];var s=r[1];if(!isNaN(a)&&!isNaN(s)){var n=Math.PI*2;var o=t.pointRadius;if(t.fill!==false){this.setCanvasStyle("fill",t);this.canvas.beginPath();this.canvas.arc(a,s,o,0,n,true);this.canvas.fill();if(this.hitDetection){this.setHitContextStyle("fill",i,t);this.hitContext.beginPath();this.hitContext.arc(a,s,o,0,n,true);this.hitContext.fill()}}if(t.stroke!==false){this.setCanvasStyle("stroke",t);this.canvas.beginPath();this.canvas.arc(a,s,o,0,n,true);this.canvas.stroke();if(this.hitDetection){this.setHitContextStyle("stroke",i,t);this.hitContext.beginPath();this.hitContext.arc(a,s,o,0,n,true);this.hitContext.stroke()}this.setCanvasStyle("reset")}}}}},drawLineString:function(e,t,i){t=OpenLayers.Util.applyDefaults({fill:false},t);this.drawLinearRing(e,t,i)},drawLinearRing:function(e,t,i){if(t.fill!==false){this.setCanvasStyle("fill",t);this.renderPath(this.canvas,e,t,i,"fill");if(this.hitDetection){this.setHitContextStyle("fill",i,t);this.renderPath(this.hitContext,e,t,i,"fill")}}if(t.stroke!==false){this.setCanvasStyle("stroke",t);this.renderPath(this.canvas,e,t,i,"stroke");if(this.hitDetection){this.setHitContextStyle("stroke",i,t);this.renderPath(this.hitContext,e,t,i,"stroke")}}this.setCanvasStyle("reset")},renderPath:function(e,t,p,u,i){var r=t.components;var a=r.length;e.beginPath();var s=this.getLocalXY(r[0]);var n=s[0];var o=s[1];if(!isNaN(n)&&!isNaN(o)){e.moveTo(s[0],s[1]);for(var l=1;l<a;++l){var h=this.getLocalXY(r[l]);e.lineTo(h[0],h[1])}if(i==="fill"){e.fill()}else{e.stroke()}}},drawPolygon:function(e,t,i){var r=e.components;var a=r.length;this.drawLinearRing(r[0],t,i);for(var s=1;s<a;++s){this.canvas.globalCompositeOperation="destination-out";if(this.hitDetection){this.hitContext.globalCompositeOperation="destination-out"}this.drawLinearRing(r[s],OpenLayers.Util.applyDefaults({stroke:false,fillOpacity:1},t),i);this.canvas.globalCompositeOperation="source-over";if(this.hitDetection){this.hitContext.globalCompositeOperation="source-over"}this.drawLinearRing(r[s],OpenLayers.Util.applyDefaults({fill:false},t),i)}},drawText:function(p,e){var t=this.getLocalXY(p);this.setCanvasStyle("reset");this.canvas.fillStyle=e.fontColor;this.canvas.globalAlpha=e.fontOpacity||1;var i=[e.fontStyle?e.fontStyle:"normal","normal",e.fontWeight?e.fontWeight:"normal",e.fontSize?e.fontSize:"1em",e.fontFamily?e.fontFamily:"sans-serif"].join(" ");var r=e.label.split("\n");var a=r.length;if(this.canvas.fillText){this.canvas.font=i;this.canvas.textAlign=OpenLayers.Renderer.Canvas.LABEL_ALIGN[e.labelAlign[0]]||"center";this.canvas.textBaseline=OpenLayers.Renderer.Canvas.LABEL_ALIGN[e.labelAlign[1]]||"middle";var s=OpenLayers.Renderer.Canvas.LABEL_FACTOR[e.labelAlign[1]];if(s==null){s=-.5}var n=this.canvas.measureText("Mg").height||this.canvas.measureText("xx").width;t[1]+=n*s*(a-1);for(var o=0;o<a;o++){if(e.labelOutlineWidth){this.canvas.save();this.canvas.globalAlpha=e.labelOutlineOpacity||e.fontOpacity||1;this.canvas.strokeStyle=e.labelOutlineColor;this.canvas.lineWidth=e.labelOutlineWidth;this.canvas.strokeText(r[o],t[0],t[1]+n*o+1);this.canvas.restore()}this.canvas.fillText(r[o],t[0],t[1]+n*o)}}else if(this.canvas.mozDrawText){this.canvas.mozTextStyle=i;var l=OpenLayers.Renderer.Canvas.LABEL_FACTOR[e.labelAlign[0]];if(l==null){l=-.5}var s=OpenLayers.Renderer.Canvas.LABEL_FACTOR[e.labelAlign[1]];if(s==null){s=-.5}var n=this.canvas.mozMeasureText("xx");t[1]+=n*(1+s*a);for(var o=0;o<a;o++){var h=t[0]+l*this.canvas.mozMeasureText(r[o]);var u=t[1]+o*n;this.canvas.translate(h,u);this.canvas.mozDrawText(r[o]);this.canvas.translate(-h,-u)}}this.setCanvasStyle("reset")},getLocalXY:function(e){var t=this.getResolution();var i=this.extent;var r=(e.x-this.featureDx)/t+-i.left/t;var a=i.top/t-e.y/t;return[r,a]},clear:function(){var e=this.root.height;var t=this.root.width;this.canvas.clearRect(0,0,t,e);this.features={};if(this.hitDetection){this.hitContext.clearRect(0,0,t,e)}},getFeatureIdFromEvent:function(e){var t,i;if(this.hitDetection&&this.root.style.display!=="none"){if(!this.map.dragging){var r=e.xy;var a=r.x|0;var s=r.y|0;var n=this.hitContext.getImageData(a,s,1,1).data;if(n[3]===255){var o=n[2]+256*(n[1]+256*n[0]);if(o){t="OpenLayers_Feature_Vector_"+(o-1+this.hitOverflow);try{i=this.features[t][0]}catch(e){}}}}}return i},eraseFeatures:function(e){if(!OpenLayers.Util.isArray(e)){e=[e]}for(var t=0;t<e.length;++t){delete this.features[e[t].id]}this.redraw()},redraw:function(){if(!this.locked){var e=this.root.height;var t=this.root.width;this.canvas.clearRect(0,0,t,e);if(this.hitDetection){this.hitContext.clearRect(0,0,t,e)}var i=[];var r,a,s;var n=this.map.baseLayer&&this.map.baseLayer.wrapDateLine&&this.map.getMaxExtent();for(var o in this.features){if(!this.features.hasOwnProperty(o)){continue}r=this.features[o][0];a=r.geometry;this.calculateFeatureDx(a.getBounds(),n);s=this.features[o][1];this.drawGeometry(a,s,r.id);if(s.label){i.push([r,s])}}var l;for(var h=0,p=i.length;h<p;++h){l=i[h];this.drawText(l[0].geometry.getCentroid(),l[1])}}},CLASS_NAME:"OpenLayers.Renderer.Canvas"});OpenLayers.Renderer.Canvas.LABEL_ALIGN={l:"left",r:"right",t:"top",b:"bottom"};OpenLayers.Renderer.Canvas.LABEL_FACTOR={l:0,r:-1,t:0,b:-1};OpenLayers.Renderer.Canvas.drawImageScaleFactor=null;OpenLayers.Format.SLD.v1_0_0_GeoServer=OpenLayers.Class(OpenLayers.Format.SLD.v1_0_0,{version:"1.0.0",profile:"GeoServer",readers:OpenLayers.Util.applyDefaults({sld:OpenLayers.Util.applyDefaults({Priority:function(e,t){var i=this.readers.ogc._expression.call(this,e);if(i){t.priority=i}},VendorOption:function(e,t){if(!t.vendorOptions){t.vendorOptions={}}t.vendorOptions[e.getAttribute("name")]=this.getChildValue(e)},TextSymbolizer:function(e,t){OpenLayers.Format.SLD.v1_0_0.prototype.readers.sld.TextSymbolizer.apply(this,arguments);var i=this.multipleSymbolizers?t.symbolizers[t.symbolizers.length-1]:t.symbolizer["Text"];if(i.graphic===undefined){i.graphic=false}}},OpenLayers.Format.SLD.v1_0_0.prototype.readers["sld"])},OpenLayers.Format.SLD.v1_0_0.prototype.readers),writers:OpenLayers.Util.applyDefaults({sld:OpenLayers.Util.applyDefaults({Priority:function(e){return this.writers.sld._OGCExpression.call(this,"sld:Priority",e)},VendorOption:function(e){return this.createElementNSPlus("sld:VendorOption",{attributes:{name:e.name},value:e.value})},TextSymbolizer:function(e){var t=OpenLayers.Format.SLD.v1_0_0.prototype.writers;var i=t["sld"]["TextSymbolizer"].apply(this,arguments);if(e.graphic!==false&&(e.externalGraphic||e.graphicName)){this.writeNode("Graphic",e,i)}if("priority"in e){this.writeNode("Priority",e.priority,i)}return this.addVendorOptions(i,e)},PointSymbolizer:function(e){var t=OpenLayers.Format.SLD.v1_0_0.prototype.writers;var i=t["sld"]["PointSymbolizer"].apply(this,arguments);return this.addVendorOptions(i,e)},LineSymbolizer:function(e){var t=OpenLayers.Format.SLD.v1_0_0.prototype.writers;var i=t["sld"]["LineSymbolizer"].apply(this,arguments);return this.addVendorOptions(i,e)},PolygonSymbolizer:function(e){var t=OpenLayers.Format.SLD.v1_0_0.prototype.writers;var i=t["sld"]["PolygonSymbolizer"].apply(this,arguments);return this.addVendorOptions(i,e)}},OpenLayers.Format.SLD.v1_0_0.prototype.writers["sld"])},OpenLayers.Format.SLD.v1_0_0.prototype.writers),addVendorOptions:function(e,t){var i=t.vendorOptions;if(i){for(var r in t.vendorOptions){this.writeNode("VendorOption",{name:r,value:t.vendorOptions[r]},e)}}return e},CLASS_NAME:"OpenLayers.Format.SLD.v1_0_0_GeoServer"});Ext.namespace("gxp");gxp.WMSStylesDialog=Ext.extend(Ext.Container,{addStyleText:gettext("Add"),addStyleTip:gettext("Add a new style"),chooseStyleText:gettext("Choose style"),deleteStyleText:gettext("Remove"),deleteStyleTip:gettext("Delete the selected style"),editStyleText:gettext("Edit"),editStyleTip:gettext("Edit the selected style"),duplicateStyleText:gettext("Duplicate"),duplicateStyleTip:gettext("Duplicate the selected style"),addRuleText:gettext("Add"),addRuleTip:gettext("Add a new rule"),newRuleText:gettext("New Rule"),deleteRuleText:gettext("Remove"),deleteRuleTip:gettext("Delete the selected rule"),editRuleText:gettext("Edit"),editRuleTip:gettext("Edit the selected rule"),duplicateRuleText:gettext("Duplicate"),duplicateRuleTip:gettext("Duplicate the selected rule"),cancelText:gettext("Cancel"),saveText:gettext("Save"),styleWindowTitle:gettext("User Style: {0}"),ruleWindowTitle:gettext("Style Rule: {0}"),stylesFieldsetTitle:gettext("Styles"),rulesFieldsetTitle:gettext("Rules"),errorTitle:gettext("Error saving style"),errorMsg:"There was an error saving the style back to the server.",layerRecord:null,layerDescription:null,symbolType:null,stylesStore:null,selectedStyle:null,selectedRule:null,editable:true,modified:false,dialogCls:Ext.Window,initComponent:function(){this.addEvents("ready","modified","styleselected","beforesaved","saved");var e={layout:"form",disabled:true,items:[{xtype:"fieldset",title:this.stylesFieldsetTitle,labelWidth:85,style:"margin-bottom: 0;"},{xtype:"toolbar",style:"border-width: 0 1px 1px 1px; margin-bottom: 10px;",items:[{xtype:"button",iconCls:"add",text:this.addStyleText,tooltip:this.addStyleTip,handler:this.addStyle,scope:this},{xtype:"button",iconCls:"delete",text:this.deleteStyleText,tooltip:this.deleteStyleTip,handler:function(){this.stylesStore.remove(this.selectedStyle)},scope:this},{xtype:"button",iconCls:"edit",text:this.editStyleText,tooltip:this.editStyleTip,handler:function(){this.editStyle()},scope:this},{xtype:"button",iconCls:"duplicate",text:this.duplicateStyleText,tooltip:this.duplicateStyleTip,handler:function(){var e=this.selectedStyle;var t=e.get("userStyle").clone();t.isDefault=false;t.name=this.newStyleName();var i=this.stylesStore;i.add(new i.recordType({name:t.name,title:t.title,abstract:t.description,userStyle:t}));this.editStyle(e)},scope:this}]}]};Ext.applyIf(this,e);this.createStylesStore();this.on({beforesaved:function(){this._saving=true},saved:function(){delete this._saving},savefailed:function(){Ext.Msg.show({title:this.errorTitle,msg:this.errorMsg,icon:Ext.MessageBox.ERROR,buttons:{ok:true}});delete this._saving},render:function(){gxp.util.dispatch([this.getStyles],function(){this.enable()},this)},scope:this});gxp.WMSStylesDialog.superclass.initComponent.apply(this,arguments)},addStyle:function(){if(!this._ready){this.on("ready",this.addStyle,this);return}var e=this.selectedStyle;var t=this.stylesStore;var i=new OpenLayers.Style(null,{name:this.newStyleName(),rules:[this.createRule()]});t.add(new t.recordType({name:i.name,userStyle:i}));this.editStyle(e)},editStyle:function(e){var t=this.selectedStyle.get("userStyle");var i={bbar:["->",{text:this.cancelText,iconCls:"cancel",handler:function(){r.propertiesDialog.userStyle=t;r.destroy();if(e){this._cancelling=true;this.stylesStore.remove(this.selectedStyle);this.changeStyle(e,{updateCombo:true,markModified:true});delete this._cancelling}},scope:this},{text:this.saveText,iconCls:"save",handler:function(){r.destroy()}}]};var r=new this.dialogCls(Ext.apply(i,{title:String.format(this.styleWindowTitle,t.title||t.name),shortTitle:t.title||t.name,bodyBorder:false,autoHeight:true,width:300,modal:true,items:{border:false,items:{xtype:"gxp_stylepropertiesdialog",ref:"../propertiesDialog",userStyle:t.clone(),nameEditable:false,style:"padding: 10px;"}},listeners:{beforedestroy:function(){this.selectedStyle.set("userStyle",r.propertiesDialog.userStyle)},scope:this}}));this.showDlg(r)},createSLD:function(t){t=t||{};var i={version:"1.0.0",namedLayers:{}};var r=this.layerRecord.get("name");i.namedLayers[r]={name:r,userStyles:[]};this.stylesStore.each(function(e){if(!t.userStyles||t.userStyles.indexOf(e.get("name"))!==-1){i.namedLayers[r].userStyles.push(e.get("userStyle"))}});return new OpenLayers.Format.SLD({multipleSymbolizers:true,profile:"GeoServer"}).write(i)},saveStyles:function(e){this.modified===true&&this.fireEvent("beforesaved",this,e)},updateStyleRemoveButton:function(){var e=this.selectedStyle&&this.selectedStyle.get("userStyle");this.items.get(1).items.get(1).setDisabled(!e||this.stylesStore.getCount()<=1||e.isDefault===true)},updateRuleRemoveButton:function(){this.items.get(3).items.get(1).setDisabled(!this.selectedRule||this.items.get(2).items.get(0).rules.length<2)},createRule:function(){return new OpenLayers.Rule({symbolizers:[new OpenLayers.Symbolizer[this.symbolType]]})},addRulesFieldSet:function(){var e=new Ext.form.FieldSet({itemId:"rulesfieldset",title:this.rulesFieldsetTitle,autoScroll:true,style:"margin-bottom: 0;",hideMode:"offsets",hidden:true});var t=new Ext.Toolbar({style:"border-width: 0 1px 1px 1px;",hidden:true,items:[{xtype:"button",iconCls:"add",text:this.addRuleText,tooltip:this.addRuleTip,handler:this.addRule,scope:this},{xtype:"button",iconCls:"delete",text:this.deleteRuleText,tooltip:this.deleteRuleTip,handler:this.removeRule,scope:this,disabled:true},{xtype:"button",iconCls:"edit",text:this.editRuleText,toolitp:this.editRuleTip,handler:function(){this.layerDescription?this.editRule():this.describeLayer(this.editRule)},scope:this,disabled:true},{xtype:"button",iconCls:"duplicate",text:this.duplicateRuleText,tip:this.duplicateRuleTip,handler:this.duplicateRule,scope:this,disabled:true}]});this.add(e,t);this.doLayout();return e},addRule:function(){var e=this.items.get(2).items.get(0);this.selectedStyle.get("userStyle").rules.push(this.createRule());e.update();this.selectedStyle.store.afterEdit(this.selectedStyle);this.updateRuleRemoveButton()},removeRule:function(){var e=this.selectedRule;this.items.get(2).items.get(0).unselect();this.selectedStyle.get("userStyle").rules.remove(e);this.afterRuleChange()},duplicateRule:function(){var e=this.items.get(2).items.get(0);var t=this.selectedRule.clone();this.selectedStyle.get("userStyle").rules.push(t);e.update();this.selectedStyle.store.afterEdit(this.selectedStyle);this.updateRuleRemoveButton()},editRule:function(){var e=this.selectedRule;var t=e.clone();var i=new this.dialogCls({title:String.format(this.ruleWindowTitle,e.title||e.name||this.newRuleText),shortTitle:e.title||e.name||this.newRuleText,layout:"fit",width:320,height:450,modal:true,items:[{xtype:"gxp_rulepanel",ref:"rulePanel",symbolType:this.symbolType,rule:e,attributes:new GeoExt.data.AttributeStore({url:this.layerDescription.owsURL,baseParams:{SERVICE:this.layerDescription.owsType,REQUEST:"DescribeFeatureType",TYPENAME:this.layerDescription.typeName},method:"GET",disableCaching:false}),autoScroll:true,border:false,defaults:{autoHeight:true,hideMode:"offsets"},listeners:{change:this.saveRule,tabchange:function(){if(i instanceof Ext.Window){i.syncShadow()}},scope:this}}],bbar:["->",{text:this.cancelText,iconCls:"cancel",handler:function(){this.saveRule(i.rulePanel,t);i.destroy()},scope:this},{text:this.saveText,iconCls:"save",handler:function(){i.destroy()}}]});this.showDlg(i)},saveRule:function(e,t){var i=this.selectedStyle;var r=this.items.get(2).items.get(0);var a=i.get("userStyle");var s=a.rules.indexOf(this.selectedRule);a.rules[s]=t;this.afterRuleChange(t)},afterRuleChange:function(e){var t=this.items.get(2).items.get(0);this.selectedRule=e;this.selectedStyle.store.afterEdit(this.selectedStyle)},setRulesFieldSetVisible:function(e){this.items.get(3).setVisible(e&&this.editable);this.items.get(2).setVisible(e);this.doLayout()},parseSLD:function(e,p){var t=e.responseXML;if(!t||!t.documentElement){t=(new OpenLayers.Format.XML).read(e.responseText)}var i=this.layerRecord.getLayer().params;var r=this.initialConfig.styleName||i.STYLES;if(r){this.selectedStyle=this.stylesStore.getAt(this.stylesStore.findExact("name",r))}var a=new OpenLayers.Format.SLD({profile:"GeoServer",multipleSymbolizers:true});try{var u=a.read(t);var s=u.namedLayers[i.LAYERS].userStyles;var c;if(i.SLD_BODY){var d=a.read(i.SLD_BODY);c=d.namedLayers[i.LAYERS].userStyles;Array.prototype.push.apply(s,c)}this.stylesStore.removeAll();this.selectedStyle=null;var n,o,l,f;for(var h=0,y=s.length;h<y;++h){n=s[h];l=this.stylesStore.findExact("name",n.name);l!==-1&&this.stylesStore.removeAt(l);o=new this.stylesStore.recordType({name:n.name,title:n.title,abstract:n.description,userStyle:n});o.phantom=false;this.stylesStore.add(o);if(!this.selectedStyle&&(r===n.name||!r&&n.isDefault===true)){this.selectedStyle=o}if(n.isDefault===true){f=o}}if(!this.selectedStyle){this.selectedStyle=f}this.addRulesFieldSet();this.createLegend(this.selectedStyle.get("userStyle").rules);this.stylesStoreReady();i.SLD_BODY&&this.markModified()}catch(e){if(window.console){console.warn(e.message)}this.setupNonEditable()}},createLegend:function(e){var t=OpenLayers.Symbolizer.Raster;if(t&&e[0]&&e[0].symbolizers[0]instanceof t){throw new Error("Raster symbolizers are not supported.")}else{this.addVectorLegend(e)}},setupNonEditable:function(){this.editable=false;this.items.get(1).hide();var e=this.getComponent("rulesfieldset")||this.addRulesFieldSet();e.add(this.createLegendImage());this.doLayout();this.items.get(3).hide();this.stylesStoreReady()},stylesStoreReady:function(){this.stylesStore.commitChanges();this.stylesStore.on({load:function(){this.addStylesCombo();this.updateStyleRemoveButton()},add:function(e,t,i){this.updateStyleRemoveButton();var r=this.items.get(0).items.get(0);this.markModified();r.fireEvent("select",r,e.getAt(i),i);r.setValue(this.selectedStyle.get("name"))},remove:function(e,t,i){if(!this._cancelling){this._removing=true;var r=Math.min(i,e.getCount()-1);this.updateStyleRemoveButton();var a=this.items.get(0).items.get(0);this.markModified();a.fireEvent("select",a,e.getAt(r),r);a.setValue(this.selectedStyle.get("name"));delete this._removing}},update:function(e,t){var i=t.get("userStyle");var r={name:i.name,title:i.title||i.name,abstract:i.description};Ext.apply(t.data,r);this.changeStyle(t,{updateCombo:true,markModified:true})},scope:this});this.stylesStore.fireEvent("load",this.stylesStore,this.stylesStore.getRange());this._ready=true;this.fireEvent("ready")},markModified:function(){if(this.modified===false){this.modified=true}if(!this._saving){this.fireEvent("modified",this,this.selectedStyle.get("name"))}},createStylesStore:function(e){var t=this.layerRecord.get("styles")||[];this.stylesStore=new Ext.data.JsonStore({data:{styles:t},idProperty:"name",root:"styles",fields:["name","title","abstract","legend","userStyle"],listeners:{add:function(e,t){for(var i,r=t.length-1;r>=0;--r){i=t[r];e.suspendEvents();i.get("title")||i.set("title",i.get("name"));e.resumeEvents()}}}})},getStyles:function(e){var t=this.layerRecord.getLayer();if(this.editable===true){var i=t.params["VERSION"];if(parseFloat(i)>1.1){i="1.1.1"}Ext.Ajax.request({url:typeof t.url==="string"?t.url:t.url[0],params:{SERVICE:"WMS",VERSION:i,REQUEST:"GetStyles",LAYERS:[t.params["LAYERS"]].join(",")},method:"GET",disableCaching:false,success:this.parseSLD,failure:this.setupNonEditable,callback:e,scope:this})}else{this.setupNonEditable()}},describeLayer:function(e){if(this.layerDescription){window.setTimeout(function(){e.call(this)},0)}else{var t=this.layerRecord.getLayer();var i=t.params["VERSION"];if(parseFloat(i)>1.1){i="1.1.1"}Ext.Ajax.request({url:typeof t.url==="string"?t.url:t.url[0],params:{SERVICE:"WMS",VERSION:i,REQUEST:"DescribeLayer",LAYERS:[t.params["LAYERS"]].join(",")},method:"GET",disableCaching:false,success:function(e){var t=(new OpenLayers.Format.WMSDescribeLayer).read(e.responseXML&&e.responseXML.documentElement?e.responseXML:e.responseText);this.layerDescription=t[0]},callback:e,scope:this})}},addStylesCombo:function(){var e=this.stylesStore;var t=new Ext.form.ComboBox(Ext.apply({fieldLabel:this.chooseStyleText,store:e,editable:false,displayField:"title",valueField:"name",value:this.selectedStyle?this.selectedStyle.get("title"):this.layerRecord.getLayer().params.STYLES||"default",disabled:!e.getCount(),mode:"local",typeAhead:true,triggerAction:"all",forceSelection:true,anchor:"100%",listeners:{select:function(e,t){this.changeStyle(t);if(!t.phantom&&!this._removing){this.fireEvent("styleselected",this,t.get("name"))}},scope:this}},this.initialConfig.stylesComboOptions));this.items.get(0).add(t);this.doLayout()},createLegendImage:function(){var r=new GeoExt.WMSLegend({showTitle:false,layerRecord:this.layerRecord,autoScroll:true,defaults:{listeners:{render:function(i){i.getEl().on({load:function(e,t){if(t.getAttribute("src")!=i.defaultImgSrc){this.setRulesFieldSetVisible(true);if(i.getEl().getHeight()>250){r.setHeight(250)}}},error:function(){this.setRulesFieldSetVisible(false)},scope:this})},scope:this}}});return r},changeStyle:function(e,t){t=t||{};var i=this.items.get(2).items.get(0);this.selectedStyle=e;this.updateStyleRemoveButton();var r=e.get("name");if(this.editable===true){var a=e.get("userStyle");if(a.isDefault===true){r=""}var s=i.rules.indexOf(this.selectedRule);i.ownerCt.remove(i);this.createLegend(a.rules,{selectedRuleIndex:s})}if(t.updateCombo===true){this.items.get(0).items.get(0).setValue(a.name);t.markModified===true&&this.markModified()}},addVectorLegend:function(e,t){t=Ext.applyIf(t||{},{enableDD:true});this.symbolType=t.symbolType;if(!this.symbolType){var i=["Point","Line","Polygon"];highest=0;var r=e[0].symbolizers,a;for(var s=r.length-1;s>=0;s--){a=r[s].CLASS_NAME.split(".").pop();highest=Math.max(highest,i.indexOf(a))}this.symbolType=i[highest]}var n=this.items.get(2).add({xtype:"gx_vectorlegend",showTitle:false,height:e.length>10?250:undefined,autoScroll:e.length>10,rules:e,symbolType:this.symbolType,selectOnClick:true,enableDD:t.enableDD,listeners:{ruleselected:function(e,t){this.selectedRule=t;var i=this.items.get(3).items;this.updateRuleRemoveButton();i.get(2).enable();i.get(3).enable()},ruleunselected:function(e,t){this.selectedRule=null;var i=this.items.get(3).items;i.get(1).disable();i.get(2).disable();i.get(3).disable()},rulemoved:function(){this.markModified()},afterlayout:function(){if(this.selectedRule!==null&&n.selectedRule===null&&n.rules.indexOf(this.selectedRule)!==-1){n.selectRuleEntry(this.selectedRule)}},scope:this}});this.setRulesFieldSetVisible(true);return n},newStyleName:function(){var e=this.layerRecord.get("name");return e.split(":").pop()+"_"+gxp.util.md5(e+new Date+Math.random()).substr(0,8)},showDlg:function(e){e.show()}});gxp.WMSStylesDialog.createGeoServerStylerConfig=function(e,t){var i=e.getLayer();if(!t){t=e.get("restUrl")}if(!t){t=i.url.split("?").shift().replace(/\/(wms|ows)\/?$/,"/rest")}return{xtype:"gxp_wmsstylesdialog",layerRecord:e,plugins:[{ptype:"gxp_geoserverstylewriter",baseUrl:t}],listeners:{styleselected:function(e,t){i.mergeNewParams({styles:t})},modified:function(e,t){e.saveStyles()},saved:function(e,t){i.mergeNewParams({_olSalt:Math.random(),styles:t})},scope:this}}};OpenLayers.Renderer.defaultSymbolizer={fillColor:"#808080",fillOpacity:1,strokeColor:"#000000",strokeOpacity:1,strokeWidth:1,strokeDashstyle:"solid",pointRadius:3,graphicName:"square",fontColor:"#000000",fontSize:10,haloColor:"#FFFFFF",haloOpacity:1,haloRadius:1,labelAlign:"cm"};Ext.reg("gxp_wmsstylesdialog",gxp.WMSStylesDialog);Ext.namespace("gxp");gxp.ScaleLimitPanel=Ext.extend(Ext.Panel,{maxScaleDenominatorLimit:40075016.68*39.3701*OpenLayers.DOTS_PER_INCH/256,limitMaxScaleDenominator:true,maxScaleDenominator:undefined,minScaleDenominatorLimit:Math.pow(.5,19)*40075016.68*39.3701*OpenLayers.DOTS_PER_INCH/256,limitMinScaleDenominator:true,minScaleDenominator:undefined,scaleLevels:20,scaleSliderTemplate:"{scaleType} Scale 1:{scale}",modifyScaleTipContext:Ext.emptyFn,scaleFactor:null,changing:false,border:false,maxScaleLimitText:gettext("Max scale limit"),minScaleLimitText:gettext("Min scale limit"),initComponent:function(){this.layout="column";this.defaults={border:false,bodyStyle:"margin: 0 5px;"};this.bodyStyle={padding:"5px"};this.scaleSliderTemplate=new Ext.Template(this.scaleSliderTemplate);Ext.applyIf(this,{minScaleDenominator:this.minScaleDenominatorLimit,maxScaleDenominator:this.maxScaleDenominatorLimit});this.scaleFactor=Math.pow(this.maxScaleDenominatorLimit/this.minScaleDenominatorLimit,1/(this.scaleLevels-1));this.scaleSlider=new Ext.Slider({vertical:true,height:100,values:[0,100],listeners:{changecomplete:function(e,t){this.updateScaleValues(e)},render:function(e){e.thumbs[0].el.setVisible(this.limitMaxScaleDenominator);e.thumbs[1].el.setVisible(this.limitMinScaleDenominator);e.setDisabled(!this.limitMinScaleDenominator&&!this.limitMaxScaleDenominator)},scope:this},plugins:[new gxp.slider.Tip({getText:function(e){var t=e.slider.thumbs.indexOf(e);var i=e.value;var r=this.sliderValuesToScale([e.value]);var a={scale:String(r[0]),zoom:(e.value*(this.scaleLevels/100)).toFixed(1),type:t===0?"Max":"Min",scaleType:t===0?"Min":"Max"};this.modifyScaleTipContext(this,a);return this.scaleSliderTemplate.apply(a)}.createDelegate(this)})]});this.maxScaleDenominatorInput=new Ext.form.NumberField({allowNegative:false,width:100,fieldLabel:gettext("1"),value:Math.round(this.maxScaleDenominator),disabled:!this.limitMaxScaleDenominator,validator:function(e){return!this.limitMinScaleDenominator||e>this.minScaleDenominator}.createDelegate(this),listeners:{valid:function(e){var t=Number(e.getValue());var i=Math.round(this.maxScaleDenominatorLimit);if(t<i&&t>this.minScaleDenominator){this.maxScaleDenominator=t;this.updateSliderValues()}},change:function(e){var t=Number(e.getValue());var i=Math.round(this.maxScaleDenominatorLimit);if(t>i){e.setValue(i)}else if(t<this.minScaleDenominator){e.setValue(this.minScaleDenominator)}else{this.maxScaleDenominator=t;this.updateSliderValues()}},scope:this}});this.minScaleDenominatorInput=new Ext.form.NumberField({allowNegative:false,width:100,fieldLabel:gettext("1"),value:Math.round(this.minScaleDenominator),disabled:!this.limitMinScaleDenominator,validator:function(e){return!this.limitMaxScaleDenominator||e<this.maxScaleDenominator}.createDelegate(this),listeners:{valid:function(e){var t=Number(e.getValue());var i=Math.round(this.minScaleDenominatorLimit);if(t>i&&t<this.maxScaleDenominator){this.minScaleDenominator=t;this.updateSliderValues()}},change:function(e){var t=Number(e.getValue());var i=Math.round(this.minScaleDenominatorLimit);if(t<i){e.setValue(i)}else if(t>this.maxScaleDenominator){e.setValue(this.maxScaleDenominator)}else{this.minScaleDenominator=t;this.updateSliderValues()}},scope:this}});this.items=[this.scaleSlider,{xtype:"panel",layout:"form",defaults:{border:false},items:[{labelWidth:90,layout:"form",width:150,items:[{xtype:"checkbox",checked:!!this.limitMinScaleDenominator,fieldLabel:this.maxScaleLimitText,listeners:{check:function(e,t){this.limitMinScaleDenominator=t;var i=this.scaleSlider;i.setValue(1,100);i.thumbs[1].el.setVisible(t);this.minScaleDenominatorInput.setDisabled(!t);this.updateScaleValues(i);i.setDisabled(!this.limitMinScaleDenominator&&!this.limitMaxScaleDenominator)},scope:this}}]},{labelWidth:10,layout:"form",items:[this.minScaleDenominatorInput]},{labelWidth:90,layout:"form",items:[{xtype:"checkbox",checked:!!this.limitMaxScaleDenominator,fieldLabel:this.minScaleLimitText,listeners:{check:function(e,t){this.limitMaxScaleDenominator=t;var i=this.scaleSlider;i.setValue(0,0);i.thumbs[0].el.setVisible(t);this.maxScaleDenominatorInput.setDisabled(!t);this.updateScaleValues(i);i.setDisabled(!this.limitMinScaleDenominator&&!this.limitMaxScaleDenominator)},scope:this}}]},{labelWidth:10,layout:"form",items:[this.maxScaleDenominatorInput]}]}];this.addEvents("change");gxp.ScaleLimitPanel.superclass.initComponent.call(this)},updateScaleValues:function(e){if(!this.changing){var t=e.getValues();var i=false;if(!this.limitMaxScaleDenominator){if(t[0]>0){t[0]=0;i=true}}if(!this.limitMinScaleDenominator){if(t[1]<100){t[1]=100;i=true}}if(i){e.setValue(0,t[0]);e.setValue(1,t[1])}else{var r=this.sliderValuesToScale(t);var a=r[0];var s=r[1];this.changing=true;this.minScaleDenominatorInput.setValue(s);this.maxScaleDenominatorInput.setValue(a);this.changing=false;this.fireEvent("change",this,this.limitMinScaleDenominator?s:undefined,this.limitMaxScaleDenominator?a:undefined)}}},updateSliderValues:function(){if(!this.changing){var e=this.minScaleDenominator;var t=this.maxScaleDenominator;var i=this.scaleToSliderValues([t,e]);this.changing=true;this.scaleSlider.setValue(0,i[0]);this.scaleSlider.setValue(1,i[1]);this.changing=false;this.fireEvent("change",this,this.limitMinScaleDenominator?e:undefined,this.limitMaxScaleDenominator?t:undefined)}},sliderValuesToScale:function(e){var t=100/(this.scaleLevels-1);return[Math.round(Math.pow(this.scaleFactor,(100-e[0])/t)*this.minScaleDenominatorLimit),Math.round(Math.pow(this.scaleFactor,(100-e[1])/t)*this.minScaleDenominatorLimit)]},scaleToSliderValues:function(e){var t=100/(this.scaleLevels-1);return[100-t*Math.log(e[0]/this.minScaleDenominatorLimit)/Math.log(this.scaleFactor),100-t*Math.log(e[1]/this.minScaleDenominatorLimit)/Math.log(this.scaleFactor)]}});Ext.reg("gxp_scalelimitpanel",gxp.ScaleLimitPanel);Ext.namespace("gxp.slider");gxp.slider.Tip=Ext.extend(Ext.slider.Tip,{hover:true,dragging:false,init:function(e){if(this.hover){e.on("render",this.registerThumbListeners,this)}this.slider=e;gxp.slider.Tip.superclass.init.apply(this,arguments)},registerThumbListeners:function(){for(var e=0,t=this.slider.thumbs.length;e<t;++e){this.slider.thumbs[e].el.on({mouseover:this.createHoverListener(e),mouseout:function(){if(!this.dragging){this.hide.apply(this,arguments)}},scope:this})}},createHoverListener:function(e){return function(){this.onSlide(this.slider,{},this.slider.thumbs[e]);this.dragging=false}.createDelegate(this)},onSlide:function(e,t,i){this.dragging=true;gxp.slider.Tip.superclass.onSlide.apply(this,arguments)}});Ext.namespace("gxp.plugins");gxp.plugins.FormFieldHelp=Ext.extend(Object,{ptype:"gxp_formfieldhelp",helpText:null,dismissDelay:5e3,constructor:function(e){Ext.apply(this,e)},init:function(e){this.target=e;e.on("render",this.showHelp,this)},showHelp:function(){var e;if(this.target.label){e=this.target.label}else{e=this.target.getEl()}Ext.QuickTips.register({target:e,dismissDelay:this.dismissDelay,text:this.helpText})}});Ext.preg(gxp.plugins.FormFieldHelp.prototype.ptype,gxp.plugins.FormFieldHelp);Ext.namespace("gxp");gxp.TextSymbolizer=Ext.extend(Ext.Panel,{fonts:undefined,symbolizer:null,defaultSymbolizer:null,attributes:null,colorManager:null,haloCache:null,border:false,layout:"form",labelValuesText:gettext("Label values"),haloText:gettext("Halo"),sizeText:gettext("Size"),priorityText:gettext("Priority"),labelOptionsText:gettext("Label options"),autoWrapText:gettext("Auto wrap"),followLineText:gettext("Follow line"),maxDisplacementText:gettext("Maximum displacement"),repeatText:gettext("Repeat"),forceLeftToRightText:gettext("Force left to right"),groupText:gettext("Grouping"),spaceAroundText:gettext("Space around"),labelAllGroupText:gettext("Label all segments in line group"),maxAngleDeltaText:gettext("Maximum angle delta"),conflictResolutionText:gettext("Conflict resolution"),goodnessOfFitText:gettext("Goodness of fit"),polygonAlignText:gettext("Polygon alignment"),graphicResizeText:gettext("Graphic resize"),graphicMarginText:gettext("Graphic margin"),graphicTitle:gettext("Graphic"),fontColorTitle:gettext("Font color and opacity"),positioningText:gettext("Label positioning"),anchorPointText:gettext("Anchor point"),displacementXText:gettext("Displacement (X-direction)"),displacementYText:gettext("Displacement (Y-direction)"),perpendicularOffsetText:gettext("Perpendicular offset"),priorityHelp:"The higher the value of the specified field, the sooner the label will be drawn (which makes it win in the conflict resolution game)",autoWrapHelp:"Wrap labels that exceed a certain length in pixels",followLineHelp:"Should the label follow the geometry of the line?",maxDisplacementHelp:"Maximum displacement in pixels if label position is busy",repeatHelp:"Repeat labels after a certain number of pixels",forceLeftToRightHelp:"Labels are usually flipped to make them readable. If the character happens to be a directional arrow then this is not desirable",groupHelp:"Grouping works by collecting all features with the same label text, then choosing a representative geometry for the group. Road data is a classic example to show why grouping is useful. It is usually desirable to display only a single label for all of 'Main Street', not a label for every block of 'Main Street.'",spaceAroundHelp:"Overlapping and Separating Labels. By default GeoServer will not render labels 'on top of each other'. By using the spaceAround option you can either allow labels to overlap, or add extra space around labels. The value supplied for the option is a positive or negative size in pixels. Using the default value of 0, the bounding box of a label cannot overlap the bounding box of another label.",labelAllGroupHelp:"The labelAllGroup option makes sure that all of the segments in a line group are labeled instead of just the longest one.",conflictResolutionHelp:"By default labels are subjected to conflict resolution, meaning the renderer will not allow any label to overlap with a label that has been drawn already. Setting this parameter to false pull the label out of the conflict resolution game, meaning the label will be drawn even if it overlaps with other labels, and other labels drawn after it wonât mind overlapping with it.",goodnessOfFitHelp:"Geoserver will remove labels if they are a particularly bad fit for the geometry they are labeling. For Polygons: the label is sampled approximately at every letter. The distance from these points to the polygon is determined and each sample votes based on how close it is to the polygon. The default value is 0.5.",graphic_resizeHelp:"Specifies a mode for resizing label graphics (such as highway shields) to fit the text of the label. The default mode, ânoneâ, never modifies the label graphic. In stretch mode, GeoServer will resize the graphic to exactly surround the label text, possibly modifying the imageâs aspect ratio. In proportional mode, GeoServer will expand the image to be large enough to surround the text while preserving its original aspect ratio.",maxAngleDeltaHelp:"Designed to use used in conjuection with followLine, the maxAngleDelta option sets the maximum angle, in degrees, between two subsequent characters in a curved label. Large angles create either visually disconnected words or overlapping characters. It is advised not to use angles larger than 30.",polygonAlignHelp:"GeoServer normally tries to place horizontal labels within a polygon, and give up in case the label position is busy or if the label does not fit enough in the polygon. This options allows GeoServer to try alternate rotations for the labels. Possible options: the default value, only the rotation manually specified in the <Rotation> tag will be used (manual), If the label does not fit horizontally and the polygon is taller than wider the vertical alignement will also be tried (ortho), If the label does not fit horizontally the minimum bounding rectangle will be computed and a label aligned to it will be tried out as well (mbr).",graphic_marginHelp:"Similar to the margin shorthand property in CSS for HTML, its interpretation varies depending on how many margin values are provided: 1 = use that margin length on all sides of the label 2 = use the first for top & bottom margins and the second for left & right margins. 3 = use the first for the top margin, second for left & right margins, third for the bottom margin. 4 = use the first for the top margin, second for the right margin, third for the bottom margin, and fourth for the left margin.",initComponent:function(){if(!this.symbolizer){this.symbolizer={}}Ext.applyIf(this.symbolizer,this.defaultSymbolizer);if(!this.symbolizer.vendorOptions){this.symbolizer.vendorOptions={}}this.haloCache={};this.attributes.on("load",this.showHideGeometryOptions,this);this.attributes.load();var e={xtype:"combo",fieldLabel:this.labelValuesText,store:this.attributes,mode:"local",lastQuery:"",editable:false,triggerAction:"all",allowBlank:false,displayField:"name",valueField:"name",value:this.symbolizer.label&&this.symbolizer.label.replace(/^\${(.*)}$/,"$1"),listeners:{select:function(e,t){this.symbolizer.label="${"+t.get("name")+"}";this.fireEvent("change",this.symbolizer)},scope:this},width:120};this.attributesComboConfig=this.attributesComboConfig||{};Ext.applyIf(this.attributesComboConfig,e);this.labelWidth=80;this.items=[this.attributesComboConfig,{cls:"x-html-editor-tb",style:"background: transparent; border: none; padding: 0 0em 0.5em;",xtype:"toolbar",items:[{xtype:"gxp_fontcombo",fonts:this.fonts||undefined,width:110,value:this.symbolizer.fontFamily,listeners:{select:function(e,t){this.symbolizer.fontFamily=t.get("field1");this.fireEvent("change",this.symbolizer)},scope:this}},{xtype:"tbtext",text:this.sizeText+": "},{xtype:"numberfield",allowNegative:false,emptyText:OpenLayers.Renderer.defaultSymbolizer.fontSize,value:this.symbolizer.fontSize,width:30,listeners:{change:function(e,t){t=parseFloat(t);if(isNaN(t)){delete this.symbolizer.fontSize}else{this.symbolizer.fontSize=t}this.fireEvent("change",this.symbolizer)},scope:this}},{enableToggle:true,cls:"x-btn-icon",iconCls:"x-edit-bold",pressed:this.symbolizer.fontWeight==="bold",listeners:{toggle:function(e,t){this.symbolizer.fontWeight=t?"bold":"normal";this.fireEvent("change",this.symbolizer)},scope:this}},{enableToggle:true,cls:"x-btn-icon",iconCls:"x-edit-italic",pressed:this.symbolizer.fontStyle==="italic",listeners:{toggle:function(e,t){this.symbolizer.fontStyle=t?"italic":"normal";this.fireEvent("change",this.symbolizer)},scope:this}}]},{xtype:"gxp_fillsymbolizer",fillText:this.fontColorTitle,symbolizer:this.symbolizer,colorProperty:"fontColor",opacityProperty:"fontOpacity",checkboxToggle:false,autoHeight:true,width:213,labelWidth:70,plugins:this.colorManager&&[new this.colorManager],listeners:{change:function(e){this.fireEvent("change",this.symbolizer)},scope:this}},{xtype:"fieldset",title:this.graphicTitle,checkboxToggle:true,hideMode:"offsets",collapsed:!(this.symbolizer.fillColor||this.symbolizer.fillOpacity||this.symbolizer.vendorOptions["graphic-resize"]||this.symbolizer.vendorOptions["graphic-margin"]),labelWidth:70,items:[{xtype:"gxp_pointsymbolizer",symbolizer:this.symbolizer,listeners:{change:function(e){e.graphic=!!e.graphicName||!!e.externalGraphic;this.fireEvent("change",this.symbolizer)},scope:this},border:false,labelWidth:70},this.createVendorSpecificField({name:"graphic-resize",xtype:"combo",store:["none","stretch","proportional"],mode:"local",listeners:{select:function(e,t){if(e.getValue()==="none"){this.graphicMargin.hide()}else{if(Ext.isEmpty(this.graphicMargin.getValue())){this.graphicMargin.setValue(0);this.symbolizer.vendorOptions["graphic-margin"]=0}this.graphicMargin.show()}},scope:this},width:100,triggerAction:"all",fieldLabel:this.graphicResizeText}),this.createVendorSpecificField({name:"graphic-margin",ref:"../graphicMargin",hidden:this.symbolizer.vendorOptions["graphic-resize"]!=="stretch"&&this.symbolizer.vendorOptions["graphic-resize"]!=="proportional",width:100,fieldLabel:this.graphicMarginText,xtype:"textfield"})],listeners:{collapse:function(){this.graphicCache={externalGraphic:this.symbolizer.externalGraphic,fillColor:this.symbolizer.fillColor,fillOpacity:this.symbolizer.fillOpacity,graphicName:this.symbolizer.graphicName,pointRadius:this.symbolizer.pointRadius,rotation:this.symbolizer.rotation,strokeColor:this.symbolizer.strokeColor,strokeWidth:this.symbolizer.strokeWidth,strokeDashStyle:this.symbolizer.strokeDashStyle};delete this.symbolizer.externalGraphic;delete this.symbolizer.fillColor;delete this.symbolizer.fillOpacity;delete this.symbolizer.graphicName;delete this.symbolizer.pointRadius;delete this.symbolizer.rotation;delete this.symbolizer.strokeColor;delete this.symbolizer.strokeWidth;delete this.symbolizer.strokeDashStyle;this.fireEvent("change",this.symbolizer)},expand:function(){Ext.apply(this.symbolizer,this.graphicCache);this.doLayout();this.fireEvent("change",this.symbolizer)},scope:this}},{xtype:"fieldset",title:this.haloText,checkboxToggle:true,collapsed:!(this.symbolizer.haloRadius||this.symbolizer.haloColor||this.symbolizer.haloOpacity),autoHeight:true,labelWidth:50,items:[{xtype:"numberfield",fieldLabel:this.sizeText,anchor:"89%",allowNegative:false,emptyText:OpenLayers.Renderer.defaultSymbolizer.haloRadius,value:this.symbolizer.haloRadius,listeners:{change:function(e,t){t=parseFloat(t);if(isNaN(t)){delete this.symbolizer.haloRadius}else{this.symbolizer.haloRadius=t}this.fireEvent("change",this.symbolizer)},scope:this}},{xtype:"gxp_fillsymbolizer",symbolizer:{fillColor:"haloColor"in this.symbolizer?this.symbolizer.haloColor:OpenLayers.Renderer.defaultSymbolizer.haloColor,fillOpacity:"haloOpacity"in this.symbolizer?this.symbolizer.haloOpacity:OpenLayers.Renderer.defaultSymbolizer.haloOpacity*100},defaultColor:OpenLayers.Renderer.defaultSymbolizer.haloColor,checkboxToggle:false,width:190,labelWidth:60,plugins:this.colorManager&&[new this.colorManager],listeners:{change:function(e){this.symbolizer.haloColor=e.fillColor;this.symbolizer.haloOpacity=e.fillOpacity;this.fireEvent("change",this.symbolizer)},scope:this}}],listeners:{collapse:function(){this.haloCache={haloRadius:this.symbolizer.haloRadius,haloColor:this.symbolizer.haloColor,haloOpacity:this.symbolizer.haloOpacity};delete this.symbolizer.haloRadius;delete this.symbolizer.haloColor;delete this.symbolizer.haloOpacity;this.fireEvent("change",this.symbolizer)},expand:function(){Ext.apply(this.symbolizer,this.haloCache);this.doLayout();this.fireEvent("change",this.symbolizer)},scope:this}},{xtype:"fieldset",collapsed:!(this.symbolizer.labelAlign||this.symbolizer.vendorOptions["polygonAlign"]||this.symbolizer.labelXOffset||this.symbolizer.labelYOffset||this.symbolizer.labelPerpendicularOffset),title:this.positioningText,checkboxToggle:true,autoHeight:true,labelWidth:75,defaults:{width:100},items:[this.createField(Ext.applyIf({fieldLabel:this.anchorPointText,geometryTypes:["POINT"],value:this.symbolizer.labelAlign||"lb",store:[["lt","Left-top"],["ct","Center-top"],["rt","Right-top"],["lm","Left-center"],["cm","Center"],["rm","Right-center"],["lb","Left-bottom"],["cb","Center-bottom"],["rb","Right-bottom"]],listeners:{select:function(e,t){this.symbolizer.labelAlign=e.getValue();delete this.symbolizer.labelAnchorPointX;delete this.symbolizer.labelAnchorPointY;this.fireEvent("change",this.symbolizer)},scope:this}},this.attributesComboConfig)),this.createField({xtype:"numberfield",geometryTypes:["POINT"],fieldLabel:this.displacementXText,value:this.symbolizer.labelXOffset,listeners:{change:function(e,t){this.symbolizer.labelXOffset=t;this.fireEvent("change",this.symbolizer)},scope:this}}),this.createField({xtype:"numberfield",geometryTypes:["POINT"],fieldLabel:this.displacementYText,value:this.symbolizer.labelYOffset,listeners:{change:function(e,t){this.symbolizer.labelYOffset=t;this.fireEvent("change",this.symbolizer)},scope:this}}),this.createField({xtype:"numberfield",geometryTypes:["LINE"],fieldLabel:this.perpendicularOffsetText,value:this.symbolizer.labelPerpendicularOffset,listeners:{change:function(e,t){if(Ext.isEmpty(t)){delete this.symbolizer.labelPerpendicularOffset}else{this.symbolizer.labelPerpendicularOffset=t}this.fireEvent("change",this.symbolizer)},scope:this}}),this.createVendorSpecificField({name:"polygonAlign",geometryTypes:["POLYGON"],xtype:"combo",mode:"local",value:this.symbolizer.vendorOptions["polygonAlign"]||"manual",triggerAction:"all",store:["manual","ortho","mbr"],fieldLabel:this.polygonAlignText})]},{xtype:"fieldset",title:this.priorityText,checkboxToggle:true,collapsed:!this.symbolizer.priority,autoHeight:true,labelWidth:50,items:[Ext.applyIf({fieldLabel:this.priorityText,value:this.symbolizer.priority&&this.symbolizer.priority.replace(/^\${(.*)}$/,"$1"),allowBlank:true,name:"priority",plugins:[{ptype:"gxp_formfieldhelp",dismissDelay:2e4,helpText:this.priorityHelp}],listeners:{select:function(e,t){this.symbolizer[e.name]="${"+t.get("name")+"}";this.fireEvent("change",this.symbolizer)},scope:this}},this.attributesComboConfig)]},{xtype:"fieldset",title:this.labelOptionsText,checkboxToggle:true,collapsed:!(this.symbolizer.vendorOptions["autoWrap"]||this.symbolizer.vendorOptions["followLine"]||this.symbolizer.vendorOptions["maxAngleDelta"]||this.symbolizer.vendorOptions["maxDisplacement"]||this.symbolizer.vendorOptions["repeat"]||this.symbolizer.vendorOptions["forceLeftToRight"]||this.symbolizer.vendorOptions["group"]||this.symbolizer.vendorOptions["spaceAround"]||this.symbolizer.vendorOptions["labelAllGroup"]||this.symbolizer.vendorOptions["conflictResolution"]||this.symbolizer.vendorOptions["goodnessOfFit"]||this.symbolizer.vendorOptions["polygonAlign"]),autoHeight:true,labelWidth:80,defaults:{width:100},items:[this.createVendorSpecificField({name:"autoWrap",allowBlank:false,fieldLabel:this.autoWrapText}),this.createVendorSpecificField({name:"followLine",geometryTypes:["LINE"],xtype:"checkbox",listeners:{check:function(e,t){if(!t){this.maxAngleDelta.hide()}else{this.maxAngleDelta.show()}},scope:this},fieldLabel:this.followLineText}),this.createVendorSpecificField({name:"maxAngleDelta",ref:"../maxAngleDelta",hidden:this.symbolizer.vendorOptions["followLine"]==null,geometryTypes:["LINE"],fieldLabel:this.maxAngleDeltaText}),this.createVendorSpecificField({name:"maxDisplacement",fieldLabel:this.maxDisplacementText}),this.createVendorSpecificField({name:"repeat",geometryTypes:["LINE"],fieldLabel:this.repeatText}),this.createVendorSpecificField({name:"forceLeftToRight",xtype:"checkbox",geometryTypes:["LINE"],fieldLabel:this.forceLeftToRightText}),this.createVendorSpecificField({name:"group",listeners:{check:function(e,t){if(this.geometryType==="LINE"){if(t===false){this.labelAllGroup.hide()}else{this.labelAllGroup.show()}}},scope:this},xtype:"checkbox",yesno:true,fieldLabel:this.groupText}),this.createVendorSpecificField({name:"labelAllGroup",ref:"../labelAllGroup",geometryTypes:["LINE"],hidden:this.symbolizer.vendorOptions["group"]!=="yes",xtype:"checkbox",fieldLabel:this.labelAllGroupText}),this.createVendorSpecificField({name:"conflictResolution",xtype:"checkbox",listeners:{check:function(e,t){if(!t){this.spaceAround.hide()}else{this.spaceAround.show()}},scope:this},fieldLabel:this.conflictResolutionText}),this.createVendorSpecificField({name:"spaceAround",hidden:this.symbolizer.vendorOptions["conflictResolution"]!==true,allowNegative:true,ref:"../spaceAround",fieldLabel:this.spaceAroundText}),this.createVendorSpecificField({name:"goodnessOfFit",geometryTypes:["POLYGON"],fieldLabel:this.goodnessOfFitText})]}];this.addEvents("change");gxp.TextSymbolizer.superclass.initComponent.call(this)},createField:function(t){var i=Ext.ComponentMgr.create(t);if(t.geometryTypes){this.on("geometrytype",function(e){if(t.geometryTypes.indexOf(e)===-1){i.hide()}})}return i},createVendorSpecificField:function(i){var e=function(e,t){if(Ext.isEmpty(t)){delete this.symbolizer.vendorOptions[i.name]}else{if(i.yesno===true){this.symbolizer.vendorOptions[i.name]=t==true?"yes":"no"}else{this.symbolizer.vendorOptions[i.name]=t}}this.fireEvent("change",this.symbolizer)};var t=Ext.ComponentMgr.create(Ext.applyIf(i,{xtype:"numberfield",allowNegative:false,value:i.value||this.symbolizer.vendorOptions[i.name],checked:i.yesno===true?this.symbolizer.vendorOptions[i.name]==="yes":this.symbolizer.vendorOptions[i.name],plugins:[{ptype:"gxp_formfieldhelp",dismissDelay:2e4,helpText:this[i.name.replace(/-/g,"_")+"Help"]}]}));t.on("change",e,this);t.on("check",e,this);if(i.geometryTypes){this.on("geometrytype",function(e){if(i.geometryTypes.indexOf(e)===-1){t.hide()}})}return t},showHideGeometryOptions:function(){var r=/gml:((Multi)?(Point|Line|Polygon|Curve|Surface|Geometry)).*/;var a=/gml:((Multi)?(Polygon|Surface)).*/;var s=/gml:((Multi)?(Point)).*/;var n=/gml:((Multi)?(Line|Curve|Surface)).*/;var o=null;this.attributes.each(function(e){var t=e.get("type");var i=r.exec(t);if(i){if(a.exec(t)){o="POLYGON"}else if(s.exec(t)){o="POINT"}else if(n.exec(t)){o="LINE"}}},this);if(o!==null){this.geometryType=o;this.fireEvent("geometrytype",o)}}});Ext.reg("gxp_textsymbolizer",gxp.TextSymbolizer);Ext.namespace("gxp");gxp.FillSymbolizer=Ext.extend(Ext.FormPanel,{symbolizer:null,colorProperty:"fillColor",opacityProperty:"fillOpacity",colorManager:null,checkboxToggle:true,defaultColor:null,border:false,fillText:gettext("Fill"),colorText:gettext("Color"),opacityText:gettext("Opacity"),initComponent:function(){if(!this.symbolizer){this.symbolizer={}}var e;if(this.colorManager){e=[new this.colorManager]}var t=100;if(this.opacityProperty in this.symbolizer){t=this.symbolizer[this.opacityProperty]*100}else if(OpenLayers.Renderer.defaultSymbolizer[this.opacityProperty]){t=OpenLayers.Renderer.defaultSymbolizer[this.opacityProperty]*100}this.items=[{xtype:"fieldset",title:this.fillText,autoHeight:true,checkboxToggle:this.checkboxToggle,collapsed:this.checkboxToggle===true&&this.symbolizer.fill===false,hideMode:"offsets",defaults:{width:100},items:[{xtype:"gxp_colorfield",fieldLabel:this.colorText,name:"color",emptyText:OpenLayers.Renderer.defaultSymbolizer[this.colorProperty],value:this.symbolizer[this.colorProperty],defaultBackground:this.defaultColor||OpenLayers.Renderer.defaultSymbolizer[this.colorProperty],plugins:e,listeners:{valid:function(e){var t=e.getValue();var i=this.symbolizer[this.colorProperty]!=t;this.symbolizer[this.colorProperty]=t;i&&this.fireEvent("change",this.symbolizer)},scope:this}},{xtype:"slider",fieldLabel:this.opacityText,name:"opacity",values:[t],isFormField:true,listeners:{changecomplete:function(e,t){this.symbolizer[this.opacityProperty]=t/100;this.fireEvent("change",this.symbolizer)},scope:this},plugins:[new GeoExt.SliderTip({getText:function(e){return e.value+"%"}})]}],listeners:{collapse:function(){if(this.symbolizer.fill!==false){this.symbolizer.fill=false;this.fireEvent("change",this.symbolizer)}},expand:function(){this.symbolizer.fill=true;this.fireEvent("change",this.symbolizer)},scope:this}}];this.addEvents("change");gxp.FillSymbolizer.superclass.initComponent.call(this)}});Ext.reg("gxp_fillsymbolizer",gxp.FillSymbolizer);Ext.namespace("gxp.form");gxp.form.ColorField=Ext.extend(Ext.form.TextField,{cssColors:{aqua:"#00FFFF",black:"#000000",blue:"#0000FF",fuchsia:"#FF00FF",gray:"#808080",green:"#008000",lime:"#00FF00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#FF0000",silver:"#C0C0C0",teal:"#008080",white:"#FFFFFF",yellow:"#FFFF00"},defaultBackground:"#ffffff",initComponent:function(){if(this.value){this.value=this.hexToColor(this.value)}gxp.form.ColorField.superclass.initComponent.call(this);this.on({render:this.colorField,valid:this.colorField,scope:this})},isDark:function(e){var t=false;if(e){var i=parseInt(e.substring(1,3),16)/255;var r=parseInt(e.substring(3,5),16)/255;var a=parseInt(e.substring(5,7),16)/255;var s=i*.299+r*.587+a*.144;t=s<.5}return t},colorField:function(){var e=this.colorToHex(this.getValue())||this.defaultBackground;this.getEl().setStyle({background:e,color:this.isDark(e)?"#ffffff":"#000000"})},getHexValue:function(){return this.colorToHex(gxp.form.ColorField.superclass.getValue.apply(this,arguments))},getValue:function(){var e=this.getHexValue();var t=this.initialConfig.value;if(e===this.hexToColor(t)){e=t}return e},setValue:function(e){gxp.form.ColorField.superclass.setValue.apply(this,[this.hexToColor(e)])},colorToHex:function(e){if(!e){return e}var t;if(e.match(/^#[0-9a-f]{6}$/i)){t=e}else{t=this.cssColors[e.toLowerCase()]||null}return t},hexToColor:function(e){if(!e){return e}var t=e;for(var i in this.cssColors){if(this.cssColors[i]==t.toUpperCase()){t=i;break}}return t}});Ext.reg("gxp_colorfield",gxp.form.ColorField);Ext.namespace("gxp.form");gxp.form.FontComboBox=Ext.extend(Ext.form.ComboBox,{fonts:["Serif","SansSerif","Arial","Courier New","Tahoma","Times New Roman","Verdana"],defaultFont:"Serif",allowBlank:false,mode:"local",triggerAction:"all",editable:false,initComponent:function(){var e=this.fonts||gxp.form.FontComboBox.prototype.fonts;var t=this.defaultFont;if(e.indexOf(this.defaultFont)===-1){t=e[0]}var i={displayField:"field1",valueField:"field1",store:e,value:t,tpl:new Ext.XTemplate('<tpl for=".">'+'<div class="x-combo-list-item">'+'<span style="font-family: {field1};">{field1}</span>'+"</div></tpl>")};Ext.applyIf(this,i);gxp.form.FontComboBox.superclass.initComponent.call(this)}});Ext.reg("gxp_fontcombo",gxp.form.FontComboBox);Ext.namespace("gxp");gxp.PolygonSymbolizer=Ext.extend(Ext.Panel,{symbolizer:null,initComponent:function(){this.items=[{xtype:"gxp_fillsymbolizer",symbolizer:this.symbolizer,listeners:{change:function(e){this.fireEvent("change",this.symbolizer)},scope:this}},{xtype:"gxp_strokesymbolizer",symbolizer:this.symbolizer,listeners:{change:function(e){this.fireEvent("change",this.symbolizer)},scope:this}}];this.addEvents("change");gxp.PolygonSymbolizer.superclass.initComponent.call(this)}});Ext.reg("gxp_polygonsymbolizer",gxp.PolygonSymbolizer);Ext.namespace("gxp");gxp.StrokeSymbolizer=Ext.extend(Ext.FormPanel,{solidStrokeName:"solid",dashStrokeName:"dash",dotStrokeName:"dot",titleText:gettext("Stroke"),styleText:gettext("Style"),colorText:gettext("Color"),widthText:gettext("Width"),opacityText:gettext("Opacity"),symbolizer:null,colorManager:null,checkboxToggle:true,defaultColor:null,dashStyles:null,border:false,initComponent:function(){this.dashStyles=this.dashStyles||[["solid",this.solidStrokeName],["4 4",this.dashStrokeName],["2 4",this.dotStrokeName]];if(!this.symbolizer){this.symbolizer={}}var e;if(this.colorManager){e=[new this.colorManager]}this.items=[{xtype:"fieldset",title:this.titleText,autoHeight:true,checkboxToggle:this.checkboxToggle,collapsed:this.checkboxToggle===true&&this.symbolizer.stroke===false,hideMode:"offsets",defaults:{width:100},items:[{xtype:"combo",name:"style",fieldLabel:this.styleText,store:new Ext.data.SimpleStore({data:this.dashStyles,fields:["value","display"]}),displayField:"display",valueField:"value",value:this.getDashArray(this.symbolizer.strokeDashstyle)||OpenLayers.Renderer.defaultSymbolizer.strokeDashstyle,mode:"local",allowBlank:true,triggerAction:"all",editable:false,listeners:{select:function(e,t){this.symbolizer.strokeDashstyle=t.get("value");this.fireEvent("change",this.symbolizer)},scope:this}},{xtype:"gxp_colorfield",name:"color",fieldLabel:this.colorText,emptyText:OpenLayers.Renderer.defaultSymbolizer.strokeColor,value:this.symbolizer.strokeColor,defaultBackground:this.defaultColor||OpenLayers.Renderer.defaultSymbolizer.strokeColor,plugins:e,listeners:{valid:function(e){var t=e.getValue();var i=this.symbolizer.strokeColor!=t;this.symbolizer.strokeColor=t;i&&this.fireEvent("change",this.symbolizer)},scope:this}},{xtype:"numberfield",name:"width",fieldLabel:this.widthText,allowNegative:false,emptyText:OpenLayers.Renderer.defaultSymbolizer.strokeWidth,value:this.symbolizer.strokeWidth,listeners:{change:function(e,t){t=parseFloat(t);if(isNaN(t)){delete this.symbolizer.strokeWidth}else{this.symbolizer.strokeWidth=t}this.fireEvent("change",this.symbolizer)},scope:this}},{xtype:"slider",name:"opacity",fieldLabel:this.opacityText,values:[("strokeOpacity"in this.symbolizer?this.symbolizer.strokeOpacity:OpenLayers.Renderer.defaultSymbolizer.strokeOpacity)*100],isFormField:true,listeners:{changecomplete:function(e,t){this.symbolizer.strokeOpacity=t/100;this.fireEvent("change",this.symbolizer)},scope:this},plugins:[new GeoExt.SliderTip({getText:function(e){return e.value+"%"}})]}],listeners:{collapse:function(){if(this.symbolizer.stroke!==false){this.symbolizer.stroke=false;this.fireEvent("change",this.symbolizer)}},expand:function(){this.symbolizer.stroke=true;this.fireEvent("change",this.symbolizer)},scope:this}}];this.addEvents("change");gxp.StrokeSymbolizer.superclass.initComponent.call(this)},getDashArray:function(e){var t;if(e){var i=e.split(/\s+/);var r=i[0]/i[1];if(!isNaN(r)){t=r>=1?"4 4":"2 4"}}return t}});Ext.reg("gxp_strokesymbolizer",gxp.StrokeSymbolizer);Ext.namespace("gxp");gxp.LineSymbolizer=Ext.extend(Ext.Panel,{symbolizer:null,initComponent:function(){this.items=[{xtype:"gxp_strokesymbolizer",symbolizer:this.symbolizer,listeners:{change:function(e){this.fireEvent("change",this.symbolizer)},scope:this}}];this.addEvents("change");gxp.LineSymbolizer.superclass.initComponent.call(this)}});Ext.reg("gxp_linesymbolizer",gxp.LineSymbolizer);Ext.namespace("gxp");gxp.PointSymbolizer=Ext.extend(Ext.Panel,{symbolizer:null,graphicCircleText:gettext("circle"),graphicSquareText:gettext("square"),graphicTriangleText:gettext("triangle"),graphicStarText:gettext("star"),graphicCrossText:gettext("cross"),graphicXText:gettext("x"),graphicExternalText:gettext("external"),urlText:gettext("URL"),opacityText:gettext("opacity"),symbolText:gettext("Symbol"),sizeText:gettext("Size"),rotationText:gettext("Rotation"),pointGraphics:null,colorManager:null,external:null,layout:"form",initComponent:function(){if(!this.symbolizer){this.symbolizer={}}if(!this.pointGraphics){this.pointGraphics=[{display:this.graphicCircleText,value:"circle",mark:true},{display:this.graphicSquareText,value:"square",mark:true},{display:this.graphicTriangleText,value:"triangle",mark:true},{display:this.graphicStarText,value:"star",mark:true},{display:this.graphicCrossText,value:"cross",mark:true},{display:this.graphicXText,value:"x",mark:true},{display:this.graphicExternalText}]}this.external=!!this.symbolizer["externalGraphic"];this.markPanel=new Ext.Panel({border:false,collapsed:this.external,layout:"form",items:[{xtype:"gxp_fillsymbolizer",symbolizer:this.symbolizer,labelWidth:this.labelWidth,labelAlign:this.labelAlign,colorManager:this.colorManager,listeners:{change:function(e){this.fireEvent("change",this.symbolizer)},scope:this}},{xtype:"gxp_strokesymbolizer",symbolizer:this.symbolizer,labelWidth:this.labelWidth,labelAlign:this.labelAlign,colorManager:this.colorManager,listeners:{change:function(e){this.fireEvent("change",this.symbolizer)},scope:this}}]});this.urlField=new Ext.form.TextField({name:"url",fieldLabel:this.urlText,value:this.symbolizer["externalGraphic"],hidden:!this.external,listeners:{change:function(e,t){this.symbolizer["externalGraphic"]=t;this.fireEvent("change",this.symbolizer)},scope:this},width:100});this.graphicPanel=new Ext.Panel({border:false,collapsed:!this.external,layout:"form",items:[this.urlField,{xtype:"slider",name:"opacity",fieldLabel:this.opacityText,value:[this.symbolizer["graphicOpacity"]==null?100:this.symbolizer["graphicOpacity"]*100],isFormField:true,listeners:{changecomplete:function(e,t){this.symbolizer["graphicOpacity"]=t/100;this.fireEvent("change",this.symbolizer)},scope:this},plugins:[new GeoExt.SliderTip({getText:function(e){return e.value+"%"}})],width:100}]});this.items=[{xtype:"combo",name:"mark",fieldLabel:this.symbolText,store:new Ext.data.JsonStore({data:{root:this.pointGraphics},root:"root",fields:["value","display","preview",{name:"mark",type:"boolean"}]}),value:this.external?0:this.symbolizer["graphicName"],displayField:"display",valueField:"value",tpl:new Ext.XTemplate('<tpl for=".">'+'<div class="x-combo-list-item gx-pointsymbolizer-mark-item">'+'<tpl if="preview">'+'<img src="{preview}" alt="{display}"/>'+"</tpl>"+"<span>{display}</span>"+"</div></tpl>"),mode:"local",allowBlank:false,triggerAction:"all",editable:false,listeners:{select:function(e,t){var i=t.get("mark");var r=t.get("value");if(!i){if(r){this.urlField.hide();this.symbolizer["externalGraphic"]=r}else{this.urlField.show()}if(!this.external){this.external=true;var a=this.urlField.getValue();if(!Ext.isEmpty(a)){this.symbolizer["externalGraphic"]=a}delete this.symbolizer["graphicName"];this.updateGraphicDisplay()}}else{if(this.external){this.external=false;delete this.symbolizer["externalGraphic"];this.updateGraphicDisplay()}this.symbolizer["graphicName"]=r}this.fireEvent("change",this.symbolizer)},scope:this},width:100},{xtype:"textfield",name:"size",fieldLabel:this.sizeText,value:this.symbolizer["pointRadius"]&&this.symbolizer["pointRadius"]*2,listeners:{change:function(e,t){this.symbolizer["pointRadius"]=t/2;this.fireEvent("change",this.symbolizer)},scope:this},width:100},{xtype:"textfield",name:"rotation",fieldLabel:this.rotationText,value:this.symbolizer["rotation"],listeners:{change:function(e,t){this.symbolizer["rotation"]=t;this.fireEvent("change",this.symbolizer)},scope:this},width:100},this.markPanel,this.graphicPanel];this.addEvents("change");gxp.PointSymbolizer.superclass.initComponent.call(this)},updateGraphicDisplay:function(){if(this.external){this.markPanel.collapse();this.graphicPanel.expand()}else{this.graphicPanel.collapse();this.markPanel.expand()}}});Ext.reg("gxp_pointsymbolizer",gxp.PointSymbolizer);OpenLayers.Control.ScaleLine=OpenLayers.Class(OpenLayers.Control,{maxWidth:100,topOutUnits:"km",topInUnits:"m",bottomOutUnits:"mi",bottomInUnits:"ft",eTop:null,eBottom:null,geodesic:false,draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);if(!this.eTop){this.eTop=document.createElement("div");this.eTop.className=this.displayClass+"Top";var e=this.topInUnits.length;this.div.appendChild(this.eTop);if(this.topOutUnits==""||this.topInUnits==""){this.eTop.style.visibility="hidden"}else{this.eTop.style.visibility="visible"}this.eBottom=document.createElement("div");this.eBottom.className=this.displayClass+"Bottom";this.div.appendChild(this.eBottom);if(this.bottomOutUnits==""||this.bottomInUnits==""){this.eBottom.style.visibility="hidden"}else{this.eBottom.style.visibility="visible"}}this.map.events.register("moveend",this,this.update);this.update();return this.div},getBarLen:function(e){var t=parseInt(Math.log(e)/Math.log(10));var i=Math.pow(10,t);var r=parseInt(e/i);var a;if(r>5){a=5}else if(r>2){a=2}else{a=1}return a*i},update:function(){var e=this.map.getResolution();if(!e){return}var t=this.map.getUnits();var i=OpenLayers.INCHES_PER_UNIT;var r=this.maxWidth*e*i[t];var a=1;if(this.geodesic===true){var p=(this.map.getGeodesicPixelSize().w||1e-6)*this.maxWidth;var u=r/i["km"];a=p/u;r*=a}var s;var n;if(r>1e5){s=this.topOutUnits;n=this.bottomOutUnits}else{s=this.topInUnits;n=this.bottomInUnits}var o=r/i[s];var l=r/i[n];var h=this.getBarLen(o);var c=this.getBarLen(l);o=h/i[t]*i[s];l=c/i[t]*i[n];var d=o/e/a;var f=l/e/a;if(this.eBottom.style.visibility=="visible"){this.eBottom.style.width=Math.round(f)+"px";this.eBottom.innerHTML=c+" "+n}if(this.eTop.style.visibility=="visible"){this.eTop.style.width=Math.round(d)+"px";this.eTop.innerHTML=h+" "+s}},CLASS_NAME:"OpenLayers.Control.ScaleLine"});Ext.namespace("gxp");gxp.ScaleOverlay=Ext.extend(Ext.Panel,{map:null,zoomLevelText:gettext("Zoom level"),initComponent:function(){gxp.ScaleOverlay.superclass.initComponent.call(this);this.cls="map-overlay";if(this.map){if(this.map instanceof GeoExt.MapPanel){this.map=this.map.map}this.bind(this.map)}this.on("beforedestroy",this.unbind,this)},addToMapPanel:function(e){this.on({afterrender:function(){this.bind(e.map)},scope:this})},stopMouseEvents:function(e){e.stopEvent()},removeFromMapPanel:function(e){var t=this.getEl();t.un("mousedown",this.stopMouseEvents,this);t.un("click",this.stopMouseEvents,this);this.unbind()},addScaleLine:function(){var t=new Ext.BoxComponent({autoEl:{tag:"div",cls:"olControlScaleLine overlay-element overlay-scaleline"}});this.on("afterlayout",function(){t.getEl().dom.style.position="relative";t.getEl().dom.style.display="inline";this.getEl().on("click",this.stopMouseEvents,this);this.getEl().on("mousedown",this.stopMouseEvents,this)},this);t.on("render",function(){var e=new OpenLayers.Control.ScaleLine({geodesic:true,div:t.getEl().dom});this.map.addControl(e);e.activate()},this);this.add(t)},handleZoomEnd:function(){var e=this.zoomStore.queryBy(function(e){return this.map.getZoom()==e.data.level},this);if(e.length>0){e=e.items[0];this.zoomSelector.setValue("1 : "+parseInt(e.data.scale,10))}else{if(!this.zoomSelector.rendered){return}this.zoomSelector.clearValue()}},addScaleCombo:function(){this.zoomStore=new GeoExt.data.ScaleStore({map:this.map});this.zoomSelector=new Ext.form.ComboBox({emptyText:this.zoomLevelText,tpl:'<tpl for="."><div class="x-combo-list-item">1 : {[parseInt(values.scale)]}</div></tpl>',editable:false,triggerAction:"all",mode:"local",store:this.zoomStore,width:110});this.zoomSelector.on({click:this.stopMouseEvents,mousedown:this.stopMouseEvents,select:function(e,t,i){this.map.zoomTo(t.data.level)},scope:this});this.map.events.register("zoomend",this,this.handleZoomEnd);var e=new Ext.Panel({items:[this.zoomSelector],cls:"overlay-element overlay-scalechooser",border:false});this.add(e)},bind:function(e){this.map=e;this.addScaleLine();this.addScaleCombo();this.doLayout()},unbind:function(){if(this.map&&this.map.events){this.map.events.unregister("zoomend",this,this.handleZoomEnd)}this.zoomStore=null;this.zoomSelector=null}});Ext.reg("gxp_scaleoverlay",gxp.ScaleOverlay);Ext.namespace("gxp.plugins");gxp.plugins.Tool=Ext.extend(Ext.util.Observable,{ptype:"gxp_tool",autoActivate:true,actionTarget:"map.tbar",showButtonText:false,output:null,constructor:function(e){this.initialConfig=e||{};this.active=false;Ext.apply(this,e);if(!this.id){this.id=Ext.id()}this.output=[];this.addEvents("activate","deactivate");gxp.plugins.Tool.superclass.constructor.apply(this,arguments)},init:function(e){e.tools[this.id]=this;this.target=e;this.autoActivate&&this.activate();this.target.on("portalready",this.addActions,this)},activate:function(){if(this.active===false){this.active=true;this.fireEvent("activate",this);return true}},deactivate:function(){if(this.active===true){this.active=false;this.fireEvent("deactivate",this);return true}},getContainer:function(e){var t,i,r,a=e.split("."),s=a[0];if(s){if(s=="map"){t=this.target.mapPanel}else{t=Ext.getCmp(s)||this.target.portal[s];if(!t){throw new Error("Can't find component with id: "+s)}}}else{t=this.target.portal}i=a.length>1&&a[1];if(i){r={tbar:"getTopToolbar",bbar:"getBottomToolbar",fbar:"getFooterToolbar"}[i];if(r){t=t[r]()}else{t=t[i]}}return t},addActions:function(e){e=e||this.actions;if(!e||this.actionTarget===null){this.removeOutput();this.addOutput(this.outputConfig);return}var t=this.actionTarget instanceof Array?this.actionTarget:[this.actionTarget];var i=e instanceof Array?e:[e];var r,a,s,n,o,p,l,h=null;for(n=t.length-1;n>=0;--n){a=t[n];if(a){if(a instanceof Object){h=a.index;a=a.target}l=this.getContainer(a)}for(o=0,p=i.length;o<p;++o){if(!(i[o]instanceof Ext.Action||i[o]instanceof Ext.Component)){s=Ext.getCmp(i[o]);if(s){i[o]=s}if(typeof i[o]!="string"){if(o==this.defaultAction){i[o].pressed=true}i[o]=new Ext.Action(i[o])}}r=i[o];if(o==this.defaultAction&&r instanceof GeoExt.Action){r.isDisabled()?r.activateOnEnable=true:r.control.activate()}if(l){if(this.showButtonText){r.setText(r.initialConfig.buttonText)}if(l instanceof Ext.menu.Menu){r=Ext.apply(new Ext.menu.CheckItem(r),{text:r.initialConfig.menuText,group:r.initialConfig.toggleGroup,groupClass:null})}else if(!(l instanceof Ext.Toolbar)){r=new Ext.Button(r)}var u=h===null?l.add(r):l.insert(h,r);r=r instanceof Ext.Button?r:u;if(h!==null){h+=1}if(this.outputAction!=null&&o==this.outputAction){var s;r.on("click",function(){if(s){this.outputTarget?s.show():s.ownerCt.ownerCt.show()}else{s=this.addOutput()}},this)}}}if(l){l.isVisible()?l.doLayout():l instanceof Ext.menu.Menu||l.show()}}this.actions=i;return this.actions},addOutput:function(e){if(!e&&!this.outputConfig){return}e=e||{};var t=this.outputTarget;var i;if(t){i=this.getContainer(t);if(!(e instanceof Ext.Component)){Ext.apply(e,this.outputConfig)}}else{var r=this.outputConfig||{};i=new Ext.Window(Ext.apply({hideBorders:true,shadow:false,closeAction:"hide",autoHeight:!r.height,layout:r.height?"fit":undefined,items:[{defaults:Ext.applyIf({autoHeight:!r.height&&!(r.defaults&&r.defaults.height)},r.defaults)}]},r)).show().items.get(0)}if(i){var a=i.add(e);a.on("removed",function(e){this.output.remove(e)},this,{single:true});if(a instanceof Ext.Window){a.show()}else{i.doLayout()}this.output.push(a);return a}else{var s=this.ptype;if(window.console){console.error("Failed to create output for plugin with ptype: "+s)}}},removeOutput:function(){var e;for(var t=this.output.length-1;t>=0;--t){e=this.output[t];if(!this.outputTarget){e.findParentBy(function(e){return e instanceof Ext.Window}).close()}else{if(e.ownerCt){e.ownerCt.remove(e);if(e.ownerCt instanceof Ext.Window){e.ownerCt[e.ownerCt.closeAction]()}}else{e.remove()}}}this.output=[]},getState:function(){return Ext.apply({},this.initialConfig)}});Ext.preg(gxp.plugins.Tool.prototype.ptype,gxp.plugins.Tool);Ext.namespace("gxp.data");gxp.data.WFSProtocolProxy=Ext.extend(GeoExt.data.ProtocolProxy,{setFilter:function(e){this.protocol.filter=e;this.protocol.options.filter=e},constructor:function(e){Ext.applyIf(e,{version:"1.1.0"});if(!(this.protocol&&this.protocol instanceof OpenLayers.Protocol)){e.protocol=new OpenLayers.Protocol.WFS(Ext.apply({version:e.version,srsName:e.srsName,url:e.url,featureType:e.featureType,featureNS:e.featureNS,geometryName:e.geometryName,schema:e.schema,filter:e.filter,maxFeatures:e.maxFeatures,multi:e.multi},e.protocol))}gxp.data.WFSProtocolProxy.superclass.constructor.apply(this,arguments)},doRequest:function(e,t,i,r,a,s,n){delete i.xaction;if(e===Ext.data.Api.actions.read){this.load(i,r,a,s,n)}else{if(!(t instanceof Array)){t=[t]}var o=new Array(t.length),l;Ext.each(t,function(e,t){o[t]=e.getFeature();l=o[t];l.modified=Ext.apply(l.modified||{},{attributes:Ext.apply(l.modified&&l.modified.attributes||{},e.modified)})},this);var p={action:e,records:t,callback:a,scope:s};var h={callback:function(e){this.onProtocolCommit(e,p)},scope:this};Ext.applyIf(h,i);this.protocol.commit(o,h)}},onProtocolCommit:function(e,t){if(e.success()){var i=e.reqFeatures;var r,a;var s=[];var p=e.insertIds||[];var n,o,u=0;for(n=0,o=i.length;n<o;++n){a=i[n];r=a.state;if(r){if(r==OpenLayers.State.DELETE){s.push(a)}else if(r==OpenLayers.State.INSERT){a.fid=p[u];++u}else if(a.modified){a.modified={}}a.state=null}}for(n=0,o=s.length;n<o;++n){a=s[n];a.layer&&a.layer.destroyFeatures([a])}o=i.length;var c=new Array(o);var l;for(n=0;n<o;++n){l=i[n];c[n]={id:l.id,feature:l,state:null};var d=t.records[n].fields;for(var f in l.attributes){if(d.containsKey(f)){c[n][f]=l.attributes[f]}}}t.callback.call(t.scope,c,e.priv,true)}else{var h=e.priv;if(h.status>=200&&h.status<300){this.fireEvent("exception",this,"remote",t.action,t,e.error,t.records)}else{this.fireEvent("exception",this,"response",t.action,t,h)}t.callback.call(t.scope,[],h,false)}}});Ext.namespace("gxp.data");gxp.data.WFSFeatureStore=Ext.extend(GeoExt.data.FeatureStore,{setOgcFilter:function(e){this.proxy.setFilter(e)},constructor:function(e){if(!(e.proxy&&e.proxy instanceof GeoExt.data.ProtocolProxy)){e.proxy=new gxp.data.WFSProtocolProxy(Ext.apply({srsName:e.srsName,url:e.url,featureType:e.featureType,featureNS:e.featureNS,geometryName:e.geometryName,schema:e.schema,filter:e.ogcFilter,maxFeatures:e.maxFeatures,multi:e.multi},e.proxy))}if(!e.writer){e.writer=new Ext.data.DataWriter({write:Ext.emptyFn})}gxp.data.WFSFeatureStore.superclass.constructor.apply(this,arguments);this.reader.extractValues=function(e,t,i){var r=this.readRecords([e.feature]);return r.records[0].data}.createDelegate(this.reader);this.reader.meta.idProperty="id";this.reader.getId=function(e){return e.id}}});Ext.namespace("gxp.plugins");gxp.plugins.FeatureManager=Ext.extend(gxp.plugins.Tool,{ptype:"gxp_featuremanager",maxFeatures:100,paging:true,pagingType:null,autoZoomPage:false,autoSetLayer:true,autoLoadFeatures:false,layerRecord:null,featureStore:null,hitCountProtocol:null,featureLayer:null,schema:null,geometryType:null,toolsShowingLayer:null,selectStyle:null,style:null,pages:null,page:null,numberOfFeatures:null,numPages:null,pageIndex:null,constructor:function(e){this.addEvents("beforequery","query","beforelayerchange","layerchange","beforesetpage","setpage","beforeclearfeatures","clearfeatures","beforesave","exception");if(e&&!e.pagingType){this.pagingType=gxp.plugins.FeatureManager.QUADTREE_PAGING}if(e&&e.layer){this.autoSetLayer=false}gxp.plugins.FeatureManager.superclass.constructor.apply(this,arguments)},init:function(e){gxp.plugins.FeatureManager.superclass.init.apply(this,arguments);this.toolsShowingLayer={};this.style={all:new OpenLayers.Style(null,{rules:[new OpenLayers.Rule({symbolizer:this.initialConfig.symbolizer||{Point:{pointRadius:4,graphicName:"square",fillColor:"white",fillOpacity:1,strokeWidth:1,strokeOpacity:1,strokeColor:"#333333"},Line:{strokeWidth:4,strokeOpacity:1,strokeColor:"#ff9933"},Polygon:{strokeWidth:2,strokeOpacity:1,strokeColor:"#ff6633",fillColor:"white",fillOpacity:.3}}})]}),selected:new OpenLayers.Style(null,{rules:[new OpenLayers.Rule({symbolizer:{display:"none"}})]})};this.featureLayer=new OpenLayers.Layer.Vector(this.id,{displayInLayerSwitcher:false,visibility:false,styleMap:new OpenLayers.StyleMap({select:Ext.applyIf(Ext.apply({display:""},this.selectStyle),OpenLayers.Feature.Vector.style["select"]),vertex:this.style["all"]},{extendDefault:false})});this.target.on({ready:function(){this.target.mapPanel.map.addLayer(this.featureLayer)},scope:this});this.on({beforedestroy:function(){this.target.mapPanel.map.removeLayer(this.featureLayer)},scope:this})},activate:function(){if(gxp.plugins.FeatureManager.superclass.activate.apply(this,arguments)){if(this.autoSetLayer){this.target.on("beforelayerselectionchange",this.setLayer,this)}if(this.layer){var e=Ext.apply({},this.layer);this.target.createLayerRecord(e,this.setLayer,this)}this.on("layerchange",this.setSchema,this);return true}},deactivate:function(){if(gxp.plugins.FeatureManager.superclass.deactivate.apply(this,arguments)){if(this.autoSetLayer){this.target.un("beforelayerselectionchange",this.setLayer,this)}this.un("layerchange",this.setSchema,this);this.setLayer();return true}},getPageExtent:function(){if(this.pagingType===gxp.plugins.FeatureManager.QUADTREE_PAGING){return this.page.extent}else{return this.featureStore.layer.getDataExtent()}},setLayer:function(e){var t=this.fireEvent("beforelayerchange",this,e);if(t!==false){if(e){this.featureLayer.projection=e.getLayer().projection}if(e!==this.layerRecord){this.clearFeatureStore();this.layerRecord=e;if(e){this.autoLoadFeatures===true?this.loadFeatures():this.setFeatureStore()}else{this.fireEvent("layerchange",this,null)}}}return t},setSchema:function(e,t,i){this.schema=i},showLayer:function(e,t){this.toolsShowingLayer[e]=t||"all";this.setLayerDisplay()},hideLayer:function(e){delete this.toolsShowingLayer[e];this.setLayerDisplay()},setLayerDisplay:function(){var e=this.visible();var t=this.target.mapPanel.map;if(e){var i=this.style[e];if(i!==this.featureLayer.styleMap.styles["default"]){this.featureLayer.styleMap.styles["default"]=i;this.featureLayer.redraw()}this.featureLayer.setVisibility(true);t.events.on({addlayer:this.raiseLayer,scope:this})}else if(this.featureLayer.map){this.featureLayer.setVisibility(false);t.events.un({addlayer:this.raiseLayer,scope:this})}},visible:function(){var e=false;for(var t in this.toolsShowingLayer){if(e!="all"){e=this.toolsShowingLayer[t]}}return e},raiseLayer:function(){var e=this.featureLayer&&this.featureLayer.map;if(e){e.setLayerIndex(this.featureLayer,e.layers.length)}},loadFeatures:function(e,r,a){if(this.fireEvent("beforequery",this,e,r,a)!==false){this.filter=e;this.pages=null;if(r){var s=this;s._activeQuery&&s.un("query",s._activeQuery);this.on("query",s._activeQuery=function(e,t){delete s._activeQuery;this.un("query",arguments.callee,this);var i=t.getCount();if(t.getCount()==0){r.call(a,[])}else{this.featureLayer.events.register("featuresadded",this,function(e){this.featureLayer.events.unregister("featuresadded",this,arguments.callee);r.call(a,e.features)})}},this,{single:true})}if(!this.featureStore){this.paging&&this.on("layerchange",function(e,t,i){if(i){this.un("layerchange",arguments.callee,this);this.setPage()}},this);this.setFeatureStore(e,!this.paging)}else{this.featureStore.setOgcFilter(e);if(this.paging){this.setPage()}else{this.featureStore.load()}}}},clearFeatures:function(){var e=this.featureStore;if(e){if(this.fireEvent("beforeclearfeatures",this)!==false){e.removeAll();this.fireEvent("clearfeatures",this);var t=e.proxy;t.abortRequest();if(t.protocol.response){t.protocol.response.abort()}}}},getProjection:function(e){var t=this.target.mapPanel.map.getProjectionObject();var i=e.getLayer().projection;if(i&&i.equals(t)){t=i}return t},setFeatureStore:function(i,r){var l=this.layerRecord;var e=this.target.getSource(l);if(e&&e instanceof gxp.plugins.WMSSource){e.getSchema(l,function(e){if(e===false){this.clearFeatureStore()}else{var a=[],s;var n=/gml:((Multi)?(Point|Line|Polygon|Curve|Surface|Geometry)).*/;var o={"xsd:boolean":"boolean","xsd:int":"int","xsd:integer":"int","xsd:short":"int","xsd:long":"int","xsd:date":"date","xsd:string":"string","xsd:float":"float","xsd:double":"float"};e.each(function(e){var t=n.exec(e.get("type"));if(t){s=e.get("name");this.geometryType=t[1]}else{var i=o[e.get("type")];var r={name:e.get("name"),type:o[i]};if(i=="date"){r.dateFormat="Y-m-d\\Z"}a.push(r)}},this);var t={srsName:this.getProjection(l).getCode(),url:e.url,featureType:e.reader.raw.featureTypes[0].typeName,featureNS:e.reader.raw.targetNamespace,geometryName:s};this.hitCountProtocol=new OpenLayers.Protocol.WFS(Ext.apply({version:"1.1.0",readOptions:{output:"object"},resultType:"hits",filter:i},t));this.featureStore=new gxp.data.WFSFeatureStore(Ext.apply({fields:a,proxy:{protocol:{outputFormat:this.format,multi:this.multi}},maxFeatures:this.maxFeatures,layer:this.featureLayer,ogcFilter:i,autoLoad:r,autoSave:false,listeners:{beforewrite:function(e,t,i,r){this.fireEvent("beforesave",this,e,r.params)},write:function(e,t,i,r,a){this.redrawMatchingLayers(l)},load:function(e,t,i){this.fireEvent("query",this,e,this.filter)},scope:this}},t))}this.fireEvent("layerchange",this,l,e)},this)}else{this.clearFeatureStore();this.fireEvent("layerchange",this,l,false)}},redrawMatchingLayers:function(e){var t=e.get("name");var i=e.get("source");this.target.mapPanel.layers.each(function(e){if(e.get("source")===i&&e.get("name")===t){e.getLayer().redraw(true)}})},clearFeatureStore:function(){if(this.featureStore){this.featureStore.removeAll();this.featureStore.unbind();this.featureStore.destroy();this.numberOfFeatures=null;this.featureStore=null;this.geometryType=null}},processPage:function(r,a,s,n){a=a||{};var o=a.lonLat?null:a.index;var l=a.next;var h=this.pages;var e=this.pages.indexOf(r);this.setPageFilter(r);var t=l?e==(h.indexOf(l)||h.length)-1:true;var i=a.lonLat?r.extent.containsLonLat(a.lonLat):true;if(i&&r.numFeatures&&r.numFeatures<=this.maxFeatures){s.call(this,r)}else if(i&&(e==o||t)){this.hitCountProtocol.read({callback:function(e){var t=o,i=a.lonLat;if(l){t=(h.indexOf(l)||h.length)-1}if(!t&&i&&r.extent.containsLonLat(i)){t=h.indexOf(r)}r.numFeatures=e.numberOfFeatures;if(this.page){return}if(r.numFeatures>this.maxFeatures){this.createLeaf(r,Ext.applyIf({index:t,next:l},a),s,n)}else if(r.numFeatures==0&&h.length>1){h.remove(r);a.allowEmpty===false&&this.setPage({index:o%this.pages.length,allowEmpty:false})}else if(this.pages.indexOf(r)==t){s.call(this,r)}},scope:this})}},createLeaf:function(e,t,i,r){t=t||{};var p=this.layerRecord.getLayer();var a=this.pages.indexOf(e);this.pages.remove(e);var s=e.extent;var n=s.getCenterLonLat();var o=[s.left,n.lon,s.left,n.lon];var u=[n.lat,n.lat,s.bottom,s.bottom];var c=[n.lon,s.right,n.lon,s.right];var d=[s.top,s.top,n.lat,n.lat];var l,h;for(l=3;l>=0;--l){h={extent:new OpenLayers.Bounds(o[l],u[l],c[l],d[l])};this.pages.splice(a,0,h);this.processPage(h,t,i,r)}},getPagingExtent:function(e){var t=this.layerRecord.getLayer();var i=this.getSpatialFilter();var r=i?i.value:this.target.mapPanel.map[e]();if(r&&t.maxExtent){if(r.containsBounds(t.maxExtent)){r=t.maxExtent}}return r},getSpatialFilter:function(){var e;if(this.filter instanceof OpenLayers.Filter.Spatial&&this.filter.type===OpenLayers.Filter.Spatial.BBOX){e=this.filter}else if(this.filter instanceof OpenLayers.Filter.Logical&&this.filter.type===OpenLayers.Filter.Logical.AND){for(var t,i=this.filter.filters.length-1;i>=0;--i){t=this.filter.filters[i];if(t instanceof OpenLayers.Filter.Spatial&&t.type===OpenLayers.Filter.Spatial.BBOX){e=t;break}}}return e},setPageFilter:function(e){var t;if(e.extent){var i=new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.BBOX,property:this.featureStore.geometryName,value:e.extent});t=this.filter?new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,filters:[this.filter,i]}):i}else{t=this.filter}this.featureStore.setOgcFilter(t);this.hitCountProtocol.filter=t;this.hitCountProtocol.options.filter=t;return t},nextPage:function(e,t){var i;if(this.pagingType===gxp.plugins.FeatureManager.QUADTREE_PAGING){var r=this.page;this.page=null;i=(this.pages.indexOf(r)+1)%this.pages.length}else{i=this.pageIndex+1%this.numPages}this.setPage({index:i,allowEmpty:false},e,t)},previousPage:function(e,t){var i;if(this.pagingType===gxp.plugins.FeatureManager.QUADTREE_PAGING){i=this.pages.indexOf(this.page)-1;if(i<0){i=this.pages.length-1}}else{i=this.pageIndex-1;if(i<0){i=this.numPages-1}}this.setPage({index:i,allowEmpty:false,next:this.page},e)},setPage:function(r,a,s){if(this.pagingType===gxp.plugins.FeatureManager.QUADTREE_PAGING){if(this.filter instanceof OpenLayers.Filter.FeatureId){this.featureStore.load({callback:function(){a&&a.call(s)}});return}if(this.fireEvent("beforesetpage",this,r,a,s)!==false){if(!r){var e=this.getPagingExtent("getExtent");var t=new OpenLayers.LonLat(e.left,e.top);var i=this.target.mapPanel.map.getMaxExtent();if(!i.containsLonLat(t,true)){t=new OpenLayers.LonLat(i.left,i.top)}r={lonLat:t,allowEmpty:false}}r.index=r.index||0;if(r.index=="last"){r.index=this.pages.length-1;r.next=this.pages[0]}this.page=null;if(!this.pages){var h=this.layerRecord.getLayer();var n=this.getPagingExtent("getMaxExtent");this.pages=[{extent:n}];r.index=0}else if(r.lonLat){for(var o=this.pages.length-1;o>=0;--o){if(this.pages[o].extent.containsLonLat(r.lonLat)){r.index=o;break}}}this.processPage(this.pages[r.index],r,function(e){var t=this.target.mapPanel.map;this.page=e;this.setPageFilter(e);if(this.autoZoomPage&&!t.getExtent().containsLonLat(e.extent.getCenterLonLat())){t.zoomToExtent(e.extent)}var i=this.pages.indexOf(this.page);this.fireEvent("setpage",this,r,a,s,i,this.pages.length);this.featureStore.load({callback:function(){a&&a.call(s,e)}})},this)}}else{if(this.fireEvent("beforesetpage",this,r,a,s)!==false){if(!r){this.hitCountProtocol.read({filter:this.filter,callback:function(e){this.numberOfFeatures=e.numberOfFeatures;this.numPages=Math.ceil(this.numberOfFeatures/this.maxFeatures);this.pageIndex=0;this.fireEvent("setpage",this,r,a,s,this.pageIndex,this.numPages);this.featureStore.load({output:"object",callback:function(){a&&a.call(s)}})},scope:this})}else{if(r.index!=null){if(r.index==="last"){this.pageIndex=this.numPages-1}else if(r.index==="first"){this.pageIndex=0}else{this.pageIndex=r.index}var l=this.pageIndex*this.maxFeatures;this.fireEvent("setpage",this,r,a,s,this.pageIndex,this.numPages);this.featureStore.load({startIndex:l,callback:function(){a&&a.call(s)}})}}}}}});gxp.plugins.FeatureManager.QUADTREE_PAGING=0;gxp.plugins.FeatureManager.WFS_PAGING=1;Ext.preg(gxp.plugins.FeatureManager.prototype.ptype,gxp.plugins.FeatureManager);OpenLayers.Handler.Feature=OpenLayers.Class(OpenLayers.Handler,{EVENTMAP:{click:{in:"click",out:"clickout"},mousemove:{in:"over",out:"out"},dblclick:{in:"dblclick",out:null},mousedown:{in:null,out:null},mouseup:{in:null,out:null},touchstart:{in:"click",out:"clickout"}},feature:null,lastFeature:null,down:null,up:null,clickTolerance:4,geometryTypes:null,stopClick:true,stopDown:true,stopUp:false,initialize:function(e,t,i,r){OpenLayers.Handler.prototype.initialize.apply(this,[e,i,r]);this.layer=t},touchstart:function(e){this.startTouch();return OpenLayers.Event.isMultiTouch(e)?true:this.mousedown(e)},touchmove:function(e){OpenLayers.Event.preventDefault(e)},mousedown:function(e){if(OpenLayers.Event.isLeftClick(e)||OpenLayers.Event.isSingleTouch(e)){this.down=e.xy}return this.handle(e)?!this.stopDown:true},mouseup:function(e){this.up=e.xy;return this.handle(e)?!this.stopUp:true},click:function(e){return this.handle(e)?!this.stopClick:true},mousemove:function(e){if(!this.callbacks["over"]&&!this.callbacks["out"]){return true}this.handle(e);return true},dblclick:function(e){return!this.handle(e)},geometryTypeMatches:function(e){return this.geometryTypes==null||OpenLayers.Util.indexOf(this.geometryTypes,e.geometry.CLASS_NAME)>-1},handle:function(e){if(this.feature&&!this.feature.layer){this.feature=null}var t=e.type;var i=false;var r=!!this.feature;var a=t=="click"||t=="dblclick"||t=="touchstart";this.feature=this.layer.getFeatureFromEvent(e);if(this.feature&&!this.feature.layer){this.feature=null}if(this.lastFeature&&!this.lastFeature.layer){this.lastFeature=null}if(this.feature){if(t==="touchstart"){OpenLayers.Event.preventDefault(e)}var s=this.feature!=this.lastFeature;if(this.geometryTypeMatches(this.feature)){if(r&&s){if(this.lastFeature){this.triggerCallback(t,"out",[this.lastFeature])}this.triggerCallback(t,"in",[this.feature])}else if(!r||a){this.triggerCallback(t,"in",[this.feature])}this.lastFeature=this.feature;i=true}else{if(this.lastFeature&&(r&&s||a)){this.triggerCallback(t,"out",[this.lastFeature])}this.feature=null}}else if(this.lastFeature&&(r||a)){this.triggerCallback(t,"out",[this.lastFeature])}return i},triggerCallback:function(e,t,i){var r=this.EVENTMAP[e][t];if(r){if(e=="click"&&this.up&&this.down){var a=Math.sqrt(Math.pow(this.up.x-this.down.x,2)+Math.pow(this.up.y-this.down.y,2));if(a<=this.clickTolerance){this.callback(r,i)}this.up=this.down=null}else{this.callback(r,i)}}},activate:function(){var e=false;if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){this.moveLayerToTop();this.map.events.on({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this});e=true}return e},deactivate:function(){var e=false;if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){this.moveLayerBack();this.feature=null;this.lastFeature=null;this.down=null;this.up=null;this.map.events.un({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this});e=true}return e},handleMapEvents:function(e){if(e.type=="removelayer"||e.property=="order"){this.moveLayerToTop()}},moveLayerToTop:function(){var e=Math.max(this.map.Z_INDEX_BASE["Feature"]-1,this.layer.getZIndex())+1;this.layer.setZIndex(e)},moveLayerBack:function(){var e=this.layer.getZIndex()-1;if(e>=this.map.Z_INDEX_BASE["Feature"]){this.layer.setZIndex(e)}else{this.map.setLayerZIndex(this.layer,this.map.getLayerIndex(this.layer))}},CLASS_NAME:"OpenLayers.Handler.Feature"});OpenLayers.Layer.Vector.RootContainer=OpenLayers.Class(OpenLayers.Layer.Vector,{displayInLayerSwitcher:false,layers:null,display:function(){},getFeatureFromEvent:function(e){var t=this.layers;var i;for(var r=0;r<t.length;r++){i=t[r].getFeatureFromEvent(e);if(i){return i}}},setMap:function(e){OpenLayers.Layer.Vector.prototype.setMap.apply(this,arguments);this.collectRoots();e.events.register("changelayer",this,this.handleChangeLayer)},removeMap:function(e){e.events.unregister("changelayer",this,this.handleChangeLayer);this.resetRoots();OpenLayers.Layer.Vector.prototype.removeMap.apply(this,arguments)},collectRoots:function(){var e;for(var t=0;t<this.map.layers.length;++t){e=this.map.layers[t];if(OpenLayers.Util.indexOf(this.layers,e)!=-1){e.renderer.moveRoot(this.renderer)}}},resetRoots:function(){var e;for(var t=0;t<this.layers.length;++t){e=this.layers[t];if(this.renderer&&e.renderer.getRenderLayerId()==this.id){this.renderer.moveRoot(e.renderer)}}},handleChangeLayer:function(e){var t=e.layer;if(e.property=="order"&&OpenLayers.Util.indexOf(this.layers,t)!=-1){this.resetRoots();this.collectRoots()}},CLASS_NAME:"OpenLayers.Layer.Vector.RootContainer"});OpenLayers.Control.SelectFeature=OpenLayers.Class(OpenLayers.Control,{multipleKey:null,toggleKey:null,multiple:false,clickout:true,toggle:false,hover:false,highlightOnly:false,box:false,onBeforeSelect:function(){},onSelect:function(){},onUnselect:function(){},scope:null,geometryTypes:null,layer:null,layers:null,callbacks:null,selectStyle:null,renderIntent:"select",handlers:null,initialize:function(e,t){OpenLayers.Control.prototype.initialize.apply(this,[t]);if(this.scope===null){this.scope=this}this.initLayer(e);var i={click:this.clickFeature,clickout:this.clickoutFeature};if(this.hover){i.over=this.overFeature;i.out=this.outFeature}this.callbacks=OpenLayers.Util.extend(i,this.callbacks);this.handlers={feature:new OpenLayers.Handler.Feature(this,this.layer,this.callbacks,{geometryTypes:this.geometryTypes})};if(this.box){this.handlers.box=new OpenLayers.Handler.Box(this,{done:this.selectBox},{boxDivClassName:"olHandlerBoxSelectFeature"})}},initLayer:function(e){if(OpenLayers.Util.isArray(e)){this.layers=e;this.layer=new OpenLayers.Layer.Vector.RootContainer(this.id+"_container",{layers:e})}else{this.layer=e}},destroy:function(){if(this.active&&this.layers){this.map.removeLayer(this.layer)}OpenLayers.Control.prototype.destroy.apply(this,arguments);if(this.layers){this.layer.destroy()}},activate:function(){if(!this.active){if(this.layers){this.map.addLayer(this.layer)}this.handlers.feature.activate();if(this.box&&this.handlers.box){this.handlers.box.activate()}}return OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){if(this.active){this.handlers.feature.deactivate();if(this.handlers.box){this.handlers.box.deactivate()}if(this.layers){this.map.removeLayer(this.layer)}}return OpenLayers.Control.prototype.deactivate.apply(this,arguments)},unselectAll:function(e){var t=this.layers||[this.layer],i,r,a,s;for(a=0;a<t.length;++a){i=t[a];s=0;if(i.selectedFeatures!=null){while(i.selectedFeatures.length>s){r=i.selectedFeatures[s];if(!e||e.except!=r){this.unselect(r)}else{++s}}}}},clickFeature:function(e){if(!this.hover){var t=OpenLayers.Util.indexOf(e.layer.selectedFeatures,e)>-1;if(t){if(this.toggleSelect()){this.unselect(e)}else if(!this.multipleSelect()){this.unselectAll({except:e})}}else{if(!this.multipleSelect()){this.unselectAll({except:e})}this.select(e)}}},multipleSelect:function(){return this.multiple||this.handlers.feature.evt&&this.handlers.feature.evt[this.multipleKey]},toggleSelect:function(){return this.toggle||this.handlers.feature.evt&&this.handlers.feature.evt[this.toggleKey]},clickoutFeature:function(e){if(!this.hover&&this.clickout){this.unselectAll()}},overFeature:function(e){var t=e.layer;if(this.hover){if(this.highlightOnly){this.highlight(e)}else if(OpenLayers.Util.indexOf(t.selectedFeatures,e)==-1){this.select(e)}}},outFeature:function(e){if(this.hover){if(this.highlightOnly){if(e._lastHighlighter==this.id){if(e._prevHighlighter&&e._prevHighlighter!=this.id){delete e._lastHighlighter;var t=this.map.getControl(e._prevHighlighter);if(t){t.highlight(e)}}else{this.unhighlight(e)}}}else{this.unselect(e)}}},highlight:function(e){var t=e.layer;var i=this.events.triggerEvent("beforefeaturehighlighted",{feature:e});if(i!==false){e._prevHighlighter=e._lastHighlighter;e._lastHighlighter=this.id;var r=this.selectStyle||this.renderIntent;t.drawFeature(e,r);this.events.triggerEvent("featurehighlighted",{feature:e})}},unhighlight:function(e){var t=e.layer;if(e._prevHighlighter==undefined){delete e._lastHighlighter}else if(e._prevHighlighter==this.id){delete e._prevHighlighter}else{e._lastHighlighter=e._prevHighlighter;delete e._prevHighlighter}t.drawFeature(e,e.style||e.layer.style||"default");this.events.triggerEvent("featureunhighlighted",{feature:e})},select:function(e){var t=this.onBeforeSelect.call(this.scope,e);var i=e.layer;if(t!==false){t=i.events.triggerEvent("beforefeatureselected",{feature:e});if(t!==false){i.selectedFeatures.push(e);this.highlight(e);if(!this.handlers.feature.lastFeature){this.handlers.feature.lastFeature=i.selectedFeatures[0]}i.events.triggerEvent("featureselected",{feature:e});this.onSelect.call(this.scope,e)}}},unselect:function(e){var t=e.layer;this.unhighlight(e);OpenLayers.Util.removeItem(t.selectedFeatures,e);t.events.triggerEvent("featureunselected",{feature:e});this.onUnselect.call(this.scope,e)},selectBox:function(e){if(e instanceof OpenLayers.Bounds){var t=this.map.getLonLatFromPixel({x:e.left,y:e.bottom});var i=this.map.getLonLatFromPixel({x:e.right,y:e.top});var r=new OpenLayers.Bounds(t.lon,t.lat,i.lon,i.lat);if(!this.multipleSelect()){this.unselectAll()}var a=this.multiple;this.multiple=true;var s=this.layers||[this.layer];this.events.triggerEvent("boxselectionstart",{layers:s});var n;for(var o=0;o<s.length;++o){n=s[o];for(var l=0,p=n.features.length;l<p;++l){var h=n.features[l];if(!h.getVisibility()){continue}if(this.geometryTypes==null||OpenLayers.Util.indexOf(this.geometryTypes,h.geometry.CLASS_NAME)>-1){if(r.toGeometry().intersects(h.geometry)){if(OpenLayers.Util.indexOf(n.selectedFeatures,h)==-1){this.select(h)}}}}}this.multiple=a;this.events.triggerEvent("boxselectionend",{layers:s})}},setMap:function(e){this.handlers.feature.setMap(e);if(this.box){this.handlers.box.setMap(e)}OpenLayers.Control.prototype.setMap.apply(this,arguments)},setLayer:function(e){var t=this.active;this.unselectAll();this.deactivate();if(this.layers){this.layer.destroy();this.layers=null}this.initLayer(e);this.handlers.feature.layer=this.layer;if(t){this.activate()}},CLASS_NAME:"OpenLayers.Control.SelectFeature"});OpenLayers.Format.WMSGetFeatureInfo=OpenLayers.Class(OpenLayers.Format.XML,{layerIdentifier:"_layer",featureIdentifier:"_feature",regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},gmlFormat:null,read:function(e){var t;if(typeof e=="string"){e=OpenLayers.Format.XML.prototype.read.apply(this,[e])}var i=e.documentElement;if(i){var r=this;var a=this["read_"+i.nodeName];if(a){t=a.call(this,i)}else{t=new OpenLayers.Format.GML(this.options?this.options:{}).read(e)}}else{t=e}return t},read_msGMLOutput:function(p){var e=[];var t=this.getSiblingNodesByTagCriteria(p,this.layerIdentifier);if(t){for(var i=0,u=t.length;i<u;++i){var r=t[i];var a=r.nodeName;if(r.prefix){a=a.split(":")[1]}var a=a.replace(this.layerIdentifier,"");var s=this.getSiblingNodesByTagCriteria(r,this.featureIdentifier);if(s){for(var n=0;n<s.length;n++){var o=s[n];var l=this.parseGeometry(o);var c=this.parseAttributes(o);var h=new OpenLayers.Feature.Vector(l.geometry,c,null);h.bounds=l.bounds;h.type=a;e.push(h)}}}}return e},read_FeatureInfoResponse:function(p){var e=[];var t=this.getElementsByTagNameNS(p,"*","FIELDS");for(var i=0,u=t.length;i<u;i++){var r=t[i];var c=null;var a={};var s;var n=r.attributes.length;if(n>0){for(s=0;s<n;s++){var o=r.attributes[s];a[o.nodeName]=o.nodeValue}}else{var l=r.childNodes;for(s=0,n=l.length;s<n;++s){var h=l[s];if(h.nodeType!=3){a[h.getAttribute("name")]=h.getAttribute("value")}}}e.push(new OpenLayers.Feature.Vector(c,a,null))}return e},getSiblingNodesByTagCriteria:function(e,t){var i=[];var r,a,s,n,o;if(e&&e.hasChildNodes()){r=e.childNodes;s=r.length;for(var l=0;l<s;l++){o=r[l];while(o&&o.nodeType!=1){o=o.nextSibling;l++}a=o?o.nodeName:"";if(a.length>0&&a.indexOf(t)>-1){i.push(o)}else{n=this.getSiblingNodesByTagCriteria(o,t);if(n.length>0){i.length==0?i=n:i.push(n)}}}}return i},parseAttributes:function(e){var t={};if(e.nodeType==1){var i=e.childNodes;var r=i.length;for(var a=0;a<r;++a){var s=i[a];if(s.nodeType==1){var n=s.childNodes;var o=s.prefix?s.nodeName.split(":")[1]:s.nodeName;if(n.length==0){t[o]=null}else if(n.length==1){var l=n[0];if(l.nodeType==3||l.nodeType==4){var h=l.nodeValue.replace(this.regExes.trimSpace,"");t[o]=h}}}}}return t},parseGeometry:function(e){if(!this.gmlFormat){this.gmlFormat=new OpenLayers.Format.GML}var t=this.gmlFormat.parseFeature(e);var i,r=null;if(t){i=t.geometry&&t.geometry.clone();r=t.bounds&&t.bounds.clone();t.destroy()}return{geometry:i,bounds:r}},CLASS_NAME:"OpenLayers.Format.WMSGetFeatureInfo"});Ext.namespace("gxp.plugins");gxp.plugins.ClickableFeatures=Ext.extend(gxp.plugins.Tool,{featureManager:null,autoLoadFeature:false,autoLoadedFeature:null,toleranceParameters:["BUFFER","RADIUS"],constructor:function(e){if(e&&"autoLoadFeatures"in e){e.autoLoadFeature=e.autoLoadFeatures;delete e.autoLoadFeatures;if(window.console){console.warn("Deprecated config option 'autoLoadFeatures' for ptype: '"+e.ptype+"'. Use 'autoLoadFeature' instead.")}}gxp.plugins.ClickableFeatures.superclass.constructor.apply(this,[e])},noFeatureClick:function(o){if(!this.selectControl){this.selectControl=new OpenLayers.Control.SelectFeature(this.target.tools[this.featureManager].featureLayer,this.initialConfig.controlOptions)}var p=this.target.mapPanel.map.getLonLatFromPixel(o.xy);var l=this.target.tools[this.featureManager];var e=l.page;if(l.visible()=="all"&&l.paging&&e&&e.extent.containsLonLat(p)){return}var t=l.layerRecord&&l.layerRecord.getLayer();if(!t){return}var i=this.target.mapPanel.map;var r=i.getSize();var a=Ext.applyIf({REQUEST:"GetFeatureInfo",BBOX:i.getExtent().toBBOX(),WIDTH:r.w,HEIGHT:r.h,X:parseInt(o.xy.x),Y:parseInt(o.xy.y),QUERY_LAYERS:t.params.LAYERS,INFO_FORMAT:"application/vnd.ogc.gml",EXCEPTIONS:"application/vnd.ogc.se_xml",FEATURE_COUNT:1},t.params);if(typeof this.tolerance==="number"){for(var s=0,u=this.toleranceParameters.length;s<u;++s){a[this.toleranceParameters[s]]=this.tolerance}}var n=i.getProjectionObject();var h=t.projection;if(h&&h.equals(n)){n=h}if(parseFloat(t.params.VERSION)>=1.3){a.CRS=n.getCode()}else{a.SRS=n.getCode()}var c=new GeoExt.data.FeatureStore({fields:{},proxy:new GeoExt.data.ProtocolProxy({protocol:new OpenLayers.Protocol.HTTP({url:typeof t.url==="string"?t.url:t.url[0],params:a,format:new OpenLayers.Format.WMSGetFeatureInfo})}),autoLoad:true,listeners:{load:function(e,t){if(t.length>0){var i=t[0].get("fid");var r=new OpenLayers.Filter.FeatureId({fids:[i]});var a=function(){l.loadFeatures(r,function(e){if(e.length){this.autoLoadedFeature=e[0];this.select(e[0])}},this)}.createDelegate(this);var s=l.featureLayer.getFeatureByFid(i);if(s){this.select(s)}else if(l.paging&&l.pagingType===gxp.plugins.FeatureManager.QUADTREE_PAGING){var n=this.target.mapPanel.map.getLonLatFromPixel(o.xy);l.setPage({lonLat:n},function(){var e=l.featureLayer.getFeatureByFid(i);if(e){this.select(e)}else if(this.autoLoadFeature===true){a()}},this)}else{a()}}},scope:this}})},select:function(e){this.selectControl.unselectAll();this.selectControl.select(e)}});Ext.namespace("gxp.plugins");gxp.plugins.SchemaAnnotations={getAnnotationsFromSchema:function(e){var t=null;var i=e.get("annotation");if(i!==undefined){t={};var r=GeoExt.Lang.locale.split("-").shift();var a,s;for(a=0,s=i.appinfo.length;a<s;++a){var n=Ext.decode(i.appinfo[a]);if(n.title&&n.title[r]){t.label=n.title[r];break}}for(a=0,s=i.documentation.length;a<s;++a){if(i.documentation[a].lang===r){t.helpText=i.documentation[a].textContent;break}}}return t}};Ext.namespace("gxp.plugins");gxp.plugins.FeatureEditorGrid=Ext.extend(Ext.grid.PropertyGrid,{ptype:"gxp_editorgrid",xtype:"gxp_editorgrid",feature:null,schema:null,fields:null,excludeFields:null,propertyNames:null,readOnly:null,border:false,initComponent:function(){if(!this.dateFormat){this.dateFormat=Ext.form.DateField.prototype.format}if(!this.timeFormat){this.timeFormat=Ext.form.TimeField.prototype.format}this.customRenderers=this.customRenderers||{};this.customEditors=this.customEditors||{};var l=this.feature,h;if(this.fields){h={};for(var e=0,t=this.fields.length;e<t;++e){h[this.fields[e]]=l.attributes[this.fields[e]]}}else{h=l.attributes}if(!this.excludeFields){this.excludeFields=[]}if(this.schema){var p=this.fields?this.fields.join(",").toUpperCase().split(","):[];this.schema.each(function(e){var t=e.get("type");if(t.match(/^[^:]*:?((Multi)?(Point|Line|Polygon|Curve|Surface|Geometry))/)){return}var i=e.get("name");if(this.fields){if(p.indexOf(i.toUpperCase())==-1){this.excludeFields.push(i)}}var r=l.attributes[i];var a=GeoExt.form.recordToField(e);var s=this.getAnnotationsFromSchema(e);if(s&&s.label){this.propertyNames=this.propertyNames||{};this.propertyNames[i]=s.label}var n;if(typeof r=="string"){var o;switch(t.split(":").pop()){case"date":o=this.dateFormat;a.editable=false;break;case"dateTime":if(!o){o=this.dateFormat+" "+this.timeFormat;a.editable=true}a.format=o;n={startedit:function(e,t){if(!(t instanceof Date)){var i=Date.parseDate(t.replace(/Z$/,""),"c");if(i){this.setValue(i)}}}};this.customRenderers[i]=function(){return function(e){var t=e;if(typeof e=="string"){t=Date.parseDate(e.replace(/Z$/,""),"c")}return t?t.format(o):e}}();break;case"boolean":n={startedit:function(e,t){this.setValue(Boolean(t))}};break;default:break}}this.customEditors[i]=new Ext.grid.GridEditor({field:Ext.create(a),listeners:n});h[i]=r},this);l.attributes=h}this.source=h;var i=this.excludeFields.length?this.excludeFields.join(",").toUpperCase().split(","):[];this.viewConfig={forceFit:true,getRowClass:function(e){if(i.indexOf(e.get("name").toUpperCase())!==-1){return"x-hide-nosize"}}};this.listeners={beforeedit:function(){return this.featureEditor&&this.featureEditor.editing},propertychange:function(){if(this.featureEditor){this.featureEditor.setFeatureState(this.featureEditor.getDirtyState())}},scope:this};var r=Ext.data.Store.prototype.sort;Ext.data.Store.prototype.sort=function(){};gxp.plugins.FeatureEditorGrid.superclass.initComponent.apply(this,arguments);Ext.data.Store.prototype.sort=r;this.propStore.isEditableValue=function(){return true}},init:function(e){this.featureEditor=e;this.featureEditor.on("canceledit",this.onCancelEdit,this);this.featureEditor.add(this);this.featureEditor.doLayout()},destroy:function(){if(this.featureEditor){this.featureEditor.un("canceledit",this.onCancelEdit,this);this.featureEditor=null}gxp.plugins.FeatureEditorGrid.superclass.destroy.call(this)},onCancelEdit:function(e,t){if(t){this.setSource(t.attributes)}}});Ext.override(gxp.plugins.FeatureEditorGrid,gxp.plugins.SchemaAnnotations);Ext.preg(gxp.plugins.FeatureEditorGrid.prototype.ptype,gxp.plugins.FeatureEditorGrid);Ext.reg(gxp.plugins.FeatureEditorGrid.prototype.xtype,gxp.plugins.FeatureEditorGrid);OpenLayers.Handler.Keyboard=OpenLayers.Class(OpenLayers.Handler,{KEY_EVENTS:["keydown","keyup"],eventListener:null,observeElement:null,initialize:function(e,t,i){OpenLayers.Handler.prototype.initialize.apply(this,arguments);this.eventListener=OpenLayers.Function.bindAsEventListener(this.handleKeyEvent,this)},destroy:function(){this.deactivate();this.eventListener=null;OpenLayers.Handler.prototype.destroy.apply(this,arguments)},activate:function(){if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){this.observeElement=this.observeElement||document;for(var e=0,t=this.KEY_EVENTS.length;e<t;e++){OpenLayers.Event.observe(this.observeElement,this.KEY_EVENTS[e],this.eventListener)}return true}else{return false}},deactivate:function(){var e=false;if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){for(var t=0,i=this.KEY_EVENTS.length;t<i;t++){OpenLayers.Event.stopObserving(this.observeElement,this.KEY_EVENTS[t],this.eventListener)}e=true}return e},handleKeyEvent:function(e){if(this.checkModifiers(e)){this.callback(e.type,[e])}},CLASS_NAME:"OpenLayers.Handler.Keyboard"});OpenLayers.Control.ModifyFeature=OpenLayers.Class(OpenLayers.Control,{documentDrag:false,geometryTypes:null,clickout:true,toggle:true,standalone:false,layer:null,feature:null,vertex:null,vertices:null,virtualVertices:null,handlers:null,deleteCodes:null,virtualStyle:null,vertexRenderIntent:null,mode:null,createVertices:true,modified:false,radiusHandle:null,dragHandle:null,onModificationStart:function(){},onModification:function(){},onModificationEnd:function(){},initialize:function(e,t){t=t||{};this.layer=e;this.vertices=[];this.virtualVertices=[];this.virtualStyle=OpenLayers.Util.extend({},this.layer.style||this.layer.styleMap.createSymbolizer(null,t.vertexRenderIntent));this.virtualStyle.fillOpacity=.3;this.virtualStyle.strokeOpacity=.3;this.deleteCodes=[46,68];this.mode=OpenLayers.Control.ModifyFeature.RESHAPE;OpenLayers.Control.prototype.initialize.apply(this,[t]);if(!OpenLayers.Util.isArray(this.deleteCodes)){this.deleteCodes=[this.deleteCodes]}var i={down:function(e){this.vertex=null;var t=this.layer.getFeatureFromEvent(this.handlers.drag.evt);if(t){this.dragStart(t)}else if(this.clickout){this._unselect=this.feature}},move:function(e){delete this._unselect;if(this.vertex){this.dragVertex(this.vertex,e)}},up:function(){this.handlers.drag.stopDown=false;if(this._unselect){this.unselectFeature(this._unselect);delete this._unselect}},done:function(e){if(this.vertex){this.dragComplete(this.vertex)}}};var r={documentDrag:this.documentDrag,stopDown:false};var a={keydown:this.handleKeypress};this.handlers={keyboard:new OpenLayers.Handler.Keyboard(this,a),drag:new OpenLayers.Handler.Drag(this,i,r)}},destroy:function(){if(this.map){this.map.events.un({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this})}this.layer=null;OpenLayers.Control.prototype.destroy.apply(this,[])},activate:function(){if(OpenLayers.Control.prototype.activate.apply(this,arguments)){this.moveLayerToTop();this.map.events.on({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this});return this.handlers.keyboard.activate()&&this.handlers.drag.activate()}return false},deactivate:function(){var e=false;if(OpenLayers.Control.prototype.deactivate.apply(this,arguments)){this.moveLayerBack();this.map.events.un({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this});this.layer.removeFeatures(this.vertices,{silent:true});this.layer.removeFeatures(this.virtualVertices,{silent:true});this.vertices=[];this.handlers.drag.deactivate();this.handlers.keyboard.deactivate();var t=this.feature;if(t&&t.geometry&&t.layer){this.unselectFeature(t)}e=true}return e},beforeSelectFeature:function(e){return this.layer.events.triggerEvent("beforefeaturemodified",{feature:e})},selectFeature:function(e){if(this.feature===e||this.geometryTypes&&OpenLayers.Util.indexOf(this.geometryTypes,e.geometry.CLASS_NAME)==-1){return}if(this.beforeSelectFeature(e)!==false){if(this.feature){this.unselectFeature(this.feature)}this.feature=e;this.layer.selectedFeatures.push(e);this.layer.drawFeature(e,"select");this.modified=false;this.resetVertices();this.onModificationStart(this.feature)}var t=e.modified;if(e.geometry&&!(t&&t.geometry)){this._originalGeometry=e.geometry.clone()}},unselectFeature:function(e){this.layer.removeFeatures(this.vertices,{silent:true});this.vertices=[];this.layer.destroyFeatures(this.virtualVertices,{silent:true});this.virtualVertices=[];if(this.dragHandle){this.layer.destroyFeatures([this.dragHandle],{silent:true});delete this.dragHandle}if(this.radiusHandle){this.layer.destroyFeatures([this.radiusHandle],{silent:true});delete this.radiusHandle}this.layer.drawFeature(this.feature,"default");this.feature=null;OpenLayers.Util.removeItem(this.layer.selectedFeatures,e);this.onModificationEnd(e);this.layer.events.triggerEvent("afterfeaturemodified",{feature:e,modified:this.modified});this.modified=false},dragStart:function(e){var t=e.geometry.CLASS_NAME=="OpenLayers.Geometry.Point";if(!this.standalone&&(!e._sketch&&t||!e._sketch)){if(this.toggle&&this.feature===e){this._unselect=e}this.selectFeature(e)}if(e._sketch||t){this.vertex=e;this.handlers.drag.stopDown=true}},dragVertex:function(e,t){var i=this.map.getLonLatFromViewPortPx(t);var r=e.geometry;r.move(i.lon-r.x,i.lat-r.y);this.modified=true;if(this.feature.geometry.CLASS_NAME=="OpenLayers.Geometry.Point"){this.layer.events.triggerEvent("vertexmodified",{vertex:e.geometry,feature:this.feature,pixel:t})}else{if(e._index){e.geometry.parent.addComponent(e.geometry,e._index);delete e._index;OpenLayers.Util.removeItem(this.virtualVertices,e);this.vertices.push(e)}else if(e==this.dragHandle){this.layer.removeFeatures(this.vertices,{silent:true});this.vertices=[];if(this.radiusHandle){this.layer.destroyFeatures([this.radiusHandle],{silent:true});this.radiusHandle=null}}else if(e!==this.radiusHandle){this.layer.events.triggerEvent("vertexmodified",{vertex:e.geometry,feature:this.feature,pixel:t})}if(this.virtualVertices.length>0){this.layer.destroyFeatures(this.virtualVertices,{silent:true});this.virtualVertices=[]}this.layer.drawFeature(this.feature,this.standalone?undefined:"select")}this.layer.drawFeature(e)},dragComplete:function(e){this.resetVertices();this.setFeatureState();this.onModification(this.feature);this.layer.events.triggerEvent("featuremodified",{feature:this.feature})},setFeatureState:function(){if(this.feature.state!=OpenLayers.State.INSERT&&this.feature.state!=OpenLayers.State.DELETE){this.feature.state=OpenLayers.State.UPDATE;if(this.modified&&this._originalGeometry){var e=this.feature;e.modified=OpenLayers.Util.extend(e.modified,{geometry:this._originalGeometry});delete this._originalGeometry}}},resetVertices:function(){if(this.vertices.length>0){this.layer.removeFeatures(this.vertices,{silent:true});this.vertices=[]}if(this.virtualVertices.length>0){this.layer.removeFeatures(this.virtualVertices,{silent:true});this.virtualVertices=[]}if(this.dragHandle){this.layer.destroyFeatures([this.dragHandle],{silent:true});this.dragHandle=null}if(this.radiusHandle){this.layer.destroyFeatures([this.radiusHandle],{silent:true});this.radiusHandle=null}if(this.feature&&this.feature.geometry.CLASS_NAME!="OpenLayers.Geometry.Point"){if(this.mode&OpenLayers.Control.ModifyFeature.DRAG){this.collectDragHandle()}if(this.mode&(OpenLayers.Control.ModifyFeature.ROTATE|OpenLayers.Control.ModifyFeature.RESIZE)){this.collectRadiusHandle()}if(this.mode&OpenLayers.Control.ModifyFeature.RESHAPE){if(!(this.mode&OpenLayers.Control.ModifyFeature.RESIZE)){this.collectVertices()}}}},handleKeypress:function(e){var t=e.keyCode;if(this.feature&&OpenLayers.Util.indexOf(this.deleteCodes,t)!=-1){var i=this.layer.getFeatureFromEvent(this.handlers.drag.evt);if(i&&OpenLayers.Util.indexOf(this.vertices,i)!=-1&&!this.handlers.drag.dragging&&i.geometry.parent){i.geometry.parent.removeComponent(i.geometry);this.layer.events.triggerEvent("vertexremoved",{vertex:i.geometry,feature:this.feature,pixel:e.xy});this.layer.drawFeature(this.feature,this.standalone?undefined:"select");this.modified=true;this.resetVertices();this.setFeatureState();this.onModification(this.feature);this.layer.events.triggerEvent("featuremodified",{feature:this.feature})}}},collectVertices:function(){this.vertices=[];this.virtualVertices=[];var u=this;function c(e){var t,i,r,a;if(e.CLASS_NAME=="OpenLayers.Geometry.Point"){i=new OpenLayers.Feature.Vector(e);i._sketch=true;i.renderIntent=u.vertexRenderIntent;u.vertices.push(i)}else{var s=e.components.length;if(e.CLASS_NAME=="OpenLayers.Geometry.LinearRing"){s-=1}for(t=0;t<s;++t){r=e.components[t];if(r.CLASS_NAME=="OpenLayers.Geometry.Point"){i=new OpenLayers.Feature.Vector(r);i._sketch=true;i.renderIntent=u.vertexRenderIntent;u.vertices.push(i)}else{c(r)}}if(u.createVertices&&e.CLASS_NAME!="OpenLayers.Geometry.MultiPoint"){for(t=0,a=e.components.length;t<a-1;++t){var n=e.components[t];var o=e.components[t+1];if(n.CLASS_NAME=="OpenLayers.Geometry.Point"&&o.CLASS_NAME=="OpenLayers.Geometry.Point"){var l=(n.x+o.x)/2;var p=(n.y+o.y)/2;var h=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(l,p),null,u.virtualStyle);h.geometry.parent=e;h._index=t+1;h._sketch=true;u.virtualVertices.push(h)}}}}}c.call(this,this.feature.geometry);this.layer.addFeatures(this.virtualVertices,{silent:true});this.layer.addFeatures(this.vertices,{silent:true})},collectDragHandle:function(){var i=this.feature.geometry;var e=i.getBounds().getCenterLonLat();var t=new OpenLayers.Geometry.Point(e.lon,e.lat);var r=new OpenLayers.Feature.Vector(t);t.move=function(e,t){OpenLayers.Geometry.Point.prototype.move.call(this,e,t);i.move(e,t)};r._sketch=true;this.dragHandle=r;this.dragHandle.renderIntent=this.vertexRenderIntent;this.layer.addFeatures([this.dragHandle],{silent:true})},collectRadiusHandle:function(){var d=this.feature.geometry;var e=d.getBounds();var t=e.getCenterLonLat();var f=new OpenLayers.Geometry.Point(t.lon,t.lat);var i=new OpenLayers.Geometry.Point(e.right,e.bottom);var r=new OpenLayers.Feature.Vector(i);var y=this.mode&OpenLayers.Control.ModifyFeature.RESIZE;var g=this.mode&OpenLayers.Control.ModifyFeature.RESHAPE;var m=this.mode&OpenLayers.Control.ModifyFeature.ROTATE;i.move=function(e,t){OpenLayers.Geometry.Point.prototype.move.call(this,e,t);var i=this.x-f.x;var r=this.y-f.y;var a=i-e;var s=r-t;if(m){var n=Math.atan2(s,a);var p=Math.atan2(r,i);var o=p-n;o*=180/Math.PI;d.rotate(o,f)}if(y){var l,h;if(g){l=r/s;h=i/a/l}else{var u=Math.sqrt(a*a+s*s);var c=Math.sqrt(i*i+r*r);l=c/u}d.resize(l,f,h)}};r._sketch=true;this.radiusHandle=r;this.radiusHandle.renderIntent=this.vertexRenderIntent;this.layer.addFeatures([this.radiusHandle],{silent:true})},setMap:function(e){this.handlers.drag.setMap(e);OpenLayers.Control.prototype.setMap.apply(this,arguments)},handleMapEvents:function(e){if(e.type=="removelayer"||e.property=="order"){this.moveLayerToTop()}},moveLayerToTop:function(){var e=Math.max(this.map.Z_INDEX_BASE["Feature"]-1,this.layer.getZIndex())+1;this.layer.setZIndex(e)},moveLayerBack:function(){var e=this.layer.getZIndex()-1;if(e>=this.map.Z_INDEX_BASE["Feature"]){this.layer.setZIndex(e)}else{this.map.setLayerZIndex(this.layer,this.map.getLayerIndex(this.layer))}},CLASS_NAME:"OpenLayers.Control.ModifyFeature"});OpenLayers.Control.ModifyFeature.RESHAPE=1;OpenLayers.Control.ModifyFeature.RESIZE=2;OpenLayers.Control.ModifyFeature.ROTATE=4;OpenLayers.Control.ModifyFeature.DRAG=8;Ext.namespace("gxp");gxp.FeatureEditPopup=Ext.extend(GeoExt.Popup,{closeMsgTitle:gettext("Save Changes?"),closeMsg:"This feature has unsaved changes. Would you like to save your changes?",deleteMsgTitle:gettext("Delete Feature?"),deleteMsg:"Are you sure you want to delete this feature?",editButtonText:gettext("Edit"),editButtonTooltip:gettext("Make this feature editable"),deleteButtonText:gettext("Delete"),deleteButtonTooltip:gettext("Delete this feature"),cancelButtonText:gettext("Cancel"),cancelButtonTooltip:gettext("Stop editing, discard changes"),saveButtonText:gettext("Save"),saveButtonTooltip:gettext("Save changes"),layout:"fit",feature:null,schema:null,readOnly:false,allowDelete:false,editing:false,editorPluginConfig:{ptype:"gxp_editorgrid"},modifyControl:null,geometry:null,attributes:null,cancelButton:null,saveButton:null,editButton:null,deleteButton:null,initComponent:function(){this.addEvents("startedit","stopedit","beforefeaturemodified","featuremodified","canceledit","cancelclose");var e=this.feature;if(e instanceof GeoExt.data.FeatureRecord){e=this.feature=e.getFeature()}if(!this.location){this.location=e}this.anchored=!this.editing;if(!this.title&&e.fid){this.title=e.fid}this.editButton=new Ext.Button({text:this.editButtonText,tooltip:this.editButtonTooltip,iconCls:"edit",handler:this.startEditing,scope:this});this.deleteButton=new Ext.Button({text:this.deleteButtonText,tooltip:this.deleteButtonTooltip,iconCls:"delete",hidden:!this.allowDelete,handler:this.deleteFeature,scope:this});this.cancelButton=new Ext.Button({text:this.cancelButtonText,tooltip:this.cancelButtonTooltip,iconCls:"cancel",hidden:true,handler:function(){this.stopEditing(false)},scope:this});this.saveButton=new Ext.Button({text:this.saveButtonText,tooltip:this.saveButtonTooltip,iconCls:"save",hidden:true,handler:function(){this.stopEditing(true)},scope:this});this.plugins=[Ext.apply({feature:e,schema:this.schema,fields:this.fields,excludeFields:this.excludeFields,propertyNames:this.propertyNames,readOnly:this.readOnly},this.editorPluginConfig)];this.bbar=new Ext.Toolbar({hidden:this.readOnly,items:[this.editButton,this.deleteButton,this.saveButton,this.cancelButton]});gxp.FeatureEditPopup.superclass.initComponent.call(this);this.on({show:function(){if(this.editing){this.editing=null;this.startEditing()}},beforeclose:function(){if(!this.editing){return}if(this.feature.state===this.getDirtyState()){Ext.Msg.show({title:this.closeMsgTitle,msg:this.closeMsg,buttons:Ext.Msg.YESNOCANCEL,fn:function(e){if(e&&e!=="cancel"){this.stopEditing(e==="yes");this.close()}else{this.fireEvent("cancelclose",this)}},scope:this,icon:Ext.MessageBox.QUESTION,animEl:this.getEl()});return false}else{this.stopEditing(false)}},scope:this})},getDirtyState:function(){return this.feature.state===OpenLayers.State.INSERT?this.feature.state:OpenLayers.State.UPDATE},startEditing:function(){if(!this.editing){this.fireEvent("startedit",this);this.editing=true;this.anc&&this.unanchorPopup();this.editButton.hide();this.deleteButton.hide();this.saveButton.show();this.cancelButton.show();this.geometry=this.feature.geometry&&this.feature.geometry.clone();this.attributes=Ext.apply({},this.feature.attributes);this.modifyControl=new OpenLayers.Control.ModifyFeature(this.feature.layer,{standalone:true,vertexRenderIntent:this.vertexRenderIntent});this.feature.layer.map.addControl(this.modifyControl);this.modifyControl.activate();if(this.feature.geometry){this.modifyControl.selectFeature(this.feature)}}},stopEditing:function(e){if(this.editing){this.fireEvent("stopedit",this);this.modifyControl.deactivate();this.modifyControl.destroy();var t=this.feature;if(t.state===this.getDirtyState()){if(e===true){this.fireEvent("beforefeaturemodified",this,t);if(this.schema){var i,r;for(var a in t.attributes){r=this.schema.getAt(this.schema.findExact("name",a));i=t.attributes[a];if(i instanceof Date){var s=r.get("type").split(":").pop();t.attributes[a]=i.format(s=="date"?"Y-m-d":"c")}}}this.fireEvent("featuremodified",this,t)}else if(t.state===OpenLayers.State.INSERT){this.editing=false;t.layer&&t.layer.destroyFeatures([t]);this.fireEvent("canceledit",this,null);this.close()}else{var n=t.layer;n.drawFeature(t,{display:"none"});t.geometry=this.geometry;t.attributes=this.attributes;this.setFeatureState(null);n.drawFeature(t);this.fireEvent("canceledit",this,t)}}if(!this.isDestroyed){this.cancelButton.hide();this.saveButton.hide();this.editButton.show();this.allowDelete&&this.deleteButton.show()}this.editing=false}},deleteFeature:function(){Ext.Msg.show({title:this.deleteMsgTitle,msg:this.deleteMsg,buttons:Ext.Msg.YESNO,fn:function(e){if(e==="yes"){this.setFeatureState(OpenLayers.State.DELETE);this.fireEvent("featuremodified",this,this.feature);this.close()}},scope:this,icon:Ext.MessageBox.QUESTION,animEl:this.getEl()})},setFeatureState:function(e){this.feature.state=e;var t=this.feature.layer;t&&t.events.triggerEvent("featuremodified",{feature:this.feature})}});Ext.reg("gxp_featureeditpopup",gxp.FeatureEditPopup);OpenLayers.Control.DrawFeature=OpenLayers.Class(OpenLayers.Control,{layer:null,callbacks:null,multi:false,featureAdded:function(){},initialize:function(e,t,i){OpenLayers.Control.prototype.initialize.apply(this,[i]);this.callbacks=OpenLayers.Util.extend({done:this.drawFeature,modify:function(e,t){this.layer.events.triggerEvent("sketchmodified",{vertex:e,feature:t})},create:function(e,t){this.layer.events.triggerEvent("sketchstarted",{vertex:e,feature:t})}},this.callbacks);this.layer=e;this.handlerOptions=this.handlerOptions||{};this.handlerOptions.layerOptions=OpenLayers.Util.applyDefaults(this.handlerOptions.layerOptions,{renderers:e.renderers,rendererOptions:e.rendererOptions});if(!("multi"in this.handlerOptions)){this.handlerOptions.multi=this.multi}var r=this.layer.styleMap&&this.layer.styleMap.styles.temporary;if(r){this.handlerOptions.layerOptions=OpenLayers.Util.applyDefaults(this.handlerOptions.layerOptions,{styleMap:new OpenLayers.StyleMap({default:r})})}this.handler=new t(this,this.callbacks,this.handlerOptions)},drawFeature:function(e){var t=new OpenLayers.Feature.Vector(e);var i=this.layer.events.triggerEvent("sketchcomplete",{feature:t});if(i!==false){t.state=OpenLayers.State.INSERT;this.layer.addFeatures([t]);this.featureAdded(t);this.events.triggerEvent("featureadded",{feature:t})}},insertXY:function(e,t){if(this.handler&&this.handler.line){this.handler.insertXY(e,t)}},insertDeltaXY:function(e,t){if(this.handler&&this.handler.line){this.handler.insertDeltaXY(e,t)}},insertDirectionLength:function(e,t){if(this.handler&&this.handler.line){this.handler.insertDirectionLength(e,t)}},insertDeflectionLength:function(e,t){if(this.handler&&this.handler.line){this.handler.insertDeflectionLength(e,t)}},undo:function(){return this.handler.undo&&this.handler.undo()},redo:function(){return this.handler.redo&&this.handler.redo()},finishSketch:function(){this.handler.finishGeometry()},cancel:function(){this.handler.cancel()},CLASS_NAME:"OpenLayers.Control.DrawFeature"});OpenLayers.Handler.Point=OpenLayers.Class(OpenLayers.Handler,{point:null,layer:null,multi:false,citeCompliant:false,mouseDown:false,stoppedDown:null,lastDown:null,lastUp:null,persist:false,stopDown:false,stopUp:false,layerOptions:null,pixelTolerance:5,lastTouchPx:null,initialize:function(e,t,i){if(!(i&&i.layerOptions&&i.layerOptions.styleMap)){this.style=OpenLayers.Util.extend(OpenLayers.Feature.Vector.style["default"],{})}OpenLayers.Handler.prototype.initialize.apply(this,arguments)},activate:function(){if(!OpenLayers.Handler.prototype.activate.apply(this,arguments)){return false}var e=OpenLayers.Util.extend({displayInLayerSwitcher:false,calculateInRange:OpenLayers.Function.True,wrapDateLine:this.citeCompliant},this.layerOptions);this.layer=new OpenLayers.Layer.Vector(this.CLASS_NAME,e);this.map.addLayer(this.layer);return true},createFeature:function(e){var t=this.layer.getLonLatFromViewPortPx(e);var i=new OpenLayers.Geometry.Point(t.lon,t.lat);this.point=new OpenLayers.Feature.Vector(i);this.callback("create",[this.point.geometry,this.point]);this.point.geometry.clearBounds();this.layer.addFeatures([this.point],{silent:true})},deactivate:function(){if(!OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){return false}this.cancel();if(this.layer.map!=null){this.destroyFeature(true);this.layer.destroy(false)}this.layer=null;return true},destroyFeature:function(e){if(this.layer&&(e||!this.persist)){this.layer.destroyFeatures()}this.point=null},destroyPersistedFeature:function(){var e=this.layer;if(e&&e.features.length>1){this.layer.features[0].destroy()}},finalize:function(e){var t=e?"cancel":"done";this.mouseDown=false;this.lastDown=null;this.lastUp=null;this.lastTouchPx=null;this.callback(t,[this.geometryClone()]);this.destroyFeature(e)},cancel:function(){this.finalize(true)},click:function(e){OpenLayers.Event.stop(e);return false},dblclick:function(e){OpenLayers.Event.stop(e);return false},modifyFeature:function(e){if(!this.point){this.createFeature(e)}var t=this.layer.getLonLatFromViewPortPx(e);this.point.geometry.x=t.lon;this.point.geometry.y=t.lat;this.callback("modify",[this.point.geometry,this.point,false]);this.point.geometry.clearBounds();this.drawFeature()},drawFeature:function(){this.layer.drawFeature(this.point,this.style)},getGeometry:function(){var e=this.point&&this.point.geometry;if(e&&this.multi){e=new OpenLayers.Geometry.MultiPoint([e])}return e},geometryClone:function(){var e=this.getGeometry();return e&&e.clone()},mousedown:function(e){return this.down(e)},touchstart:function(e){this.startTouch();this.lastTouchPx=e.xy;return this.down(e)},mousemove:function(e){return this.move(e)},touchmove:function(e){this.lastTouchPx=e.xy;return this.move(e)},mouseup:function(e){return this.up(e)},touchend:function(e){e.xy=this.lastTouchPx;return this.up(e)},down:function(e){this.mouseDown=true;this.lastDown=e.xy;if(!this.touch){this.modifyFeature(e.xy)}this.stoppedDown=this.stopDown;return!this.stopDown},move:function(e){if(!this.touch&&(!this.mouseDown||this.stoppedDown)){this.modifyFeature(e.xy)}return true},up:function(e){this.mouseDown=false;this.stoppedDown=this.stopDown;if(!this.checkModifiers(e)){return true}if(this.lastUp&&this.lastUp.equals(e.xy)){return true}if(this.lastDown&&this.passesTolerance(this.lastDown,e.xy,this.pixelTolerance)){if(this.touch){this.modifyFeature(e.xy)}if(this.persist){this.destroyPersistedFeature()}this.lastUp=e.xy;this.finalize();return!this.stopUp}else{return true}},mouseout:function(e){if(OpenLayers.Util.mouseLeft(e,this.map.viewPortDiv)){this.stoppedDown=this.stopDown;this.mouseDown=false}},passesTolerance:function(e,t,i){var r=true;if(i!=null&&e&&t){var a=e.distanceTo(t);if(a>i){r=false}}return r},CLASS_NAME:"OpenLayers.Handler.Point"});OpenLayers.Handler.Path=OpenLayers.Class(OpenLayers.Handler.Point,{line:null,maxVertices:null,doubleTouchTolerance:20,freehand:false,freehandToggle:"shiftKey",timerId:null,redoStack:null,createFeature:function(e){var t=this.layer.getLonLatFromViewPortPx(e);var i=new OpenLayers.Geometry.Point(t.lon,t.lat);this.point=new OpenLayers.Feature.Vector(i);this.line=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString([this.point.geometry]));this.callback("create",[this.point.geometry,this.getSketch()]);this.point.geometry.clearBounds();this.layer.addFeatures([this.line,this.point],{silent:true})},destroyFeature:function(e){OpenLayers.Handler.Point.prototype.destroyFeature.call(this,e);this.line=null},destroyPersistedFeature:function(){var e=this.layer;if(e&&e.features.length>2){this.layer.features[0].destroy()}},removePoint:function(){if(this.point){this.layer.removeFeatures([this.point])}},addPoint:function(e){this.layer.removeFeatures([this.point]);var t=this.layer.getLonLatFromViewPortPx(e);this.point=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(t.lon,t.lat));this.line.geometry.addComponent(this.point.geometry,this.line.geometry.components.length);this.layer.addFeatures([this.point]);this.callback("point",[this.point.geometry,this.getGeometry()]);this.callback("modify",[this.point.geometry,this.getSketch()]);this.drawFeature();delete this.redoStack},insertXY:function(e,t){this.line.geometry.addComponent(new OpenLayers.Geometry.Point(e,t),this.getCurrentPointIndex());this.drawFeature();delete this.redoStack},insertDeltaXY:function(e,t){var i=this.getCurrentPointIndex()-1;var r=this.line.geometry.components[i];if(r&&!isNaN(r.x)&&!isNaN(r.y)){this.insertXY(r.x+e,r.y+t)}},insertDirectionLength:function(e,t){e*=Math.PI/180;var i=t*Math.cos(e);var r=t*Math.sin(e);this.insertDeltaXY(i,r)},insertDeflectionLength:function(e,t){var i=this.getCurrentPointIndex()-1;if(i>0){var r=this.line.geometry.components[i];var a=this.line.geometry.components[i-1];var s=Math.atan2(r.y-a.y,r.x-a.x);this.insertDirectionLength(s*180/Math.PI+e,t)}},getCurrentPointIndex:function(){return this.line.geometry.components.length-1},undo:function(){var e=this.line.geometry;var t=e.components;var i=this.getCurrentPointIndex()-1;var r=t[i];var a=e.removeComponent(r);if(a){if(this.touch&&i>0){t=e.components;var s=t[i-1];var n=this.getCurrentPointIndex();var o=t[n];o.x=s.x;o.y=s.y}if(!this.redoStack){this.redoStack=[]}this.redoStack.push(r);this.drawFeature()}return a},redo:function(){var e=this.redoStack&&this.redoStack.pop();if(e){this.line.geometry.addComponent(e,this.getCurrentPointIndex());this.drawFeature()}return!!e},freehandMode:function(e){return this.freehandToggle&&e[this.freehandToggle]?!this.freehand:this.freehand},modifyFeature:function(e,t){if(!this.line){this.createFeature(e)}var i=this.layer.getLonLatFromViewPortPx(e);this.point.geometry.x=i.lon;this.point.geometry.y=i.lat;this.callback("modify",[this.point.geometry,this.getSketch(),t]);this.point.geometry.clearBounds();this.drawFeature()},drawFeature:function(){this.layer.drawFeature(this.line,this.style);this.layer.drawFeature(this.point,this.style)},getSketch:function(){return this.line},getGeometry:function(){var e=this.line&&this.line.geometry;if(e&&this.multi){e=new OpenLayers.Geometry.MultiLineString([e])}return e},touchstart:function(e){if(this.timerId&&this.passesTolerance(this.lastTouchPx,e.xy,this.doubleTouchTolerance)){this.finishGeometry();window.clearTimeout(this.timerId);this.timerId=null;return false}else{if(this.timerId){window.clearTimeout(this.timerId);this.timerId=null}this.timerId=window.setTimeout(OpenLayers.Function.bind(function(){this.timerId=null},this),300);return OpenLayers.Handler.Point.prototype.touchstart.call(this,e)}},down:function(e){var t=this.stopDown;if(this.freehandMode(e)){t=true;if(this.touch){this.modifyFeature(e.xy,!!this.lastUp);OpenLayers.Event.stop(e)}}if(!this.touch&&(!this.lastDown||!this.passesTolerance(this.lastDown,e.xy,this.pixelTolerance))){this.modifyFeature(e.xy,!!this.lastUp)}this.mouseDown=true;this.lastDown=e.xy;this.stoppedDown=t;return!t},move:function(e){if(this.stoppedDown&&this.freehandMode(e)){if(this.persist){this.destroyPersistedFeature()}if(this.maxVertices&&this.line&&this.line.geometry.components.length===this.maxVertices){this.removePoint();this.finalize()}else{this.addPoint(e.xy)}return false}if(!this.touch&&(!this.mouseDown||this.stoppedDown)){this.modifyFeature(e.xy,!!this.lastUp)}return true},up:function(e){if(this.mouseDown&&(!this.lastUp||!this.lastUp.equals(e.xy))){if(this.stoppedDown&&this.freehandMode(e)){if(this.persist){this.destroyPersistedFeature()}this.removePoint();this.finalize()}else{if(this.passesTolerance(this.lastDown,e.xy,this.pixelTolerance)){if(this.touch){this.modifyFeature(e.xy)}if(this.lastUp==null&&this.persist){this.destroyPersistedFeature()}this.addPoint(e.xy);this.lastUp=e.xy;if(this.line.geometry.components.length===this.maxVertices+1){this.finishGeometry()}}}}this.stoppedDown=this.stopDown;this.mouseDown=false;return!this.stopUp},finishGeometry:function(){var e=this.line.geometry.components.length-1;this.line.geometry.removeComponent(this.line.geometry.components[e]);this.removePoint();this.finalize()},dblclick:function(e){if(!this.freehandMode(e)){this.finishGeometry()}return false},CLASS_NAME:"OpenLayers.Handler.Path"});OpenLayers.Handler.Polygon=OpenLayers.Class(OpenLayers.Handler.Path,{holeModifier:null,drawingHole:false,polygon:null,createFeature:function(e){var t=this.layer.getLonLatFromViewPortPx(e);var i=new OpenLayers.Geometry.Point(t.lon,t.lat);this.point=new OpenLayers.Feature.Vector(i);this.line=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LinearRing([this.point.geometry]));this.polygon=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon([this.line.geometry]));this.callback("create",[this.point.geometry,this.getSketch()]);this.point.geometry.clearBounds();this.layer.addFeatures([this.polygon,this.point],{silent:true})},addPoint:function(e){if(!this.drawingHole&&this.holeModifier&&this.evt&&this.evt[this.holeModifier]){var t=this.point.geometry;var i=this.control.layer.features;var r,a;for(var s=i.length-1;s>=0;--s){r=i[s].geometry;if((r instanceof OpenLayers.Geometry.Polygon||r instanceof OpenLayers.Geometry.MultiPolygon)&&r.intersects(t)){a=i[s];this.control.layer.removeFeatures([a],{silent:true});this.control.layer.events.registerPriority("sketchcomplete",this,this.finalizeInteriorRing);this.control.layer.events.registerPriority("sketchmodified",this,this.enforceTopology);a.geometry.addComponent(this.line.geometry);this.polygon=a;this.drawingHole=true;break}}}OpenLayers.Handler.Path.prototype.addPoint.apply(this,arguments)},getCurrentPointIndex:function(){return this.line.geometry.components.length-2},enforceTopology:function(e){var t=e.vertex;var i=this.line.geometry.components;if(!this.polygon.geometry.intersects(t)){var r=i[i.length-3];t.x=r.x;t.y=r.y}},finishGeometry:function(){var e=this.line.geometry.components.length-2;this.line.geometry.removeComponent(this.line.geometry.components[e]);this.removePoint();this.finalize()},finalizeInteriorRing:function(){var e=this.line.geometry;var t=e.getArea()!==0;if(t){var i=this.polygon.geometry.components;for(var r=i.length-2;r>=0;--r){if(e.intersects(i[r])){t=false;break}}if(t){var a;e:for(var r=i.length-2;r>0;--r){var s=i[r].components;for(var n=0,o=s.length;n<o;++n){if(e.containsPoint(s[n])){t=false;break e}}}}}if(t){if(this.polygon.state!==OpenLayers.State.INSERT){this.polygon.state=OpenLayers.State.UPDATE}}else{this.polygon.geometry.removeComponent(e)}this.restoreFeature();return false},cancel:function(){if(this.drawingHole){this.polygon.geometry.removeComponent(this.line.geometry);this.restoreFeature(true)}return OpenLayers.Handler.Path.prototype.cancel.apply(this,arguments)},restoreFeature:function(e){this.control.layer.events.unregister("sketchcomplete",this,this.finalizeInteriorRing);this.control.layer.events.unregister("sketchmodified",this,this.enforceTopology);this.layer.removeFeatures([this.polygon],{silent:true});this.control.layer.addFeatures([this.polygon],{silent:true});this.drawingHole=false;if(!e){this.control.layer.events.triggerEvent("sketchcomplete",{feature:this.polygon})}},destroyFeature:function(e){OpenLayers.Handler.Path.prototype.destroyFeature.call(this,e);this.polygon=null},drawFeature:function(){this.layer.drawFeature(this.polygon,this.style);this.layer.drawFeature(this.point,this.style)},getSketch:function(){return this.polygon},getGeometry:function(){var e=this.polygon&&this.polygon.geometry;if(e&&this.multi){e=new OpenLayers.Geometry.MultiPolygon([e])}return e},CLASS_NAME:"OpenLayers.Handler.Polygon"});Ext.namespace("gxp.plugins");gxp.plugins.FeatureEditor=Ext.extend(gxp.plugins.ClickableFeatures,{ptype:"gxp_featureeditor",commitMessage:false,splitButton:null,iconClsAdd:"gxp-icon-addfeature",closeOnSave:false,supportAbstractGeometry:false,supportNoGeometry:false,iconClsEdit:"gxp-icon-editfeature",exceptionTitle:gettext("Save Failed"),exceptionText:gettext("Trouble saving features"),pointText:gettext("Point"),lineText:gettext("Line"),polygonText:gettext("Polygon"),noGeometryText:gettext("Event"),commitTitle:gettext("Commit message"),commitText:gettext("Please enter a commit message for this edit:"),createFeatureActionTip:gettext("Create a new feature"),createFeatureActionText:gettext("Create"),editFeatureActionTip:gettext("Edit existing feature"),editFeatureActionText:gettext("Modify"),splitButtonText:gettext("Edit"),splitButtonTooltip:gettext("Edit features on selected WMS layer"),outputTarget:"map",snappingAgent:null,readOnly:false,modifyOnly:false,showSelectedOnly:true,roles:["ROLE_ADMINISTRATOR"],createAction:null,editAction:null,activeIndex:0,drawControl:null,popup:null,schema:null,constructor:function(e){this.addEvents("layereditable","featureeditable");gxp.plugins.FeatureEditor.superclass.constructor.apply(this,arguments)},init:function(e){gxp.plugins.FeatureEditor.superclass.init.apply(this,arguments);this.target.on("authorizationchange",this.onAuthorizationChange,this)},destroy:function(){this.target.un("authorizationchange",this.onAuthorizationChange,this);gxp.plugins.FeatureEditor.superclass.destroy.apply(this,arguments)},onAuthorizationChange:function(){if(!this.target.isAuthorized(this.roles)){this.selectControl.deactivate();this.drawControl.deactivate()}this.enableOrDisable()},addActions:function(){var s;var h=this.getFeatureManager();var r=h.featureLayer;var n=false;function e(e,t){var i=Array.prototype.slice.call(arguments);i.splice(0,2);if(!n&&s&&!s.isDestroyed){if(s.editing){function r(){n=true;a.call(this);if(t==="setLayer"){this.target.selectLayer(i[0])}else if(t==="clearFeatures"){window.setTimeout(function(){e[t].call(e)})}else{e[t].apply(e,i)}}function a(){h.featureStore.un("write",r,this);s.un("canceledit",r,this);s.un("cancelclose",a,this)}h.featureStore.on("write",r,this);s.on({canceledit:r,cancelclose:a,scope:this});s.close()}return!s.editing}n=false}h.on({beforequery:e.createDelegate(this,"loadFeatures",1),beforelayerchange:e.createDelegate(this,"setLayer",1),beforesetpage:e.createDelegate(this,"setPage",1),beforeclearfeatures:e.createDelegate(this,"clearFeatures",1),scope:this});this.drawControl=new OpenLayers.Control.DrawFeature(r,OpenLayers.Handler.Point,{eventListeners:{featureadded:function(e){if(this.autoLoadFeature===true){this.autoLoadedFeature=e.feature}},activate:function(){this.target.doAuthorized(this.roles,function(){h.showLayer(this.id,this.showSelectedOnly&&"selected")},this)},deactivate:function(){h.hideLayer(this.id)},scope:this}});this.selectControl=new OpenLayers.Control.SelectFeature(r,{clickout:false,multipleKey:"fakeKey",eventListeners:{activate:function(){this.target.doAuthorized(this.roles,function(){if(this.autoLoadFeature===true||h.paging){this.target.mapPanel.map.events.register("click",this,this.noFeatureClick)}h.showLayer(this.id,this.showSelectedOnly&&"selected");this.selectControl.unselectAll(s&&s.editing&&{except:s.feature})},this)},deactivate:function(){if(this.autoLoadFeature===true||h.paging){this.target.mapPanel.map.events.unregister("click",this,this.noFeatureClick)}if(s){if(s.editing){s.on("cancelclose",function(){this.selectControl.activate()},this,{single:true})}s.on("close",function(){h.hideLayer(this.id)},this,{single:true});s.close()}else{h.hideLayer(this.id)}},scope:this}});r.events.on({beforefeatureremoved:function(e){if(this.popup&&e.feature===this.popup.feature){this.selectControl.unselect(e.feature)}},featureunselected:function(e){var t=e.feature;if(t){this.fireEvent("featureeditable",this,t,false)}if(t&&t.geometry&&s&&!s.hidden){s.close()}},beforefeatureselected:function(e){if(s){return!s.editing}},featureselected:function(e){var t=e.feature;if(t){this.fireEvent("featureeditable",this,t,true)}var l=h.featureStore;if(this._forcePopupForNoGeometry===true||this.selectControl.active&&t.geometry!==null){if(this.readOnly===false){this.selectControl.deactivate();h.showLayer(this.id,this.showSelectedOnly&&"selected")}s=this.addOutput({xtype:"gxp_featureeditpopup",collapsible:true,feature:l.getByFeature(t),vertexRenderIntent:"vertex",readOnly:this.readOnly,fields:this.fields,excludeFields:this.excludeFields,editing:t.state===OpenLayers.State.INSERT,schema:this.schema,allowDelete:true,width:200,height:250});s.on({close:function(){if(this.readOnly===false){this.selectControl.activate()}if(t.layer&&t.layer.selectedFeatures.indexOf(t)!==-1){this.selectControl.unselect(t)}if(t===this.autoLoadedFeature){if(t.layer){t.layer.removeFeatures([e.feature])}this.autoLoadedFeature=null}},featuremodified:function(o,e){l.on({beforewrite:{fn:function(e,t,i,r){if(this.commitMessage===true){r.params.handle=this._commitMsg;delete this._commitMsg}},single:true},beforesave:{fn:function(){if(o&&o.isVisible()){o.disable()}if(this.commitMessage===true){if(!this._commitMsg){var i=arguments.callee;Ext.Msg.show({prompt:true,title:this.commitTitle,msg:this.commitText,buttons:Ext.Msg.OK,fn:function(e,t){if(e==="ok"){this._commitMsg=t;l.un("beforesave",i,this);l.save()}},scope:this,multiline:true});return false}}},single:this.commitMessage!==true},write:{fn:function(){if(o){if(o.isVisible()){o.enable()}if(this.closeOnSave){o.close()}}var e=h.layerRecord;this.target.fireEvent("featureedit",h,{name:e.get("name"),source:e.get("source")})},single:true},exception:{fn:function(e,t,i,r,a,s){var n=this.exceptionText;if(t==="remote"){if(a.exceptionReport){n=gxp.util.getOGCExceptionText(a.exceptionReport)}}else{n="Status: "+a.status}h.fireEvent("exception",h,a.exceptionReport||{},n,s);if(h.hasListener("exception")===false&&l.hasListener("exception")===false){Ext.Msg.show({title:this.exceptionTitle,msg:n,icon:Ext.MessageBox.ERROR,buttons:{ok:true}})}if(o&&o.isVisible()){o.enable();o.startEditing()}},single:true},scope:this});if(e.state===OpenLayers.State.DELETE){l._removing=true;l.remove(l.getRecordFromFeature(e));delete l._removing}l.save()},canceledit:function(e,t){l.commitChanges()},scope:this});this.popup=s}},sketchcomplete:function(e){h.featureLayer.events.register("featuresadded",this,function(e){h.featureLayer.events.unregister("featuresadded",this,arguments.callee);this.drawControl.deactivate();this.selectControl.activate();this.selectControl.select(e.features[0])})},scope:this});var t=this.toggleGroup||Ext.id();var i=[];var a={tooltip:this.createFeatureActionTip,menuText:this.initialConfig.createFeatureActionText,text:this.initialConfig.createFeatureActionText,iconCls:this.iconClsAdd,disabled:true,hidden:this.modifyOnly||this.readOnly,toggleGroup:t,group:t,groupClass:null,enableToggle:true,allowDepress:true,control:this.drawControl,deactivateOnDisable:true,map:this.target.mapPanel.map,listeners:{checkchange:this.onItemCheckchange,scope:this}};if(this.supportAbstractGeometry===true){var o=[];if(this.supportNoGeometry===true){o.push(new Ext.menu.CheckItem({text:this.noGeometryText,iconCls:"gxp-icon-event",groupClass:null,group:t,listeners:{checkchange:function(e,t){if(t===true){var i=new OpenLayers.Feature.Vector(null);i.state=OpenLayers.State.INSERT;r.addFeatures([i]);this._forcePopupForNoGeometry=true;r.events.triggerEvent("featureselected",{feature:i});delete this._forcePopupForNoGeometry}if(this.createAction.items[0]instanceof Ext.menu.CheckItem){this.createAction.items[0].setChecked(false)}else{this.createAction.items[0].toggle(false)}},scope:this}}))}var l=function(e,t,i){if(t===true){this.setHandler(i,false)}if(this.createAction.items[0]instanceof Ext.menu.CheckItem){this.createAction.items[0].setChecked(t)}else{this.createAction.items[0].toggle(t)}};o.push(new Ext.menu.CheckItem({groupClass:null,text:this.pointText,group:t,iconCls:"gxp-icon-point",listeners:{checkchange:l.createDelegate(this,[OpenLayers.Handler.Point],2)}}),new Ext.menu.CheckItem({groupClass:null,text:this.lineText,group:t,iconCls:"gxp-icon-line",listeners:{checkchange:l.createDelegate(this,[OpenLayers.Handler.Path],2)}}),new Ext.menu.CheckItem({groupClass:null,text:this.polygonText,group:t,iconCls:"gxp-icon-polygon",listeners:{checkchange:l.createDelegate(this,[OpenLayers.Handler.Polygon],2)}}));i.push(new GeoExt.Action(Ext.apply(a,{menu:new Ext.menu.Menu({items:o})})))}else{i.push(new GeoExt.Action(a))}i.push(new GeoExt.Action({tooltip:this.editFeatureActionTip,text:this.initialConfig.editFeatureActionText,menuText:this.initialConfig.editFeatureActionText,iconCls:this.iconClsEdit,disabled:true,toggleGroup:t,group:t,groupClass:null,enableToggle:true,allowDepress:true,control:this.selectControl,deactivateOnDisable:true,map:this.target.mapPanel.map,listeners:{checkchange:this.onItemCheckchange,scope:this}}));this.createAction=i[0];this.editAction=i[1];if(this.splitButton){this.splitButton=new Ext.SplitButton({menu:{items:[Ext.apply(new Ext.menu.CheckItem(i[0]),{text:this.createFeatureActionText}),Ext.apply(new Ext.menu.CheckItem(i[1]),{text:this.editFeatureActionText})]},disabled:true,buttonText:this.splitButtonText,tooltip:this.splitButtonTooltip,iconCls:this.iconClsAdd,enableToggle:true,toggleGroup:this.toggleGroup,allowDepress:true,handler:function(e,t){if(e.pressed){e.menu.items.itemAt(this.activeIndex).setChecked(true)}},scope:this,listeners:{toggle:function(e,t){if(!t){e.menu.items.each(function(e){e.setChecked(false)})}},render:function(e){Ext.ButtonToggleMgr.register(e)}}});i=[this.splitButton]}i=gxp.plugins.FeatureEditor.superclass.addActions.call(this,i);h.on("layerchange",this.onLayerChange,this);var p=this.getSnappingAgent();if(p){p.registerEditor(this)}return i},onItemCheckchange:function(e,t){if(this.splitButton){this.activeIndex=e.ownerCt.items.indexOf(e);this.splitButton.toggle(t);if(t){this.splitButton.setIconClass(e.iconCls)}}},getFeatureManager:function(){var e=this.target.tools[this.featureManager];if(!e){throw new Error("Unable to access feature manager by id: "+this.featureManager)}return e},getSnappingAgent:function(){var e;var t=this.snappingAgent;if(t){e=this.target.tools[t];if(!e){throw new Error("Unable to locate snapping agent with id: "+t)}}return e},setHandler:function(e,t){var i=this.drawControl;var r=i.active;if(r){i.deactivate()}i.handler.destroy();i.handler=new e(i,i.callbacks,Ext.apply(i.handlerOptions,{multi:t}));if(r){i.activate()}},enableOrDisable:function(){var e=!this.schema;if(this.splitButton){this.splitButton.setDisabled(e)}this.createAction.setDisabled(e);this.editAction.setDisabled(e);return e},onLayerChange:function(e,t,i){this.schema=i;var r=this.enableOrDisable();if(r){this.fireEvent("layereditable",this,t,false);return}var h=this.drawControl;var a=this.createAction;var s={Point:OpenLayers.Handler.Point,Line:OpenLayers.Handler.Path,Curve:OpenLayers.Handler.Path,Polygon:OpenLayers.Handler.Polygon,Surface:OpenLayers.Handler.Polygon};var n=e.geometryType&&e.geometryType.replace("Multi","");var o=n&&s[n];if(o){var l=n!=e.geometryType;this.setHandler(o,l);a.enable()}else if(this.supportAbstractGeometry===true&&e.geometryType&&e.geometryType==="Geometry"){a.enable()}else{a.disable()}this.fireEvent("layereditable",this,t,true)},select:function(e){this.selectControl.unselectAll(this.popup&&this.popup.editing&&{except:this.popup.feature});this.selectControl.select(e)}});Ext.preg(gxp.plugins.FeatureEditor.prototype.ptype,gxp.plugins.FeatureEditor);Ext.namespace("GeoExt.grid");GeoExt.grid.FeatureSelectionModelMixin=function(){return{autoActivateControl:true,layerFromStore:true,selectControl:null,bound:false,superclass:null,selectedFeatures:[],autoPanMapOnSelection:false,constructor:function(e){e=e||{};if(e.selectControl instanceof OpenLayers.Control.SelectFeature){if(!e.singleSelect){var t=e.selectControl;e.singleSelect=!(t.multiple||!!t.multipleKey)}}else if(e.layer instanceof OpenLayers.Layer.Vector){this.selectControl=this.createSelectControl(e.layer,e.selectControl);delete e.layer;delete e.selectControl}if(e.autoPanMapOnSelection){this.autoPanMapOnSelection=true;delete e.autoPanMapOnSelection}this.superclass=arguments.callee.superclass;this.superclass.constructor.call(this,e)},initEvents:function(){this.superclass.initEvents.call(this);if(this.layerFromStore){var e=this.grid.getStore()&&this.grid.getStore().layer;if(e&&!(this.selectControl instanceof OpenLayers.Control.SelectFeature)){this.selectControl=this.createSelectControl(e,this.selectControl)}}if(this.selectControl){this.bind(this.selectControl)}},createSelectControl:function(e,t){t=t||{};var i=t.singleSelect!==undefined?t.singleSelect:this.singleSelect;t=OpenLayers.Util.extend({toggle:true,multipleKey:i?null:Ext.isMac?"metaKey":"ctrlKey"},t);var r=new OpenLayers.Control.SelectFeature(e,t);e.map.addControl(r);return r},bind:function(e,t){if(!this.bound){t=t||{};this.selectControl=e;if(e instanceof OpenLayers.Layer.Vector){this.selectControl=this.createSelectControl(e,t.controlConfig)}if(this.autoActivateControl){this.selectControl.activate()}var i=this.getLayers();for(var r=0,a=i.length;r<a;r++){i[r].events.on({featureselected:this.featureSelected,featureunselected:this.featureUnselected,scope:this})}this.on("rowselect",this.rowSelected,this);this.on("rowdeselect",this.rowDeselected,this);this.bound=true}return this.selectControl},unbind:function(){var e=this.selectControl;if(this.bound){var t=this.getLayers();for(var i=0,r=t.length;i<r;i++){t[i].events.un({featureselected:this.featureSelected,featureunselected:this.featureUnselected,scope:this})}this.un("rowselect",this.rowSelected,this);this.un("rowdeselect",this.rowDeselected,this);if(this.autoActivateControl){e.deactivate()}this.selectControl=null;this.bound=false}return e},featureSelected:function(i){if(!this._selecting){var e=this.grid.store;var t=e.findBy(function(e,t){return e.getFeature()==i.feature});if(t!=-1&&!this.isSelected(t)){this._selecting=true;this.selectRow(t,!this.singleSelect);this._selecting=false;this.grid.getView().focusRow(t)}}},featureUnselected:function(i){if(!this._selecting){var e=this.grid.store;var t=e.findBy(function(e,t){return e.getFeature()==i.feature});if(t!=-1&&this.isSelected(t)){this._selecting=true;this.deselectRow(t);this._selecting=false;this.grid.getView().focusRow(t)}}},rowSelected:function(e,t,i){var r=i.getFeature();if(!this._selecting&&r){var a=this.getLayers();for(var s=0,n=a.length;s<n;s++){if(a[s].selectedFeatures.indexOf(r)==-1){this._selecting=true;this.selectControl.select(r);this._selecting=false;this.selectedFeatures.push(r);break}}if(this.autoPanMapOnSelection){this.recenterToSelectionExtent()}}},rowDeselected:function(e,t,i){var r=i.getFeature();if(!this._selecting&&r){var a=this.getLayers();for(var s=0,n=a.length;s<n;s++){if(a[s].selectedFeatures.indexOf(r)!=-1){this._selecting=true;this.selectControl.unselect(r);this._selecting=false;OpenLayers.Util.removeItem(this.selectedFeatures,r);break}}if(this.autoPanMapOnSelection&&this.selectedFeatures.length>0){this.recenterToSelectionExtent()}}},getLayers:function(){return this.selectControl.layers||[this.selectControl.layer]},recenterToSelectionExtent:function(){var e=this.selectControl.map;var t=this.getSelectionExtent();var i=e.getZoomForExtent(t,false);if(i>e.getZoom()){e.setCenter(t.getCenterLonLat())}else{e.zoomToExtent(t)}},getSelectionExtent:function(){var e=null;var t=this.selectedFeatures;if(t&&t.length>0){var i=null;for(var r=0,a=t.length;r<a;r++){i=t[r].geometry;if(i){if(e===null){e=new OpenLayers.Bounds}e.extend(i.getBounds())}}}return e}}};GeoExt.grid.FeatureSelectionModel=Ext.extend(Ext.grid.RowSelectionModel,new GeoExt.grid.FeatureSelectionModelMixin);Ext.namespace("gxp.grid");gxp.grid.FeatureGrid=Ext.extend(Ext.grid.GridPanel,{map:null,ignoreFields:null,includeFields:null,layer:null,columnsSortable:true,columnMenuDisabled:false,initComponent:function(){this.ignoreFields=["feature","state","fid"].concat(this.ignoreFields);if(this.store){this.cm=this.createColumnModel(this.store);if(this.map){this.layer=new OpenLayers.Layer.Vector(this.id+"_layer");this.map.addLayer(this.layer)}}else{this.store=new Ext.data.Store;this.cm=new Ext.grid.ColumnModel({columns:[]})}if(this.layer){this.sm=this.sm||new GeoExt.grid.FeatureSelectionModel({layerFromStore:false,layer:this.layer});if(this.store instanceof GeoExt.data.FeatureStore){this.store.bind(this.layer)}}if(!this.dateFormat){this.dateFormat=Ext.form.DateField.prototype.format}if(!this.timeFormat){this.timeFormat=Ext.form.TimeField.prototype.format}gxp.grid.FeatureGrid.superclass.initComponent.call(this)},onDestroy:function(){if(this.initialConfig&&this.initialConfig.map&&!this.initialConfig.layer){this.layer.destroy();delete this.layer}gxp.grid.FeatureGrid.superclass.onDestroy.apply(this,arguments)},setStore:function(e,t){if(t){this.schema=t}if(e){if(this.store instanceof GeoExt.data.FeatureStore){this.store.unbind()}if(this.layer){this.layer.destroyFeatures();e.bind(this.layer)}this.reconfigure(e,this.createColumnModel(e))}else{this.reconfigure(new Ext.data.Store,new Ext.grid.ColumnModel({columns:[]}))}},getColumns:function(e){function i(i){return function(e){var t=e;if(typeof e=="string"){t=Date.parseDate(e.replace(/Z$/,""),"c")}return t?t.format(i):e}}var r=[],a=this.customEditors||{},s=this.customRenderers||{},n,o,l,h,p;(this.schema||e.fields).each(function(e){if(this.schema){n=e.get("name");o=e.get("type").split(":").pop();h=null;switch(o){case"date":h=this.dateFormat;break;case"datetime":h=h?h:this.dateFormat+" "+this.timeFormat;l=undefined;p=i(h);break;case"boolean":l="booleancolumn";break;case"string":l="gridcolumn";break;default:l="numbercolumn";break}}else{n=e.name}if(this.ignoreFields.indexOf(n)===-1&&(this.includeFields===null||this.includeFields.indexOf(n)>=0)){var t=this.columnConfig?this.columnConfig[n]:null;r.push(Ext.apply({dataIndex:n,hidden:this.fieldVisibility?!this.fieldVisibility[n]:false,header:this.propertyNames?this.propertyNames[n]||n:n,sortable:this.columnsSortable,menuDisabled:this.columnMenuDisabled,xtype:l,editor:a[n]||{xtype:"textfield"},format:h,renderer:s[n]||(l?undefined:p)},t))}},this);return r},createColumnModel:function(e){var t=this.getColumns(e);return new Ext.grid.ColumnModel(t)}});Ext.reg("gxp_featuregrid",gxp.grid.FeatureGrid);Ext.namespace("gxp.plugins");gxp.plugins.FeatureGrid=Ext.extend(gxp.plugins.ClickableFeatures,{ptype:"gxp_featuregrid",schema:null,showTotalResults:false,alwaysDisplayOnMap:false,displayMode:"all",autoExpand:false,autoCollapse:false,selectOnMap:false,displayFeatureText:gettext("Display on map"),firstPageTip:gettext("First page"),previousPageTip:gettext("Previous page"),zoomPageExtentTip:gettext("Zoom to page extent"),nextPageTip:gettext("Next page"),lastPageTip:gettext("Last page"),totalMsg:"Features {1} to {2} of {0}",displayTotalResults:function(){var e=this.target.tools[this.featureManager];if(this.showTotalResults===true){this.displayItem.setText(e.numberOfFeatures!==null?String.format(this.totalMsg,e.numberOfFeatures,e.pageIndex*e.maxFeatures+Math.min(e.numberOfFeatures,1),Math.min((e.pageIndex+1)*e.maxFeatures,e.numberOfFeatures)):"")}},addOutput:function(e){var a=this.target.tools[this.featureManager];var t=this.target.mapPanel.map,i;this.selectControl=new OpenLayers.Control.SelectFeature(a.featureLayer,this.initialConfig.controlOptions);if(this.selectOnMap){if(this.autoLoadFeature||a.paging&&a.pagingType===gxp.plugins.FeatureManager.QUADTREE_PAGING){this.selectControl.events.on({activate:function(){t.events.register("click",this,this.noFeatureClick)},deactivate:function(){t.events.unregister("click",this,this.noFeatureClick)},scope:this})}t.addControl(this.selectControl);i={selectControl:this.selectControl}}else{i={selectControl:this.selectControl,singleSelect:false,autoActivateControl:false,listeners:{beforerowselect:function(){if(window.event&&window.event.type=="contextmenu"||this.selectControl.active||a.featureStore.getModifiedRecords().length){return false}},scope:this}}}this.displayItem=new Ext.Toolbar.TextItem({});e=Ext.apply({xtype:"gxp_featuregrid",border:false,sm:new GeoExt.grid.FeatureSelectionModel(i),autoScroll:true,columnMenuDisabled:!!a.paging,bbar:(a.paging?[{iconCls:"x-tbar-page-first",ref:"../firstPageButton",tooltip:this.firstPageTip,disabled:true,handler:function(){a.setPage({index:0})}},{iconCls:"x-tbar-page-prev",ref:"../prevPageButton",tooltip:this.previousPageTip,disabled:true,handler:function(){a.previousPage()}},{iconCls:"gxp-icon-zoom-to",ref:"../zoomToPageButton",tooltip:this.zoomPageExtentTip,disabled:true,hidden:a.pagingType!==gxp.plugins.FeatureManager.QUADTREE_PAGING||a.autoZoomPage,handler:function(){var e=a.getPageExtent();if(e!==null){t.zoomToExtent(e)}}},{iconCls:"x-tbar-page-next",ref:"../nextPageButton",tooltip:this.nextPageTip,disabled:true,handler:function(){a.nextPage()}},{iconCls:"x-tbar-page-last",ref:"../lastPageButton",tooltip:this.lastPageTip,disabled:true,handler:function(){a.setPage({index:"last"})}},{xtype:"tbspacer",width:10},this.displayItem]:[]).concat(["->"].concat(!this.alwaysDisplayOnMap?[{text:this.displayFeatureText,enableToggle:true,toggleHandler:function(e,t){this.selectOnMap&&this.selectControl[t?"activate":"deactivate"]();a[t?"showLayer":"hideLayer"](this.id,this.displayMode)},scope:this}]:[])),contextMenu:new Ext.menu.Menu({items:[]})},e||{});var h=gxp.plugins.FeatureGrid.superclass.addOutput.call(this,e);h.on({added:function(e,t){function i(){this.displayTotalResults();this.selectOnMap&&this.selectControl.deactivate();this.autoCollapse&&typeof t.collapse=="function"&&t.collapse()}function r(){this.displayTotalResults();this.selectOnMap&&this.selectControl.activate();this.autoExpand&&typeof t.expand=="function"&&t.expand()}a.on({query:function(e,t){if(t&&t.getCount()){r.call(this)}else{i.call(this)}},layerchange:i,clearfeatures:i,scope:this})},contextmenu:function(e){if(h.contextMenu.items.getCount()>0){var t=h.getView().findRowIndex(e.getTarget());if(t!==false){h.getSelectionModel().selectRow(t);h.contextMenu.showAt(e.getXY());e.stopEvent()}}},scope:this});if(this.alwaysDisplayOnMap||this.selectOnMap===true&&this.displayMode==="selected"){a.showLayer(this.id,this.displayMode)}a.paging&&a.on({beforesetpage:function(){h.zoomToPageButton.disable()},setpage:function(e,t,i,r,a,s){var n=s>0;h.zoomToPageButton.setDisabled(!n);var o=n&&a!==0;h.firstPageButton.setDisabled(!o);h.prevPageButton.setDisabled(!o);var l=n&&a!==s-1;h.lastPageButton.setDisabled(!l);h.nextPageButton.setDisabled(!l)},scope:this});function r(){var e=a.schema,t=["feature","state","fid"];e&&e.each(function(e){e.get("type").indexOf("gml:")==0&&t.push(e.get("name"))});h.ignoreFields=t;h.setStore(a.featureStore,e);if(!a.featureStore){if(a.paging){h.lastPageButton.disable();h.nextPageButton.disable();h.firstPageButton.disable();h.prevPageButton.disable();h.zoomToPageButton.disable()}this.displayTotalResults()}}if(a.featureStore){r.call(this)}a.on("layerchange",r,this);return h}});Ext.preg(gxp.plugins.FeatureGrid.prototype.ptype,gxp.plugins.FeatureGrid);Ext.namespace("gxp.plugins");gxp.plugins.StyleWriter=Ext.extend(Ext.util.Observable,{deletedStyles:null,constructor:function(e){this.initialConfig=e;Ext.apply(this,e);this.deletedStyles=[];gxp.plugins.StyleWriter.superclass.constructor.apply(this,arguments)},init:function(e){this.target=e;e.stylesStore.on({remove:function(e,t,i){var r=t.get("name");t.get("name")===r&&this.deletedStyles.push(r)},scope:this});e.on({beforesaved:this.write,scope:this})},write:function(e,t){e.stylesStore.commitChanges();e.fireEvent("saved",e,e.selectedStyle.get("name"))}});Ext.namespace("gxp.plugins");gxp.plugins.GeoServerStyleWriter=Ext.extend(gxp.plugins.StyleWriter,{baseUrl:"/geoserver/rest",constructor:function(e){this.initialConfig=e;Ext.apply(this,e);gxp.plugins.GeoServerStyleWriter.superclass.constructor.apply(this,arguments)},write:function(r){delete this._failed;r=r||{};var t=[];var i=this.target.stylesStore;i.each(function(e){(e.phantom||i.modified.indexOf(e)!==-1)&&this.writeStyle(e,t)},this);var e=function(){var e=this.target;if(this._failed!==true){this.deleteStyles();var t=this.target.stylesStore.getModifiedRecords();for(var i=t.length-1;i>=0;--i){t[i].phantom=false}e.stylesStore.commitChanges();r.success&&r.success.call(r.scope);e.fireEvent("saved",e,e.selectedStyle.get("name"))}else{e.fireEvent("savefailed",e,e.selectedStyle.get("name"))}};if(t.length>0){gxp.util.dispatch(t,function(){this.assignStyles(r.defaultStyle,e)},this)}else{this.assignStyles(r.defaultStyle,e)}},writeStyle:function(i,e){var r=i.get("userStyle").name;e.push(function(e,t){Ext.Ajax.request({method:i.phantom===true?"POST":"PUT",url:this.baseUrl+"/styles"+(i.phantom===true?"":"/"+r+".xml"),headers:{"Content-Type":"application/vnd.ogc.sld+xml; charset=UTF-8"},xmlData:this.target.createSLD({userStyles:[r]}),failure:function(){this._failed=true;e.call(this)},success:i.phantom===true?function(){Ext.Ajax.request({method:"POST",url:this.baseUrl+"/layers/"+this.target.layerRecord.get("name")+"/styles.json",jsonData:{style:{name:r}},failure:function(){this._failed=true;e.call(this)},success:e,scope:this})}:e,scope:this})})},assignStyles:function(t,e){var i=[];this.target.stylesStore.each(function(e){if(!t&&e.get("userStyle").isDefault===true){t=e.get("name")}if(e.get("name")!==t&&this.deletedStyles.indexOf(e.id)===-1){i.push({name:e.get("name")})}},this);Ext.Ajax.request({method:"PUT",url:this.baseUrl+"/layers/"+this.target.layerRecord.get("name")+".json",jsonData:{layer:{defaultStyle:{name:t},styles:i.length>0?{style:i}:{},enabled:true}},success:e,failure:function(){this._failed=true;e.call(this)},scope:this})},deleteStyles:function(){for(var e=0,t=this.deletedStyles.length;e<t;++e){Ext.Ajax.request({method:"DELETE",url:this.baseUrl+"/styles/"+this.deletedStyles[e]+"?purge=true"})}this.deletedStyles=[]}});Ext.preg("gxp_geoserverstylewriter",gxp.plugins.GeoServerStyleWriter);Ext.namespace("gxp.plugins");gxp.plugins.LayerSource=Ext.extend(Ext.util.Observable,{store:null,lazy:false,hidden:false,title:gettext(""),constructor:function(e){this.initialConfig=e;Ext.apply(this,e);this.addEvents("ready","failure");gxp.plugins.LayerSource.superclass.constructor.apply(this,arguments)},init:function(e){this.target=e;this.createStore()},getMapProjection:function(){var e=this.target.mapPanel.map.projection;return this.target.mapPanel.map.getProjectionObject()||e&&new OpenLayers.Projection(e)||new OpenLayers.Projection("EPSG:4326")},getProjection:function(e){var t=e.getLayer();var i=this.getMapProjection();var r=t.projection?t.projection instanceof OpenLayers.Projection?t.projection:new OpenLayers.Projection(t.projection):i;return r.equals(i)?i:null},createStore:function(){this.fireEvent("ready",this)},createLayerRecord:function(e){},getConfigForRecord:function(e){var t=e.getLayer();return{source:e.get("source"),name:e.get("name"),title:e.get("title"),visibility:t.getVisibility(),opacity:t.opacity||undefined,group:e.get("group"),fixed:e.get("fixed"),selected:e.get("selected")}},getState:function(){return Ext.apply({},this.initialConfig)}});OpenLayers.Layer.XYZ=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:true,sphericalMercator:false,zoomOffset:0,serverResolutions:null,initialize:function(e,t,i){if(i&&i.sphericalMercator||this.sphericalMercator){i=OpenLayers.Util.extend({projection:"EPSG:900913",numZoomLevels:19},i)}OpenLayers.Layer.Grid.prototype.initialize.apply(this,[e||this.name,t||this.url,{},i])},clone:function(e){if(e==null){e=new OpenLayers.Layer.XYZ(this.name,this.url,this.getOptions())}e=OpenLayers.Layer.Grid.prototype.clone.apply(this,[e]);return e},getURL:function(e){var t=this.getXYZ(e);var i=this.url;if(OpenLayers.Util.isArray(i)){var r=""+t.x+t.y+t.z;i=this.selectUrl(r,i)}return OpenLayers.String.format(i,t)},getXYZ:function(e){var t=this.getServerResolution();var i=Math.round((e.left-this.maxExtent.left)/(t*this.tileSize.w));var r=Math.round((this.maxExtent.top-e.top)/(t*this.tileSize.h));var a=this.getServerZoom();if(this.wrapDateLine){var s=Math.pow(2,a);i=(i%s+s)%s}return{x:i,y:r,z:a}},setMap:function(e){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments);if(!this.tileOrigin){this.tileOrigin=new OpenLayers.LonLat(this.maxExtent.left,this.maxExtent.bottom)}},CLASS_NAME:"OpenLayers.Layer.XYZ"});OpenLayers.Layer.Bing=OpenLayers.Class(OpenLayers.Layer.XYZ,{key:null,serverResolutions:[156543.03390625,78271.516953125,39135.7584765625,19567.87923828125,9783.939619140625,4891.9698095703125,2445.9849047851562,1222.9924523925781,611.4962261962891,305.74811309814453,152.87405654907226,76.43702827453613,38.218514137268066,19.109257068634033,9.554628534317017,4.777314267158508,2.388657133579254,1.194328566789627,.5971642833948135,.29858214169740677,.14929107084870338,.07464553542435169],attributionTemplate:'<span class="olBingAttribution ${type}">'+'<div><a target="_blank" href="http://www.bing.com/maps/">'+'<img src="${logo}" /></a></div>${copyrights}'+'<a style="white-space: nowrap" target="_blank" '+'href="http://www.microsoft.com/maps/product/terms.html">'+"Terms of Use</a></span>",metadata:null,protocolRegex:/^http:/i,type:"Road",culture:"en-US",metadataParams:null,tileOptions:null,protocol:~window.location.href.indexOf("http")?"":"http:",initialize:function(e){e=OpenLayers.Util.applyDefaults({sphericalMercator:true},e);var t=e.name||"Bing "+(e.type||this.type);var i=[t,null,e];OpenLayers.Layer.XYZ.prototype.initialize.apply(this,i);this.tileOptions=OpenLayers.Util.extend({crossOriginKeyword:"anonymous"},this.options.tileOptions);this.loadMetadata()},loadMetadata:function(){this._callbackId="_callback_"+this.id.replace(/\./g,"_");window[this._callbackId]=OpenLayers.Function.bind(OpenLayers.Layer.Bing.processMetadata,this);var e=OpenLayers.Util.applyDefaults({key:this.key,jsonp:this._callbackId,include:"ImageryProviders"},this.metadataParams);var t=this.protocol+"//dev.virtualearth.net/REST/v1/Imagery/Metadata/"+this.type+"?"+OpenLayers.Util.getParameterString(e);var i=document.createElement("script");i.type="text/javascript";i.src=t;i.id=this._callbackId;document.getElementsByTagName("head")[0].appendChild(i)},initLayer:function(){var e=this.metadata.resourceSets[0].resources[0];var t=e.imageUrl.replace("{quadkey}","${quadkey}");t=t.replace("{culture}",this.culture);t=t.replace(this.protocolRegex,this.protocol);this.url=[];for(var i=0;i<e.imageUrlSubdomains.length;++i){this.url.push(t.replace("{subdomain}",e.imageUrlSubdomains[i]))}this.addOptions({maxResolution:Math.min(this.serverResolutions[e.zoomMin],this.maxResolution||Number.POSITIVE_INFINITY),numZoomLevels:Math.min(e.zoomMax+1-e.zoomMin,this.numZoomLevels)},true);if(!this.isBaseLayer){this.redraw()}this.updateAttribution()},getURL:function(e){if(!this.url){return}var t=this.getXYZ(e),i=t.x,r=t.y,a=t.z;var s=[];for(var n=a;n>0;--n){var o="0";var l=1<<n-1;if((i&l)!=0){o++}if((r&l)!=0){o++;o++}s.push(o)}var h=s.join("");var p=this.selectUrl(""+i+r+a,this.url);return OpenLayers.String.format(p,{quadkey:h})},updateAttribution:function(){var e=this.metadata;if(!e.resourceSets||!this.map||!this.map.center){return}var p=e.resourceSets[0].resources[0];var u=this.map.getExtent().transform(this.map.getProjectionObject(),new OpenLayers.Projection("EPSG:4326"));var t=p.imageryProviders||[],i=OpenLayers.Util.indexOf(this.serverResolutions,this.getServerResolution()),r="",a,s,n,o,l,c,h;for(s=0,n=t.length;s<n;++s){a=t[s];for(o=0,l=a.coverageAreas.length;o<l;++o){h=a.coverageAreas[o];c=OpenLayers.Bounds.fromArray(h.bbox,true);if(u.intersectsBounds(c)&&i<=h.zoomMax&&i>=h.zoomMin){r+=a.attribution+" "}}}var d=e.brandLogoUri.replace(this.protocolRegex,this.protocol);this.attribution=OpenLayers.String.format(this.attributionTemplate,{type:this.type.toLowerCase(),logo:d,copyrights:r});this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"attribution"})},setMap:function(){OpenLayers.Layer.XYZ.prototype.setMap.apply(this,arguments);this.map.events.register("moveend",this,this.updateAttribution)},clone:function(e){if(e==null){e=new OpenLayers.Layer.Bing(this.options)}e=OpenLayers.Layer.XYZ.prototype.clone.apply(this,[e]);return e},destroy:function(){this.map&&this.map.events.unregister("moveend",this,this.updateAttribution);OpenLayers.Layer.XYZ.prototype.destroy.apply(this,arguments)},CLASS_NAME:"OpenLayers.Layer.Bing"});OpenLayers.Layer.Bing.processMetadata=function(e){this.metadata=e;this.initLayer();var t=document.getElementById(this._callbackId);t.parentNode.removeChild(t);window[this._callbackId]=undefined;delete this._callbackId};Ext.namespace("gxp.plugins");gxp.plugins.BingSource=Ext.extend(gxp.plugins.LayerSource,{ptype:"gxp_bingsource",title:gettext("Bing Layers"),roadTitle:gettext("Bing Roads"),aerialTitle:gettext("Bing Aerial"),labeledAerialTitle:gettext("Bing Aerial With Labels"),apiKey:"AqTGBsziZHIJYYxgivLBf0hVdrAk9mWO5cQcb8Yux8sW5M8c8opEC2lZqKR1ZZXf",createStore:function(){var e=[new OpenLayers.Layer.Bing({key:this.apiKey,name:this.roadTitle,type:"Road",buffer:1,transitionEffect:"resize"}),new OpenLayers.Layer.Bing({key:this.apiKey,name:this.aerialTitle,type:"Aerial",buffer:1,transitionEffect:"resize"}),new OpenLayers.Layer.Bing({key:this.apiKey,name:this.labeledAerialTitle,type:"AerialWithLabels",buffer:1,transitionEffect:"resize"})];this.store=new GeoExt.data.LayerStore({layers:e,fields:[{name:"source",type:"string"},{name:"name",type:"string",mapping:"type"},{name:"abstract",type:"string",mapping:"attribution"},{name:"group",type:"string",defaultValue:"background"},{name:"fixed",type:"boolean",defaultValue:true},{name:"selected",type:"boolean"}]});this.store.each(function(e){e.set("group","background")});this.fireEvent("ready",this)},createLayerRecord:function(e){var t;var i=this.store.findExact("name",e.name);if(i>-1){t=this.store.getAt(i).copy(Ext.data.Record.id({}));var r=t.getLayer().clone();if(e.title){r.setName(e.title);t.set("title",e.title)}if("visibility"in e){r.visibility=e.visibility}t.set("selected",e.selected||false);t.set("source",e.source);t.set("name",e.name);if("group"in e){t.set("group",e.group)}t.data.layer=r;t.commit()}return t}});Ext.preg(gxp.plugins.BingSource.prototype.ptype,gxp.plugins.BingSource);OpenLayers.Layer.SphericalMercator={getExtent:function(){var e=null;if(this.sphericalMercator){e=this.map.calculateBounds()}else{e=OpenLayers.Layer.FixedZoomLevels.prototype.getExtent.apply(this)}return e},getLonLatFromViewPortPx:function(e){return OpenLayers.Layer.prototype.getLonLatFromViewPortPx.apply(this,arguments)},getViewPortPxFromLonLat:function(e){return OpenLayers.Layer.prototype.getViewPortPxFromLonLat.apply(this,arguments)},initMercatorParameters:function(){this.RESOLUTIONS=[];var e=156543.03390625;for(var t=0;t<=this.MAX_ZOOM_LEVEL;++t){this.RESOLUTIONS[t]=e/Math.pow(2,t)}this.units="m";this.projection=this.projection||"EPSG:900913"},forwardMercator:function(){var r=new OpenLayers.Projection("EPSG:4326");var a=new OpenLayers.Projection("EPSG:900913");return function(e,t){var i=OpenLayers.Projection.transform({x:e,y:t},r,a);return new OpenLayers.LonLat(i.x,i.y)}}(),inverseMercator:function(){var r=new OpenLayers.Projection("EPSG:4326");var a=new OpenLayers.Projection("EPSG:900913");return function(e,t){var i=OpenLayers.Projection.transform({x:e,y:t},a,r);return new OpenLayers.LonLat(i.x,i.y)}}()};OpenLayers.Layer.EventPane=OpenLayers.Class(OpenLayers.Layer,{smoothDragPan:true,isBaseLayer:true,isFixed:true,pane:null,mapObject:null,initialize:function(e,t){OpenLayers.Layer.prototype.initialize.apply(this,arguments);if(this.pane==null){this.pane=OpenLayers.Util.createDiv(this.div.id+"_EventPane")}},destroy:function(){this.mapObject=null;this.pane=null;OpenLayers.Layer.prototype.destroy.apply(this,arguments)},setMap:function(e){OpenLayers.Layer.prototype.setMap.apply(this,arguments);this.pane.style.zIndex=parseInt(this.div.style.zIndex)+1;this.pane.style.display=this.div.style.display;this.pane.style.width="100%";this.pane.style.height="100%";if(OpenLayers.BROWSER_NAME=="msie"){this.pane.style.background="url("+OpenLayers.Util.getImageLocation("blank.gif")+")"}if(this.isFixed){this.map.viewPortDiv.appendChild(this.pane)}else{this.map.layerContainerDiv.appendChild(this.pane)}this.loadMapObject();if(this.mapObject==null){this.loadWarningMessage()}},removeMap:function(e){if(this.pane&&this.pane.parentNode){this.pane.parentNode.removeChild(this.pane)}OpenLayers.Layer.prototype.removeMap.apply(this,arguments)},loadWarningMessage:function(){this.div.style.backgroundColor="darkblue";var e=this.map.getSize();var t=Math.min(e.w,300);var i=Math.min(e.h,200);var r=new OpenLayers.Size(t,i);var a=new OpenLayers.Pixel(e.w/2,e.h/2);var s=a.add(-r.w/2,-r.h/2);var n=OpenLayers.Util.createDiv(this.name+"_warning",s,r,null,null,null,"auto");n.style.padding="7px";n.style.backgroundColor="yellow";n.innerHTML=this.getWarningHTML();this.div.appendChild(n)},getWarningHTML:function(){return""},display:function(e){OpenLayers.Layer.prototype.display.apply(this,arguments);this.pane.style.display=this.div.style.display},setZIndex:function(e){OpenLayers.Layer.prototype.setZIndex.apply(this,arguments);this.pane.style.zIndex=parseInt(this.div.style.zIndex)+1},moveByPx:function(e,t){OpenLayers.Layer.prototype.moveByPx.apply(this,arguments);if(this.dragPanMapObject){this.dragPanMapObject(e,-t)}else{this.moveTo(this.map.getCachedCenter())}},moveTo:function(h,e,t){OpenLayers.Layer.prototype.moveTo.apply(this,arguments);if(this.mapObject!=null){var i=this.map.getCenter();var r=this.map.getZoom();if(i!=null){var a=this.getMapObjectCenter();var s=this.getOLLonLatFromMapObjectLonLat(a);var n=this.getMapObjectZoom();var p=this.getOLZoomFromMapObjectZoom(n);if(!i.equals(s)||r!=p){if(!e&&s&&this.dragPanMapObject&&this.smoothDragPan){var o=this.map.getViewPortPxFromLonLat(s);var l=this.map.getViewPortPxFromLonLat(i);this.dragPanMapObject(l.x-o.x,o.y-l.y)}else{var u=this.getMapObjectLonLatFromOLLonLat(i);var c=this.getMapObjectZoomFromOLZoom(r);this.setMapObjectCenter(u,c,t)}}}}},getLonLatFromViewPortPx:function(e){var t=null;if(this.mapObject!=null&&this.getMapObjectCenter()!=null){var i=this.getMapObjectPixelFromOLPixel(e);var r=this.getMapObjectLonLatFromMapObjectPixel(i);t=this.getOLLonLatFromMapObjectLonLat(r)}return t},getViewPortPxFromLonLat:function(e){var t=null;if(this.mapObject!=null&&this.getMapObjectCenter()!=null){var i=this.getMapObjectLonLatFromOLLonLat(e);var r=this.getMapObjectPixelFromMapObjectLonLat(i);t=this.getOLPixelFromMapObjectPixel(r)}return t},getOLLonLatFromMapObjectLonLat:function(e){var t=null;if(e!=null){var i=this.getLongitudeFromMapObjectLonLat(e);var r=this.getLatitudeFromMapObjectLonLat(e);t=new OpenLayers.LonLat(i,r)}return t},getMapObjectLonLatFromOLLonLat:function(e){var t=null;if(e!=null){t=this.getMapObjectLonLatFromLonLat(e.lon,e.lat)}return t},getOLPixelFromMapObjectPixel:function(e){var t=null;if(e!=null){var i=this.getXFromMapObjectPixel(e);var r=this.getYFromMapObjectPixel(e);t=new OpenLayers.Pixel(i,r)}return t},getMapObjectPixelFromOLPixel:function(e){var t=null;if(e!=null){t=this.getMapObjectPixelFromXY(e.x,e.y)}return t},CLASS_NAME:"OpenLayers.Layer.EventPane"});OpenLayers.Layer.FixedZoomLevels=OpenLayers.Class({initialize:function(){},initResolutions:function(){var e=["minZoomLevel","maxZoomLevel","numZoomLevels"];for(var t=0,i=e.length;t<i;t++){var r=e[t];this[r]=this.options[r]!=null?this.options[r]:this.map[r]}if(this.minZoomLevel==null||this.minZoomLevel<this.MIN_ZOOM_LEVEL){this.minZoomLevel=this.MIN_ZOOM_LEVEL}var a;var s=this.MAX_ZOOM_LEVEL-this.minZoomLevel+1;if(this.options.numZoomLevels==null&&this.options.maxZoomLevel!=null||this.numZoomLevels==null&&this.maxZoomLevel!=null){a=this.maxZoomLevel-this.minZoomLevel+1}else{a=this.numZoomLevels}if(a!=null){this.numZoomLevels=Math.min(a,s)}else{this.numZoomLevels=s}this.maxZoomLevel=this.minZoomLevel+this.numZoomLevels-1;if(this.RESOLUTIONS!=null){var n=0;this.resolutions=[];for(var t=this.minZoomLevel;t<=this.maxZoomLevel;t++){this.resolutions[n++]=this.RESOLUTIONS[t]}this.maxResolution=this.resolutions[0];this.minResolution=this.resolutions[this.resolutions.length-1]}},getResolution:function(){if(this.resolutions!=null){return OpenLayers.Layer.prototype.getResolution.apply(this,arguments)}else{var e=null;var t=this.map.getSize();var i=this.getExtent();if(t!=null&&i!=null){e=Math.max(i.getWidth()/t.w,i.getHeight()/t.h)}return e}},getExtent:function(){var e=this.map.getSize();var t=this.getLonLatFromViewPortPx({x:0,y:0});var i=this.getLonLatFromViewPortPx({x:e.w,y:e.h});if(t!=null&&i!=null){return new OpenLayers.Bounds(t.lon,i.lat,i.lon,t.lat)}else{return null}},getZoomForResolution:function(e){if(this.resolutions!=null){return OpenLayers.Layer.prototype.getZoomForResolution.apply(this,arguments)}else{var t=OpenLayers.Layer.prototype.getExtent.apply(this,[]);return this.getZoomForExtent(t)}},getOLZoomFromMapObjectZoom:function(e){var t=null;if(e!=null){t=e-this.minZoomLevel;if(this.map.baseLayer!==this){t=this.map.baseLayer.getZoomForResolution(this.getResolutionForZoom(t))}}return t},getMapObjectZoomFromOLZoom:function(e){var t=null;if(e!=null){t=e+this.minZoomLevel;if(this.map.baseLayer!==this){t=this.getZoomForResolution(this.map.baseLayer.getResolutionForZoom(t))}}return t},CLASS_NAME:"OpenLayers.Layer.FixedZoomLevels"});OpenLayers.Layer.Google=OpenLayers.Class(OpenLayers.Layer.EventPane,OpenLayers.Layer.FixedZoomLevels,{MIN_ZOOM_LEVEL:0,MAX_ZOOM_LEVEL:21,RESOLUTIONS:[1.40625,.703125,.3515625,.17578125,.087890625,.0439453125,.02197265625,.010986328125,.0054931640625,.00274658203125,.001373291015625,.0006866455078125,.00034332275390625,.000171661376953125,858306884765625e-19,4291534423828125e-20,2145767211914062e-20,1072883605957031e-20,536441802978515e-20,268220901489257e-20,1341104507446289e-21,6.705522537231445e-7],type:null,wrapDateLine:true,sphericalMercator:false,version:null,initialize:function(e,t){t=t||{};if(!t.version){t.version=typeof GMap2==="function"?"2":"3"}var i=OpenLayers.Layer.Google["v"+t.version.replace(/\./g,"_")];if(i){OpenLayers.Util.applyDefaults(t,i)}else{throw"Unsupported Google Maps API version: "+t.version}OpenLayers.Util.applyDefaults(t,i.DEFAULTS);if(t.maxExtent){t.maxExtent=t.maxExtent.clone()}OpenLayers.Layer.EventPane.prototype.initialize.apply(this,[e,t]);OpenLayers.Layer.FixedZoomLevels.prototype.initialize.apply(this,[e,t]);if(this.sphericalMercator){OpenLayers.Util.extend(this,OpenLayers.Layer.SphericalMercator);this.initMercatorParameters()}},clone:function(){return new OpenLayers.Layer.Google(this.name,this.getOptions())},setVisibility:function(e){var t=this.opacity==null?1:this.opacity;OpenLayers.Layer.EventPane.prototype.setVisibility.apply(this,arguments);this.setOpacity(t)},display:function(e){if(!this._dragging){this.setGMapVisibility(e)}OpenLayers.Layer.EventPane.prototype.display.apply(this,arguments)},moveTo:function(e,t,i){this._dragging=i;OpenLayers.Layer.EventPane.prototype.moveTo.apply(this,arguments);delete this._dragging},setOpacity:function(e){if(e!==this.opacity){if(this.map!=null){this.map.events.triggerEvent("changelayer",{layer:this,property:"opacity"})}this.opacity=e}if(this.getVisibility()){var t=this.getMapContainer();OpenLayers.Util.modifyDOMElement(t,null,null,null,null,null,null,e)}},destroy:function(){if(this.map){this.setGMapVisibility(false);var e=OpenLayers.Layer.Google.cache[this.map.id];if(e&&e.count<=1){this.removeGMapElements()}}OpenLayers.Layer.EventPane.prototype.destroy.apply(this,arguments)},removeGMapElements:function(){var e=OpenLayers.Layer.Google.cache[this.map.id];if(e){var t=this.mapObject&&this.getMapContainer();if(t&&t.parentNode){t.parentNode.removeChild(t)}var i=e.termsOfUse;if(i&&i.parentNode){i.parentNode.removeChild(i)}var r=e.poweredBy;if(r&&r.parentNode){r.parentNode.removeChild(r)}if(this.mapObject&&window.google&&google.maps&&google.maps.event&&google.maps.event.clearListeners){google.maps.event.clearListeners(this.mapObject,"tilesloaded")}}},removeMap:function(e){if(this.visibility&&this.mapObject){this.setGMapVisibility(false)}var t=OpenLayers.Layer.Google.cache[e.id];if(t){if(t.count<=1){this.removeGMapElements();delete OpenLayers.Layer.Google.cache[e.id]}else{--t.count}}delete this.termsOfUse;delete this.poweredBy;delete this.mapObject;delete this.dragObject;OpenLayers.Layer.EventPane.prototype.removeMap.apply(this,arguments)},getOLBoundsFromMapObjectBounds:function(e){var t=null;if(e!=null){var i=e.getSouthWest();var r=e.getNorthEast();if(this.sphericalMercator){i=this.forwardMercator(i.lng(),i.lat());r=this.forwardMercator(r.lng(),r.lat())}else{i=new OpenLayers.LonLat(i.lng(),i.lat());r=new OpenLayers.LonLat(r.lng(),r.lat())}t=new OpenLayers.Bounds(i.lon,i.lat,r.lon,r.lat)}return t},getWarningHTML:function(){return OpenLayers.i18n("googleWarning")},getMapObjectCenter:function(){return this.mapObject.getCenter()},getMapObjectZoom:function(){return this.mapObject.getZoom()},getLongitudeFromMapObjectLonLat:function(e){return this.sphericalMercator?this.forwardMercator(e.lng(),e.lat()).lon:e.lng()},getLatitudeFromMapObjectLonLat:function(e){var t=this.sphericalMercator?this.forwardMercator(e.lng(),e.lat()).lat:e.lat();return t},getXFromMapObjectPixel:function(e){return e.x},getYFromMapObjectPixel:function(e){return e.y},CLASS_NAME:"OpenLayers.Layer.Google"});OpenLayers.Layer.Google.cache={};OpenLayers.Layer.Google.v2={termsOfUse:null,poweredBy:null,dragObject:null,loadMapObject:function(){if(!this.type){this.type=G_NORMAL_MAP}var e,t,i;var r=OpenLayers.Layer.Google.cache[this.map.id];if(r){e=r.mapObject;t=r.termsOfUse;i=r.poweredBy;++r.count}else{var a=this.map.viewPortDiv;var s=document.createElement("div");s.id=this.map.id+"_GMap2Container";s.style.position="absolute";s.style.width="100%";s.style.height="100%";a.appendChild(s);try{e=new GMap2(s);t=s.lastChild;a.appendChild(t);t.style.zIndex="1100";t.style.right="";t.style.bottom="";t.className="olLayerGoogleCopyright";i=s.lastChild;a.appendChild(i);i.style.zIndex="1100";i.style.right="";i.style.bottom="";i.className="olLayerGooglePoweredBy gmnoprint"}catch(e){throw e}OpenLayers.Layer.Google.cache[this.map.id]={mapObject:e,termsOfUse:t,poweredBy:i,count:1}}this.mapObject=e;this.termsOfUse=t;this.poweredBy=i;if(OpenLayers.Util.indexOf(this.mapObject.getMapTypes(),this.type)===-1){this.mapObject.addMapType(this.type)}if(typeof e.getDragObject=="function"){this.dragObject=e.getDragObject()}else{this.dragPanMapObject=null}if(this.isBaseLayer===false){this.setGMapVisibility(this.div.style.display!=="none")}},onMapResize:function(){if(this.visibility&&this.mapObject.isLoaded()){this.mapObject.checkResize()}else{if(!this._resized){var e=this;var t=GEvent.addListener(this.mapObject,"load",function(){GEvent.removeListener(t);delete e._resized;e.mapObject.checkResize();e.moveTo(e.map.getCenter(),e.map.getZoom())})}this._resized=true}},setGMapVisibility:function(e){var t=OpenLayers.Layer.Google.cache[this.map.id];if(t){var i=this.mapObject.getContainer();if(e===true){this.mapObject.setMapType(this.type);i.style.display="";this.termsOfUse.style.left="";this.termsOfUse.style.display="";this.poweredBy.style.display="";t.displayed=this.id}else{if(t.displayed===this.id){delete t.displayed}if(!t.displayed){i.style.display="none";this.termsOfUse.style.display="none";this.termsOfUse.style.left="-9999px";this.poweredBy.style.display="none"}}}},getMapContainer:function(){return this.mapObject.getContainer()},getMapObjectBoundsFromOLBounds:function(e){var t=null;if(e!=null){var i=this.sphericalMercator?this.inverseMercator(e.bottom,e.left):new OpenLayers.LonLat(e.bottom,e.left);var r=this.sphericalMercator?this.inverseMercator(e.top,e.right):new OpenLayers.LonLat(e.top,e.right);t=new GLatLngBounds(new GLatLng(i.lat,i.lon),new GLatLng(r.lat,r.lon))}return t},setMapObjectCenter:function(e,t){this.mapObject.setCenter(e,t)},dragPanMapObject:function(e,t){this.dragObject.moveBy(new GSize(-e,t))},getMapObjectLonLatFromMapObjectPixel:function(e){return this.mapObject.fromContainerPixelToLatLng(e)},getMapObjectPixelFromMapObjectLonLat:function(e){return this.mapObject.fromLatLngToContainerPixel(e)},getMapObjectZoomFromMapObjectBounds:function(e){return this.mapObject.getBoundsZoomLevel(e)},getMapObjectLonLatFromLonLat:function(e,t){var i;if(this.sphericalMercator){var r=this.inverseMercator(e,t);i=new GLatLng(r.lat,r.lon)}else{i=new GLatLng(t,e)}return i},getMapObjectPixelFromXY:function(e,t){return new GPoint(e,t)}};OpenLayers.Layer.Google.v3={DEFAULTS:{sphericalMercator:true,projection:"EPSG:900913"},animationEnabled:true,loadMapObject:function(){if(!this.type){this.type=google.maps.MapTypeId.ROADMAP}var e;var t=OpenLayers.Layer.Google.cache[this.map.id];if(t){e=t.mapObject;++t.count}else{var i=this.map.getCenter();var r=document.createElement("div");r.className="olForeignContainer";r.style.width="100%";r.style.height="100%";e=new google.maps.Map(r,{center:i?new google.maps.LatLng(i.lat,i.lon):new google.maps.LatLng(0,0),zoom:this.map.getZoom()||0,mapTypeId:this.type,disableDefaultUI:true,keyboardShortcuts:false,draggable:false,disableDoubleClickZoom:true,scrollwheel:false,streetViewControl:false});var a=document.createElement("div");a.style.width="100%";a.style.height="100%";e.controls[google.maps.ControlPosition.TOP_LEFT].push(a);t={googleControl:a,mapObject:e,count:1};OpenLayers.Layer.Google.cache[this.map.id]=t}this.mapObject=e;this.setGMapVisibility(this.visibility)},onMapResize:function(){if(this.visibility){google.maps.event.trigger(this.mapObject,"resize")}},setGMapVisibility:function(e){var t=OpenLayers.Layer.Google.cache[this.map.id];var i=this.map;if(t){var r=this.type;var a=i.layers;var s;for(var n=a.length-1;n>=0;--n){s=a[n];if(s instanceof OpenLayers.Layer.Google&&s.visibility===true&&s.inRange===true){r=s.type;e=true;break}}var o=this.mapObject.getDiv();if(e===true){if(o.parentNode!==i.div){if(!t.rendered){var l=this;google.maps.event.addListenerOnce(this.mapObject,"tilesloaded",function(){t.rendered=true;l.setGMapVisibility(l.getVisibility());l.moveTo(l.map.getCenter())})}else{i.div.appendChild(o);t.googleControl.appendChild(i.viewPortDiv);google.maps.event.trigger(this.mapObject,"resize")}}this.mapObject.setMapTypeId(r)}else if(t.googleControl.hasChildNodes()){i.div.appendChild(i.viewPortDiv);i.div.removeChild(o)}}},getMapContainer:function(){return this.mapObject.getDiv()},getMapObjectBoundsFromOLBounds:function(e){var t=null;if(e!=null){var i=this.sphericalMercator?this.inverseMercator(e.bottom,e.left):new OpenLayers.LonLat(e.bottom,e.left);var r=this.sphericalMercator?this.inverseMercator(e.top,e.right):new OpenLayers.LonLat(e.top,e.right);t=new google.maps.LatLngBounds(new google.maps.LatLng(i.lat,i.lon),new google.maps.LatLng(r.lat,r.lon))}return t},getMapObjectLonLatFromMapObjectPixel:function(e){var t=this.map.getSize();var i=this.getLongitudeFromMapObjectLonLat(this.mapObject.center);var r=this.getLatitudeFromMapObjectLonLat(this.mapObject.center);var a=this.map.getResolution();var s=e.x-t.w/2;var n=e.y-t.h/2;var o=new OpenLayers.LonLat(i+s*a,r-n*a);if(this.wrapDateLine){o=o.wrapDateLine(this.maxExtent)}return this.getMapObjectLonLatFromLonLat(o.lon,o.lat)},getMapObjectPixelFromMapObjectLonLat:function(e){var t=this.getLongitudeFromMapObjectLonLat(e);var i=this.getLatitudeFromMapObjectLonLat(e);var r=this.map.getResolution();var a=this.map.getExtent();return this.getMapObjectPixelFromXY(1/r*(t-a.left),1/r*(a.top-i))},setMapObjectCenter:function(e,t){if(this.animationEnabled===false&&t!=this.mapObject.zoom){var i=this.getMapContainer();google.maps.event.addListenerOnce(this.mapObject,"idle",function(){i.style.visibility=""});i.style.visibility="hidden"}this.mapObject.setOptions({center:e,zoom:t})},getMapObjectZoomFromMapObjectBounds:function(e){return this.mapObject.getBoundsZoomLevel(e)},getMapObjectLonLatFromLonLat:function(e,t){var i;if(this.sphericalMercator){var r=this.inverseMercator(e,t);i=new google.maps.LatLng(r.lat,r.lon)}else{i=new google.maps.LatLng(t,e)}return i},getMapObjectPixelFromXY:function(e,t){return new google.maps.Point(e,t)}};Ext.namespace("gxp.plugins");gxp.plugins.GoogleSource=Ext.extend(gxp.plugins.LayerSource,{ptype:"gxp_googlesource",timeout:7e3,title:gettext("Google Layers"),roadmapAbstract:"Show street map",satelliteAbstract:"Show satellite imagery",hybridAbstract:"Show imagery with street names",terrainAbstract:"Show street map with terrain",otherParams:"sensor=false",constructor:function(e){this.config=e;gxp.plugins.GoogleSource.superclass.constructor.apply(this,arguments)},createStore:function(){gxp.plugins.GoogleSource.loader.onLoad({otherParams:this.otherParams,timeout:this.timeout,callback:this.syncCreateStore,errback:function(){delete this.store;this.fireEvent("failure",this,"The Google Maps script failed to load within the provided timeout ("+this.timeout/1e3+" s).")},scope:this})},syncCreateStore:function(){var t={ROADMAP:{abstract:this.roadmapAbstract,MAX_ZOOM_LEVEL:20},SATELLITE:{abstract:this.satelliteAbstract},HYBRID:{abstract:this.hybridAbstract},TERRAIN:{abstract:this.terrainAbstract,MAX_ZOOM_LEVEL:15}};var e=[];var i,r;for(i in t){r=google.maps.MapTypeId[i];e.push(new OpenLayers.Layer.Google("Google "+r.replace(/\w/,function(e){return e.toUpperCase()}),{type:r,typeName:i,MAX_ZOOM_LEVEL:t[i].MAX_ZOOM_LEVEL,maxExtent:new OpenLayers.Bounds(-20037508.34,-20037508.34,20037508.34,20037508.34),restrictedExtent:new OpenLayers.Bounds(-20037508.34,-20037508.34,20037508.34,20037508.34),projection:this.projection}))}this.store=new GeoExt.data.LayerStore({layers:e,fields:[{name:"source",type:"string"},{name:"name",type:"string",mapping:"typeName"},{name:"abstract",type:"string"},{name:"group",type:"string",defaultValue:"background"},{name:"fixed",type:"boolean",defaultValue:true},{name:"selected",type:"boolean"}]});this.store.each(function(e){e.set("abstract",t[e.get("name")]["abstract"])});this.fireEvent("ready",this)},createLayerRecord:function(t){var e;var i=function(e){return e.get("name")===t.name};if(this.target.mapPanel.layers.findBy(i)==-1){e=this.store.getAt(this.store.findBy(i)).clone();var r=e.getLayer();if(t.title){r.setName(t.title);e.set("title",t.title)}if("visibility"in t){r.visibility=t.visibility}e.set("selected",t.selected||false);e.set("source",t.source);e.set("name",t.name);if("group"in t){e.set("group",t.group)}e.commit()}return e}});gxp.plugins.GoogleSource.loader=new(Ext.extend(Ext.util.Observable,{ready:!!(window.google&&google.maps),loading:false,constructor:function(){this.addEvents("ready","failure");return Ext.util.Observable.prototype.constructor.apply(this,arguments)},onScriptLoad:function(){var e=gxp.plugins.GoogleSource.loader;if(!e.ready){e.ready=true;e.loading=false;e.fireEvent("ready")}},onLoad:function(e){if(this.ready){window.setTimeout(function(){e.callback.call(e.scope)},0)}else if(!this.loading){this.loadScript(e)}else{this.on({ready:e.callback,failure:e.errback||Ext.emptyFn,scope:e.scope})}},loadScript:function(e){var t={autoload:Ext.encode({modules:[{name:"maps",version:3.3,nocss:"true",callback:"gxp.plugins.GoogleSource.loader.onScriptLoad",other_params:e.otherParams}]})};var i=document.createElement("script");i.src="http://www.google.com/jsapi?"+Ext.urlEncode(t);var r=e.errback||Ext.emptyFn;var a=e.timeout||gxp.plugins.GoogleSource.prototype.timeout;window.setTimeout(function(){if(!gxp.plugins.GoogleSource.loader.ready){this.loading=false;this.ready=false;document.getElementsByTagName("head")[0].removeChild(i);r.call(e.scope);this.fireEvent("failure");this.purgeListeners()}}.createDelegate(this),a);this.on({ready:e.callback,scope:e.scope});this.loading=true;function s(){document.getElementsByTagName("head")[0].appendChild(i)}if(document.body){s()}else{Ext.onReady(s)}}}));Ext.preg(gxp.plugins.GoogleSource.prototype.ptype,gxp.plugins.GoogleSource);Ext.namespace("gxp.plugins");gxp.plugins.OLSource=Ext.extend(gxp.plugins.LayerSource,{ptype:"gxp_olsource",createLayerRecord:function(e){var t;var i=window;var r=e.type.split(".");for(var a=0,s=r.length;a<s;++a){i=i[r[a]];if(!i){break}}if(i&&i.prototype&&i.prototype.initialize){var n=function(){i.prototype.initialize.apply(this,e.args)};n.prototype=i.prototype;var o=new n;if("visibility"in e){o.visibility=e.visibility}var l=GeoExt.data.LayerRecord.create([{name:"name",type:"string"},{name:"source",type:"string"},{name:"group",type:"string"},{name:"fixed",type:"boolean"},{name:"selected",type:"boolean"},{name:"type",type:"string"},{name:"args"},{name:"queryable",type:"boolean"}]);var h={layer:o,title:o.name,name:e.name||o.name,source:e.source,group:e.group,fixed:"fixed"in e?e.fixed:false,selected:"selected"in e?e.selected:false,queryable:"queryable"in e?e.queryable:false,type:e.type,args:e.args,properties:"properties"in e?e.properties:undefined};t=new l(h,o.id)}else{throw new Error("Cannot construct OpenLayers layer from given type: "+e.type)}return t},getConfigForRecord:function(e){var t=gxp.plugins.OLSource.superclass.getConfigForRecord.apply(this,arguments);var i=e.getLayer();return Ext.apply(t,{type:e.get("type"),args:e.get("args")})}});Ext.preg(gxp.plugins.OLSource.prototype.ptype,gxp.plugins.OLSource);OpenLayers.Layer.OSM=OpenLayers.Class(OpenLayers.Layer.XYZ,{name:"OpenStreetMap",url:["http://a.tile.openstreetmap.org/${z}/${x}/${y}.png","http://b.tile.openstreetmap.org/${z}/${x}/${y}.png","http://c.tile.openstreetmap.org/${z}/${x}/${y}.png"],attribution:"&copy; <a href='http://www.openstreetmap.org/copyright'>OpenStreetMap</a> contributors",sphericalMercator:true,wrapDateLine:true,tileOptions:null,initialize:function(e,t,i){OpenLayers.Layer.XYZ.prototype.initialize.apply(this,arguments);this.tileOptions=OpenLayers.Util.extend({crossOriginKeyword:"anonymous"},this.options&&this.options.tileOptions)},clone:function(e){if(e==null){e=new OpenLayers.Layer.OSM(this.name,this.url,this.getOptions())}e=OpenLayers.Layer.XYZ.prototype.clone.apply(this,[e]);return e},CLASS_NAME:"OpenLayers.Layer.OSM"});Ext.namespace("gxp.plugins");gxp.plugins.OSMSource=Ext.extend(gxp.plugins.LayerSource,{ptype:"gxp_osmsource",title:gettext("OpenStreetMap Layers"),mapnikAttribution:"&copy; <a href='http://www.openstreetmap.org/copyright'>OpenStreetMap</a> contributors",osmarenderAttribution:"Data CC-By-SA by <a href='http://openstreetmap.org/' target='_blank'>OpenStreetMap</a>",createStore:function(){var e={projection:"EPSG:900913",maxExtent:new OpenLayers.Bounds(-128*156543.0339,-128*156543.0339,128*156543.0339,128*156543.0339),maxResolution:156543.03390625,numZoomLevels:19,units:"m",buffer:1,transitionEffect:"resize"};var t=[new OpenLayers.Layer.OSM("OpenStreetMap",["http://a.tile.openstreetmap.org/${z}/${x}/${y}.png","http://b.tile.openstreetmap.org/${z}/${x}/${y}.png","http://c.tile.openstreetmap.org/${z}/${x}/${y}.png"],OpenLayers.Util.applyDefaults({attribution:this.mapnikAttribution,type:"mapnik"},e))];this.store=new GeoExt.data.LayerStore({layers:t,fields:[{name:"source",type:"string"},{name:"name",type:"string",mapping:"type"},{name:"abstract",type:"string",mapping:"attribution"},{name:"group",type:"string",defaultValue:"background"},{name:"fixed",type:"boolean",defaultValue:true},{name:"selected",type:"boolean"}]});this.store.each(function(e){e.set("group","background")});this.fireEvent("ready",this)},createLayerRecord:function(e){var t;var i=this.store.findExact("name",e.name);if(i>-1){t=this.store.getAt(i).copy(Ext.data.Record.id({}));var r=t.getLayer().clone();if(e.title){r.setName(e.title);t.set("title",e.title)}if("visibility"in e){r.visibility=e.visibility}t.set("selected",e.selected||false);t.set("source",e.source);t.set("name",e.name);if("group"in e){t.set("group",e.group)}t.data.layer=r;t.commit()}return t}});Ext.preg(gxp.plugins.OSMSource.prototype.ptype,gxp.plugins.OSMSource);OpenLayers.Layer.TMS=OpenLayers.Class(OpenLayers.Layer.Grid,{serviceVersion:"1.0.0",layername:null,type:null,isBaseLayer:true,tileOrigin:null,serverResolutions:null,zoomOffset:0,initialize:function(e,t,i){var r=[];r.push(e,t,{},i);OpenLayers.Layer.Grid.prototype.initialize.apply(this,r)},clone:function(e){if(e==null){e=new OpenLayers.Layer.TMS(this.name,this.url,this.getOptions())}e=OpenLayers.Layer.Grid.prototype.clone.apply(this,[e]);return e},getURL:function(e){e=this.adjustBounds(e);var t=this.getServerResolution();var i=Math.round((e.left-this.tileOrigin.lon)/(t*this.tileSize.w));var r=Math.round((e.bottom-this.tileOrigin.lat)/(t*this.tileSize.h));var a=this.getServerZoom();var s=this.serviceVersion+"/"+this.layername+"/"+a+"/"+i+"/"+r+"."+this.type;var n=this.url;if(OpenLayers.Util.isArray(n)){n=this.selectUrl(s,n)}return n+s},setMap:function(e){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments);if(!this.tileOrigin){this.tileOrigin=new OpenLayers.LonLat(this.map.maxExtent.left,this.map.maxExtent.bottom)}},CLASS_NAME:"OpenLayers.Layer.TMS"});Ext.namespace("gxp.plugins");gxp.plugins.MapBoxSource=Ext.extend(gxp.plugins.LayerSource,{ptype:"gxp_mapboxsource",title:gettext("MapBox Layers"),blueMarbleTopoBathyJanTitle:gettext("Blue Marble Topography & Bathymetry (January)"),blueMarbleTopoBathyJulTitle:gettext("Blue Marble Topography & Bathymetry (July)"),blueMarbleTopoJanTitle:gettext("Blue Marble Topography (January)"),blueMarbleTopoJulTitle:gettext("Blue Marble Topography (July)"),controlRoomTitle:gettext("Control Room"),geographyClassTitle:gettext("Geography Class"),naturalEarthHypsoTitle:gettext("Natural Earth Hypsometric"),naturalEarthHypsoBathyTitle:gettext("Natural Earth Hypsometric & Bathymetry"),naturalEarth1Title:gettext("Natural Earth I"),naturalEarth2Title:gettext("Natural Earth II"),worldDarkTitle:gettext("World Dark"),worldLightTitle:gettext("World Light"),worldGlassTitle:gettext("World Glass"),worldPrintTitle:gettext("World Print"),createStore:function(){var e={projection:"EPSG:900913",numZoomLevels:19,serverResolutions:[156543.03390625,78271.516953125,39135.7584765625,19567.87923828125,9783.939619140625,4891.9698095703125,2445.9849047851562,1222.9924523925781,611.4962261962891,305.74811309814453,152.87405654907226,76.43702827453613,38.218514137268066,19.109257068634033,9.554628534317017,4.777314267158508,2.388657133579254,1.194328566789627,.5971642833948135],buffer:1};var t=[{name:"blue-marble-topo-bathy-jan",numZoomLevels:9},{name:"blue-marble-topo-bathy-jul",numZoomLevels:9},{name:"blue-marble-topo-jan",numZoomLevels:9},{name:"blue-marble-topo-jul",numZoomLevels:9},{name:"control-room",numZoomLevels:9},{name:"geography-class",numZoomLevels:9},{name:"natural-earth-hypso",numZoomLevels:7},{name:"natural-earth-hypso-bathy",numZoomLevels:7},{name:"natural-earth-1",numZoomLevels:7},{name:"natural-earth-2",numZoomLevels:7},{name:"world-dark",numZoomLevels:12},{name:"world-light",numZoomLevels:12},{name:"world-glass",numZoomLevels:11},{name:"world-print",numZoomLevels:10}];var i=t.length;var r=new Array(i);var a;for(var s=0;s<i;++s){a=t[s];r[s]=new OpenLayers.Layer.TMS(this[OpenLayers.String.camelize(a.name)+"Title"],["http://a.tiles.mapbox.com/mapbox/","http://b.tiles.mapbox.com/mapbox/","http://c.tiles.mapbox.com/mapbox/","http://d.tiles.mapbox.com/mapbox/"],OpenLayers.Util.applyDefaults({attribution:/^world/.test(name)?"<a href='http://mapbox.com'>MapBox</a> | Some Data &copy; OSM CC-BY-SA | <a href='http://mapbox.com/tos'>Terms of Service</a>":"<a href='http://mapbox.com'>MapBox</a> | <a href='http://mapbox.com/tos'>Terms of Service</a>",type:"png",tileOrigin:new OpenLayers.LonLat(-128*156543.03390625,-128*156543.03390625),layername:a.name,abstract:'<div class="thumb-mapbox thumb-mapbox-'+a.name+'"></div>',numZoomLevels:a.numZoomLevels},e))}this.store=new GeoExt.data.LayerStore({layers:r,fields:[{name:"source",type:"string"},{name:"name",type:"string",mapping:"layername"},{name:"abstract",type:"string"},{name:"group",type:"string"},{name:"fixed",type:"boolean"},{name:"selected",type:"boolean"}]});this.fireEvent("ready",this)},createLayerRecord:function(e){var t;var i=this.store.findExact("name",e.name);if(i>-1){t=this.store.getAt(i).copy(Ext.data.Record.id({}));var r=t.getLayer().clone();if(e.title){r.setName(e.title);t.set("title",e.title)}if("visibility"in e){r.visibility=e.visibility}t.set("selected",e.selected||false);t.set("source",e.source);t.set("name",e.name);if("group"in e){t.set("group",e.group)}t.data.layer=r;t.commit()}return t}});Ext.preg(gxp.plugins.MapBoxSource.prototype.ptype,gxp.plugins.MapBoxSource);Ext.namespace("gxp.plugins");gxp.plugins.MapQuestSource=Ext.extend(gxp.plugins.LayerSource,{ptype:"gxp_mapquestsource",title:gettext("MapQuest Layers"),osmAttribution:"Tiles Courtesy of <a href='http://open.mapquest.co.uk/' target='_blank'>MapQuest</a> <img src='http://developer.mapquest.com/content/osm/mq_logo.png' border='0'>",osmTitle:gettext("MapQuest OpenStreetMap"),naipAttribution:"Tiles Courtesy of <a href='http://open.mapquest.co.uk/' target='_blank'>MapQuest</a> <img src='http://developer.mapquest.com/content/osm/mq_logo.png' border='0'>",naipTitle:gettext("MapQuest Imagery"),createStore:function(){var e={projection:"EPSG:900913",maxExtent:new OpenLayers.Bounds(-128*156543.0339,-128*156543.0339,128*156543.0339,128*156543.0339),maxResolution:156543.03390625,numZoomLevels:19,units:"m",buffer:1,transitionEffect:"resize",tileOptions:{crossOriginKeyword:null}};var t=[new OpenLayers.Layer.OSM(this.osmTitle,["http://otile1.mqcdn.com/tiles/1.0.0/map/${z}/${x}/${y}.png","http://otile2.mqcdn.com/tiles/1.0.0/map/${z}/${x}/${y}.png","http://otile3.mqcdn.com/tiles/1.0.0/map/${z}/${x}/${y}.png","http://otile4.mqcdn.com/tiles/1.0.0/map/${z}/${x}/${y}.png"],OpenLayers.Util.applyDefaults({attribution:this.osmAttribution,type:"osm"},e)),new OpenLayers.Layer.OSM(this.naipTitle,["http://otile1.mqcdn.com/tiles/1.0.0/sat/${z}/${x}/${y}.png","http://otile2.mqcdn.com/tiles/1.0.0/sat/${z}/${x}/${y}.png","http://otile3.mqcdn.com/tiles/1.0.0/sat/${z}/${x}/${y}.png","http://otile4.mqcdn.com/tiles/1.0.0/sat/${z}/${x}/${y}.png"],OpenLayers.Util.applyDefaults({attribution:this.naipAttribution,type:"naip"},e))];this.store=new GeoExt.data.LayerStore({layers:t,fields:[{name:"source",type:"string"},{name:"name",type:"string",mapping:"type"},{name:"abstract",type:"string",mapping:"attribution"},{name:"group",type:"string",defaultValue:"background"},{name:"fixed",type:"boolean",defaultValue:true},{name:"selected",type:"boolean"}]});this.store.each(function(e){e.set("group","background")});this.fireEvent("ready",this)},createLayerRecord:function(e){var t;var i=this.store.findExact("name",e.name);if(i>-1){t=this.store.getAt(i).copy(Ext.data.Record.id({}));var r=t.getLayer().clone();if(e.title){r.setName(e.title);t.set("title",e.title)}if("visibility"in e){r.visibility=e.visibility}t.set("selected",e.selected||false);t.set("source",e.source);t.set("name",e.name);if("group"in e){t.set("group",e.group)}t.data.layer=r;t.commit()}return t}});Ext.preg(gxp.plugins.MapQuestSource.prototype.ptype,gxp.plugins.MapQuestSource);OpenLayers.Format.WMSCapabilities=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.1.1",profile:null,CLASS_NAME:"OpenLayers.Format.WMSCapabilities"});OpenLayers.Format.WMSCapabilities.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{wms:"http://www.opengis.net/wms",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"wms",read:function(e){if(typeof e=="string"){e=OpenLayers.Format.XML.prototype.read.apply(this,[e])}var t=e;if(e&&e.nodeType==9){e=e.documentElement}var i={};this.readNode(e,i);if(i.service===undefined){var r=new OpenLayers.Format.OGCExceptionReport;i.error=r.read(t)}return i},readers:{wms:{Service:function(e,t){t.service={};this.readChildNodes(e,t.service)},Name:function(e,t){t.name=this.getChildValue(e)},Title:function(e,t){t.title=this.getChildValue(e)},Abstract:function(e,t){t["abstract"]=this.getChildValue(e)},BoundingBox:function(e,t){var i={};i.bbox=[parseFloat(e.getAttribute("minx")),parseFloat(e.getAttribute("miny")),parseFloat(e.getAttribute("maxx")),parseFloat(e.getAttribute("maxy"))];var r={x:parseFloat(e.getAttribute("resx")),y:parseFloat(e.getAttribute("resy"))};if(!(isNaN(r.x)&&isNaN(r.y))){i.res=r}return i},OnlineResource:function(e,t){t.href=this.getAttributeNS(e,this.namespaces.xlink,"href")},ContactInformation:function(e,t){t.contactInformation={};this.readChildNodes(e,t.contactInformation)},ContactPersonPrimary:function(e,t){t.personPrimary={};this.readChildNodes(e,t.personPrimary)},ContactPerson:function(e,t){t.person=this.getChildValue(e)},ContactOrganization:function(e,t){t.organization=this.getChildValue(e)},ContactPosition:function(e,t){t.position=this.getChildValue(e)},ContactAddress:function(e,t){t.contactAddress={};this.readChildNodes(e,t.contactAddress)},AddressType:function(e,t){t.type=this.getChildValue(e)},Address:function(e,t){t.address=this.getChildValue(e)},City:function(e,t){t.city=this.getChildValue(e)},StateOrProvince:function(e,t){t.stateOrProvince=this.getChildValue(e)},PostCode:function(e,t){t.postcode=this.getChildValue(e)},Country:function(e,t){t.country=this.getChildValue(e)},ContactVoiceTelephone:function(e,t){t.phone=this.getChildValue(e)},ContactFacsimileTelephone:function(e,t){t.fax=this.getChildValue(e)},ContactElectronicMailAddress:function(e,t){t.email=this.getChildValue(e)},Fees:function(e,t){var i=this.getChildValue(e);if(i&&i.toLowerCase()!="none"){t.fees=i}},AccessConstraints:function(e,t){var i=this.getChildValue(e);if(i&&i.toLowerCase()!="none"){t.accessConstraints=i}},Capability:function(e,t){t.capability={nestedLayers:[],layers:[]};this.readChildNodes(e,t.capability)},Request:function(e,t){t.request={};this.readChildNodes(e,t.request)},GetCapabilities:function(e,t){t.getcapabilities={formats:[]};this.readChildNodes(e,t.getcapabilities)},Format:function(e,t){if(OpenLayers.Util.isArray(t.formats)){t.formats.push(this.getChildValue(e))}else{t.format=this.getChildValue(e)}},DCPType:function(e,t){this.readChildNodes(e,t)},HTTP:function(e,t){this.readChildNodes(e,t)},Get:function(e,t){t.get={};this.readChildNodes(e,t.get);if(!t.href){t.href=t.get.href}},Post:function(e,t){t.post={};this.readChildNodes(e,t.post);if(!t.href){t.href=t.get.href}},GetMap:function(e,t){t.getmap={formats:[]};this.readChildNodes(e,t.getmap)},GetFeatureInfo:function(e,t){t.getfeatureinfo={formats:[]};this.readChildNodes(e,t.getfeatureinfo)},Exception:function(e,t){t.exception={formats:[]};this.readChildNodes(e,t.exception)},Layer:function(e,t){var i,r;if(t.capability){r=t.capability;i=t}else{r=t}var a=e.getAttributeNode("queryable");var s=a&&a.specified?e.getAttribute("queryable"):null;a=e.getAttributeNode("cascaded");var p=a&&a.specified?e.getAttribute("cascaded"):null;a=e.getAttributeNode("opaque");var n=a&&a.specified?e.getAttribute("opaque"):null;var u=e.getAttribute("noSubsets");var c=e.getAttribute("fixedWidth");var d=e.getAttribute("fixedHeight");var o=i||{},l=OpenLayers.Util.extend;var h={nestedLayers:[],styles:i?[].concat(i.styles):[],srs:i?l({},o.srs):{},metadataURLs:[],bbox:i?l({},o.bbox):{},llbbox:o.llbbox,dimensions:i?l({},o.dimensions):{},authorityURLs:i?l({},o.authorityURLs):{},identifiers:{},keywords:[],queryable:s&&s!==""?s==="1"||s==="true":o.queryable||false,cascaded:p!==null?parseInt(p):o.cascaded||0,opaque:n?n==="1"||n==="true":o.opaque||false,noSubsets:u!==null?u==="1"||u==="true":o.noSubsets||false,fixedWidth:c!=null?parseInt(c):o.fixedWidth||0,fixedHeight:d!=null?parseInt(d):o.fixedHeight||0,minScale:o.minScale,maxScale:o.maxScale,attribution:o.attribution};t.nestedLayers.push(h);h.capability=r;this.readChildNodes(e,h);delete h.capability;if(h.name){var f=h.name.split(":"),y=r.request,g=y.getfeatureinfo;if(f.length>0){h.prefix=f[0]}r.layers.push(h);if(h.formats===undefined){h.formats=y.getmap.formats}if(h.infoFormats===undefined&&g){h.infoFormats=g.formats}}},Attribution:function(e,t){t.attribution={};this.readChildNodes(e,t.attribution)},LogoURL:function(e,t){t.logo={width:e.getAttribute("width"),height:e.getAttribute("height")};this.readChildNodes(e,t.logo)},Style:function(e,t){var i={};t.styles.push(i);this.readChildNodes(e,i)},LegendURL:function(e,t){var i={width:e.getAttribute("width"),height:e.getAttribute("height")};t.legend=i;this.readChildNodes(e,i)},MetadataURL:function(e,t){var i={type:e.getAttribute("type")};t.metadataURLs.push(i);this.readChildNodes(e,i)},DataURL:function(e,t){t.dataURL={};this.readChildNodes(e,t.dataURL)},FeatureListURL:function(e,t){t.featureListURL={};this.readChildNodes(e,t.featureListURL)},AuthorityURL:function(e,t){var i=e.getAttribute("name");var r={};this.readChildNodes(e,r);t.authorityURLs[i]=r.href},Identifier:function(e,t){var i=e.getAttribute("authority");t.identifiers[i]=this.getChildValue(e)},KeywordList:function(e,t){this.readChildNodes(e,t)},SRS:function(e,t){t.srs[this.getChildValue(e)]=true}}},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1"});OpenLayers.Format.WMSCapabilities.v1_1=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1,{readers:{wms:OpenLayers.Util.applyDefaults({WMT_MS_Capabilities:function(e,t){this.readChildNodes(e,t)},Keyword:function(e,t){if(t.keywords){t.keywords.push(this.getChildValue(e))}},DescribeLayer:function(e,t){t.describelayer={formats:[]};this.readChildNodes(e,t.describelayer)},GetLegendGraphic:function(e,t){t.getlegendgraphic={formats:[]};this.readChildNodes(e,t.getlegendgraphic)},GetStyles:function(e,t){t.getstyles={formats:[]};this.readChildNodes(e,t.getstyles)},PutStyles:function(e,t){t.putstyles={formats:[]};this.readChildNodes(e,t.putstyles)},UserDefinedSymbolization:function(e,t){var i={supportSLD:parseInt(e.getAttribute("SupportSLD"))==1,userLayer:parseInt(e.getAttribute("UserLayer"))==1,userStyle:parseInt(e.getAttribute("UserStyle"))==1,remoteWFS:parseInt(e.getAttribute("RemoteWFS"))==1};t.userSymbols=i},LatLonBoundingBox:function(e,t){t.llbbox=[parseFloat(e.getAttribute("minx")),parseFloat(e.getAttribute("miny")),parseFloat(e.getAttribute("maxx")),parseFloat(e.getAttribute("maxy"))]},BoundingBox:function(e,t){var i=OpenLayers.Format.WMSCapabilities.v1.prototype.readers["wms"].BoundingBox.apply(this,[e,t]);i.srs=e.getAttribute("SRS");t.bbox[i.srs]=i},ScaleHint:function(e,t){var i=e.getAttribute("min");var r=e.getAttribute("max");var a=Math.pow(2,.5);var s=OpenLayers.INCHES_PER_UNIT["m"];if(i!=0){t.maxScale=parseFloat((i/a*s*OpenLayers.DOTS_PER_INCH).toPrecision(13))}if(r!=Number.POSITIVE_INFINITY){t.minScale=parseFloat((r/a*s*OpenLayers.DOTS_PER_INCH).toPrecision(13))}},Dimension:function(e,t){var i=e.getAttribute("name").toLowerCase();var r={name:i,units:e.getAttribute("units"),unitsymbol:e.getAttribute("unitSymbol")};t.dimensions[r.name]=r},Extent:function(e,t){var i=e.getAttribute("name").toLowerCase();if(i in t["dimensions"]){var r=t.dimensions[i];r.nearestVal=e.getAttribute("nearestValue")==="1";r.multipleVal=e.getAttribute("multipleValues")==="1";r.current=e.getAttribute("current")==="1";r["default"]=e.getAttribute("default")||"";var a=this.getChildValue(e);r.values=a.split(",")}}},OpenLayers.Format.WMSCapabilities.v1.prototype.readers["wms"])},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_1"});OpenLayers.Format.WMSCapabilities.v1_1_0=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1_1,{version:"1.1.0",readers:{wms:OpenLayers.Util.applyDefaults({SRS:function(e,t){var i=this.getChildValue(e);var r=i.split(/ +/);for(var a=0,s=r.length;a<s;a++){t.srs[r[a]]=true}}},OpenLayers.Format.WMSCapabilities.v1_1.prototype.readers["wms"])},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_1_0"});OpenLayers.Format.WMSCapabilities.v1_1_1=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1_1,{version:"1.1.1",readers:{wms:OpenLayers.Util.applyDefaults({SRS:function(e,t){t.srs[this.getChildValue(e)]=true}},OpenLayers.Format.WMSCapabilities.v1_1.prototype.readers["wms"])},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_1_1"});OpenLayers.Format.WMSCapabilities.v1_3=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1,{readers:{wms:OpenLayers.Util.applyDefaults({WMS_Capabilities:function(e,t){this.readChildNodes(e,t)},LayerLimit:function(e,t){t.layerLimit=parseInt(this.getChildValue(e))},MaxWidth:function(e,t){t.maxWidth=parseInt(this.getChildValue(e))},MaxHeight:function(e,t){t.maxHeight=parseInt(this.getChildValue(e))},BoundingBox:function(e,t){var i=OpenLayers.Format.WMSCapabilities.v1.prototype.readers["wms"].BoundingBox.apply(this,[e,t]);i.srs=e.getAttribute("CRS");t.bbox[i.srs]=i},CRS:function(e,t){this.readers.wms.SRS.apply(this,[e,t])},EX_GeographicBoundingBox:function(e,t){t.llbbox=[];this.readChildNodes(e,t.llbbox)},westBoundLongitude:function(e,t){t[0]=this.getChildValue(e)},eastBoundLongitude:function(e,t){t[2]=this.getChildValue(e)},southBoundLatitude:function(e,t){t[1]=this.getChildValue(e)},northBoundLatitude:function(e,t){t[3]=this.getChildValue(e)},MinScaleDenominator:function(e,t){t.maxScale=parseFloat(this.getChildValue(e)).toPrecision(16)},MaxScaleDenominator:function(e,t){t.minScale=parseFloat(this.getChildValue(e)).toPrecision(16)},Dimension:function(e,t){var i=e.getAttribute("name").toLowerCase();var r={name:i,units:e.getAttribute("units"),unitsymbol:e.getAttribute("unitSymbol"),nearestVal:e.getAttribute("nearestValue")==="1",multipleVal:e.getAttribute("multipleValues")==="1",default:e.getAttribute("default")||"",current:e.getAttribute("current")==="1",values:this.getChildValue(e).split(",")};t.dimensions[r.name]=r},Keyword:function(e,t){var i={value:this.getChildValue(e),vocabulary:e.getAttribute("vocabulary")};if(t.keywords){t.keywords.push(i)}}},OpenLayers.Format.WMSCapabilities.v1.prototype.readers["wms"]),sld:{UserDefinedSymbolization:function(e,t){this.readers.wms.UserDefinedSymbolization.apply(this,[e,t]);t.userSymbols.inlineFeature=parseInt(e.getAttribute("InlineFeature"))==1;t.userSymbols.remoteWCS=parseInt(e.getAttribute("RemoteWCS"))==1},DescribeLayer:function(e,t){this.readers.wms.DescribeLayer.apply(this,[e,t])},GetLegendGraphic:function(e,t){this.readers.wms.GetLegendGraphic.apply(this,[e,t])}}},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_3"});OpenLayers.Format.WMSCapabilities.v1_3_0=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1_3,{version:"1.3.0",CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_3_0"});Ext.namespace("GeoExt.data");GeoExt.data.WMSCapabilitiesReader=function(e,t){e=e||{};if(!e.format){e.format=new OpenLayers.Format.WMSCapabilities}if(typeof t!=="function"){t=GeoExt.data.LayerRecord.create(t||e.fields||[{name:"name",type:"string"},{name:"title",type:"string"},{name:"abstract",type:"string"},{name:"queryable",type:"boolean"},{name:"opaque",type:"boolean"},{name:"noSubsets",type:"boolean"},{name:"cascaded",type:"int"},{name:"fixedWidth",type:"int"},{name:"fixedHeight",type:"int"},{name:"minScale",type:"float"},{name:"maxScale",type:"float"},{name:"prefix",type:"string"},{name:"formats"},{name:"styles"},{name:"srs"},{name:"dimensions"},{name:"bbox"},{name:"llbbox"},{name:"attribution"},{name:"keywords"},{name:"identifiers"},{name:"authorityURLs"},{name:"metadataURLs"},{name:"infoFormats"}])}GeoExt.data.WMSCapabilitiesReader.superclass.constructor.call(this,e,t)};Ext.extend(GeoExt.data.WMSCapabilitiesReader,Ext.data.DataReader,{attributionCls:"gx-attribution",read:function(e){var t=e.responseXML;if(!t||!t.documentElement){t=e.responseText}return this.readRecords(t)},serviceExceptionFormat:function(e){if(OpenLayers.Util.indexOf(e,"application/vnd.ogc.se_inimage")>-1){return"application/vnd.ogc.se_inimage"}if(OpenLayers.Util.indexOf(e,"application/vnd.ogc.se_xml")>-1){return"application/vnd.ogc.se_xml"}return e[0]},imageFormat:function(e){var t=e.formats;if(e.opaque&&OpenLayers.Util.indexOf(t,"image/jpeg")>-1){return"image/jpeg"}if(OpenLayers.Util.indexOf(t,"image/png")>-1){return"image/png"}if(OpenLayers.Util.indexOf(t,"image/png; mode=24bit")>-1){return"image/png; mode=24bit"}if(OpenLayers.Util.indexOf(t,"image/gif")>-1){return"image/gif"}return t[0]},imageTransparent:function(e){return e.opaque==undefined||!e.opaque},readRecords:function(e){if(typeof e==="string"||e.nodeType){e=this.meta.format.read(e)}if(!!e.error){throw new Ext.data.DataReader.Error("invalid-response",e.error)}var p=e.version;var t=e.capability||{};var u=t.request&&t.request.getmap&&t.request.getmap.href;var i=t.layers;var c=t.exception?t.exception.formats:[];var d=this.serviceExceptionFormat(c);var r=[];if(u&&i){var f=this.recordType.prototype.fields;var a,s,n,o,l,h;for(var y=0,g=i.length;y<g;y++){a=i[y];if(a.name){s={};for(var m=0,v=f.length;m<v;m++){l=f.items[m];h=a[l.mapping||l.name]||l.defaultValue;h=l.convert(h);s[l.name]=h}n={attribution:a.attribution?this.attributionMarkup(a.attribution):undefined,minScale:a.minScale,maxScale:a.maxScale};if(this.meta.layerOptions){Ext.apply(n,this.meta.layerOptions)}o={layers:a.name,exceptions:d,format:this.imageFormat(a),transparent:this.imageTransparent(a),version:p};if(this.meta.layerParams){Ext.apply(o,this.meta.layerParams)}s.layer=new OpenLayers.Layer.WMS(a.title||a.name,u,o,n);r.push(new this.recordType(s,s.layer.id))}}}return{totalRecords:r.length,success:true,records:r}},attributionMarkup:function(e){var t=[];if(e.logo){t.push("<img class='"+this.attributionCls+"-image' "+"src='"+e.logo.href+"' />")}if(e.title){t.push("<span class='"+this.attributionCls+"-title'>"+e.title+"</span>")}if(e.href){for(var i=0;i<t.length;i++){t[i]="<a class='"+this.attributionCls+"-link' "+"href="+e.href+">"+t[i]+"</a>"}}return t.join(" ")}});Ext.namespace("GeoExt.data");GeoExt.data.WMSCapabilitiesStore=function(e){e=e||{};GeoExt.data.WMSCapabilitiesStore.superclass.constructor.call(this,Ext.apply(e,{proxy:e.proxy||(!e.data?new Ext.data.HttpProxy({url:e.url,disableCaching:false,method:"GET"}):undefined),reader:new GeoExt.data.WMSCapabilitiesReader(e,e.fields)}))};Ext.extend(GeoExt.data.WMSCapabilitiesStore,Ext.data.Store);Ext.namespace("GeoExt.data");GeoExt.data.WMSDescribeLayerStore=function(e){e=e||{};GeoExt.data.WMSDescribeLayerStore.superclass.constructor.call(this,Ext.apply(e,{proxy:e.proxy||(!e.data?new Ext.data.HttpProxy({url:e.url,disableCaching:false,method:"GET"}):undefined),reader:new GeoExt.data.WMSDescribeLayerReader(e,e.fields)}))};Ext.extend(GeoExt.data.WMSDescribeLayerStore,Ext.data.Store);(function(){function e(e){var t=this.meta.format;if(typeof e==="string"||e.nodeType){e=t.read(e);var i=t.read;t.read=function(){t.read=i;return e}}this.raw=e}Ext.intercept(GeoExt.data.WMSCapabilitiesReader.prototype,"readRecords",e);GeoExt.data.AttributeReader&&Ext.intercept(GeoExt.data.AttributeReader.prototype,"readRecords",e)})();Ext.namespace("gxp.plugins");gxp.plugins.WMSSource=Ext.extend(gxp.plugins.LayerSource,{ptype:"gxp_wmssource",baseParams:null,format:null,describeLayerStore:null,describedLayers:null,schemaCache:null,ready:false,requiredProperties:["title","bbox"],constructor:function(e){if(e&&e.forceLazy===true){e.requiredProperties=[];delete e.forceLazy;if(window.console){console.warn("Deprecated config option 'forceLazy: true' for layer source '"+e.id+"'. Use 'requiredProperties: []' instead.")}}gxp.plugins.WMSSource.superclass.constructor.apply(this,arguments);if(!this.format){this.format=new OpenLayers.Format.WMSCapabilities({keepData:true})}},init:function(e){gxp.plugins.WMSSource.superclass.init.apply(this,arguments);this.target.on("authorizationchange",this.onAuthorizationChange,this)},onAuthorizationChange:function(){if(this.disabled!==true&&this.store&&this.url.charAt(0)==="/"){var e=this.store.lastOptions||{params:{}};Ext.apply(e.params,{_dc:Math.random()});this.store.reload(e)}},destroy:function(){this.target.un("authorizationchange",this.onAuthorizationChange,this);gxp.plugins.WMSSource.superclass.destroy.apply(this,arguments)},isLazy:function(){var e=true;var t=this.target.initialConfig.map;if(t&&t.layers){var i;for(var r=0,a=t.layers.length;r<a;++r){i=t.layers[r];if(i.source===this.id){e=this.layerConfigComplete(i);if(e===false){break}}}}return e},layerConfigComplete:function(e){var t=true;if(!Ext.isObject(e.capability)){var i=this.requiredProperties;for(var r=i.length-1;r>=0;--r){t=!!e[i[r]];if(t===false){break}}}return t},createStore:function(){var e=this.baseParams||{SERVICE:"WMS",REQUEST:"GetCapabilities"};if(this.version){e.VERSION=this.version}var t=this.isLazy();this.store=new GeoExt.data.WMSCapabilitiesStore({url:this.trimUrl(this.url,e),baseParams:e,format:this.format,autoLoad:!t,layerParams:{exceptions:null},listeners:{load:function(){if(!this.store.reader.raw||!this.store.reader.raw.service){this.fireEvent("failure",this,"Invalid capabilities document.")}else{if(!this.title){this.title=this.store.reader.raw.service.title}if(!this.ready){this.ready=true;this.fireEvent("ready",this)}else{this.lazy=false}}delete this.format.data},exception:function(e,t,h,p,i,r){delete this.store;var a,s="";if(t==="response"){if(typeof r=="string"){a=r}else{a="Invalid response from server.";var n=this.format&&this.format.data;if(n&&n.parseError){a+="  "+n.parseError.reason+" - line: "+n.parseError.line}var o=i.status;if(o>=200&&o<300){var l=r&&r.arg&&r.arg.exceptionReport;s=gxp.util.getOGCExceptionText(l)}else{s="Status: "+o}}}else{a="Trouble creating layer store from response.";s="Unable to handle response."}this.fireEvent("failure",this,a,s);delete this.format.data},scope:this}});if(t){this.lazy=t;this.ready=true;this.fireEvent("ready",this)}},trimUrl:function(e,t,i){var r=OpenLayers.Util.getParameters(e);t=OpenLayers.Util.upperCaseObject(t);var a=0;for(var s in r){++a;if(s.toUpperCase()in t){--a;delete r[s]}}return e.split("?").shift()+(a?"?"+OpenLayers.Util.getParameterString(r):"")},createLazyLayerRecord:function(e){e=Ext.apply({},e);var t=e.srs||this.target.map.projection;e.srs={};e.srs[t]=true;var i=e.bbox||this.target.map.maxExtent||OpenLayers.Projection.defaults[t].maxExtent;e.bbox={};e.bbox[t]={bbox:i};var r;if(this.store&&this.store instanceof GeoExt.data.WMSCapabilitiesStore){r=new this.store.recordType(e)}else{r=new GeoExt.data.LayerRecord(e)}r.setLayer(new OpenLayers.Layer.WMS(e.title||e.name,e.url||this.url,{layers:e.name,transparent:"transparent"in e?e.transparent:true,cql_filter:e.cql_filter,format:e.format},{projection:t,eventListeners:{tileloaded:this.countAlive,tileerror:this.countAlive,scope:this}}));r.json=e;return r},countAlive:function(e){if(!("_alive"in e.object.metadata)){e.object.metadata._alive=0;e.object.events.register("loadend",this,this.removeDeadLayer)}e.object.metadata._alive+=e.type=="tileerror"?-1:1},removeDeadLayer:function(e){e.object.events.un({tileloaded:this.countAlive,tileerror:this.countAlive,loadend:this.removeDeadLayer,scope:this});if(e.object.metadata._alive===0){this.target.mapPanel.map.removeLayer(e.object);if(window.console){console.debug("Unavailable layer "+e.object.name+" removed.")}}delete e.object.metadata._alive},createLayerRecord:function(e){var t,i;var r=this.store.findExact("name",e.name);if(r>-1){i=this.store.getAt(r)}else if(Ext.isObject(e.capability)){i=this.store.reader.readRecords({capability:{request:{getmap:{href:this.trimUrl(this.url,this.baseParams)}},layers:[e.capability]}}).records[0]}else if(this.layerConfigComplete(e)){i=this.createLazyLayerRecord(e)}if(i){var a=i.getLayer().clone();var p=this.getMapProjection();var s=this.getProjection(i);if(s){a.addOptions({projection:s})}var u=(s||p).getCode(),n=i.get("bbox"),o;if(n&&n[u]){o=OpenLayers.Bounds.fromArray(n[u].bbox,a.reverseAxisOrder())}else{var l=i.get("llbbox");if(l){l[0]=Math.max(l[0],-180);l[1]=Math.max(l[1],-90);l[2]=Math.min(l[2],180);l[3]=Math.min(l[3],90);o=OpenLayers.Bounds.fromArray(l).transform("EPSG:4326",p)}}a.mergeNewParams({STYLES:e.styles,FORMAT:e.format,TRANSPARENT:e.transparent,CQL_FILTER:e.cql_filter});var h=false;if("tiled"in e){h=!e.tiled}else{if(i.data.dimensions&&i.data.dimensions.time){h=true}}a.setName(e.title||a.name);a.addOptions({attribution:e.attribution||a.attribution,maxExtent:o,restrictedExtent:o,singleTile:h,ratio:e.ratio||1,visibility:"visibility"in e?e.visibility:true,opacity:"opacity"in e?e.opacity:1,buffer:"buffer"in e?e.buffer:1,dimensions:i.data.dimensions,transitionEffect:h?"resize":null,minScale:e.minscale,maxScale:e.maxscale});var c=Ext.applyIf({title:a.name,group:e.group,infoFormat:e.infoFormat,getFeatureInfo:e.getFeatureInfo,source:e.source,properties:"gxp_wmslayerpanel",fixed:e.fixed,selected:"selected"in e?e.selected:false,restUrl:this.restUrl,layer:a},i.data);var d=[{name:"source",type:"string"},{name:"group",type:"string"},{name:"properties",type:"string"},{name:"fixed",type:"boolean"},{name:"selected",type:"boolean"},{name:"restUrl",type:"string"},{name:"infoFormat",type:"string"},{name:"getFeatureInfo"}];i.fields.each(function(e){d.push(e)});var f=GeoExt.data.LayerRecord.create(d);t=new f(c,a.id);t.json=e}else{if(window.console&&this.store.getCount()>0&&e.name!==undefined){console.warn("Could not create layer record for layer '"+e.name+"'. Check if the layer is found in the WMS GetCapabilities response.")}}return t},getProjection:function(e){var t=this.getMapProjection();var i=t;var r=e.get("srs");if(!r[t.getCode()]){i=null;var a,s;for(s in r){if((a=new OpenLayers.Projection(s)).equals(t)){i=a;break}}}return i},initDescribeLayerStore:function(){var e=this.store.reader.raw;if(this.lazy){e={capability:{request:{describelayer:{href:this.url}}},version:this.version||"1.1.1"}}var t=e.capability.request.describelayer;if(t){var i=e.version;if(parseFloat(i)>1.1){i="1.1.1"}var r={SERVICE:"WMS",VERSION:i,REQUEST:"DescribeLayer"};this.describeLayerStore=new GeoExt.data.WMSDescribeLayerStore({url:this.trimUrl(t.href,r),baseParams:r})}},describeLayer:function(e,s,n){if(!this.describeLayerStore){this.initDescribeLayerStore()}function t(e){window.setTimeout(function(){s.call(n,e)},0)}if(!this.describeLayerStore){t(false);return}if(!this.describedLayers){this.describedLayers={}}var o=e.getLayer().params.LAYERS;var i=function(){var e=Ext.isArray(arguments[1])?arguments[1]:arguments[0];var t,i;for(var r=e.length-1;r>=0;r--){t=e[r];i=t.get("layerName");if(i==o){this.describeLayerStore.un("load",arguments.callee,this);this.describedLayers[i]=true;s.call(n,t);return}else if(typeof this.describedLayers[i]=="function"){var a=this.describedLayers[i];this.describeLayerStore.un("load",a,this);a.apply(this,arguments)}}delete l[o];s.call(n,false)};var l=this.describedLayers;var r;if(!l[o]){l[o]=i;this.describeLayerStore.load({params:{LAYERS:o},add:true,callback:i,scope:this})}else if((r=this.describeLayerStore.findExact("layerName",o))==-1){this.describeLayerStore.on("load",i,this)}else{t(this.describeLayerStore.getAt(r))}},fetchSchema:function(e,t,i,r){var a=this.schemaCache[t];if(a){if(a.getCount()==0){a.on("load",function(){i.call(r,a)},this,{single:true})}else{i.call(r,a)}}else{a=new GeoExt.data.AttributeStore({url:e,baseParams:{SERVICE:"WFS",VERSION:"1.1.0",REQUEST:"DescribeFeatureType",TYPENAME:t},autoLoad:true,listeners:{load:function(){i.call(r,a)},scope:this}});this.schemaCache[t]=a}},getSchema:function(r,a,s){if(!this.schemaCache){this.schemaCache={}}this.describeLayer(r,function(e){if(e&&e.get("owsType")=="WFS"){var t=e.get("typeName");var i=e.get("owsURL");this.fetchSchema(i,t,a,s)}else if(!e){this.fetchSchema(this.url,r.get("name"),a,s)}else{a.call(s,false)}},this)},getWFSProtocol:function(a,s,n){this.getSchema(a,function(e){var t=false;if(e){var i;var r=/gml:((Multi)?(Point|Line|Polygon|Curve|Surface|Geometry)).*/;e.each(function(e){var t=r.exec(e.get("type"));if(t){i=e.get("name")}},this);t=new OpenLayers.Protocol.WFS({version:"1.1.0",srsName:a.getLayer().projection.getCode(),url:e.url,featureType:e.reader.raw.featureTypes[0].typeName,featureNS:e.reader.raw.targetNamespace,geometryName:i})}s.call(n,t,e,a)},this)},getConfigForRecord:function(e){var t=Ext.applyIf(gxp.plugins.WMSSource.superclass.getConfigForRecord.apply(this,arguments),e.json),i=e.getLayer(),r=i.params,a=i.options;var h=t.name,s=this.store.reader.raw;if(s){var n=s.capability.layers;for(var o=n.length-1;o>=0;--o){if(n[o].name===h){t.capability=Ext.apply({},n[o]);var l={};l[i.projection.getCode()]=true;t.capability.srs=l;break}}}if(!t.capability){if(i.maxExtent){t.bbox=i.maxExtent.toArray()}t.srs=i.projection.getCode()}return Ext.apply(t,{format:r.FORMAT,styles:r.STYLES,tiled:!a.singleTile,transparent:r.TRANSPARENT,cql_filter:r.CQL_FILTER,minscale:a.minScale,maxscale:a.maxScale,infoFormat:e.get("infoFormat"),attribution:i.attribution})},disable:function(){this.disabled=true},getState:function(){var e=gxp.plugins.WMSSource.superclass.getState.apply(this,arguments);return Ext.applyIf(e,{title:this.title})}});Ext.preg(gxp.plugins.WMSSource.prototype.ptype,gxp.plugins.WMSSource);Ext.namespace("gxp.plugins");gxp.plugins.CatalogueSource=Ext.extend(gxp.plugins.WMSSource,{url:null,yx:null,title:null,lazy:true,hidden:true,proxyOptions:null,describeLayer:function(e,t,i){var r=Ext.data.Record.create([{name:"owsType",type:"string"},{name:"owsURL",type:"string"},{name:"typeName",type:"string"}]);var a=new r({owsType:"WFS",owsURL:e.get("url"),typeName:e.get("name")});t.call(i,a)},destroy:function(){this.store&&this.store.destroy();this.store=null;gxp.plugins.CatalogueSource.superclass.destroy.apply(this,arguments)}});OpenLayers.Format.CSWGetRecords=function(e){e=OpenLayers.Util.applyDefaults(e,OpenLayers.Format.CSWGetRecords.DEFAULTS);var t=OpenLayers.Format.CSWGetRecords["v"+e.version.replace(/\./g,"_")];if(!t){throw"Unsupported CSWGetRecords version: "+e.version}return new t(e)};OpenLayers.Format.CSWGetRecords.DEFAULTS={version:"2.0.2"};OpenLayers.Format.CSWGetRecords.v2_0_2=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{csw:"http://www.opengis.net/cat/csw/2.0.2",dc:"http://purl.org/dc/elements/1.1/",dct:"http://purl.org/dc/terms/",gmd:"http://www.isotc211.org/2005/gmd",geonet:"http://www.fao.org/geonetwork",ogc:"http://www.opengis.net/ogc",ows:"http://www.opengis.net/ows",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",xmlns:"http://www.w3.org/2000/xmlns/"},defaultPrefix:"csw",version:"2.0.2",schemaLocation:"http://www.opengis.net/cat/csw/2.0.2 http://schemas.opengis.net/csw/2.0.2/CSW-discovery.xsd",requestId:null,resultType:null,outputFormat:null,outputSchema:null,startPosition:null,maxRecords:null,DistributedSearch:null,ResponseHandler:null,Query:null,regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},initialize:function(e){OpenLayers.Format.XML.prototype.initialize.apply(this,[e])},read:function(e){if(typeof e=="string"){e=OpenLayers.Format.XML.prototype.read.apply(this,[e])}if(e&&e.nodeType==9){e=e.documentElement}var t={};this.readNode(e,t);return t},readers:{csw:{GetRecordsResponse:function(e,t){t.records=[];this.readChildNodes(e,t);var i=this.getAttributeNS(e,"","version");if(i!=""){t.version=i}},RequestId:function(e,t){t.RequestId=this.getChildValue(e)},SearchStatus:function(e,t){t.SearchStatus={};var i=this.getAttributeNS(e,"","timestamp");if(i!=""){t.SearchStatus.timestamp=i}},SearchResults:function(e,t){this.readChildNodes(e,t);var i=e.attributes;var r={};for(var a=0,s=i.length;a<s;++a){if(i[a].name=="numberOfRecordsMatched"||i[a].name=="numberOfRecordsReturned"||i[a].name=="nextRecord"){r[i[a].name]=parseInt(i[a].nodeValue)}else{r[i[a].name]=i[a].nodeValue}}t.SearchResults=r},SummaryRecord:function(e,t){var i={type:"SummaryRecord"};this.readChildNodes(e,i);t.records.push(i)},BriefRecord:function(e,t){var i={type:"BriefRecord"};this.readChildNodes(e,i);t.records.push(i)},DCMIRecord:function(e,t){var i={type:"DCMIRecord"};this.readChildNodes(e,i);t.records.push(i)},Record:function(e,t){var i={type:"Record"};this.readChildNodes(e,i);t.records.push(i)},"*":function(e,t){var i=e.localName||e.nodeName.split(":").pop();t[i]=this.getChildValue(e)}},geonet:{info:function(e,t){var i={};this.readChildNodes(e,i);t.gninfo=i}},dc:{"*":function(e,t){var i=e.localName||e.nodeName.split(":").pop();if(!OpenLayers.Util.isArray(t[i])){t[i]=[]}var r={};var a=e.attributes;for(var s=0,n=a.length;s<n;++s){r[a[s].name]=a[s].nodeValue}r.value=this.getChildValue(e);if(r.value!=""){t[i].push(r)}}},dct:{"*":function(e,t){var i=e.localName||e.nodeName.split(":").pop();if(!OpenLayers.Util.isArray(t[i])){t[i]=[]}t[i].push(this.getChildValue(e))}},ows:OpenLayers.Util.applyDefaults({BoundingBox:function(e,t){if(t.bounds){t.BoundingBox=[{crs:t.projection,value:[t.bounds.left,t.bounds.bottom,t.bounds.right,t.bounds.top]}];delete t.projection;delete t.bounds}OpenLayers.Format.OWSCommon.v1_0_0.prototype.readers["ows"]["BoundingBox"].apply(this,arguments)}},OpenLayers.Format.OWSCommon.v1_0_0.prototype.readers["ows"])},write:function(e){var t=this.writeNode("csw:GetRecords",e);this.setAttributeNS(t,this.namespaces.xmlns,"xmlns:gmd",this.namespaces.gmd);return OpenLayers.Format.XML.prototype.write.apply(this,[t])},writers:{csw:{GetRecords:function(e){if(!e){e={}}var t=this.createElementNSPlus("csw:GetRecords",{attributes:{service:"CSW",version:this.version,requestId:e.requestId||this.requestId,resultType:e.resultType||this.resultType,outputFormat:e.outputFormat||this.outputFormat,outputSchema:e.outputSchema||this.outputSchema,startPosition:e.startPosition||this.startPosition,maxRecords:e.maxRecords||this.maxRecords}});if(e.DistributedSearch||this.DistributedSearch){this.writeNode("csw:DistributedSearch",e.DistributedSearch||this.DistributedSearch,t)}var i=e.ResponseHandler||this.ResponseHandler;if(OpenLayers.Util.isArray(i)&&i.length>0){for(var r=0,a=i.length;r<a;r++){this.writeNode("csw:ResponseHandler",i[r],t)}}this.writeNode("Query",e.Query||this.Query,t);return t},DistributedSearch:function(e){var t=this.createElementNSPlus("csw:DistributedSearch",{attributes:{hopCount:e.hopCount}});return t},ResponseHandler:function(e){var t=this.createElementNSPlus("csw:ResponseHandler",{value:e.value});return t},Query:function(e){if(!e){e={}}var t=this.createElementNSPlus("csw:Query",{attributes:{typeNames:e.typeNames||"csw:Record"}});var i=e.ElementName;if(OpenLayers.Util.isArray(i)&&i.length>0){for(var r=0,a=i.length;r<a;r++){this.writeNode("csw:ElementName",i[r],t)}}else{this.writeNode("csw:ElementSetName",e.ElementSetName||{value:"summary"},t)}if(e.Constraint){this.writeNode("csw:Constraint",e.Constraint,t)}if(e.SortBy){this.writeNode("ogc:SortBy",e.SortBy,t)}return t},ElementName:function(e){var t=this.createElementNSPlus("csw:ElementName",{value:e.value});return t},ElementSetName:function(e){var t=this.createElementNSPlus("csw:ElementSetName",{attributes:{typeNames:e.typeNames},value:e.value});return t},Constraint:function(e){var t=this.createElementNSPlus("csw:Constraint",{attributes:{version:e.version}});if(e.Filter){var i=new OpenLayers.Format.Filter({version:e.version});t.appendChild(i.write(e.Filter))}else if(e.CqlText){var r=this.createElementNSPlus("CqlText",{value:e.CqlText.value});t.appendChild(r)}return t}},ogc:OpenLayers.Format.Filter.v1_1_0.prototype.writers["ogc"]},CLASS_NAME:"OpenLayers.Format.CSWGetRecords.v2_0_2"});Ext.namespace("GeoExt.data");GeoExt.data.CSWRecordsReader=function(e,t){e=e||{};if(!e.format){e.format=new OpenLayers.Format.CSWGetRecords}if(!e.root){e.root="records"}GeoExt.data.CSWRecordsReader.superclass.constructor.call(this,e,t)};Ext.extend(GeoExt.data.CSWRecordsReader,Ext.data.JsonReader,{read:function(e){var t=e.data;if(!t){t=e.responseXML;if(!t||!t.documentElement){t=e.responseText}}return this.readRecords(t)},readRecords:function(e){if(typeof e==="string"||e.nodeType){e=this.meta.format.read(e)}if(e.success===false){throw new Ext.data.DataReader.Error("invalid-response",e)}var t=GeoExt.data.CSWRecordsReader.superclass.readRecords.call(this,e);Ext.each(t.records,function(e){for(var t in e.data){var i=e.data[t];if(i instanceof Array){for(var r=0,a=i.length;r<a;++r){if(i[r]instanceof Object){var s=0;for(var n in i[r]){if(i[r].hasOwnProperty(n)){s++}}if(s===1&&i[r].value){i[r]=i[r].value}}}}}});if(e.SearchResults){t.totalRecords=e.SearchResults.numberOfRecordsMatched}return t}});OpenLayers.Protocol.CSW=function(e){e=OpenLayers.Util.applyDefaults(e,OpenLayers.Protocol.CSW.DEFAULTS);var t=OpenLayers.Protocol.CSW["v"+e.version.replace(/\./g,"_")];if(!t){throw"Unsupported CSW version: "+e.version}return new t(e)};OpenLayers.Protocol.CSW.DEFAULTS={version:"2.0.2"};OpenLayers.Protocol.CSW.v2_0_2=OpenLayers.Class(OpenLayers.Protocol,{formatOptions:null,initialize:function(e){OpenLayers.Protocol.prototype.initialize.apply(this,[e]);if(!e.format){this.format=new OpenLayers.Format.CSWGetRecords.v2_0_2(OpenLayers.Util.extend({},this.formatOptions))}},destroy:function(){if(this.options&&!this.options.format){this.format.destroy()}this.format=null;OpenLayers.Protocol.prototype.destroy.apply(this)},read:function(e){e=OpenLayers.Util.extend({},e);OpenLayers.Util.applyDefaults(e,this.options||{});var t=new OpenLayers.Protocol.Response({requestType:"read"});var i=this.format.write(e.params||e);t.priv=OpenLayers.Request.POST({url:e.url,callback:this.createCallback(this.handleRead,t,e),params:e.params,headers:e.headers,data:i});return t},handleRead:function(e,t){if(t.callback){var i=e.priv;if(i.status>=200&&i.status<300){e.data=this.parseData(i);e.code=OpenLayers.Protocol.Response.SUCCESS}else{e.code=OpenLayers.Protocol.Response.FAILURE}t.callback.call(t.scope,e)}},parseData:function(e){var t=e.responseXML;if(!t||!t.documentElement){t=e.responseText}if(!t||t.length<=0){return null}return this.format.read(t)},CLASS_NAME:"OpenLayers.Protocol.CSW.v2_0_2"});Ext.namespace("gxp.plugins");gxp.plugins.CSWCatalogueSource=Ext.extend(gxp.plugins.CatalogueSource,{ptype:"gxp_cataloguesource",createStore:function(){this.store=new Ext.data.Store({proxy:new GeoExt.data.ProtocolProxy(Ext.apply({setParamsAsOptions:true,protocol:new OpenLayers.Protocol.CSW({url:this.url})},this.proxyOptions||{})),reader:new GeoExt.data.CSWRecordsReader({fields:["title","abstract","URI","bounds","projection","references"]})});gxp.plugins.LayerSource.prototype.createStore.apply(this,arguments)},getPagingStart:function(){return 1},getPagingParamNames:function(){return{start:"startPosition",limit:"maxRecords"}},getFullFilter:function(e,t){var i=[];if(e!==undefined){i.push(e)}i=i.concat(t);if(i.length<=1){return i[0]}else{return new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,filters:i})}},filter:function(e){var t=undefined;if(e.queryString!==""){t=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LIKE,matchCase:false,property:"csw:AnyText",value:"*"+e.queryString+"*"})}var i={resultType:"results",maxRecords:e.limit,Query:{typeNames:"gmd:MD_Metadata",ElementSetName:{value:"full"}}};var r=this.getFullFilter(t,e.filters);if(r!==undefined){Ext.apply(i.Query,{Constraint:{version:"1.1.0",Filter:r}})}Ext.apply(this.store.baseParams,i);this.store.load()}});Ext.preg(gxp.plugins.CSWCatalogueSource.prototype.ptype,gxp.plugins.CSWCatalogueSource);Ext.namespace("gxp.plugins");gxp.plugins.QueryForm=Ext.extend(gxp.plugins.Tool,{ptype:"gxp_queryform",featureManager:null,autoHide:false,schema:null,queryActionText:gettext("Query"),cancelButtonText:gettext("Cancel"),queryMenuText:gettext("Query layer"),queryActionTip:gettext("Query the selected layer"),queryByLocationText:gettext("Query by current map extent"),queryByAttributesText:gettext("Query by attributes"),queryMsg:"Querying...",noFeaturesTitle:gettext("No Match"),noFeaturesMessage:gettext("Your query did not return any results."),outputAction:0,autoExpand:null,addActions:function(e){if(!this.initialConfig.actions&&!e){e=[{text:this.queryActionText,menuText:this.queryMenuText,iconCls:"gxp-icon-find",tooltip:this.queryActionTip,disabled:true,toggleGroup:this.toggleGroup,enableToggle:true,allowDepress:true,toggleHandler:function(e,t){if(this.autoExpand&&this.output.length>0){var i=Ext.getCmp(this.autoExpand);i[t?"expand":"collapse"]();if(t){i.expand();if(i.ownerCt&&i.ownerCt instanceof Ext.Panel){i.ownerCt.expand()}}else{this.target.tools[this.featureManager].loadFeatures()}}},scope:this}]}this.actions=gxp.plugins.QueryForm.superclass.addActions.apply(this,e);if(this.actionTarget!==null&&this.actions){this.target.tools[this.featureManager].on("layerchange",function(e,t,i){for(var r=this.actions.length-1;r>=0;--r){this.actions[r].setDisabled(!i)}},this)}},addOutput:function(e){var i=this.target.tools[this.featureManager];e=Ext.apply({border:false,bodyStyle:"padding: 10px",layout:"form",width:320,autoScroll:true,items:[{xtype:"fieldset",ref:"spatialFieldset",title:this.queryByLocationText,anchor:"97%",style:"margin-bottom:0; border-left-color:transparent; border-right-color:transparent; border-width:1px 1px 0 1px; padding-bottom:0",checkboxToggle:true},{xtype:"fieldset",ref:"attributeFieldset",title:this.queryByAttributesText,anchor:"97%",style:"margin-bottom:0",checkboxToggle:true}],bbar:["->",{text:this.cancelButtonText,iconCls:"cancel",handler:function(){var e=this.outputTarget?r.ownerCt:r.ownerCt.ownerCt;if(e&&e instanceof Ext.Window){e.hide()}n(i,i.layerRecord,i.schema);i.loadFeatures()}},{text:this.queryActionText,iconCls:"gxp-icon-find",handler:function(){var e=[];if(r.spatialFieldset.collapsed!==true){e.push(new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.BBOX,property:i.featureStore.geometryName,value:this.target.mapPanel.map.getExtent()}))}if(r.attributeFieldset.collapsed!==true){var t=r.filterBuilder.getFilter();t&&e.push(t)}i.loadFeatures(e.length>1?new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,filters:e}):e[0])},scope:this}]},e||{});var r=gxp.plugins.QueryForm.superclass.addOutput.call(this,e);var a=null,s=true;if(this.autoExpand){a=Ext.getCmp(this.autoExpand);function t(){if(s){a.un("expand",t);a.un("collapse",t);a=null}s=true}a.on({expand:t,collapse:t})}var n=function(e,t,i){r.attributeFieldset.removeAll();r.setDisabled(!i);if(a){s=false;a[i?"expand":"collapse"]();if(i&&a&&a.ownerCt&&a.ownerCt instanceof Ext.Panel){a.ownerCt.expand()}}if(i){r.attributeFieldset.add({xtype:"gxp_filterbuilder",ref:"../filterBuilder",attributes:i,allowBlank:true,allowGroups:false});r.spatialFieldset.expand();r.attributeFieldset.expand()}else{r.attributeFieldset.rendered&&r.attributeFieldset.collapse();r.spatialFieldset.rendered&&r.spatialFieldset.collapse()}r.attributeFieldset.doLayout()};i.on("layerchange",n);n(i,i.layerRecord,i.schema);i.on({beforequery:function(){new Ext.LoadMask(r.getEl(),{store:i.featureStore,msg:this.queryMsg}).show()},query:function(e,t){if(t){if(this.target.tools[this.featureManager].featureStore!==null){t.getCount()||Ext.Msg.show({title:this.noFeaturesTitle,msg:this.noFeaturesMessage,buttons:Ext.Msg.OK,icon:Ext.Msg.INFO});if(this.autoHide){var i=this.outputTarget?r.ownerCt:r.ownerCt.ownerCt;i instanceof Ext.Window&&i.hide()}}}},scope:this});return r}});Ext.preg(gxp.plugins.QueryForm.prototype.ptype,gxp.plugins.QueryForm);Ext.namespace("GeoExt.data");GeoExt.data.WMSDescribeLayerReader=function(e,t){e=e||{};if(!e.format){e.format=new OpenLayers.Format.WMSDescribeLayer}if(!(typeof t==="function")){t=Ext.data.Record.create(t||e.fields||[{name:"owsType",type:"string"},{name:"owsURL",type:"string"},{name:"typeName",type:"string"}])}GeoExt.data.WMSDescribeLayerReader.superclass.constructor.call(this,e,t)};Ext.extend(GeoExt.data.WMSDescribeLayerReader,Ext.data.DataReader,{read:function(e){var t=e.responseXML;if(!t||!t.documentElement){t=e.responseText}return this.readRecords(t)},readRecords:function(e){if(typeof e==="string"||e.nodeType){e=this.meta.format.read(e)}if(!!e.error){throw new Ext.data.DataReader.Error("invalid-response",e.error)}var t=[],i;for(var r=0,a=e.length;r<a;r++){i=e[r];if(i){t.push(new this.recordType(i))}}return{totalRecords:t.length,success:true,records:t}}});OpenLayers.Format.WMSCapabilities.v1_1_1_WMSC=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1_1_1,{version:"1.1.1",profile:"WMSC",readers:{wms:OpenLayers.Util.applyDefaults({VendorSpecificCapabilities:function(e,t){t.vendorSpecific={tileSets:[]};this.readChildNodes(e,t.vendorSpecific)},TileSet:function(e,t){var i={srs:{},bbox:{},resolutions:[]};this.readChildNodes(e,i);t.tileSets.push(i)},Resolutions:function(e,t){var i=this.getChildValue(e).split(" ");for(var r=0,a=i.length;r<a;r++){if(i[r]!=""){t.resolutions.push(parseFloat(i[r]))}}},Width:function(e,t){t.width=parseInt(this.getChildValue(e))},Height:function(e,t){t.height=parseInt(this.getChildValue(e))},Layers:function(e,t){t.layers=this.getChildValue(e)},Styles:function(e,t){t.styles=this.getChildValue(e)}},OpenLayers.Format.WMSCapabilities.v1_1_1.prototype.readers["wms"])},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_1_1_WMSC"});Ext.namespace("gxp.plugins");gxp.plugins.WMSCSource=Ext.extend(gxp.plugins.WMSSource,{ptype:"gxp_wmscsource",version:"1.1.1",constructor:function(e){e.baseParams={SERVICE:"WMS",REQUEST:"GetCapabilities",TILED:true};if(!e.format){this.format=new OpenLayers.Format.WMSCapabilities({keepData:true,profile:"WMSC",allowFallback:true})}gxp.plugins.WMSCSource.superclass.constructor.apply(this,arguments)},createLayerRecord:function(e){var t=gxp.plugins.WMSCSource.superclass.createLayerRecord.apply(this,arguments);if(!t){return}var i,r;if(this.store.reader.raw){i=this.store.reader.raw.capability}var a=i&&i.vendorSpecific?i.vendorSpecific.tileSets:e.capability&&e.capability.tileSets;var s=t.get("layer");if(a){var p=this.getProjection(t)||this.getMapProjection();for(var n=0,u=a.length;n<u;n++){var o=a[n];if(o.layers===s.params.LAYERS){var l;for(r in o.srs){l=new OpenLayers.Projection(r);break}if(p.equals(l)){var c=o.bbox[r].bbox;s.projection=l;s.addOptions({resolutions:o.resolutions,tileSize:new OpenLayers.Size(o.width,o.height),tileOrigin:new OpenLayers.LonLat(c[0],c[1])});break}}}}else if(this.lazy){var d=e.tileSize,f=e.tileOrigin;s.addOptions({resolutions:e.resolutions,tileSize:d?new OpenLayers.Size(d[0],d[1]):undefined,tileOrigin:f?OpenLayers.LonLat.fromArray(f):undefined});if(!f){var h;if(this.target.map.maxExtent){h=this.target.map.maxExtent}else{r=e.srs||this.target.map.projection;h=OpenLayers.Projection.defaults[r].maxExtent}if(h){s.tileOrigin=OpenLayers.LonLat.fromArray(h)}}}s.params.TILED=e.cached!==false&&true;return t},getConfigForRecord:function(e){var t=gxp.plugins.WMSCSource.superclass.getConfigForRecord.apply(this,arguments),i=t.name,r,a=e.getLayer();if(t.capability&&this.store.reader.raw){var s=this.store.reader.raw.capability;var n=s.vendorSpecific&&s.vendorSpecific.tileSets;if(n){for(var o=n.length-1;o>=0;--o){r=n[o];if(r.layers===i&&r.srs[a.projection]){t.capability.tileSets=[r];break}}}}if(!(t.capability&&t.capability.tileSets)){var l=a.options.tileSize;if(l){t.tileSize=[l.w,l.h]}t.tileOrigin=a.options.tileOrigin;t.resolutions=a.options.resolutions}return Ext.applyIf(t,{cached:!!a.params.TILED})}});Ext.preg(gxp.plugins.WMSCSource.prototype.ptype,gxp.plugins.WMSCSource);Ext.namespace("gxp.plugins");gxp.plugins.ZoomToExtent=Ext.extend(gxp.plugins.Tool,{ptype:"gxp_zoomtoextent",menuText:gettext("Zoom To Max Extent"),tooltip:gettext("Zoom To Max Extent"),extent:null,closest:true,iconCls:"gxp-icon-zoomtoextent",closest:true,constructor:function(e){gxp.plugins.ZoomToExtent.superclass.constructor.apply(this,arguments);if(this.extent instanceof Array){this.extent=OpenLayers.Bounds.fromArray(this.extent)}},addActions:function(){return gxp.plugins.ZoomToExtent.superclass.addActions.apply(this,[{text:this.buttonText,menuText:this.menuText,iconCls:this.iconCls,tooltip:this.tooltip,handler:function(){var e=this.target.mapPanel.map;var t=typeof this.extent=="function"?this.extent():this.extent;if(!t){var i,r;for(var a=0,s=e.layers.length;a<s;++a){i=e.layers[a];if(i.getVisibility()){r=i.restrictedExtent||i.maxExtent;if(t){t.extend(r)}else if(r){t=r.clone()}}}}if(t){var n=e.restrictedExtent||e.maxExtent;if(n){t=new OpenLayers.Bounds(Math.max(t.left,n.left),Math.max(t.bottom,n.bottom),Math.min(t.right,n.right),Math.min(t.top,n.top))}e.zoomToExtent(t,this.closest)}},scope:this}])}});Ext.preg(gxp.plugins.ZoomToExtent.prototype.ptype,gxp.plugins.ZoomToExtent);OpenLayers.Control.NavigationHistory=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOGGLE,previous:null,previousOptions:null,next:null,nextOptions:null,limit:50,autoActivate:true,clearOnDeactivate:false,registry:null,nextStack:null,previousStack:null,listeners:null,restoring:false,initialize:function(e){OpenLayers.Control.prototype.initialize.apply(this,[e]);this.registry=OpenLayers.Util.extend({moveend:this.getState},this.registry);var t={trigger:OpenLayers.Function.bind(this.previousTrigger,this),displayClass:this.displayClass+" "+this.displayClass+"Previous"};OpenLayers.Util.extend(t,this.previousOptions);this.previous=new OpenLayers.Control.Button(t);var i={trigger:OpenLayers.Function.bind(this.nextTrigger,this),displayClass:this.displayClass+" "+this.displayClass+"Next"};OpenLayers.Util.extend(i,this.nextOptions);this.next=new OpenLayers.Control.Button(i);this.clear()},onPreviousChange:function(e,t){if(e&&!this.previous.active){this.previous.activate()}else if(!e&&this.previous.active){this.previous.deactivate()}},onNextChange:function(e,t){if(e&&!this.next.active){this.next.activate()}else if(!e&&this.next.active){this.next.deactivate()}},destroy:function(){OpenLayers.Control.prototype.destroy.apply(this);this.previous.destroy();this.next.destroy();this.deactivate();for(var e in this){this[e]=null}},setMap:function(e){this.map=e;this.next.setMap(e);this.previous.setMap(e)},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);this.next.draw();this.previous.draw()},previousTrigger:function(){var e=this.previousStack.shift();var t=this.previousStack.shift();if(t!=undefined){this.nextStack.unshift(e);this.previousStack.unshift(t);this.restoring=true;this.restore(t);this.restoring=false;this.onNextChange(this.nextStack[0],this.nextStack.length);this.onPreviousChange(this.previousStack[1],this.previousStack.length-1)}else{this.previousStack.unshift(e)}return t},nextTrigger:function(){var e=this.nextStack.shift();if(e!=undefined){this.previousStack.unshift(e);this.restoring=true;this.restore(e);this.restoring=false;this.onNextChange(this.nextStack[0],this.nextStack.length);this.onPreviousChange(this.previousStack[1],this.previousStack.length-1)}return e},clear:function(){this.previousStack=[];this.previous.deactivate();this.nextStack=[];this.next.deactivate()},getState:function(){return{center:this.map.getCenter(),resolution:this.map.getResolution(),projection:this.map.getProjectionObject(),units:this.map.getProjectionObject().getUnits()||this.map.units||this.map.baseLayer.units}},restore:function(e){var t,i;if(this.map.getProjectionObject()==e.projection){i=this.map.getZoomForResolution(e.resolution);t=e.center}else{t=e.center.clone();t.transform(e.projection,this.map.getProjectionObject());var r=e.units;var a=this.map.getProjectionObject().getUnits()||this.map.units||this.map.baseLayer.units;var s=r&&a?OpenLayers.INCHES_PER_UNIT[r]/OpenLayers.INCHES_PER_UNIT[a]:1;i=this.map.getZoomForResolution(s*e.resolution)}this.map.setCenter(t,i)},setListeners:function(){this.listeners={};for(var t in this.registry){this.listeners[t]=OpenLayers.Function.bind(function(){if(!this.restoring){var e=this.registry[t].apply(this,arguments);this.previousStack.unshift(e);if(this.previousStack.length>1){this.onPreviousChange(this.previousStack[1],this.previousStack.length-1)}if(this.previousStack.length>this.limit+1){this.previousStack.pop()}if(this.nextStack.length>0){this.nextStack=[];this.onNextChange(null,0)}}return true},this)}},activate:function(){var e=false;if(this.map){if(OpenLayers.Control.prototype.activate.apply(this)){if(this.listeners==null){this.setListeners()}for(var t in this.listeners){this.map.events.register(t,this,this.listeners[t])}e=true;if(this.previousStack.length==0){this.initStack()}}}return e},initStack:function(){if(this.map.getCenter()){this.listeners.moveend()}},deactivate:function(){var e=false;if(this.map){if(OpenLayers.Control.prototype.deactivate.apply(this)){for(var t in this.listeners){this.map.events.unregister(t,this,this.listeners[t])}if(this.clearOnDeactivate){this.clear()}e=true}}return e},CLASS_NAME:"OpenLayers.Control.NavigationHistory"});Ext.namespace("gxp.plugins");gxp.plugins.NavigationHistory=Ext.extend(gxp.plugins.Tool,{ptype:"gxp_navigationhistory",previousMenuText:gettext("Zoom To Previous Extent"),nextMenuText:gettext("Zoom To Next Extent"),previousTooltip:gettext("Zoom To Previous Extent"),nextTooltip:gettext("Zoom To Next Extent"),constructor:function(e){gxp.plugins.NavigationHistory.superclass.constructor.apply(this,arguments)},addActions:function(){var e=new OpenLayers.Control.NavigationHistory;this.target.mapPanel.map.addControl(e);var t=[new GeoExt.Action({menuText:this.previousMenuText,iconCls:"gxp-icon-zoom-previous",tooltip:this.previousTooltip,disabled:true,control:e.previous}),new GeoExt.Action({menuText:this.nextMenuText,iconCls:"gxp-icon-zoom-next",tooltip:this.nextTooltip,disabled:true,control:e.next})];return gxp.plugins.NavigationHistory.superclass.addActions.apply(this,[t])}});Ext.preg(gxp.plugins.NavigationHistory.prototype.ptype,gxp.plugins.NavigationHistory);Ext.namespace("gxp.plugins");gxp.plugins.Zoom=Ext.extend(gxp.plugins.Tool,{ptype:"gxp_zoom",zoomMenuText:gettext("Zoom Box"),zoomInMenuText:gettext("Zoom In"),zoomOutMenuText:gettext("Zoom Out"),zoomTooltip:gettext("Zoom by dragging a box"),zoomInTooltip:gettext("Zoom in"),zoomOutTooltip:gettext("Zoom out"),constructor:function(e){gxp.plugins.Zoom.superclass.constructor.apply(this,arguments)},addActions:function(){var e=[{menuText:this.zoomInMenuText,iconCls:"gxp-icon-zoom-in",tooltip:this.zoomInTooltip,handler:function(){this.target.mapPanel.map.zoomIn()},scope:this},{menuText:this.zoomOutMenuText,iconCls:"gxp-icon-zoom-out",tooltip:this.zoomOutTooltip,handler:function(){this.target.mapPanel.map.zoomOut()},scope:this}];if(this.showZoomBoxAction){e.unshift(new GeoExt.Action({menuText:this.zoomText,iconCls:"gxp-icon-zoom",tooltip:this.zoomTooltip,control:new OpenLayers.Control.ZoomBox(this.controlOptions),map:this.target.mapPanel.map,enableToggle:true,allowDepress:false,toggleGroup:this.toggleGroup}))}return gxp.plugins.Zoom.superclass.addActions.apply(this,[e])}});Ext.preg(gxp.plugins.Zoom.prototype.ptype,gxp.plugins.Zoom);OpenLayers.Control.Measure=OpenLayers.Class(OpenLayers.Control,{callbacks:null,displaySystem:"metric",geodesic:false,displaySystemUnits:{geographic:["dd"],english:["mi","ft","in"],metric:["km","m"]},partialDelay:300,delayedTrigger:null,persist:false,immediate:false,initialize:function(e,t){OpenLayers.Control.prototype.initialize.apply(this,[t]);var i={done:this.measureComplete,point:this.measurePartial};if(this.immediate){i.modify=this.measureImmediate}this.callbacks=OpenLayers.Util.extend(i,this.callbacks);this.handlerOptions=OpenLayers.Util.extend({persist:this.persist},this.handlerOptions);this.handler=new e(this,this.callbacks,this.handlerOptions)},deactivate:function(){this.cancelDelay();return OpenLayers.Control.prototype.deactivate.apply(this,arguments)},cancel:function(){this.cancelDelay();this.handler.cancel()},setImmediate:function(e){this.immediate=e;if(this.immediate){this.callbacks.modify=this.measureImmediate}else{delete this.callbacks.modify}},updateHandler:function(e,t){var i=this.active;if(i){this.deactivate()}this.handler=new e(this,this.callbacks,t);if(i){this.activate()}},measureComplete:function(e){this.cancelDelay();this.measure(e,"measure")},measurePartial:function(e,t){this.cancelDelay();t=t.clone();if(this.handler.freehandMode(this.handler.evt)){this.measure(t,"measurepartial")}else{this.delayedTrigger=window.setTimeout(OpenLayers.Function.bind(function(){this.delayedTrigger=null;this.measure(t,"measurepartial")},this),this.partialDelay)}},measureImmediate:function(e,t,i){if(i&&!this.handler.freehandMode(this.handler.evt)){this.cancelDelay();this.measure(t.geometry,"measurepartial")}},cancelDelay:function(){if(this.delayedTrigger!==null){window.clearTimeout(this.delayedTrigger);this.delayedTrigger=null}},measure:function(e,t){var i,r;if(e.CLASS_NAME.indexOf("LineString")>-1){i=this.getBestLength(e);r=1}else{i=this.getBestArea(e);r=2}this.events.triggerEvent(t,{measure:i[0],units:i[1],order:r,geometry:e})},getBestArea:function(e){var t=this.displaySystemUnits[this.displaySystem];var i,r;for(var a=0,s=t.length;a<s;++a){i=t[a];r=this.getArea(e,i);if(r>1){break}}return[r,i]},getArea:function(e,t){var i,r;if(this.geodesic){i=e.getGeodesicArea(this.map.getProjectionObject());r="m"}else{i=e.getArea();r=this.map.getUnits()}var a=OpenLayers.INCHES_PER_UNIT[t];if(a){var s=OpenLayers.INCHES_PER_UNIT[r];i*=Math.pow(s/a,2)}return i},getBestLength:function(e){var t=this.displaySystemUnits[this.displaySystem];var i,r;for(var a=0,s=t.length;a<s;++a){i=t[a];r=this.getLength(e,i);if(r>1){break}}return[r,i]},getLength:function(e,t){var i,r;if(this.geodesic){i=e.getGeodesicLength(this.map.getProjectionObject());r="m"}else{i=e.getLength();r=this.map.getUnits()}var a=OpenLayers.INCHES_PER_UNIT[t];if(a){var s=OpenLayers.INCHES_PER_UNIT[r];i*=s/a}return i},CLASS_NAME:"OpenLayers.Control.Measure"});Ext.namespace("gxp.plugins");gxp.plugins.Measure=Ext.extend(gxp.plugins.Tool,{ptype:"gxp_measure",outputTarget:"map",buttonText:gettext("Measure"),lengthMenuText:gettext("Length"),areaMenuText:gettext("Area"),lengthTooltip:gettext("Measure length"),areaTooltip:gettext("Measure area"),measureTooltip:gettext("Measure"),constructor:function(e){gxp.plugins.Measure.superclass.constructor.apply(this,arguments)},destroy:function(){this.button=null;gxp.plugins.Measure.superclass.destroy.apply(this,arguments)},createMeasureControl:function(e,r){var t=new OpenLayers.StyleMap({default:new OpenLayers.Style(null,{rules:[new OpenLayers.Rule({symbolizer:{Point:{pointRadius:4,graphicName:"square",fillColor:"white",fillOpacity:1,strokeWidth:1,strokeOpacity:1,strokeColor:"#333333"},Line:{strokeWidth:3,strokeOpacity:1,strokeColor:"#666666",strokeDashstyle:"dash"},Polygon:{strokeWidth:2,strokeOpacity:1,strokeColor:"#666666",fillColor:"white",fillOpacity:.3}}})]})});var a=function(){if(n){n.destroy()}};var s=function(e){var t=e.measure;var i=e.units;o.displaySystem="english";var r=e.geometry.CLASS_NAME.indexOf("LineString")>-1?o.getBestLength(e.geometry):o.getBestArea(e.geometry);var a=r[0];var s=r[1];o.displaySystem="metric";var n=e.order==2?"<sup>2</sup>":"";return t.toFixed(2)+" "+i+n+"<br>"+a.toFixed(2)+" "+s+n};var n;var i=Ext.apply({},this.initialConfig.controlOptions);Ext.applyIf(i,{geodesic:true,persist:true,handlerOptions:{layerOptions:{styleMap:t}},eventListeners:{measurepartial:function(e){a();n=this.addOutput({xtype:"tooltip",html:s(e),title:r,autoHide:false,closable:true,draggable:false,mouseOffset:[0,0],showDelay:1,listeners:{hide:a}});if(e.measure>0){var t=o.handler.lastUp;var i=this.target.mapPanel.getPosition();n.targetXY=[i[0]+t.x,i[1]+t.y];n.show()}},deactivate:a,scope:this}});var o=new OpenLayers.Control.Measure(e,i);return o},addActions:function(){this.activeIndex=0;this.button=new Ext.SplitButton({iconCls:"gxp-icon-measure-length",tooltip:this.measureTooltip,buttonText:this.buttonText,enableToggle:true,toggleGroup:this.toggleGroup,allowDepress:true,handler:function(e,t){if(e.pressed){e.menu.items.itemAt(this.activeIndex).setChecked(true)}},scope:this,listeners:{toggle:function(e,t){if(!t){e.menu.items.each(function(e){e.setChecked(false)})}},render:function(e){Ext.ButtonToggleMgr.register(e)}},menu:new Ext.menu.Menu({items:[new Ext.menu.CheckItem(new GeoExt.Action({text:this.lengthMenuText,iconCls:"gxp-icon-measure-length",toggleGroup:this.toggleGroup,group:this.toggleGroup,listeners:{checkchange:function(e,t){this.activeIndex=0;this.button.toggle(t);if(t){this.button.setIconClass(e.iconCls)}},scope:this},map:this.target.mapPanel.map,control:this.createMeasureControl(OpenLayers.Handler.Path,this.lengthTooltip)})),new Ext.menu.CheckItem(new GeoExt.Action({text:this.areaMenuText,iconCls:"gxp-icon-measure-area",toggleGroup:this.toggleGroup,group:this.toggleGroup,allowDepress:false,listeners:{checkchange:function(e,t){this.activeIndex=1;this.button.toggle(t);if(t){this.button.setIconClass(e.iconCls)}},scope:this},map:this.target.mapPanel.map,control:this.createMeasureControl(OpenLayers.Handler.Polygon,this.areaTooltip)}))]})});return gxp.plugins.Measure.superclass.addActions.apply(this,[this.button])}});Ext.preg(gxp.plugins.Measure.prototype.ptype,gxp.plugins.Measure);OpenLayers.Handler.Hover=OpenLayers.Class(OpenLayers.Handler,{delay:500,pixelTolerance:null,stopMove:false,px:null,timerId:null,mousemove:function(e){if(this.passesTolerance(e.xy)){this.clearTimer();this.callback("move",[e]);this.px=e.xy;e=OpenLayers.Util.extend({},e);this.timerId=window.setTimeout(OpenLayers.Function.bind(this.delayedCall,this,e),this.delay)}return!this.stopMove},mouseout:function(e){if(OpenLayers.Util.mouseLeft(e,this.map.viewPortDiv)){this.clearTimer();this.callback("move",[e])}return true},passesTolerance:function(e){var t=true;if(this.pixelTolerance&&this.px){var i=Math.sqrt(Math.pow(this.px.x-e.x,2)+Math.pow(this.px.y-e.y,2));if(i<this.pixelTolerance){t=false}}return t},clearTimer:function(){if(this.timerId!=null){window.clearTimeout(this.timerId);this.timerId=null}},delayedCall:function(e){this.callback("pause",[e])},deactivate:function(){var e=false;if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){this.clearTimer();e=true}return e},CLASS_NAME:"OpenLayers.Handler.Hover"});OpenLayers.Control.WMSGetFeatureInfo=OpenLayers.Class(OpenLayers.Control,{hover:false,drillDown:false,maxFeatures:10,clickCallback:"click",output:"features",layers:null,queryVisible:false,url:null,layerUrls:null,infoFormat:"text/html",vendorParams:{},format:null,formatOptions:null,handler:null,hoverRequest:null,initialize:function(e){e=e||{};e.handlerOptions=e.handlerOptions||{};OpenLayers.Control.prototype.initialize.apply(this,[e]);if(!this.format){this.format=new OpenLayers.Format.WMSGetFeatureInfo(e.formatOptions)}if(this.drillDown===true){this.hover=false}if(this.hover){this.handler=new OpenLayers.Handler.Hover(this,{move:this.cancelHover,pause:this.getInfoForHover},OpenLayers.Util.extend(this.handlerOptions.hover||{},{delay:250}))}else{var t={};t[this.clickCallback]=this.getInfoForClick;this.handler=new OpenLayers.Handler.Click(this,t,this.handlerOptions.click||{})}},getInfoForClick:function(e){this.events.triggerEvent("beforegetfeatureinfo",{xy:e.xy});OpenLayers.Element.addClass(this.map.viewPortDiv,"olCursorWait");this.request(e.xy,{})},getInfoForHover:function(e){this.events.triggerEvent("beforegetfeatureinfo",{xy:e.xy});this.request(e.xy,{hover:true})},cancelHover:function(){if(this.hoverRequest){this.hoverRequest.abort();this.hoverRequest=null}},findLayers:function(){var e=this.layers||this.map.layers;var t=[];var i,r;for(var a=e.length-1;a>=0;--a){i=e[a];if(i instanceof OpenLayers.Layer.WMS&&(!this.queryVisible||i.getVisibility())){r=OpenLayers.Util.isArray(i.url)?i.url[0]:i.url;if(this.drillDown===false&&!this.url){this.url=r}if(this.drillDown===true||this.urlMatches(r)){t.push(i)}}}return t},urlMatches:function(e){var t=OpenLayers.Util.isEquivalentUrl(this.url,e);if(!t&&this.layerUrls){for(var i=0,r=this.layerUrls.length;i<r;++i){if(OpenLayers.Util.isEquivalentUrl(this.layerUrls[i],e)){t=true;break}}}return t},buildWMSOptions:function(t,e,i,p){t=OpenLayers.Util.isArray(t)?t[0]:t;var r=[],a=[];for(var s=0,u=e.length;s<u;s++){if(e[s].params.LAYERS!=null){r=r.concat(e[s].params.LAYERS);a=a.concat(this.getStyleNames(e[s]))}}var n=e[0];var o=this.map.getProjection();var l=n.projection;if(l&&l.equals(this.map.getProjectionObject())){o=l.getCode()}var h=OpenLayers.Util.extend({service:"WMS",version:n.params.VERSION,request:"GetFeatureInfo",exceptions:n.params.EXCEPTIONS,bbox:this.map.getExtent().toBBOX(null,n.reverseAxisOrder()),feature_count:this.maxFeatures,height:this.map.getSize().h,width:this.map.getSize().w,format:p,info_format:n.params.INFO_FORMAT||this.infoFormat},parseFloat(n.params.VERSION)>=1.3?{crs:o,i:parseInt(i.x),j:parseInt(i.y)}:{srs:o,x:parseInt(i.x),y:parseInt(i.y)});if(r.length!=0){h=OpenLayers.Util.extend({layers:r,query_layers:r,styles:a},h)}OpenLayers.Util.applyDefaults(h,this.vendorParams);return{url:t,params:OpenLayers.Util.upperCaseObject(h),callback:function(e){this.handleResponse(i,e,t)},scope:this}},getStyleNames:function(e){var t;if(e.params.STYLES){t=e.params.STYLES}else{if(OpenLayers.Util.isArray(e.params.LAYERS)){t=new Array(e.params.LAYERS.length)}else{t=e.params.LAYERS.replace(/[^,]/g,"")}}return t},request:function(e,t){var i=this.findLayers();if(i.length==0){this.events.triggerEvent("nogetfeatureinfo");OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait");return}t=t||{};if(this.drillDown===false){var r=this.buildWMSOptions(this.url,i,e,i[0].params.FORMAT);var a=OpenLayers.Request.GET(r);if(t.hover===true){this.hoverRequest=a}}else{this._requestCount=0;this._numRequests=0;this.features=[];var s={},n;for(var o=0,l=i.length;o<l;o++){var h=i[o];var p,u=false;n=OpenLayers.Util.isArray(h.url)?h.url[0]:h.url;if(n in s){s[n].push(h)}else{this._numRequests++;s[n]=[h]}}var i;for(var n in s){i=s[n];var r=this.buildWMSOptions(n,i,e,i[0].params.FORMAT);OpenLayers.Request.GET(r)}}},triggerGetFeatureInfo:function(e,t,i){this.events.triggerEvent("getfeatureinfo",{text:e.responseText,features:i,request:e,xy:t});OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait")},handleResponse:function(e,t,i){var r=t.responseXML;if(!r||!r.documentElement){r=t.responseText}var a=this.format.read(r);if(this.drillDown===false){this.triggerGetFeatureInfo(t,e,a)}else{this._requestCount++;if(this.output==="object"){this._features=(this._features||[]).concat({url:i,features:a})}else{this._features=(this._features||[]).concat(a)}if(this._requestCount===this._numRequests){this.triggerGetFeatureInfo(t,e,this._features.concat());delete this._features;delete this._requestCount;delete this._numRequests}}},CLASS_NAME:"OpenLayers.Control.WMSGetFeatureInfo"});Ext.namespace("gxp.plugins");gxp.plugins.WMSGetFeatureInfo=Ext.extend(gxp.plugins.Tool,{ptype:"gxp_wmsgetfeatureinfo",outputTarget:"map",popupCache:null,infoActionTip:gettext("Get Feature Info"),popupTitle:gettext("Feature Info"),buttonText:gettext("Identify"),format:"html",addActions:function(){this.popupCache={};var e=gxp.plugins.WMSGetFeatureInfo.superclass.addActions.call(this,[{tooltip:this.infoActionTip,iconCls:"gxp-icon-getfeatureinfo",buttonText:this.buttonText,toggleGroup:this.toggleGroup,enableToggle:true,allowDepress:true,toggleHandler:function(e,t){for(var i=0,r=h.controls.length;i<r;i++){if(t){h.controls[i].activate()}else{h.controls[i].deactivate()}}}}]);var l=this.actions[0].items[0];var h={controls:[]};var t=function(){var e=this.target.mapPanel.layers.queryBy(function(e){return e.get("queryable")});var o=this.target.mapPanel.map;var t;for(var i=0,r=h.controls.length;i<r;i++){t=h.controls[i];t.deactivate();t.destroy()}h.controls=[];e.each(function(r){var e=r.getLayer();var t=Ext.apply({},this.vendorParams),i;if(this.layerParams){for(var a=this.layerParams.length-1;a>=0;--a){i=this.layerParams[a].toUpperCase();t[i]=e.params[i]}}var s=r.get("infoFormat");if(s===undefined){s=this.format=="html"?"text/html":"application/vnd.ogc.gml"}var n=new OpenLayers.Control.WMSGetFeatureInfo(Ext.applyIf({url:typeof e.url==="string"?e.url:e.url[0],queryVisible:true,layers:[e],infoFormat:s,vendorParams:t,eventListeners:{getfeatureinfo:function(e){var t=r.get("title")||r.get("name");if(s=="text/html"){var i=e.text.match(/<body[^>]*>([\s\S]*)<\/body>/);if(i&&!i[1].match(/^\s*$/)){this.displayPopup(e,t,i[1])}}else if(s=="text/plain"){this.displayPopup(e,t,"<pre>"+e.text+"</pre>")}else if(e.features&&e.features.length>0){this.displayPopup(e,t,null,r.get("getFeatureInfo"))}},scope:this}},this.controlOptions));o.addControl(n);h.controls.push(n);if(l.pressed){n.activate()}},this)};this.target.mapPanel.layers.on("update",t,this);this.target.mapPanel.layers.on("add",t,this);this.target.mapPanel.layers.on("remove",t,this);return e},displayPopup:function(e,t,i,r){var a;var s=e.xy.x+"."+e.xy.y;r=r||{};if(!(s in this.popupCache)){a=this.addOutput({xtype:"gx_popup",title:this.popupTitle,layout:"accordion",fill:false,autoScroll:true,location:e.xy,map:this.target.mapPanel,width:250,height:300,defaults:{layout:"fit",autoScroll:true,autoHeight:true,autoWidth:true,collapsible:true}});a.on({close:function(t){return function(e){delete this.popupCache[t]}}(s),scope:this});this.popupCache[s]=a}else{a=this.popupCache[s]}var p=this.target.mapPanel;var n=e.features,o=[];if(!i&&n){var l;for(var h=0,u=n.length;h<u;++h){l=n[h];o.push(Ext.apply({xtype:"gxp_editorgrid",tbar:["->",{text:gettext("Add to Filter"),iconCls:"gxp-icon-addfeature",handler:function(){var e=new OpenLayers.Feature.Vector(l.geometry.transform(new OpenLayers.Projection("EPSG:4326"),new OpenLayers.Projection("EPSG:900913")),{fid:l.fid});e.attributes={featureid:l.fid,type:"Layer Feature"};p.map.getLayersByName("Filter Layer")[0].addFeatures(e)}}],readOnly:true,listeners:{beforeedit:function(e){return false}},title:l.fid?l.fid:t,feature:l,fields:r.fields,propertyNames:r.propertyNames},this.itemConfig))}}else if(i){o.push(Ext.apply({title:t,html:i},this.itemConfig))}a.add(o);a.doLayout()}});Ext.preg(gxp.plugins.WMSGetFeatureInfo.prototype.ptype,gxp.plugins.WMSGetFeatureInfo);Ext.namespace("gxp.plugins");gxp.plugins.Navigation=Ext.extend(gxp.plugins.Tool,{ptype:"gxp_navigation",menuText:gettext("Pan Map"),tooltip:gettext("Pan Map"),constructor:function(e){gxp.plugins.Navigation.superclass.constructor.apply(this,arguments)},addActions:function(){var e;if(!this.controlOptions){candidates=this.target.mapPanel.map.getControlsByClass("OpenLayers.Control.Navigation");if(candidates.length){e=candidates[0]}}else{this.controlOptions=this.controlOptions||{};Ext.applyIf(this.controlOptions,{dragPanOptions:{enableKinetic:true}});e=new OpenLayers.Control.Navigation(this.controlOptions)}var t=[new GeoExt.Action({tooltip:this.tooltip,menuText:this.menuText,iconCls:"gxp-icon-pan",enableToggle:true,pressed:true,allowDepress:false,control:e,map:e.map?null:this.target.mapPanel.map,toggleGroup:this.toggleGroup})];return gxp.plugins.Navigation.superclass.addActions.apply(this,[t])}});Ext.preg(gxp.plugins.Navigation.prototype.ptype,gxp.plugins.Navigation);Ext.namespace("gxp.plugins");gxp.plugins.LayerTree=Ext.extend(gxp.plugins.Tool,{ptype:"gxp_layertree",shortTitle:gettext("Layers"),rootNodeText:gettext("Layers"),overlayNodeText:gettext("Overlays"),baseNodeText:gettext("Base Layers"),groups:null,defaultGroup:"default",treeNodeUI:null,constructor:function(e){gxp.plugins.LayerTree.superclass.constructor.apply(this,arguments);if(!this.groups){this.groups={default:this.overlayNodeText,background:{title:this.baseNodeText,exclusive:true}}}if(!this.treeNodeUI){this.treeNodeUI=Ext.extend(GeoExt.tree.LayerNodeUI,new GeoExt.tree.TreeNodeUIEventMixin)}},addOutput:function(e){e=Ext.apply(this.createOutputConfig(),e||{});var t=gxp.plugins.LayerTree.superclass.addOutput.call(this,e);t.on({contextmenu:this.handleTreeContextMenu,beforemovenode:this.handleBeforeMoveNode,scope:this});return t},createOutputConfig:function(){var e=new Ext.tree.TreeNode({text:this.rootNodeText,expanded:true,isTarget:false,allowDrop:false});var t;if(this.initialConfig.loader&&this.initialConfig.loader.baseAttrs){t=this.initialConfig.loader.baseAttrs}var i=this.defaultGroup,r=this,a,s;for(var n in this.groups){a=typeof this.groups[n]=="string"?{title:this.groups[n]}:this.groups[n];s=a.exclusive;e.appendChild(new GeoExt.tree.LayerContainer(Ext.apply({text:a.title,iconCls:"gxp-folder",expanded:true,group:n==this.defaultGroup?undefined:n,loader:new GeoExt.tree.LayerLoader({baseAttrs:s?Ext.apply({checkedGroup:Ext.isString(s)?s:n},t):t,store:this.target.mapPanel.layers,filter:function(t){return function(e){return(e.get("group")||i)==t&&e.getLayer().displayInLayerSwitcher==true}}(n),createNode:function(e){r.configureLayerNode(this,e);return GeoExt.tree.LayerLoader.prototype.createNode.apply(this,arguments)}}),singleClickExpand:true,allowDrag:false,listeners:{append:function(e,t){t.expand()}}},a)))}return{xtype:"treepanel",root:e,rootVisible:false,shortTitle:this.shortTitle,border:false,enableDD:true,selModel:new Ext.tree.DefaultSelectionModel({listeners:{beforeselect:this.handleBeforeSelect,scope:this}}),contextMenu:new Ext.menu.Menu({items:[]})}},configureLayerNode:function(e,t){t.uiProvider=this.treeNodeUI;var i=t.layer;var r=t.layerStore;if(i&&r){var a=r.getAt(r.findBy(function(e){return e.getLayer()===i}));if(a){t.qtip=a.get("abstract");if(!a.get("queryable")&&!t.iconCls){t.iconCls="gxp-tree-rasterlayer-icon"}if(a.get("fixed")){t.allowDrag=false}t.listeners={rendernode:function(t){if(a===this.target.selectedLayer){t.select()}this.target.on("layerselectionchange",function(e){if(!this.selectionChanging&&e===a){t.select()}},this)},scope:this}}}},handleBeforeSelect:function(e,t){var i=true;var r=t&&t.layer;var a;if(r){var s=t.layerStore;a=s.getAt(s.findBy(function(e){return e.getLayer()===r}))}this.selectionChanging=true;i=this.target.selectLayer(a);this.selectionChanging=false;return i},handleTreeContextMenu:function(e,t){if(e&&e.layer){e.select();var i=e.getOwnerTree();if(i.getSelectionModel().getSelectedNode()===e){var r=i.contextMenu;r.contextNode=e;r.items.getCount()>0&&r.showAt(t.getXY())}}},handleBeforeMoveNode:function(e,t,i,r,a){if(i!==r){var s=r.loader.store;var n=s.findBy(function(e){return e.getLayer()===t.layer});var o=s.getAt(n);o.set("group",r.attributes.group)}}});Ext.preg(gxp.plugins.LayerTree.prototype.ptype,gxp.plugins.LayerTree);Ext.namespace("GeoExt.plugins");GeoExt.plugins.TreeNodeComponent=Ext.extend(Ext.util.Observable,{constructor:function(e){Ext.apply(this.initialConfig,Ext.apply({},e));Ext.apply(this,e);GeoExt.plugins.TreeNodeComponent.superclass.constructor.apply(this,arguments)},init:function(e){e.on({rendernode:this.onRenderNode,beforedestroy:this.onBeforeDestroy,scope:this})},onRenderNode:function(e){var t=e.rendered;var i=e.attributes;var r=i.component||this.component;if(!t&&r){var a=Ext.DomHelper.append(e.ui.elNode,[{tag:"div"}]);if(typeof r=="function"){r=r(e,a)}else if(typeof r=="object"&&typeof r.fn=="function"){r=r.fn.apply(r.scope,[e,a])}if(typeof r=="object"&&typeof r.xtype=="string"){r=Ext.ComponentMgr.create(r)}if(r instanceof Ext.Component){r.render(a);e.component=r}}},onBeforeDestroy:function(e){e.un("rendernode",this.onRenderNode,this);e.un("beforedestroy",this.onBeforeDestroy,this)}});Ext.preg("gx_treenodecomponent",GeoExt.plugins.TreeNodeComponent);Ext.namespace("gxp.plugins");gxp.plugins.LayerManager=Ext.extend(gxp.plugins.LayerTree,{ptype:"gxp_layermanager",baseNodeText:gettext("Base Maps"),createOutputConfig:function(){var e=gxp.plugins.LayerManager.superclass.createOutputConfig.apply(this,arguments);Ext.applyIf(e,Ext.apply({cls:"gxp-layermanager-tree",lines:false,useArrows:true,plugins:[{ptype:"gx_treenodecomponent"}]},this.treeConfig));return e},configureLayerNode:function(e,t){gxp.plugins.LayerManager.superclass.configureLayerNode.apply(this,arguments);var i;if(OpenLayers.Layer.WMS&&t.layer instanceof OpenLayers.Layer.WMS){i="gx_wmslegend"}else if(OpenLayers.Layer.Vector&&t.layer instanceof OpenLayers.Layer.Vector){i="gx_vectorlegend"}if(i){var r;if(e&&e.baseAttrs&&e.baseAttrs.baseParams){r=e.baseAttrs.baseParams}Ext.apply(t,{component:{xtype:i,hidden:!t.layer.getVisibility(),baseParams:Ext.apply({transparent:true,format:"image/png",Language:GeoExt.Lang.locale,legend_options:"fontAntiAliasing:true;fontSize:11;fontName:Arial"},r),layerRecord:this.target.mapPanel.layers.getByLayer(t.layer),showTitle:false,cls:"legend"}})}}});Ext.preg(gxp.plugins.LayerManager.prototype.ptype,gxp.plugins.LayerManager);Ext.namespace("gxp");gxp.NewSourceDialog=Ext.extend(Ext.Panel,{title:gettext("Add New Server..."),cancelText:gettext("Cancel"),addServerText:gettext("Add Server"),invalidURLText:gettext("Enter a valid URL to a WMS/TMS/REST endpoint (e.g. http://example.com/geoserver/wms)"),contactingServerText:gettext("Contacting Server..."),bodyStyle:"padding: 0px",error:null,initComponent:function(){this.addEvents("urlselected");this.urlTextField=new Ext.form.TextField({fieldLabel:gettext("URL"),allowBlank:false,width:240,msgTarget:"under",validator:this.urlValidator.createDelegate(this),listeners:{specialkey:function(e,t){if(t.getKey()===t.ENTER){this.addServer()}},scope:this}});this.form=new Ext.form.FormPanel({items:[{xtype:"combo",width:240,name:"type",fieldLabel:gettext("Type"),value:"WMS",mode:"local",triggerAction:"all",store:[["WMS","Web Map Service (WMS)"],["TMS","Tiled Map Service (TMS)"],["REST","ArcGIS REST Service (REST)"]]},this.urlTextField],border:false,labelWidth:30,bodyStyle:"padding: 5px",autoWidth:true,autoHeight:true,listeners:{afterrender:function(){this.urlTextField.focus(false,true)},scope:this}});this.bbar=[new Ext.Button({text:this.cancelText,handler:this.hide,scope:this}),new Ext.Toolbar.Fill,new Ext.Button({text:this.addServerText,iconCls:"add",handler:this.addServer,scope:this})];this.items=this.form;gxp.NewSourceDialog.superclass.initComponent.call(this);this.form.on("render",function(){this.loadMask=new Ext.LoadMask(this.form.getEl(),{msg:this.contactingServerText})},this);this.on({hide:this.reset,removed:this.reset,scope:this});this.on("urlselected",function(e,t){this.setLoading();var i=function(){this.setError(this.sourceLoadFailureMessage)};this.addSource(t,this.hide,i,this)},this)},addServer:function(){this.error=null;if(this.urlTextField.validate()){this.fireEvent("urlselected",this,this.urlTextField.getValue(),this.form.getForm().findField("type").getValue())}},reset:function(){this.error=null;this.urlTextField.reset();this.loadMask.hide()},urlRegExp:/^(http(s)?:)?\/\/([\w%]+:[\w%]+@)?([^@\/:]+)(:\d+)?\//i,urlValidator:function(e){var t;if(!this.urlRegExp.test(e)){t=this.invalidURLText}else{t=!this.error||this.error}this.error=null;return t},setLoading:function(){this.loadMask.show()},setError:function(e){this.loadMask.hide();this.error=e;this.urlTextField.validate()},addSource:function(e,t,i,r){}});Ext.reg("gxp_newsourcedialog",gxp.NewSourceDialog);Ext.namespace("gxp.plugins");gxp.plugins.FeedGetFeatureInfo=Ext.extend(gxp.plugins.Tool,{ptype:"gxp_getfeedfeatureinfo",init:function(e){gxp.plugins.FeedGetFeatureInfo.superclass.init.apply(this,arguments);this.target.mapPanel.layers.on({add:this.addLayer,remove:this.removeLayer,scope:this})},addLayer:function(e,t,i){for(var r=0,a=t.length;r<a;++r){var s=t[r];var n=this.target.getSource(s);var o=s.getLayer();if(n instanceof gxp.plugins.FeedSource){if(this.target.selectControl==null){this.target.selectControl=new OpenLayers.Control.SelectFeature(o,{clickout:true,listeners:{clickoutFeature:function(){}},scope:this});this.target.mapPanel.map.addControl(this.target.selectControl)}else{var l=this.target.selectControl.layers?this.target.selectControl.layers:this.target.selectControl.layer?[this.target.selectControl.layer]:[];l.push(o);this.target.selectControl.setLayer(l)}}}if(this.target.selectControl)this.target.selectControl.activate()},removeLayer:function(e,t,h){if(!t.length){t=[t]}for(var i=0,r=t.length;i<r;++i){var a=t[i].getLayer();var s=this.target.selectControl;if(s!=null){if(s.layers){for(var n=0;n<s.layers.length;n++){var o=s.layers[n];var l=s.layers;if(o.id===a.id){l.splice(n,1);s.setLayer(l)}}}else if(s.layer!=null){if(a.id===s.layer.id){s.setLayer([])}}}}}});Ext.preg(gxp.plugins.FeedGetFeatureInfo.prototype.ptype,gxp.plugins.FeedGetFeatureInfo);OpenLayers.Format.GeoRSS=OpenLayers.Class(OpenLayers.Format.XML,{rssns:"http://backend.userland.com/rss2",featureNS:"http://mapserver.gis.umn.edu/mapserver",georssns:"http://www.georss.org/georss",geons:"http://www.w3.org/2003/01/geo/wgs84_pos#",featureTitle:gettext("Untitled"),featureDescription:"No Description",gmlParser:null,xy:false,createGeometryFromItem:function(e){var t=this.getElementsByTagNameNS(e,this.georssns,"point");var i=this.getElementsByTagNameNS(e,this.geons,"lat");var r=this.getElementsByTagNameNS(e,this.geons,"long");var a=this.getElementsByTagNameNS(e,this.georssns,"line");var p=this.getElementsByTagNameNS(e,this.georssns,"polygon");var u=this.getElementsByTagNameNS(e,this.georssns,"where");var c=this.getElementsByTagNameNS(e,this.georssns,"box");if(t.length>0||i.length>0&&r.length>0){var s;if(t.length>0){s=OpenLayers.String.trim(t[0].firstChild.nodeValue).split(/\s+/);if(s.length!=2){s=OpenLayers.String.trim(t[0].firstChild.nodeValue).split(/\s*,\s*/)}}else{s=[parseFloat(i[0].firstChild.nodeValue),parseFloat(r[0].firstChild.nodeValue)]}var n=new OpenLayers.Geometry.Point(s[1],s[0])}else if(a.length>0){var o=OpenLayers.String.trim(this.getChildValue(a[0])).split(/\s+/);var l=[];var t;for(var h=0,d=o.length;h<d;h+=2){t=new OpenLayers.Geometry.Point(o[h+1],o[h]);l.push(t)}n=new OpenLayers.Geometry.LineString(l)}else if(p.length>0){var o=OpenLayers.String.trim(this.getChildValue(p[0])).split(/\s+/);var l=[];var t;for(var h=0,d=o.length;h<d;h+=2){t=new OpenLayers.Geometry.Point(o[h+1],o[h]);l.push(t)}n=new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing(l)])}else if(u.length>0){if(!this.gmlParser){this.gmlParser=new OpenLayers.Format.GML({xy:this.xy})}var f=this.gmlParser.parseFeature(u[0]);n=f.geometry}else if(c.length>0){var o=OpenLayers.String.trim(c[0].firstChild.nodeValue).split(/\s+/);var l=[];var t;if(o.length>3){t=new OpenLayers.Geometry.Point(o[1],o[0]);l.push(t);t=new OpenLayers.Geometry.Point(o[1],o[2]);l.push(t);t=new OpenLayers.Geometry.Point(o[3],o[2]);l.push(t);t=new OpenLayers.Geometry.Point(o[3],o[0]);l.push(t);t=new OpenLayers.Geometry.Point(o[1],o[0]);l.push(t)}n=new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing(l)])}if(n&&this.internalProjection&&this.externalProjection){n.transform(this.externalProjection,this.internalProjection)}return n},createFeatureFromItem:function(e){var t=this.createGeometryFromItem(e);var i=this._getChildValue(e,"*","title",this.featureTitle);var r=this._getChildValue(e,"*","description",this._getChildValue(e,"*","content",this._getChildValue(e,"*","summary",this.featureDescription)));var a=this._getChildValue(e,"*","link");if(!a){try{a=this.getElementsByTagNameNS(e,"*","link")[0].getAttribute("href")}catch(e){a=null}}var s=this._getChildValue(e,"*","id",null);var n={title:i,description:r,link:a};var o=new OpenLayers.Feature.Vector(t,n);o.fid=s;return o},_getChildValue:function(e,t,i,r){var a;var s=this.getElementsByTagNameNS(e,t,i);if(s&&s[0]&&s[0].firstChild&&s[0].firstChild.nodeValue){a=this.getChildValue(s[0])}else{a=r==undefined?"":r}return a},read:function(e){if(typeof e=="string"){e=OpenLayers.Format.XML.prototype.read.apply(this,[e])}var t=null;t=this.getElementsByTagNameNS(e,"*","item");if(t.length==0){t=this.getElementsByTagNameNS(e,"*","entry")}var i=t.length;var r=new Array(i);for(var a=0;a<i;a++){r[a]=this.createFeatureFromItem(t[a])}return r},write:function(e){var t;if(OpenLayers.Util.isArray(e)){t=this.createElementNS(this.rssns,"rss");for(var i=0,r=e.length;i<r;i++){t.appendChild(this.createFeatureXML(e[i]))}}else{t=this.createFeatureXML(e)}return OpenLayers.Format.XML.prototype.write.apply(this,[t])},createFeatureXML:function(e){var t=this.buildGeometryNode(e.geometry);var i=this.createElementNS(this.rssns,"item");var r=this.createElementNS(this.rssns,"title");r.appendChild(this.createTextNode(e.attributes.title?e.attributes.title:gettext("")));var a=this.createElementNS(this.rssns,"description");a.appendChild(this.createTextNode(e.attributes.description?e.attributes.description:""));i.appendChild(r);i.appendChild(a);if(e.attributes.link){var s=this.createElementNS(this.rssns,"link");s.appendChild(this.createTextNode(e.attributes.link));i.appendChild(s)}for(var n in e.attributes){if(n=="link"||n=="title"||n=="description"){continue}var o=this.createTextNode(e.attributes[n]);var l=n;if(n.search(":")!=-1){l=n.split(":")[1]}var h=this.createElementNS(this.featureNS,"feature:"+l);h.appendChild(o);i.appendChild(h)}i.appendChild(t);return i},buildGeometryNode:function(e){if(this.internalProjection&&this.externalProjection){e=e.clone();e.transform(this.internalProjection,this.externalProjection)}var t;if(e.CLASS_NAME=="OpenLayers.Geometry.Polygon"){t=this.createElementNS(this.georssns,"georss:polygon");t.appendChild(this.buildCoordinatesNode(e.components[0]))}else if(e.CLASS_NAME=="OpenLayers.Geometry.LineString"){t=this.createElementNS(this.georssns,"georss:line");t.appendChild(this.buildCoordinatesNode(e))}else if(e.CLASS_NAME=="OpenLayers.Geometry.Point"){t=this.createElementNS(this.georssns,"georss:point");t.appendChild(this.buildCoordinatesNode(e))}else{throw"Couldn't parse "+e.CLASS_NAME}return t},buildCoordinatesNode:function(e){var t=null;if(e.components){t=e.components}var i;if(t){var r=t.length;var a=new Array(r);for(var s=0;s<r;s++){a[s]=t[s].y+" "+t[s].x}i=a.join(" ")}else{i=e.y+" "+e.x}return this.createTextNode(i)},CLASS_NAME:"OpenLayers.Format.GeoRSS"});OpenLayers.Format.QueryStringFilter=function(){var l={};l[OpenLayers.Filter.Comparison.EQUAL_TO]="eq";l[OpenLayers.Filter.Comparison.NOT_EQUAL_TO]="ne";l[OpenLayers.Filter.Comparison.LESS_THAN]="lt";l[OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO]="lte";l[OpenLayers.Filter.Comparison.GREATER_THAN]="gt";l[OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO]="gte";l[OpenLayers.Filter.Comparison.LIKE]="ilike";function h(e){e=e.replace(/%/g,"\\%");e=e.replace(/\\\\\.(\*)?/g,function(e,t){return t?e:"\\\\_"});e=e.replace(/\\\\\.\*/g,"\\\\%");e=e.replace(/(\\)?\.(\*)?/g,function(e,t,i){return t||i?e:"_"});e=e.replace(/(\\)?\.\*/g,function(e,t){return t?e:"%"});e=e.replace(/\\\./g,".");e=e.replace(/(\\)?\\\*/g,function(e,t){return t?e:"*"});return e}return OpenLayers.Class(OpenLayers.Format,{wildcarded:false,srsInBBOX:false,write:function(e,t){t=t||{};var i=e.CLASS_NAME;var r=i.substring(i.lastIndexOf(".")+1);switch(r){case"Spatial":switch(e.type){case OpenLayers.Filter.Spatial.BBOX:t.bbox=e.value.toArray();if(this.srsInBBOX&&e.projection){t.bbox.push(e.projection.getCode())}break;case OpenLayers.Filter.Spatial.DWITHIN:t.tolerance=e.distance;case OpenLayers.Filter.Spatial.WITHIN:t.lon=e.value.x;t.lat=e.value.y;break;default:OpenLayers.Console.warn("Unknown spatial filter type "+e.type)}break;case"Comparison":var a=l[e.type];if(a!==undefined){var s=e.value;if(e.type==OpenLayers.Filter.Comparison.LIKE){s=h(s);if(this.wildcarded){s="%"+s+"%"}}t[e.property+"__"+a]=s;t.queryable=t.queryable||[];t.queryable.push(e.property)}else{OpenLayers.Console.warn("Unknown comparison filter type "+e.type)}break;case"Logical":if(e.type===OpenLayers.Filter.Logical.AND){for(var n=0,o=e.filters.length;n<o;n++){t=this.write(e.filters[n],t)}}else{OpenLayers.Console.warn("Unsupported logical filter type "+e.type)}break;default:OpenLayers.Console.warn("Unknown filter type "+r)}return t},CLASS_NAME:"OpenLayers.Format.QueryStringFilter"})}();OpenLayers.Strategy=OpenLayers.Class({layer:null,options:null,active:null,autoActivate:true,autoDestroy:true,initialize:function(e){OpenLayers.Util.extend(this,e);this.options=e;this.active=false},destroy:function(){this.deactivate();this.layer=null;this.options=null},setLayer:function(e){this.layer=e},activate:function(){if(!this.active){this.active=true;return true}return false},deactivate:function(){if(this.active){this.active=false;return true}return false},CLASS_NAME:"OpenLayers.Strategy"});OpenLayers.Strategy.BBOX=OpenLayers.Class(OpenLayers.Strategy,{bounds:null,resolution:null,ratio:2,resFactor:null,response:null,activate:function(){var e=OpenLayers.Strategy.prototype.activate.call(this);if(e){this.layer.events.on({moveend:this.update,refresh:this.update,visibilitychanged:this.update,scope:this});this.update()}return e},deactivate:function(){var e=OpenLayers.Strategy.prototype.deactivate.call(this);if(e){this.layer.events.un({moveend:this.update,refresh:this.update,visibilitychanged:this.update,scope:this})}return e},update:function(e){var t=this.getMapBounds();if(t!==null&&(e&&e.force||this.layer.visibility&&this.layer.calculateInRange()&&this.invalidBounds(t))){this.calculateBounds(t);this.resolution=this.layer.map.getResolution();this.triggerRead(e)}},getMapBounds:function(){if(this.layer.map===null){return null}var e=this.layer.map.getExtent();if(e&&!this.layer.projection.equals(this.layer.map.getProjectionObject())){e=e.clone().transform(this.layer.map.getProjectionObject(),this.layer.projection)}return e},invalidBounds:function(e){if(!e){e=this.getMapBounds()}var t=!this.bounds||!this.bounds.containsBounds(e);if(!t&&this.resFactor){var i=this.resolution/this.layer.map.getResolution();t=i>=this.resFactor||i<=1/this.resFactor}return t},calculateBounds:function(e){if(!e){e=this.getMapBounds()}var t=e.getCenterLonLat();var i=e.getWidth()*this.ratio;var r=e.getHeight()*this.ratio;this.bounds=new OpenLayers.Bounds(t.lon-i/2,t.lat-r/2,t.lon+i/2,t.lat+r/2)},triggerRead:function(e){if(this.response&&!(e&&e.noAbort===true)){this.layer.protocol.abort(this.response);this.layer.events.triggerEvent("loadend")}var t={filter:this.createFilter()};this.layer.events.triggerEvent("loadstart",t);this.response=this.layer.protocol.read(OpenLayers.Util.applyDefaults({filter:t.filter,callback:this.merge,scope:this},e))},createFilter:function(){var e=new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.BBOX,value:this.bounds,projection:this.layer.projection});if(this.layer.filter){e=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,filters:[this.layer.filter,e]})}return e},merge:function(e){this.layer.destroyFeatures();if(e.success()){var t=e.features;if(t&&t.length>0){var i=this.layer.projection;var r=this.layer.map.getProjectionObject();if(!r.equals(i)){var a;for(var s=0,n=t.length;s<n;++s){a=t[s].geometry;if(a){a.transform(i,r)}}}this.layer.addFeatures(t)}}else{this.bounds=null}this.response=null;this.layer.events.triggerEvent("loadend",{response:e})},CLASS_NAME:"OpenLayers.Strategy.BBOX"});OpenLayers.Strategy.Fixed=OpenLayers.Class(OpenLayers.Strategy,{preload:false,activate:function(){var e=OpenLayers.Strategy.prototype.activate.apply(this,arguments);if(e){this.layer.events.on({refresh:this.load,scope:this});if(this.layer.visibility==true||this.preload){this.load()}else{this.layer.events.on({visibilitychanged:this.load,scope:this})}}return e},deactivate:function(){var e=OpenLayers.Strategy.prototype.deactivate.call(this);if(e){this.layer.events.un({refresh:this.load,visibilitychanged:this.load,scope:this})}return e},load:function(e){var t=this.layer;t.events.triggerEvent("loadstart",{filter:t.filter});t.protocol.read(OpenLayers.Util.applyDefaults({callback:this.merge,filter:t.filter,scope:this},e));t.events.un({visibilitychanged:this.load,scope:this})},merge:function(e){var t=this.layer;t.destroyFeatures();var i=e.features;if(i&&i.length>0){var r=t.projection;var a=t.map.getProjectionObject();if(!a.equals(r)){var s;for(var n=0,o=i.length;n<o;++n){s=i[n].geometry;if(s){s.transform(r,a)}}}t.addFeatures(i)}t.events.triggerEvent("loadend",{response:e})},CLASS_NAME:"OpenLayers.Strategy.Fixed"});Ext.namespace("gxp.plugins");gxp.plugins.FeedSource=Ext.extend(gxp.plugins.LayerSource,{ptype:"gxp_feedsource",title:gettext("Feed Source"),format:"OpenLayers.Format.GeoRSS",popupTemplate:'<a target="_blank" href="{link}">{description}</a>',fixed:true,createLayerRecord:function(e){var t;var i=new OpenLayers.Layer.Vector(e.name,{projection:"projection"in e?e.projection:"EPSG:4326",visibility:"visibility"in e?e.visibility:true,strategies:[this.fixed?new OpenLayers.Strategy.Fixed:new OpenLayers.Strategy.BBOX({resFactor:1,ratio:1})],protocol:new OpenLayers.Protocol.HTTP({url:this.url,params:e.params,format:this.getFormat(e)}),styleMap:this.getStyleMap(e)});this.configureInfoPopup(i);var r=GeoExt.data.LayerRecord.create([{name:"name",type:"string"},{name:"source",type:"string"},{name:"group",type:"string"},{name:"fixed",type:"boolean"},{name:"selected",type:"boolean"},{name:"visibility",type:"boolean"},{name:"format",type:"string"},{name:"defaultStyle"},{name:"selectStyle"},{name:"params"}]);var a="format"in e?e.format:this.format;var s={layer:i,name:e.name,source:e.source,group:e.group,fixed:"fixed"in e?e.fixed:false,selected:"selected"in e?e.selected:false,params:"params"in e?e.params:{},visibility:"visibility"in e?e.visibility:false,format:a instanceof String?a:null,defaultStyle:"defaultStyle"in e?e.defaultStyle:{},selectStyle:"selectStyle"in e?e.selectStyle:{}};t=new r(s,i.id);return t},getConfigForRecord:function(e){var t=gxp.plugins.FeedSource.superclass.getConfigForRecord.apply(this,arguments);return Ext.apply(t,{name:e.get("name"),group:e.get("group"),fixed:e.get("fixed"),selected:e.get("selected"),params:e.get("params"),visibility:e.getLayer().getVisibility(),format:e.get("format"),defaultStyle:e.getLayer().styleMap["styles"]["default"]["defaultStyle"],selectStyle:e.getLayer().styleMap["styles"]["select"]["defaultStyle"]})},getFormat:function(e){var t=window;var i="format"in e?e.format:this.format;if(typeof i=="string"||i instanceof String){var r=i.split(".");for(var a=0,s=r.length;a<s;++a){t=t[r[a]];if(!t){break}}if(t&&t.prototype&&t.prototype.initialize){var n=function(){t.prototype.initialize.apply(this)};n.prototype=t.prototype;var o=new n;return o}}else{return i}},configureInfoPopup:function(e){var r=new Ext.XTemplate(this.popupTemplate);e.events.on({featureselected:function(e){var t=e.feature;var i=t.geometry;if(this.target.selectControl){if(this.target.selectControl.popup){this.target.selectControl.popup.close()}this.target.selectControl.popup=new GeoExt.Popup({title:t.attributes.title,closeAction:"destroy",location:t,html:r.apply(t.attributes)});this.target.selectControl.popup.show()}},featureunselected:function(){if(this.target.selectControl&&this.target.selectControl.popup){this.target.selectControl.popup.close()}},scope:this})},getStyleMap:function(e){return new OpenLayers.StyleMap({default:new OpenLayers.Style("defaultStyle"in e?e.defaultStyle:{graphicName:"circle",pointRadius:5,fillOpacity:.7,fillColor:"Red"},{title:e.name}),select:new OpenLayers.Style("selectStyle"in e?e.selectStyle:{graphicName:"circle",pointRadius:10,fillOpacity:1,fillColor:"Yellow"})})}});Ext.preg(gxp.plugins.FeedSource.prototype.ptype,gxp.plugins.FeedSource);Ext.namespace("gxp.plugins");gxp.plugins.PicasaFeedSource=Ext.extend(gxp.plugins.FeedSource,{ptype:"gxp_picasasource",url:"http://picasaweb.google.com/data/feed/base/all?thumbsize=160c&",format:"OpenLayers.Format.Picasa",title:gettext("Picasa Photos"),pointRadius:14,popupTemplate:'<tpl for="."><a target="_blank" href="{link}"><img  title="{title}" src="{thumbnail}"/></a></tpl>',fixed:false,createLayerRecord:function(e){if(Ext.isEmpty(e.params["max-results"])){e.params["max-results"]=50}e.url=this.url;this.format=new OpenLayers.Format.GeoRSS({createFeatureFromItem:function(e){var t=OpenLayers.Format.GeoRSS.prototype.createFeatureFromItem.apply(this,arguments);t.attributes.thumbnail=this.getElementsByTagNameNS(e,"http://search.yahoo.com/mrss/","thumbnail")[0].getAttribute("url");t.attributes.content=OpenLayers.Util.getXmlNodeValue(this.getElementsByTagNameNS(e,"*","summary")[0]);return t}});var t=gxp.plugins.PicasaFeedSource.superclass.createLayerRecord.apply(this,arguments);var i=t.getLayer();i.protocol.filterToParams=function(e,t){if(e.type===OpenLayers.Filter.Spatial.BBOX){var i=e.value.toArray();t.bbox=[Math.max(-180,i[0]),Math.max(-90,i[1]),Math.min(180,i[2]),Math.min(90,i[3])]}return t};return t},configureInfoPopup:function(e){var s=new Ext.XTemplate(this.popupTemplate);e.events.on({featureselected:function(e){var t=e.feature;var i=t.geometry;if(this.target.selectControl.popup!=null){this.target.selectControl.popup.close()}var r=document.createElement("div");r.innerHTML=t.attributes.content;var a={link:r.getElementsByTagName("a")[0].getAttribute("href"),title:t.attributes.title,thumbnail:t.attributes.thumbnail};this.target.selectControl.popup=new GeoExt.Popup({title:t.attributes.title,closeAction:"destroy",location:t,width:175,height:200,html:s.apply(a)});this.target.selectControl.popup.show()},featureunselected:function(e){if(this.target.selectControl&&this.target.selectControl.popup){this.target.selectControl.popup.close()}},scope:this})},getStyleMap:function(e){return new OpenLayers.StyleMap({default:new OpenLayers.Style({externalGraphic:"${thumbnail}",pointRadius:this.pointRadius},{title:this.title}),select:new OpenLayers.Style({pointRadius:this.pointRadius+5})})}});Ext.preg(gxp.plugins.PicasaFeedSource.prototype.ptype,gxp.plugins.PicasaFeedSource);Ext.namespace("gxp.plugins");gxp.plugins.YouTubeFeedSource=Ext.extend(gxp.plugins.FeedSource,{ptype:"gxp_youtubesource",url:"http://gdata.youtube.com/feeds/api/videos?v=2&prettyprint=true&",format:"OpenLayers.Format.YouTube",title:gettext("Youtube Videos"),pointRadius:24,popupTemplate:'<tpl for="."><a target="_blank" href="{link}"><img height="180"  width="240" title="{title}" src="{thumbnail}"/></a></tpl>',fixed:false,createLayerRecord:function(e){if(Ext.isEmpty(e.params["max-results"])){e.params["max-results"]=50}else{e.params["max-results"]=Math.min(e.params["max-results"],50)}e.url=this.url;this.format=new OpenLayers.Format.GeoRSS({createFeatureFromItem:function(e){var t=OpenLayers.Format.GeoRSS.prototype.createFeatureFromItem.apply(this,arguments);t.attributes.thumbnail=this.getElementsByTagNameNS(e,"http://search.yahoo.com/mrss/","thumbnail")[4].getAttribute("url");t.attributes.content=OpenLayers.Util.getXmlNodeValue(this.getElementsByTagNameNS(e,"*","summary")[0]);return t}});var t=gxp.plugins.YouTubeFeedSource.superclass.createLayerRecord.apply(this,arguments);var i=t.getLayer();i.protocol.filterToParams=function(e,t){if(e.type===OpenLayers.Filter.Spatial.BBOX){var i=e.value;var r=i.getCenterLonLat();var a=6378.137;var s=3.1415926;var n=a*i.left/180/s;var o=a*i.right/180/s;var l=Math.min((o-n)/2*2,1e3);Ext.apply(t,{location:""+r.lat+","+r.lon,"location-radius":l+"km"})}return t};return t},configureInfoPopup:function(e){var r=new Ext.XTemplate(this.popupTemplate);e.events.on({featureselected:function(e){var t=e.feature;var i=t.geometry;if(this.target.selectControl.popup!=null){this.target.selectControl.popup.close()}this.target.selectControl.popup=new GeoExt.Popup({title:t.attributes.title,location:t,width:240,height:220,closeAction:"destroy",html:r.apply(t.attributes)});this.target.selectControl.popup.show()},featureunselected:function(e){if(this.target.selectControl&&this.target.selectControl.popup){this.target.selectControl.popup.close()}},scope:this})},getStyleMap:function(e){return new OpenLayers.StyleMap({default:new OpenLayers.Style({externalGraphic:"${thumbnail}",pointRadius:24},{title:this.title}),select:new OpenLayers.Style({pointRadius:this.pointRadius+5})})}});Ext.preg(gxp.plugins.YouTubeFeedSource.prototype.ptype,gxp.plugins.YouTubeFeedSource);Ext.namespace("gxp");gxp.FeedSourceDialog=Ext.extend(Ext.Container,{feedTypeText:gettext("Source"),addPicasaText:gettext("Picasa Photos"),addYouTubeText:gettext("YouTube Videos"),addRSSText:gettext("GeoRSS Feed"),addFeedText:gettext("Add to Map"),addTitleText:gettext("Title"),keywordText:gettext("Keyword"),doneText:gettext("Done"),titleText:gettext("Add Feeds"),maxResultsText:gettext("Max Items"),width:300,autoHeight:true,closeAction:"destroy",initComponent:function(){this.addEvents("addfeed");if(!this.feedTypes){this.feedTypes=[[gxp.plugins.PicasaFeedSource.ptype,this.addPicasaText],[gxp.plugins.YouTubeFeedSource.ptype,this.addYouTubeText],[gxp.plugins.FeedSource.ptype,this.addRSSText]]}var e=new Ext.data.ArrayStore({fields:["type","name"],data:this.feedTypes});var r=new Ext.form.ComboBox({store:e,fieldLabel:this.feedTypeText,displayField:"name",valueField:"type",typeAhead:true,width:180,mode:"local",triggerAction:"all",emptyText:gettext("Select a feed source..."),selectOnFocus:true,listeners:{select:function(e){if(e.value==gxp.plugins.FeedSource.ptype){a.show();s.hide();o.hide();l.show()}else{a.hide();s.show();o.show();l.hide()}t.setDisabled(e.value==null)},scope:this}});var a=new Ext.form.TextField({fieldLabel:gettext("URL"),allowBlank:false,width:180,msgTarget:"right",validator:this.urlValidator.createDelegate(this)});var s=new Ext.form.TextField({fieldLabel:this.keywordText,allowBlank:true,hidden:true,width:180,msgTarget:"right"});var n=new Ext.form.TextField({fieldLabel:this.addTitleText,allowBlank:true,width:180,msgTarget:"right"});var o=new Ext.form.ComboBox({fieldLabel:this.maxResultsText,hidden:true,hiddenName:"max-results",store:new Ext.data.ArrayStore({fields:["max-results"],data:[[10],[25],[50],[100]]}),displayField:"max-results",mode:"local",triggerAction:"all",emptyText:gettext("Choose number..."),labelWidth:70,width:180,defaults:{labelWidth:70,width:180}});var l=new gxp.PointSymbolizer({bodyStyle:{padding:"10px"},width:280,border:false,hidden:true,labelWidth:70,defaults:{labelWidth:70},symbolizer:{pointGraphics:"circle",pointRadius:"5"}});l.find("name","rotation")[0].hidden=true;if(this.symbolType==="Point"&&this.pointGraphics){cfg.pointGraphics=this.pointGraphics}var t=new Ext.Button({text:this.addFeedText,iconCls:"gxp-icon-addlayers",disabled:true,handler:function(){var e=r.getValue();var t={name:n.getValue()};if(e!="gxp_feedsource"){t.params={q:s.getValue(),"max-results":o.getValue()}}else{t.url=a.getValue();var i=l.symbolizer;t.defaultStyle={};t.selectStyle={};Ext.apply(t.defaultStyle,i);Ext.apply(t.selectStyle,i);Ext.apply(t.selectStyle,{fillColor:"Yellow",pointRadius:parseInt(i["pointRadius"])+2})}this.fireEvent("addfeed",e,t)},scope:this});var i=["->",t,new Ext.Button({text:this.doneText,handler:function(){this.hide()},scope:this})];this.panel=new Ext.Panel({bbar:i,autoScroll:true,items:[r,n,a,s,o,l],layout:"form",border:false,labelWidth:100,bodyStyle:"padding: 5px",autoWidth:true,autoHeight:true});this.items=this.panel;gxp.FeedSourceDialog.superclass.initComponent.call(this)},urlRegExp:/^(http(s)?:)?\/\/([\w%]+:[\w%]+@)?([^@\/:]+)(:\d+)?\//i,urlValidator:function(e){var t;if(!this.urlRegExp.test(e)){t=this.invalidURLText}else{t=!this.error||this.error}this.error=null;return t}});Ext.reg("gxp_feedsourcedialog",gxp.FeedSourceDialog);Ext.namespace("gxp.plugins");gxp.plugins.GeoNodeCatalogueSource=Ext.extend(gxp.plugins.CatalogueSource,{ptype:"gxp_geonodecataloguesource",rootProperty:"results",baseParams:null,fields:[{name:"title",convert:function(e){return[e]}},{name:"abstract",mapping:"description"},{name:"bounds",mapping:"bbox",convert:function(e){return{left:e.minx,right:e.maxx,bottom:e.miny,top:e.maxy}}},{name:"URI",mapping:"links",convert:function(e){var t=[];for(var i in e){t.push({value:e[i].url})}return t}}],createStore:function(){this.store=new Ext.data.Store({proxy:new Ext.data.HttpProxy(Ext.apply({url:this.url,method:"GET"},this.proxyOptions||{})),baseParams:Ext.apply({type:"layer"},this.baseParams),reader:new Ext.data.JsonReader({root:this.rootProperty},this.fields)});gxp.plugins.LayerSource.prototype.createStore.apply(this,arguments)},getPagingStart:function(){return 0},getPagingParamNames:function(){return{start:"startIndex",limit:"limit"}},filter:function(e){var t=undefined;if(e.filters!==undefined){for(var i=0,r=e.filters.length;i<r;++i){var a=e.filters[i];if(a instanceof OpenLayers.Filter.Spatial){t=a.value.toBBOX();break}}}Ext.apply(this.store.baseParams,{q:e.queryString});if(e.limit!==undefined){Ext.apply(this.store.baseParams,{limit:e.limit})}if(t!==undefined){Ext.apply(this.store.baseParams,{bbox:t})}else{delete this.store.baseParams.bbox}this.store.load()},createLayerRecord:function(e){e.restUrl=this.restUrl;e.queryable=true;return gxp.plugins.GeoNodeCatalogueSource.superclass.createLayerRecord.apply(this,arguments)}});Ext.preg(gxp.plugins.GeoNodeCatalogueSource.prototype.ptype,gxp.plugins.GeoNodeCatalogueSource);Ext.namespace("gxp.form");gxp.form.CSWFilterField=Ext.extend(Ext.form.CompositeField,{clearTooltip:gettext("Clear the filter for this category"),emptyText:gettext("Select filter"),property:null,map:null,type:OpenLayers.Filter.Comparison.EQUAL_TO,name:null,comboFieldLabel:null,comboStoreData:null,target:null,getFilter:function(){if(this.property==="BoundingBox"){return new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.BBOX,property:this.property,projection:"EPSG:4326",value:this.map.getExtent().transform(this.map.getProjectionObject(),new OpenLayers.Projection("EPSG:4326"))})}else{return new OpenLayers.Filter.Comparison({type:this.type,property:this.property,value:this.combo.getValue()})}},initComponent:function(){this.items=[{ref:"combo",xtype:"combo",fieldLabel:this.comboFieldLabel,store:new Ext.data.ArrayStore({fields:["id","value"],data:this.comboStoreData}),displayField:"value",valueField:"id",mode:"local",listeners:{select:function(e,t){if(this.filter){this.target.removeFilter(this.filter)}this.filter=this.getFilter();this.target.addFilter(this.filter);return false},scope:this},emptyText:this.emptyText,triggerAction:"all"},{xtype:"button",iconCls:"gxp-icon-removelayers",tooltip:this.clearTooltip,handler:function(e){this.target.removeFilter(this.filter);this.hide()},scope:this}];this.hidden=true;gxp.form.CSWFilterField.superclass.initComponent.apply(this,arguments)},destroy:function(){this.filter=null;this.target=null;this.map=null;gxp.form.CSWFilterField.superclass.destroy.call(this)}});Ext.reg("gxp_cswfilterfield",gxp.form.CSWFilterField);Ext.namespace("gxp");gxp.CatalogueSearchPanel=Ext.extend(Ext.Panel,{border:false,maxRecords:10,map:null,selectedSource:null,sources:null,searchFieldEmptyText:gettext("Search"),searchButtonText:gettext("Search"),addTooltip:gettext("Create filter"),addMapTooltip:gettext("Add to map"),advancedTitle:gettext("Advanced"),datatypeLabel:gettext("Data type"),extentLabel:gettext("Spatial extent"),categoryLabel:gettext("Category"),datasourceLabel:gettext("Data source"),filterLabel:gettext("Filter search by"),removeSourceTooltip:gettext("Switch back to original source"),initComponent:function(){var l=this;this.addEvents("addlayer");this.filters=[];var e=[];for(var t in this.sources){e.push([t,this.sources[t].title])}if(e.length>=1){this.selectedSource=e[0][0]}var i=[["datatype","data type"],["extent","spatial extent"],["category","category"]];if(e.length>1){i.push(["csw","data source"])}this.sources[this.selectedSource].store.on("loadexception",function(e,t,i,r){if(i.success()){Ext.Msg.show({title:r.message,msg:gxp.util.getOGCExceptionText(r.arg.exceptionReport),icon:Ext.MessageBox.ERROR,buttons:Ext.MessageBox.OK})}});this.items=[{xtype:"form",border:false,ref:"form",hideLabels:true,autoHeight:true,style:"margin-left: 5px; margin-right: 5px; margin-bottom: 5px; margin-top: 5px",items:[{xtype:"compositefield",items:[{xtype:"textfield",emptyText:this.searchFieldEmptyText,ref:"../../search",name:"search",listeners:{specialkey:function(e,t){if(t.getKey()==t.ENTER){this.performQuery()}},scope:this},width:250},{xtype:"button",text:this.searchButtonText,handler:this.performQuery,scope:this}]},{xtype:"fieldset",collapsible:true,collapsed:true,hideLabels:false,hidden:true,title:this.advancedTitle,items:[{xtype:"gxp_cswfilterfield",name:"datatype",property:"apiso:Type",comboFieldLabel:this.datatypeLabel,comboStoreData:[["dataset","Dataset"],["datasetcollection","Dataset collection"],["application","Application"],["service","Service"]],target:this},{xtype:"gxp_cswfilterfield",name:"extent",property:"BoundingBox",map:this.map,comboFieldLabel:this.extentLabel,comboStoreData:[["map","spatial extent of the map"]],target:this},{xtype:"gxp_cswfilterfield",name:"category",property:"apiso:TopicCategory",comboFieldLabel:this.categoryLabel,comboStoreData:[["farming","Farming"],["biota","Biota"],["boundaries","Boundaries"],["climatologyMeteorologyAtmosphere","Climatology/Meteorology/Atmosphere"],["economy","Economy"],["elevation","Elevation"],["environment","Environment"],["geoscientificinformation","Geoscientific Information"],["health","Health"],["imageryBaseMapsEarthCover","Imagery/Base Maps/Earth Cover"],["intelligenceMilitary","Intelligence/Military"],["inlandWaters","Inland Waters"],["location","Location"],["oceans","Oceans"],["planningCadastre","Planning Cadastre"],["society","Society"],["structure","Structure"],["transportation","Transportation"],["utilitiesCommunications","Utilities/Communications"]],target:this},{xtype:"compositefield",id:"csw",ref:"../../cswCompositeField",hidden:true,items:[{xtype:"combo",ref:"../../../sourceCombo",fieldLabel:this.datasourceLabel,store:new Ext.data.ArrayStore({fields:["id","value"],data:e}),displayField:"value",valueField:"id",mode:"local",listeners:{select:function(e,t){this.setSource(e.getValue())},render:function(){this.sourceCombo.setValue(this.selectedSource)},scope:this},triggerAction:"all"},{xtype:"button",iconCls:"gxp-icon-removelayers",tooltip:this.removeSourceTooltip,handler:function(e){this.setSource(this.initialConfig.selectedSource);this.sourceCombo.setValue(this.initialConfig.selectedSource);this.cswCompositeField.hide()},scope:this}]},{xtype:"compositefield",items:[{xtype:"combo",fieldLabel:this.filterLabel,store:new Ext.data.ArrayStore({fields:["id","value"],data:i}),displayField:"value",valueField:"id",mode:"local",triggerAction:"all"},{xtype:"button",iconCls:"gxp-icon-addlayers",tooltip:this.addTooltip,handler:function(e){e.ownerCt.items.each(function(e){if(e.getXType()==="combo"){var t=e.getValue();e.clearValue();var i=this.form.getForm().findField(t);if(i){i.show()}}},this)},scope:this}]}]},{xtype:"grid",width:"100%",anchor:"99%",viewConfig:{scrollOffset:0,forceFit:true},border:false,ref:"../grid",bbar:new Ext.PagingToolbar({listeners:{beforechange:function(e,t){var i=l.sources[l.selectedSource].getPagingStart();if(t.startPosition){t.startPosition+=i}}},onLoad:function(e,t,i){var r=l.sources[l.selectedSource].getPagingStart();if(!this.rendered){this.dsLoaded=[e,t,i];return}var a=this.getParams();this.cursor=i.params&&i.params[a.start]?i.params[a.start]-r:0;var s=this.getPageData(),n=s.activePage,o=s.pages;this.afterTextItem.setText(String.format(this.afterPageText,s.pages));this.inputItem.setValue(n);this.first.setDisabled(n==1);this.prev.setDisabled(n==1);this.next.setDisabled(n==o);this.last.setDisabled(n==o);this.refresh.enable();this.updateInfo();this.fireEvent("change",this,s)},paramNames:this.sources[this.selectedSource].getPagingParamNames(),store:this.sources[this.selectedSource].store,pageSize:this.maxRecords}),loadMask:true,hideHeaders:true,store:this.sources[this.selectedSource].store,columns:[{id:"title",xtype:"templatecolumn",tpl:new Ext.XTemplate("<b>{title}</b><br/>{abstract}"),sortable:true},{xtype:"actioncolumn",width:30,items:[{getClass:function(e,t,i){if(this.findWMS(i.get("URI"))!==false||this.findWMS(i.get("references"))!==false){return"gxp-icon-addlayers"}},tooltip:this.addMapTooltip,handler:function(e,t,i){var r=this.grid.store.getAt(t);this.addLayer(r)},scope:this}]}],autoExpandColumn:"title",autoHeight:true}]}];gxp.CatalogueSearchPanel.superclass.initComponent.apply(this,arguments)},destroy:function(){this.sources=null;this.map=null;gxp.CatalogueSearchPanel.superclass.destroy.call(this)},setSource:function(e){this.selectedSource=e;var t=this.sources[e].store;this.grid.reconfigure(t,this.grid.getColumnModel());this.grid.getBottomToolbar().bindStore(t)},performQuery:function(){var e=this.sources[this.selectedSource];e.filter({queryString:this.search.getValue(),limit:this.maxRecords,filters:this.filters})},addFilter:function(e){this.filters.push(e)},removeFilter:function(e){this.filters.remove(e)},findWMS:function(e){var t=["OGC:WMS-1.1.1-HTTP-GET-MAP","OGC:WMS"];var i=null,r=null,a,s,n;for(a=0,s=e.length;a<s;++a){n=e[a];if(n.protocol&&t.indexOf(n.protocol.toUpperCase())!==-1&&n.value&&n.name){i=n.value;r=n.name;break}}if(i===null){for(a=0,s=e.length;a<s;++a){n=e[a];var o=n.value?n.value:n;if(o.toLowerCase().indexOf("service=wms")>0){var l=OpenLayers.Util.createUrlObject(o);i=l.protocol+"//"+l.host+":"+l.port+l.pathname;r=l.args.layers;break}}}if(i!==null&&r!==null){return{url:i,name:r}}else{return false}},addLayer:function(e){var t=e.get("URI");var i=e.get("bounds");var r=i.left,a=i.right,s=i.bottom,n=i.top;var o=Math.min(r,a),l=Math.max(r,a),p=Math.min(s,n),u=Math.max(s,n);var h=this.findWMS(t);if(h===false){var c=e.get("references");h=this.findWMS(c)}if(h!==false){this.fireEvent("addlayer",this,this.selectedSource,Ext.apply({title:e.get("title")[0],bbox:[o,p,l,u],srs:"EPSG:4326",projection:e.get("projection")},h))}}});Ext.reg("gxp_cataloguesearchpanel",gxp.CatalogueSearchPanel);OpenLayers.Format.TMSCapabilities=OpenLayers.Class(OpenLayers.Format.XML,{defaultPrefix:"tms",readers:{tms:{Services:function(e,t){t.services=[];this.readChildNodes(e,t)},TileMapService:function(e,t){if(t.services){t.services.push({service:"TMS",version:e.getAttribute("version"),title:e.getAttribute("title"),href:e.getAttribute("href")})}else{this.readChildNodes(e,t)}},TileMaps:function(e,t){t.tileMaps=[];this.readChildNodes(e,t)},TileMap:function(e,t){if(t.tileMaps){t.tileMaps.push({href:e.getAttribute("href"),srs:e.getAttribute("srs"),title:e.getAttribute("title"),profile:e.getAttribute("profile")})}else{t.version=e.getAttribute("version");t.tileMapService=e.getAttribute("tilemapservice");this.readChildNodes(e,t)}},Title:function(e,t){t.title=this.getChildValue(e)},Abstract:function(e,t){t["abstract"]=this.getChildValue(e)},SRS:function(e,t){t.srs=this.getChildValue(e)},BoundingBox:function(e,t){t.bbox=new OpenLayers.Bounds(e.getAttribute("minx"),e.getAttribute("miny"),e.getAttribute("maxx"),e.getAttribute("maxy"))},Origin:function(e,t){t.origin=new OpenLayers.LonLat(e.getAttribute("x"),e.getAttribute("y"))},TileFormat:function(e,t){t.tileFormat={width:parseInt(e.getAttribute("width"),10),height:parseInt(e.getAttribute("height"),10),mimeType:e.getAttribute("mime-type"),extension:e.getAttribute("extension")}},TileSets:function(e,t){t.tileSets=[];this.readChildNodes(e,t)},TileSet:function(e,t){t.tileSets.push({href:e.getAttribute("href"),unitsPerPixel:parseFloat(e.getAttribute("units-per-pixel")),order:parseInt(e.getAttribute("order"),10)})},TileMapServerError:function(e,t){t.error=true},Message:function(e,t){t.message=this.getChildValue(e)}}},read:function(e){if(typeof e=="string"){e=OpenLayers.Format.XML.prototype.read.apply(this,[e])}var t=e;if(e&&e.nodeType==9){e=e.documentElement}var i={};this.readNode(e,i);return i},CLASS_NAME:"OpenLayers.Format.TMSCapabilities"});Ext.ns("gxp.data","gxp.plugins");gxp.data.TMSCapabilitiesReader=Ext.extend(Ext.data.DataReader,{constructor:function(e,t){e=e||{};if(!e.format){e.format=new OpenLayers.Format.TMSCapabilities}if(typeof t!=="function"){t=GeoExt.data.LayerRecord.create(t||e.fields||[{name:"name",type:"string"},{name:"title",type:"string"},{name:"tileMapUrl",type:"string"}])}gxp.data.TMSCapabilitiesReader.superclass.constructor.call(this,e,t)},read:function(e){var t=e.responseXML;if(!t||!t.documentElement){t=e.responseText}return this.readRecords(t)},readRecords:function(e){var t=[],i,r,a,s;if(typeof e==="string"||e.nodeType){e=this.meta.format.read(e);this.raw=e;if(!e.tileMaps){if(e.tileSets){s=new OpenLayers.Projection(e.srs);if(this.meta.mapProjection.equals(s)){var n=[];for(i=0,r=e.tileSets.length;i<r;++i){n.push(e.tileSets[i].unitsPerPixel)}a=this.meta.baseUrl;var o=a.substring(a.indexOf(this.meta.version)+this.meta.version.length+1,a.lastIndexOf("/"));t.push(new this.recordType({layer:new OpenLayers.Layer.TMS(e.title,e.tileMapService.replace("/"+this.meta.version,""),{serverResolutions:n,type:e.tileFormat.extension,layername:o}),title:e.title,name:e.title,tileMapUrl:this.meta.baseUrl}))}}}else{for(i=0,r=e.tileMaps.length;i<r;++i){var l=e.tileMaps[i];s=new OpenLayers.Projection(l.srs);if(this.meta.mapProjection.equals(s)){a=l.href;var h=a.substring(a.indexOf(this.meta.version+"/")+6);t.push(new this.recordType({layer:new OpenLayers.Layer.TMS(l.title,this.meta.baseUrl.indexOf(this.meta.version)!==-1?this.meta.baseUrl.replace(this.meta.version+"/",""):this.meta.baseUrl,{layername:h}),title:l.title,name:l.title,tileMapUrl:a}))}}}}return{totalRecords:t.length,success:true,records:t}}});gxp.plugins.TMSSource=Ext.extend(gxp.plugins.LayerSource,{ptype:"gxp_tmssource",version:"1.0.0",constructor:function(e){gxp.plugins.TMSSource.superclass.constructor.apply(this,arguments);this.format=new OpenLayers.Format.TMSCapabilities;if(this.url.slice(-1)!=="/"){this.url=this.url+"/"}},createStore:function(){var e=this.format;this.store=new Ext.data.Store({autoLoad:true,listeners:{load:function(){this.title=this.store.reader.raw.title;this.fireEvent("ready",this)},exception:function(){var e="Trouble creating TMS layer store from response.";var t="Unable to handle response.";this.fireEvent("failure",this,e,t)},scope:this},proxy:new Ext.data.HttpProxy({url:this.url.indexOf(this.version)===-1?this.url+this.version:this.url,disableCaching:false,method:"GET"}),reader:new gxp.data.TMSCapabilitiesReader({baseUrl:this.url,version:this.version,mapProjection:this.getMapProjection()})})},createLayerRecord:function(s,n,o){var e=this.store.findExact("name",s.name);if(e>-1){var t=this.store.getAt(e);var l=t.getLayer();if(l.serverResolutions!==null){return t}else{Ext.Ajax.request({url:t.get("tileMapUrl"),success:function(e){var t=[];var i=this.format.read(e.responseText);for(var r=0,a=i.tileSets.length;r<a;++r){t.push(i.tileSets[r].unitsPerPixel)}l.addOptions({serverResolutions:t,type:i.tileFormat.extension});this.target.createLayerRecord({source:this.id,name:s.name},n,o)},scope:this})}}}});Ext.preg(gxp.plugins.TMSSource.prototype.ptype,gxp.plugins.TMSSource);OpenLayers.Layer.ArcGIS93Rest=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{format:"png"},isBaseLayer:true,initialize:function(e,t,i,r){var a=[];i=OpenLayers.Util.upperCaseObject(i);a.push(e,t,i,r);OpenLayers.Layer.Grid.prototype.initialize.apply(this,a);OpenLayers.Util.applyDefaults(this.params,OpenLayers.Util.upperCaseObject(this.DEFAULT_PARAMS));if(this.params.TRANSPARENT&&this.params.TRANSPARENT.toString().toLowerCase()=="true"){if(r==null||!r.isBaseLayer){this.isBaseLayer=false}if(this.params.FORMAT=="jpg"){this.params.FORMAT=OpenLayers.Util.alphaHack()?"gif":"png"}}},clone:function(e){if(e==null){e=new OpenLayers.Layer.ArcGIS93Rest(this.name,this.url,this.params,this.getOptions())}e=OpenLayers.Layer.Grid.prototype.clone.apply(this,[e]);return e},getURL:function(e){e=this.adjustBounds(e);var t=this.projection.getCode().split(":");var i=t[t.length-1];var r=this.getImageSize();var a={BBOX:e.toBBOX(),SIZE:r.w+","+r.h,F:"image",BBOXSR:i,IMAGESR:i};if(this.layerDefs){var s=[];var n;for(n in this.layerDefs){if(this.layerDefs.hasOwnProperty(n)){if(this.layerDefs[n]){s.push(n);s.push(":");s.push(this.layerDefs[n]);s.push(";")}}}if(s.length>0){a["LAYERDEFS"]=s.join("")}}var o=this.getFullRequestString(a);return o},setLayerFilter:function(e,t){if(!this.layerDefs){this.layerDefs={}}if(t){this.layerDefs[e]=t}else{delete this.layerDefs[e]}},clearLayerFilter:function(e){if(e){delete this.layerDefs[e]}else{delete this.layerDefs}},mergeNewParams:function(e){var t=OpenLayers.Util.upperCaseObject(e);var i=[t];return OpenLayers.Layer.Grid.prototype.mergeNewParams.apply(this,i)},CLASS_NAME:"OpenLayers.Layer.ArcGIS93Rest"});Ext.namespace("gxp.plugins");gxp.plugins.ArcRestSource=Ext.extend(gxp.plugins.LayerSource,{ptype:"gxp_arcrestsource",requiredProperties:["name"],constructor:function(e){this.config=e;gxp.plugins.ArcRestSource.superclass.constructor.apply(this,arguments)},createStore:function(){var o=this.url.split("?")[0];var l=this;var e=function(e){var t=Ext.decode(e.responseText);var i=l.getArcProjection(t.spatialReference.wkid);var r=[];if(i!=null){for(var a=0;a<t.layers.length;a++){var s=t.layers[a];var n="show:"+s.id;r.push(new OpenLayers.Layer.ArcGIS93Rest(s.name,o+"/export",{layers:n,TRANSPARENT:true},{isBaseLayer:false,ratio:1,displayInLayerSwitcher:true,visibility:true,projection:i,queryable:t.capabilities&&t.capabilities["Identify"]}))}}else{h(e)}l.title=t.documentInfo.Title;l.store=new GeoExt.data.LayerStore({layers:r,fields:[{name:"source",type:"string"},{name:"name",type:"string",mapping:"name"},{name:"layerid",type:"string"},{name:"group",type:"string",defaultValue:this.title},{name:"fixed",type:"boolean",defaultValue:true},{name:"tiled",type:"boolean",defaultValue:true},{name:"queryable",type:"boolean",defaultValue:true},{name:"selected",type:"boolean"}]});l.fireEvent("ready",l)};var h=function(e){Ext.Msg.alert("No ArcGIS Layers","Could not find any compatible layers  at "+l.config.url);l.fireEvent("failure",l)};this.lazy=this.isLazy();if(!this.lazy){Ext.Ajax.request({url:o,params:{f:"json",pretty:"false",keepPostParams:"true"},method:"POST",success:e,failure:h})}else{this.fireEvent("ready")}},isLazy:function(){var e=true;var t=false;var i=this.target.initialConfig.map;if(i&&i.layers){var r;for(var a=0,s=i.layers.length;a<s;++a){r=i.layers[a];if(r.source===this.id){t=true;e=this.layerConfigComplete(r);if(e===false){break}}}}return e&&t},layerConfigComplete:function(e){var t=true;var i=this.requiredProperties;for(var r=i.length-1;r>=0;--r){t=!!e[i[r]];if(t===false){break}}return t},createLayerRecord:function(t){var e,i;var r=function(e){return e.get("name")===t.name};var a=this.lazy||this.store&&this.store.findBy(r)>-1;if(this.target.mapPanel.layers.findBy(r)==-1&&a){if(!this.lazy&&this.store.findBy(r)>-1){e=this.store.getAt(this.store.findBy(r)).clone()}else{e=this.createLazyLayerRecord(t)}i=e.getLayer();if(t.title){i.setName(t.title);e.set("title",t.title)}if("visibility"in t){i.visibility=t.visibility}if("opacity"in t){i.opacity=t.opacity}if("format"in t){i.params.FORMAT=t.format;e.set("format",t.format)}var s=false;if("tiled"in t){s=!t.tiled}e.set("tiled",!s);e.set("selected",t.selected||false);e.set("queryable",t.queryable||true);e.set("source",t.source);e.set("name",t.name);e.set("layerid",t.layerid);e.set("properties","gxp_wmslayerpanel");if("group"in t){e.set("group",t.group)}e.commit()}return e},getArcProjection:function(e){var t=this.getMapProjection();var i=t;var r="EPSG:"+e+"";if(r!==t.getCode()){i=null;if((p=new OpenLayers.Projection(r)).equals(t)){i=p}}return i},createLazyLayerRecord:function(e){var t=e.srs||this.target.map.projection;e.srs={};e.srs[t]=true;var i=e.bbox||this.target.map.maxExtent||OpenLayers.Projection.defaults[t].maxExtent;e.bbox={};e.bbox[t]={bbox:i};var r=new GeoExt.data.LayerRecord(e);r.set("name",e.name);r.set("layerid",e.layerid||"show:0");r.set("format",e.format||"png");r.set("tiled","tiled"in e?e.tiled:true);r.setLayer(new OpenLayers.Layer.ArcGIS93Rest(e.name,this.url.split("?")[0]+"/export",{layers:e.layerid,TRANSPARENT:true,FORMAT:"format"in e?e.format:"png"},{isBaseLayer:false,displayInLayerSwitcher:true,projection:t,singleTile:"tiled"in e?!e.tiled:false,queryable:"queryable"in e?e.queryable:false}));return r},getConfigForRecord:function(e){var t=e.getLayer();return{source:e.get("source"),name:e.get("name"),title:e.get("title"),tiled:e.get("tiled"),visibility:t.getVisibility(),layerid:t.params.LAYERS,format:t.params.FORMAT,opacity:t.opacity||undefined,group:e.get("group"),fixed:e.get("fixed"),selected:e.get("selected")}}});Ext.preg(gxp.plugins.ArcRestSource.prototype.ptype,gxp.plugins.ArcRestSource);Ext.namespace("gxp.plugins");gxp.plugins.AddLayers=Ext.extend(gxp.plugins.Tool,{ptype:"gxp_addlayers",addActionMenuText:gettext("Add layers"),findActionMenuText:gettext("Find layers"),addFeedActionMenuText:gettext("Add feeds"),addActionTip:gettext("Add layers"),addServerText:gettext("Add a New Server"),addButtonText:gettext("Add layers"),untitledText:gettext("Untitled"),addLayerSourceErrorText:gettext("Error getting {type} capabilities ({msg}).\nPlease check the url and try again."),availableLayersText:gettext("Available Layers"),searchText:gettext("Search for layers"),expanderTemplateText:gettext("<p><b>Abstract:</b> {abstract}</p>"),panelTitleText:gettext("Title"),layerSelectionText:gettext("View available data from:"),doneText:gettext("Done"),uploadRoles:["ROLE_ADMINISTRATOR"],uploadText:gettext("Upload layers"),relativeUploadOnly:true,startSourceId:null,catalogSourceKey:null,selectedSource:null,addServerId:null,constructor:function(e){this.addEvents("sourceselected");gxp.plugins.AddLayers.superclass.constructor.apply(this,arguments)},addActions:function(){var e={tooltip:this.addActionTip,text:this.addActionText,menuText:this.addActionMenuText,disabled:true,iconCls:"gxp-icon-addlayers"};var t,i;if(this.initialConfig.search||this.uploadSource){var r=[new Ext.menu.Item({iconCls:"gxp-icon-addlayers",text:this.addActionMenuText,handler:this.showCapabilitiesGrid,scope:this})];if(this.initialConfig.search&&this.initialConfig.search.selectedSource&&this.target.sources[this.initialConfig.search.selectedSource]){var a=new Ext.menu.Item({iconCls:"gxp-icon-addlayers",text:this.findActionMenuText,handler:this.showCatalogueSearch,scope:this});r.push(a);Ext.Ajax.request({method:"GET",url:this.target.sources[this.initialConfig.search.selectedSource].url,callback:function(e,t,i){if(t===false){this.target.layerSources[this.initialConfig.search.selectedSource].disable();a.hide()}},scope:this})}if(this.initialConfig.feeds){r.push(new Ext.menu.Item({iconCls:"gxp-icon-addlayers",text:this.addFeedActionMenuText,handler:this.showFeedDialog,scope:this}))}if(this.uploadSource){i=this.createUploadButton(Ext.menu.Item);if(i){r.push(i)}}t=Ext.apply(e,{menu:new Ext.menu.Menu({items:r})})}else{t=Ext.apply(e,{handler:this.showCapabilitiesGrid,scope:this})}var s=gxp.plugins.AddLayers.superclass.addActions.apply(this,[t]);this.target.on("ready",function(){if(this.uploadSource){var e=this.target.layerSources[this.uploadSource];if(e){this.setSelectedSource(e)}else{delete this.uploadSource;if(i){i.hide()}}}s[0].enable()},this);return s},showCatalogueSearch:function(){var e=this.initialConfig.search.selectedSource;var t={};var i=false;for(var r in this.target.layerSources){var a=this.target.layerSources[r];if(a instanceof gxp.plugins.CatalogueSource){var s={};s[r]=a;Ext.apply(t,s);i=true}}if(i===false){if(window.console){window.console.debug("No catalogue source specified")}return}var n=gxp.plugins.AddLayers.superclass.addOutput.apply(this,[{sources:t,title:this.searchText,height:300,width:315,selectedSource:e,xtype:"gxp_cataloguesearchpanel",map:this.target.mapPanel.map}]);n.on({addlayer:function(e,t,i){var r=this.target.layerSources[t];var a=OpenLayers.Bounds.fromArray(i.bbox,r.yx&&r.yx[i.projection]===true);var s=this.target.mapPanel.map.getProjection();var n=a.transform(i.srs,s);i.srs=s;i.bbox=n.toArray();i.source=this.initialConfig.catalogSourceKey!==null?this.initialConfig.catalogSourceKey:t;var o=r.createLayerRecord(i);this.target.mapPanel.layers.add(o);if(n){this.target.mapPanel.map.zoomToExtent(n)}},scope:this});var o=n.findParentByType("window");o&&o.center();return n},showCapabilitiesGrid:function(){if(!this.capGrid){this.initCapGrid()}else if(!(this.capGrid instanceof Ext.Window)){this.addOutput(this.capGrid)}this.capGrid.show()},showFeedDialog:function(){if(!this.feedDialog){var e=this.outputTarget?Ext.Panel:Ext.Window;this.feedDialog=new e(Ext.apply({closeAction:"hide",autoScroll:true,title:this.addFeedActionMenuText,items:[{xtype:"gxp_feedsourcedialog",target:this.target,listeners:{addfeed:function(e,t){var i={config:{ptype:e}};if(t.url){i.config["url"]=t.url}var r=this.target.addLayerSource(i);t.source=r.id;var a=r.createLayerRecord(t);this.target.mapPanel.layers.add([a]);this.feedDialog.hide()},scope:this}}]},this.initialConfig.outputConfig));if(e===Ext.Panel){this.addOutput(this.feedDialog)}}if(!(this.feedDialog instanceof Ext.Window)){this.addOutput(this.feedDialog)}this.feedDialog.show()},initCapGrid:function(){var e,t=[],i=this.target;for(var r in i.layerSources){e=i.layerSources[r];if(e.store&&!e.hidden){t.push([r,e.title||r,e.url])}}var a=new Ext.data.ArrayStore({fields:["id","title","url"],data:t});var s=this.createExpander();function p(){var e=this.selectedSource;var t=l.getSelectionModel().getSelections();var i=[],r=t.length;function a(e){if(i){i.push(e)}r--;if(r===0){this.addLayers(i)}}for(var s=0,n=t.length;s<n;++s){var o=e.createLayerRecord({name:t[s].get("name"),source:e.id},a,this);if(o){a.call(this,o)}}}var n=0;if(this.startSourceId!==null){a.each(function(e){if(e.get("id")===this.startSourceId){n=a.indexOf(e)}},this)}e=this.target.layerSources[t[n][0]];var l=new Ext.grid.GridPanel({store:e.store,autoScroll:true,autoExpandColumn:"title",plugins:[s],loadMask:true,colModel:new Ext.grid.ColumnModel([s,{id:"title",header:this.panelTitleText,dataIndex:"title",sortable:true},{header:gettext("Id"),dataIndex:"name",width:120,sortable:true}]),listeners:{rowdblclick:p,scope:this}});var o=new Ext.form.ComboBox({ref:"../../sourceComboBox",width:165,store:a,valueField:"id",displayField:"title",tpl:'<tpl for="."><div ext:qtip="{url}" class="x-combo-list-item">{title}</div></tpl>',triggerAction:"all",editable:false,allowBlank:false,forceSelection:true,mode:"local",value:t[n][0],listeners:{select:function(e,t,i){var r=t.get("id");if(r===this.addServerId){y();o.reset();return}var a=this.target.layerSources[r];l.reconfigure(a.store,l.getColumnModel());l.getView().focusRow(0);this.setSelectedSource(a);(function(){e.triggerBlur();e.el.blur()}).defer(100)},focus:function(e){if(i.proxy){e.reset()}},scope:this}});var u=null,c;if(this.target.proxy||t.length>1){c=new Ext.Container({cls:"gxp-addlayers-sourceselect",items:[new Ext.Toolbar.TextItem({text:this.layerSelectionText}),o]});u=[c]}if(this.target.proxy){this.addServerId=Ext.id();a.loadData([[this.addServerId,this.addServerText+"..."]],true)}var d={xtype:"gxp_newsourcedialog",header:false,listeners:{hide:function(e){if(!this.outputTarget){e.ownerCt.hide()}},urlselected:function(i,e,r){i.setLoading();var t;switch(r){case"TMS":t="gxp_tmssource";break;case"REST":t="gxp_arcrestsource";break;default:t="gxp_wmscsource"}this.target.addLayerSource({config:{url:e,ptype:t},callback:function(e){var t=new a.recordType({id:e,title:this.target.layerSources[e].title||this.untitledText});a.insert(0,[t]);o.onSelect(t,0);i.hide()},fallback:function(e,t){i.setError(new Ext.Template(this.addLayerSourceErrorText).apply({type:r,msg:t}))},scope:this})},scope:this}};var f=this;function y(){if(f.outputTarget){f.addOutput(d)}else{new Ext.Window({title:gxp.NewSourceDialog.prototype.title,modal:true,hideBorders:true,width:300,items:d}).show()}}var g={xtype:"container",region:"center",layout:"fit",hideBorders:true,items:[l]};if(this.instructionsText){g.items.push({xtype:"box",autoHeight:true,autoEl:{tag:"p",cls:"x-form-item",style:"padding-left: 5px; padding-right: 5px"},html:this.instructionsText})}var m=["->",new Ext.Button({text:this.addButtonText,iconCls:"gxp-icon-addlayers",handler:p,scope:this}),new Ext.Button({text:this.doneText,handler:function(){this.capGrid.hide()},scope:this})];var h;if(!this.uploadSource){h=this.createUploadButton();if(h){m.unshift(h)}}var v=this.outputTarget?Ext.Panel:Ext.Window;this.capGrid=new v(Ext.apply({title:this.availableLayersText,closeAction:"hide",layout:"border",height:300,width:315,modal:true,items:g,tbar:u,bbar:m,listeners:{hide:function(e){l.getSelectionModel().clearSelections()},show:function(e){if(this.selectedSource===null){this.setSelectedSource(this.target.layerSources[t[n][0]])}else{this.setSelectedSource(this.selectedSource)}},scope:this}},this.initialConfig.outputConfig));if(v===Ext.Panel){this.addOutput(this.capGrid)}},addLayers:function(e,t){var i=this.selectedSource;var r=this.target.mapPanel.layers,a,s,n;for(var o=0,p=e.length;o<p;++o){s=i.createLayerRecord({name:e[o].get("name"),source:i.id})||e[o];if(s){n=s.getLayer();if(n.maxExtent){if(!a){a=s.getLayer().maxExtent.clone()}else{a.extend(s.getLayer().maxExtent)}}if(s.get("group")==="background"){r.insert(1,[s])}else{r.add([s])}}}if(a){this.target.mapPanel.map.zoomToExtent(a)}if(e.length===1&&s){this.target.selectLayer(s);if(t&&this.postUploadAction){var l,h=this.postUploadAction;if(!Ext.isString(h)){l=h.outputConfig;h=h.plugin}this.target.tools[h].addOutput(l)}}},setSelectedSource:function(e,t){this.selectedSource=e;var i=e.store;this.fireEvent("sourceselected",this,e);if(this.capGrid&&e.lazy){e.store.load({callback:function(){var e=this.capGrid.sourceComboBox,t=e.store,i=e.valueField,r=t.findExact(i,e.getValue()),a=t.getAt(r),s=this.target.layerSources[a.get("id")];if(s){if(s.title!==a.get("title")&&!Ext.isEmpty(s.title)){a.set("title",s.title);e.setValue(a.get(i))}}else{t.remove(a)}}.createDelegate(this)})}},createUploadButton:function(e){e=e||Ext.Button;var r;var t=this.initialConfig.upload||!!this.initialConfig.uploadSource;var a;if(t){if(typeof t==="boolean"){t={}}r=new e({text:this.uploadText,iconCls:"gxp-icon-filebrowse",hidden:!this.uploadSource,handler:function(){this.target.doAuthorized(this.uploadRoles,function(){var e=new gxp.LayerUploadPanel(Ext.apply({title:this.outputTarget?this.uploadText:undefined,url:a,width:300,border:false,bodyStyle:"padding: 10px 10px 0 10px;",labelWidth:65,autoScroll:true,defaults:{anchor:"99%",allowBlank:false,msgTarget:"side"},listeners:{uploadcomplete:function(e,t){var i=t["import"].tasks;var r,o={},a,h;for(var s=0,n=i.length;s<n;++s){r=i[s];if(r.state==="ERROR"){Ext.Msg.alert(r.layer.originalName,r.errorMessage);return}var l;if(r.target.dataStore){l=r.target.dataStore.workspace.name}else if(r.target.coverageStore){l=r.target.coverageStore.workspace.name}o[l+":"+r.layer.name]=true}this.selectedSource.store.load({params:{_dc:Math.random()},callback:function(e,t,i){var r,a;if(this.capGrid&&this.capGrid.isVisible()){r=this.capGrid.get(0).get(0);a=r.getSelectionModel();a.clearSelections()}var s=[];var n=0;this.selectedSource.store.each(function(e,t){if(e.get("name")in o){n=t;s.push(e)}});if(r){window.setTimeout(function(){a.selectRecords(s);r.getView().focusRow(n)},100)}else{this.addLayers(s,true)}},scope:this});if(this.outputTarget){e.hide()}else{p.close()}},scope:this}},t));var p;if(this.outputTarget){this.addOutput(e)}else{p=new Ext.Window({title:this.uploadText,modal:true,resizable:false,items:[e]});p.show()}},this)},scope:this});var o={};function s(a,s,n){if(a in o){window.setTimeout(function(){s.call(n,o[a])},0)}else{Ext.Ajax.request({url:a,disableCaching:false,callback:function(e,t,i){var r=i.status;o[a]=r;s.call(n,r)}})}}this.on({sourceselected:function(e,t){r[this.uploadSource?"show":"hide"]();var i=false;if(this.isEligibleForUpload(t)){a=this.getGeoServerRestUrl(t.url);if(this.target.isAuthorized()){s(a+"/imports",function(e){r.setVisible(e===200)},this)}}},scope:this})}return r},getGeoServerRestUrl:function(e){var t=e.split("/");t.pop();t.push("rest");return t.join("/")},isEligibleForUpload:function(e){return e.url&&(this.relativeUploadOnly?e.url.charAt(0)==="/":true)&&(this.nonUploadSources||[]).indexOf(e.id)===-1},createExpander:function(){return new Ext.grid.RowExpander({tpl:new Ext.Template(this.expanderTemplateText)})}});Ext.preg(gxp.plugins.AddLayers.prototype.ptype,gxp.plugins.AddLayers);Ext.namespace("gxp.plugins");gxp.plugins.RemoveLayer=Ext.extend(gxp.plugins.Tool,{ptype:"gxp_removelayer",removeMenuText:gettext("Remove layer"),removeActionTip:gettext("Remove layer"),addActions:function(){var t;var e=gxp.plugins.RemoveLayer.superclass.addActions.apply(this,[{menuText:this.removeMenuText,iconCls:"gxp-icon-removelayers",disabled:true,tooltip:this.removeActionTip,handler:function(){var e=t;if(e){this.target.mapPanel.layers.remove(e)}},scope:this}]);var i=e[0];this.target.on("layerselectionchange",function(e){t=e;i.setDisabled(this.target.mapPanel.layers.getCount()<=1||!e)},this);var r=function(e){i.setDisabled(!t||e.getCount()<=1)};this.target.mapPanel.layers.on({add:r,remove:r});return e}});Ext.preg(gxp.plugins.RemoveLayer.prototype.ptype,gxp.plugins.RemoveLayer);Ext.namespace("gxp.plugins");gxp.plugins.LayerProperties=Ext.extend(gxp.plugins.Tool,{ptype:"gxp_layerproperties",menuText:gettext("Layer Properties"),toolTip:gettext("Layer Properties"),constructor:function(e){gxp.plugins.LayerProperties.superclass.constructor.apply(this,arguments);if(!this.outputConfig){this.outputConfig={width:325,autoHeight:true}}},addActions:function(){var e=gxp.plugins.LayerProperties.superclass.addActions.apply(this,[{menuText:this.menuText,iconCls:"gxp-icon-layerproperties",disabled:true,tooltip:this.toolTip,handler:function(){this.removeOutput();this.addOutput()},scope:this}]);var t=e[0];this.target.on("layerselectionchange",function(e){t.setDisabled(!e||!e.get("properties"))},this);return e},addOutput:function(e){e=e||{};var t=this.target.selectedLayer;var i=this.initialConfig.outputConfig||{};this.outputConfig.title=i.title||this.menuText+": "+t.get("title");this.outputConfig.shortTitle=t.get("title");var r=t.get("properties")||"gxp_layerpanel";var a=this.layerPanelConfig;if(a&&a[r]){Ext.apply(e,a[r])}var s=gxp.plugins.LayerProperties.superclass.addOutput.call(this,Ext.apply({xtype:r,authorized:this.target.isAuthorized(),layerRecord:t,source:this.target.getSource(t),defaults:{style:"padding: 10px",autoHeight:this.outputConfig.autoHeight}},e));s.on({added:function(e){if(!this.outputTarget){e.on("afterrender",function(){e.ownerCt.ownerCt.center()},this,{single:true})}},scope:this});return s}});Ext.preg(gxp.plugins.LayerProperties.prototype.ptype,gxp.plugins.LayerProperties);Ext.namespace("gxp.plugins");gxp.plugins.ZoomToLayerExtent=Ext.extend(gxp.plugins.ZoomToExtent,{ptype:"gxp_zoomtolayerextent",menuText:gettext("Zoom to layer extent"),tooltip:gettext("Zoom to layer extent"),iconCls:"gxp-icon-zoom-to",destroy:function(){this.selectedRecord=null;gxp.plugins.ZoomToLayerExtent.superclass.destroy.apply(this,arguments)},extent:function(){var e=this.selectedRecord.getLayer(),t;if(OpenLayers.Layer.Vector){t=e instanceof OpenLayers.Layer.Vector&&e.getDataExtent()}return e.restrictedExtent||t||e.maxExtent||map.maxExtent},addActions:function(){var t=gxp.plugins.ZoomToLayerExtent.superclass.addActions.apply(this,arguments);t[0].disable();this.target.on("layerselectionchange",function(e){this.selectedRecord=e;t[0].setDisabled(!e||!e.get("layer"))},this);return t}});Ext.preg(gxp.plugins.ZoomToLayerExtent.prototype.ptype,gxp.plugins.ZoomToLayerExtent);Ext.namespace("gxp.plugins");gxp.plugins.ZoomToSelectedFeatures=Ext.extend(gxp.plugins.ZoomToExtent,{ptype:"gxp_zoomtoselectedfeatures",menuText:gettext("Zoom to selected features"),tooltip:gettext("Zoom to selected features"),closest:false,layer:null,iconCls:"gxp-icon-zoom-to",extent:function(){var e=this.target.tools[this.featureManager].featureLayer;var t,i,r,a=e.selectedFeatures;for(var s=a.length-1;s>=0;--s){i=a[s].geometry;if(i){r=i.getBounds();if(t){t.extend(r)}else{t=r.clone()}}}return t},addActions:function(){var t=gxp.plugins.ZoomToSelectedFeatures.superclass.addActions.apply(this,arguments);t[0].disable();var e={featureselected:function(e){if(t[0].isDisabled()&&e.feature.geometry!==null){t[0].enable()}},featureunselected:function(){if(this.layer.selectedFeatures.length===0){t[0].disable()}},scope:this};var i=this.target.tools[this.featureManager];function r(){if(this.layer){this.layer.events.un(e)}this.layer=i.featureLayer;if(this.layer){this.layer.events.on(e)}}this.target.on("layerselectionchange",r);i.on("query",function(){t[0].disable()});r.call(this);return t}});Ext.preg(gxp.plugins.ZoomToSelectedFeatures.prototype.ptype,gxp.plugins.ZoomToSelectedFeatures);Ext.namespace("gxp.plugins");gxp.plugins.Legend=Ext.extend(gxp.plugins.Tool,{ptype:"gxp_legend",menuText:gettext("Legend"),tooltip:gettext("Show Legend"),actionTarget:null,constructor:function(e){gxp.plugins.Legend.superclass.constructor.apply(this,arguments);if(!this.outputConfig){this.outputConfig={width:300,height:400}}Ext.applyIf(this.outputConfig,{title:this.menuText})},addActions:function(){var e=[{menuText:this.menuText,iconCls:"gxp-icon-legend",tooltip:this.tooltip,handler:function(){this.removeOutput();this.addOutput(this.outputConfig)},scope:this}];return gxp.plugins.Legend.superclass.addActions.apply(this,[e])},getLegendPanel:function(){return this.output[0]},addOutput:function(e){return gxp.plugins.Legend.superclass.addOutput.call(this,Ext.apply({xtype:"gx_legendpanel",ascending:false,border:false,hideMode:"offsets",layerStore:this.target.mapPanel.layers,defaults:{cls:"gxp-legend-item"}},e))}});Ext.preg(gxp.plugins.Legend.prototype.ptype,gxp.plugins.Legend);Ext.namespace("gxp.plugins");gxp.plugins.Print=Ext.extend(gxp.plugins.Tool,{ptype:"gxp_print",printService:null,printCapabilities:null,customParams:null,includeLegend:false,includeMapComments:false,menuText:gettext("Print Map"),tooltip:gettext("Print Map"),buttonText:gettext("Print"),notAllNotPrintableText:gettext("Not All Layers Can Be Printed"),nonePrintableText:gettext("None of your current map layers can be printed"),previewText:gettext("Print Preview"),openInNewWindow:false,constructor:function(e){gxp.plugins.Print.superclass.constructor.apply(this,arguments)},addActions:function(){if(this.printService!==null||this.printCapabilities!=null){var r=new GeoExt.data.PrintProvider({capabilities:this.printCapabilities,url:this.printService,customParams:this.customParams,autoLoad:false,listeners:{beforedownload:function(e,t){if(this.openInNewWindow===true){window.open(t);return false}},beforeencodelegend:function(e,r,t){if(t&&t.ptype==="gxp_layermanager"){var a=[];var i=t.output;if(i&&i[0]){i[0].getRootNode().cascade(function(e){if(e.component&&!e.component.hidden){var t=e.component;var i=this.encoders.legends[t.getXType()];console.log(t.layerRecord.data.styles);if(t.layerRecord.json.name!="geonode:afg_elev_dem_30m_aster_hillshade"){a=a.concat(i.call(this,t,r.pages[0].scale))}}},e)}r.legends=a;return false}},beforeprint:function(){a.items.get(0).printMapPanel.layers.each(function(e){var t=e.get("layer").params;for(var i in t){if(t[i]instanceof Array){t[i]=t[i].join(",")}}})},loadcapabilities:function(){if(t){t.initialConfig.disabled=false;t.enable()}},print:function(){try{a.close()}catch(e){}},printException:function(e,t){if(t.responseText&&/GetLegendGraphic/.test(t.responseText)){this.target.displayXHRTrouble&&this.target.displayXHRTrouble(gettext("Possible <b>GetLegendGraphic error</b>. Please make sure layer legends are valid. Workaround suggestions:<ul><li>&bull; Unselect layers which legend are not valid</li><li>&bull; Uncheck 'Include legend?' in Print Preview dialog</li></ul>"),t.status)}else if(t.responseText){this.target.displayXHRTrouble&&this.target.displayXHRTrouble(t.responseText.substr(0,1e3)+"&hellip;")}else{this.target.displayXHRTrouble&&this.target.displayXHRTrouble(t)}},scope:this}});var e=gxp.plugins.Print.superclass.addActions.call(this,[{menuText:this.menuText,buttonText:this.buttonText,tooltip:this.tooltip,iconCls:"gxp-icon-print",handler:function(){var e=i();if(e.length>0){var t=l.call(this);h.call(this);return t}else{Ext.Msg.alert(this.notAllNotPrintableText,this.nonePrintableText)}},scope:this,listeners:{render:function(){r.loadCapabilities()}}}]);var t=e[0].items[0];var a;function s(){if(a){try{var e=a.items.first();e.printMapPanel.printPage.destroy()}catch(e){}a=null}}var n=this.target.mapPanel;function i(){var i=[];n.layers.each(function(e){var t=e.getLayer();if(o(t)){i.push(t)}});return i}function o(e){return e.getVisibility()===true&&(e instanceof OpenLayers.Layer.WMS||e instanceof OpenLayers.Layer.OSM||e instanceof OpenLayers.Layer.Google||e instanceof OpenLayers.Layer.XYZ||e.name=="Mask Layer")}function l(){var e=null;if(this.includeLegend===true){var t,i;for(t in this.target.tools){i=this.target.tools[t];if(i.ptype==="gxp_legend"){e=i.getLegendPanel();break}}if(e===null){for(t in this.target.tools){i=this.target.tools[t];if(i.ptype==="gxp_layermanager"){e=i;break}}}}a=new Ext.Window({title:this.previewText,modal:true,border:false,autoHeight:true,resizable:false,width:360,items:[new GeoExt.ux.PrintPreview({minWidth:336,mapTitle:this.target.about&&this.target.about["title"],comment:this.target.about&&this.target.about["abstract"],printMapPanel:{autoWidth:true,height:Math.min(420,Ext.get(document.body).getHeight()-150),limitScales:true,map:Ext.applyIf({fractionalZoom:false,controls:[new OpenLayers.Control.PanPanel,new OpenLayers.Control.ZoomPanel,new OpenLayers.Control.CustomNavToolbar,new OpenLayers.Control.Attribution],eventListeners:{preaddlayer:function(e){return o(e.layer)}}},n.initialConfig.map),items:[{xtype:"gx_zoomslider",vertical:true,height:100,aggressive:true}],listeners:{afterlayout:function(e){a.setWidth(Math.max(360,this.getWidth()+24));a.center()}}},printProvider:r,includeLegend:this.includeLegend,includeMapComments:this.includeMapComments,legend:e,sourceMap:n})],listeners:{beforedestroy:s}});return a}function h(){a.show();a.setWidth(0);var e=a.items.get(0).items.get(0);var t=0;e.items.each(function(e){if(e.getEl()){t+=e.getWidth()}});a.setWidth(Math.max(a.items.get(0).printMapPanel.getWidth(),t+20));a.center()}return e}}});Ext.preg(gxp.plugins.Print.prototype.ptype,gxp.plugins.Print);Ext.namespace("gxp.plugins");gxp.plugins.WMSRasterStylesDialog={isRaster:null,init:function(e){Ext.apply(e,gxp.plugins.WMSRasterStylesDialog)},createRule:function(){var e=[new OpenLayers.Symbolizer[this.isRaster?"Raster":this.symbolType]];return new OpenLayers.Rule({symbolizers:e})},addRule:function(){var e=this.items.get(2).items.get(0);if(this.isRaster){e.rules.push(this.createPseudoRule());e.rules.length==1&&e.rules.push(this.createPseudoRule());this.savePseudoRules()}else{this.selectedStyle.get("userStyle").rules.push(this.createRule());e.update();this.selectedStyle.store.afterEdit(this.selectedStyle)}this.updateRuleRemoveButton()},removeRule:function(){if(this.isRaster){var e=this.items.get(2).items.get(0);var t=this.selectedRule;e.unselect();e.rules.remove(t);e.rules.length==1&&e.rules.remove(e.rules[0]);this.savePseudoRules()}else{gxp.WMSStylesDialog.prototype.removeRule.apply(this,arguments)}},duplicateRule:function(){var e=this.items.get(2).items.get(0);if(this.isRaster){e.rules.push(this.createPseudoRule({quantity:this.selectedRule.name,label:this.selectedRule.title,color:this.selectedRule.symbolizers[0].fillColor,opacity:this.selectedRule.symbolizers[0].fillOpacity}));this.savePseudoRules()}else{var t=this.selectedRule.clone();t.name=gxp.util.uniqueName((t.title||t.name)+" (copy)");delete t.title;this.selectedStyle.get("userStyle").rules.push(t);e.update()}this.updateRuleRemoveButton()},editRule:function(){this.isRaster?this.editPseudoRule():gxp.WMSStylesDialog.prototype.editRule.apply(this,arguments)},editPseudoRule:function(){var r=this;var a=this.selectedRule;var i=new Ext.Window({title:gettext("Color Map Entry: ")+a.name,width:340,autoHeight:true,modal:true,items:[{bodyStyle:"padding-top: 5px",border:false,defaults:{autoHeight:true,hideMode:"offsets"},items:[{xtype:"form",border:false,labelAlign:"top",defaults:{border:false},style:{padding:"0.3em 0 0 1em"},items:[{layout:"column",defaults:{border:false,style:{"padding-right":"1em"}},items:[{layout:"form",width:70,items:[{xtype:"numberfield",anchor:"95%",value:a.name,allowBlank:false,fieldLabel:gettext("Quantity"),validator:function(e){var t=r.items.get(2).items.get(0).rules;for(var i=t.length-1;i>=0;i--){if(a!==t[i]&&t[i].name==e){return"Quantity "+e+" is already defined"}}return true},listeners:{valid:function(e){this.selectedRule.name=String(e.getValue());this.savePseudoRules()},scope:this}}]},{layout:"form",width:130,items:[{xtype:"textfield",fieldLabel:gettext("Label"),anchor:"95%",value:a.title,listeners:{valid:function(e){this.selectedRule.title=e.getValue();this.savePseudoRules()},scope:this}}]},{layout:"form",width:70,items:[new GeoExt.FeatureRenderer({symbolType:this.symbolType,symbolizers:[a.symbolizers[0]],isFormField:true,fieldLabel:gettext("Appearance")})]}]}]},{xtype:"gxp_polygonsymbolizer",symbolizer:a.symbolizers[0],bodyStyle:{padding:"10px"},border:false,labelWidth:70,defaults:{labelWidth:70},listeners:{change:function(e){var t=i.findByType(GeoExt.FeatureRenderer)[0];t.setSymbolizers([e],{draw:t.rendered});this.selectedRule.symbolizers[0]=e;this.savePseudoRules()},scope:this}}]}]});var e=i.findByType("gxp_strokesymbolizer")[0];e.ownerCt.remove(e);i.show()},savePseudoRules:function(){var e=this.selectedStyle;var t=this.items.get(2).items.get(0);var i=e.get("userStyle");var r=t.rules;r.sort(function(e,t){var i=parseFloat(e.name);var r=parseFloat(t.name);return i===r?0:i<r?-1:1});var a=i.rules[0].symbolizers[0];a.colorMap=r.length>0?new Array(r.length):undefined;var s;for(var n=0,o=r.length;n<o;++n){s=r[n];a.colorMap[n]={quantity:parseFloat(s.name),label:s.title||undefined,color:s.symbolizers[0].fillColor||undefined,opacity:s.symbolizers[0].fill==false?0:s.symbolizers[0].fillOpacity}}this.afterRuleChange(this.selectedRule)},createLegend:function(e,t){var i=OpenLayers.Symbolizer.Raster;if(i&&e[0]&&e[0].symbolizers[0]instanceof i){this.getComponent("rulesfieldset").setTitle("Color Map Entries");this.isRaster=true;this.addRasterLegend(e,t)}else{this.isRaster=false;this.addVectorLegend(e)}},addRasterLegend:function(e,t){t=t||{};var i=e[0].symbolizers[0];var r=i.colorMap||[];var a=[];var s;for(var n=0,o=r.length;n<o;n++){a.push(this.createPseudoRule(r[n]))}this.selectedRule=t.selectedRuleIndex!=null?a[t.selectedRuleIndex]:null;return this.addVectorLegend(a,{symbolType:"Polygon",enableDD:false})},createPseudoRule:function(e){var t=-1;if(!e){var i=this.items.get(2);if(i.items){rules=i.items.get(0).rules;for(var r=rules.length-1;r>=0;r--){t=Math.max(t,parseFloat(rules[r].name))}}}e=Ext.applyIf(e||{},{quantity:++t,color:"#000000",opacity:1});return new OpenLayers.Rule({title:e.label,name:String(e.quantity),symbolizers:[new OpenLayers.Symbolizer.Polygon({fillColor:e.color,fillOpacity:e.opacity,stroke:false,fill:e.opacity!==0})]})},updateRuleRemoveButton:function(){this.items.get(3).items.get(1).setDisabled(!this.selectedRule||this.isRaster===false&&this.items.get(2).items.get(0).rules.length<=1)}};Ext.preg("gxp_wmsrasterstylesdialog",gxp.plugins.WMSRasterStylesDialog);Ext.namespace("gxp.plugins");gxp.plugins.Styler=Ext.extend(gxp.plugins.Tool,{ptype:"gxp_styler",menuText:gettext("Edit Styles"),tooltip:gettext("Manage layer styles"),roles:["ROLE_ADMINISTRATOR"],sameOriginStyling:true,rasterStyling:false,requireDescribeLayer:true,constructor:function(e){gxp.plugins.Styler.superclass.constructor.apply(this,arguments);if(!this.outputConfig){this.outputConfig={autoHeight:true,width:265}}Ext.applyIf(this.outputConfig,{closeAction:"close"})},init:function(e){gxp.plugins.Styler.superclass.init.apply(this,arguments);this.target.on("authorizationchange",this.enableOrDisable,this)},destroy:function(){this.target.un("authorizationchange",this.enableOrDisable,this);gxp.plugins.Styler.superclass.destroy.apply(this,arguments)},enableOrDisable:function(){if(this.target&&this.target.selectedLayer!==null){this.handleLayerChange(this.target.selectedLayer)}},addActions:function(){var e;var t=gxp.plugins.Styler.superclass.addActions.apply(this,[{menuText:this.menuText,iconCls:"gxp-icon-palette",disabled:true,tooltip:this.tooltip,handler:function(){this.target.doAuthorized(this.roles,this.addOutput,this)},scope:this}]);this.launchAction=t[0];this.target.on({layerselectionchange:this.handleLayerChange,scope:this});return t},handleLayerChange:function(t){this.launchAction.disable();if(t){var e=this.target.getSource(t);if(e instanceof gxp.plugins.WMSSource){e.describeLayer(t,function(e){this.checkIfStyleable(t,e)},this)}}},checkIfStyleable:function(e,t){if(t){var i=["WFS"];if(this.rasterStyling===true){i.push("WCS")}}if(t?i.indexOf(t.get("owsType"))!==-1:!this.requireDescribeLayer){var r=false;var a=this.target.layerSources[e.get("source")];var s;var n=e.get("restUrl");if(n){s=n+"/styles"}else{s=a.url.split("?").shift().replace(/\/(wms|ows)\/?$/,"/rest/styles")}if(this.sameOriginStyling){r=s.charAt(0)==="/";if(this.target.authenticate&&r){this.launchAction.enable();return}}else{r=true}if(r){if(this.target.isAuthorized()){this.enableActionIfAvailable(s)}}}},enableActionIfAvailable:function(e){Ext.Ajax.request({method:"PUT",url:e,callback:function(e,t,i){this.launchAction.setDisabled(i.status!==405)},scope:this})},addOutput:function(e){e=e||{};var t=this.target.selectedLayer;var i=this.initialConfig.outputConfig||{};this.outputConfig.title=i.title||this.menuText+": "+t.get("title");this.outputConfig.shortTitle=t.get("title");Ext.apply(e,gxp.WMSStylesDialog.createGeoServerStylerConfig(t));if(this.rasterStyling===true){e.plugins.push({ptype:"gxp_wmsrasterstylesdialog"})}Ext.applyIf(e,{style:"padding: 10px"});var r=gxp.plugins.Styler.superclass.addOutput.call(this,e);if(!(r.ownerCt.ownerCt instanceof Ext.Window)){r.dialogCls=Ext.Panel;r.showDlg=function(e){e.layout="fit";e.autoHeight=false;r.ownerCt.add(e)}}r.stylesStore.on("load",function(){if(!this.outputTarget&&r.ownerCt.ownerCt instanceof Ext.Window){r.ownerCt.ownerCt.center()}})}});Ext.preg(gxp.plugins.Styler.prototype.ptype,gxp.plugins.Styler);Ext.namespace("gxp.plugins");gxp.plugins.GoogleEarth=Ext.extend(gxp.plugins.Tool,{ptype:"gxp_googleearth",timeout:7e3,menuText:gettext("3D Viewer"),tooltip:gettext("Switch to 3D Viewer"),tooltipMap:gettext("Switch back to normal map view"),constructor:function(e){gxp.plugins.GoogleEarth.superclass.constructor.apply(this,arguments)},addActions:function(){var e=[{menuText:this.menuText,enableToggle:true,iconCls:"gxp-icon-googleearth",tooltip:this.tooltip,toggleHandler:function(e,t){this.actions[0].each(function(e){if(e.toggle){e.toggle(false,true)}});this.togglePanelDisplay(t)},scope:this}];return gxp.plugins.GoogleEarth.superclass.addActions.apply(this,[e])},togglePanelDisplay:function(e){var t=this.target.mapPanel.ownerCt;var i=t&&t.getLayout();if(i&&i instanceof Ext.layout.CardLayout){if(e===true){gxp.plugins.GoogleEarth.loader.onLoad({callback:function(){i.setActiveItem(1);this.actions[0].enable();this.actions[0].items[0].setTooltip(this.tooltipMap);this.actions[0].each(function(e){if(e.toggle){e.toggle(true,true)}})},scope:this})}else{i.setActiveItem(0);this.actions[0].items[0].setTooltip(this.tooltip)}}},getHost:function(){var e=window.location.host.split(":").shift();var t=window.location.port||"80";return e+":"+t}});gxp.plugins.GoogleEarth.loader=new(Ext.extend(Ext.util.Observable,{ready:!!(window.google&&window.google.earth),loading:false,constructor:function(){this.addEvents("ready","failure");return Ext.util.Observable.prototype.constructor.apply(this,arguments)},onScriptLoad:function(){var e=gxp.plugins.GoogleEarth.loader;if(!e.ready){e.ready=true;e.loading=false;e.fireEvent("ready")}},onLoad:function(e){if(this.ready){window.setTimeout(function(){e.callback.call(e.scope)},0)}else if(!this.loading){this.loadScript(e)}else{this.on({ready:e.callback,failure:e.errback||Ext.emptyFn,scope:e.scope})}},loadScript:function(e){if(window.google){delete google.loader}var t={autoload:Ext.encode({modules:[{name:"earth",version:"1",callback:"gxp.plugins.GoogleEarth.loader.onScriptLoad"}]})};var i=document.createElement("script");i.src="//www.google.com/jsapi?"+Ext.urlEncode(t);var r=e.errback||Ext.emptyFn;var a=e.timeout||gxp.plugins.GoogleSource.prototype.timeout;window.setTimeout(function(){if(!gxp.plugins.GoogleEarth.loader.ready){this.fireEvent("failure");this.unload()}}.createDelegate(this),a);this.on({ready:e.callback,failure:e.errback||Ext.emptyFn,scope:e.scope});this.loading=true;function s(){document.getElementsByTagName("head")[0].appendChild(i)}if(document.body){s()}else{Ext.onReady(s)}this.script=i},unload:function(){this.purgeListeners();if(this.script){document.getElementsByTagName("head")[0].removeChild(this.script);delete this.script}this.loading=false;this.ready=false;delete google.loader;delete google.earth}}));Ext.preg(gxp.plugins.GoogleEarth.prototype.ptype,gxp.plugins.GoogleEarth);Ext.ns("Ext.ux.form");Ext.ux.form.FileUploadField=Ext.extend(Ext.form.TextField,{buttonText:gettext("Browse..."),buttonOnly:false,buttonOffset:3,readOnly:true,autoSize:Ext.emptyFn,initComponent:function(){Ext.ux.form.FileUploadField.superclass.initComponent.call(this);this.addEvents("fileselected")},onRender:function(e,t){Ext.ux.form.FileUploadField.superclass.onRender.call(this,e,t);this.wrap=this.el.wrap({cls:"x-form-field-wrap x-form-file-wrap"});this.el.addClass("x-form-file-text");this.el.dom.removeAttribute("name");this.createFileInput();var i=Ext.applyIf(this.buttonCfg||{},{text:this.buttonText});this.button=new Ext.Button(Ext.apply(i,{renderTo:this.wrap,cls:"x-form-file-btn"+(i.iconCls?" x-btn-icon":"")}));if(this.buttonOnly){this.el.hide();this.wrap.setWidth(this.button.getEl().getWidth())}this.bindListeners();this.resizeEl=this.positionEl=this.wrap},bindListeners:function(){this.fileInput.on({scope:this,mouseenter:function(){this.button.addClass(["x-btn-over","x-btn-focus"])},mouseleave:function(){this.button.removeClass(["x-btn-over","x-btn-focus","x-btn-click"])},mousedown:function(){this.button.addClass("x-btn-click")},mouseup:function(){this.button.removeClass(["x-btn-over","x-btn-focus","x-btn-click"])},change:function(){var e=this.fileInput.dom.value;this.setValue(e);this.fireEvent("fileselected",this,e)}})},createFileInput:function(){this.fileInput=this.wrap.createChild({id:this.getFileInputId(),name:this.name||this.getId(),cls:"x-form-file",tag:"input",type:"file",size:1})},reset:function(){this.fileInput.remove();this.createFileInput();this.bindListeners();Ext.ux.form.FileUploadField.superclass.reset.call(this)},getFileInputId:function(){return this.id+"-file"},onResize:function(e,t){Ext.ux.form.FileUploadField.superclass.onResize.call(this,e,t);this.wrap.setWidth(e);if(!this.buttonOnly){var e=this.wrap.getWidth()-this.button.getEl().getWidth()-this.buttonOffset;this.el.setWidth(e)}},onDestroy:function(){Ext.ux.form.FileUploadField.superclass.onDestroy.call(this);Ext.destroy(this.fileInput,this.button,this.wrap)},onDisable:function(){Ext.ux.form.FileUploadField.superclass.onDisable.call(this);this.doDisable(true)},onEnable:function(){Ext.ux.form.FileUploadField.superclass.onEnable.call(this);this.doDisable(false)},doDisable:function(e){this.fileInput.dom.disabled=e;this.button.setDisabled(e)},preFocus:Ext.emptyFn,alignErrorIcon:function(){this.errorIcon.alignTo(this.wrap,"tl-tr",[2,0])}});Ext.reg("fileuploadfield",Ext.ux.form.FileUploadField);Ext.form.FileUploadField=Ext.ux.form.FileUploadField;Ext.grid.RowExpander=function(e){Ext.apply(this,e);this.addEvents({beforeexpand:true,expand:true,beforecollapse:true,collapse:true});Ext.grid.RowExpander.superclass.constructor.call(this);if(this.tpl){if(typeof this.tpl=="string"){this.tpl=new Ext.Template(this.tpl)}this.tpl.compile()}this.state={};this.bodyContent={}};Ext.extend(Ext.grid.RowExpander,Ext.util.Observable,{header:gettext(""),width:20,sortable:false,fixed:true,menuDisabled:true,dataIndex:"",id:"expander",lazyRender:true,enableCaching:true,getRowClass:function(e,t,i,r){i.cols=i.cols-1;var a=this.bodyContent[e.id];if(!a&&!this.lazyRender){a=this.getBodyContent(e,t)}if(a){i.body=a}return this.state[e.id]?"x-grid3-row-expanded":"x-grid3-row-collapsed"},init:function(e){this.grid=e;var t=e.getView();t.getRowClass=this.getRowClass.createDelegate(this);t.enableRowBody=true;e.on("render",function(){t.mainBody.on("mousedown",this.onMouseDown,this)},this)},getBodyContent:function(e,t){if(!this.enableCaching){return this.tpl.apply(e.data)}var i=this.bodyContent[e.id];if(!i){i=this.tpl.apply(e.data);this.bodyContent[e.id]=i}return i},onMouseDown:function(e,t){if(t.className=="x-grid3-row-expander"){e.stopEvent();var i=e.getTarget(".x-grid3-row");this.toggleRow(i)}},renderer:function(e,t,i){t.cellAttr='rowspan="2"';return'<div class="x-grid3-row-expander">&#160;</div>'},beforeExpand:function(e,t,i){if(this.fireEvent("beforeexpand",this,e,t,i)!==false){if(this.tpl&&this.lazyRender){t.innerHTML=this.getBodyContent(e,i)}return true}else{return false}},toggleRow:function(e){if(typeof e=="number"){e=this.grid.view.getRow(e)}this[Ext.fly(e).hasClass("x-grid3-row-collapsed")?"expandRow":"collapseRow"](e)},expandRow:function(e){if(typeof e=="number"){e=this.grid.view.getRow(e)}var t=this.grid.store.getAt(e.rowIndex);var i=Ext.DomQuery.selectNode("tr:nth(2) div.x-grid3-row-body",e);if(this.beforeExpand(t,i,e.rowIndex)){this.state[t.id]=true;Ext.fly(e).replaceClass("x-grid3-row-collapsed","x-grid3-row-expanded");this.fireEvent("expand",this,t,i,e.rowIndex)}},collapseRow:function(e){if(typeof e=="number"){e=this.grid.view.getRow(e)}var t=this.grid.store.getAt(e.rowIndex);var i=Ext.fly(e).child("tr:nth(1) div.x-grid3-row-body",true);if(this.fireEvent("beforecollapse",this,t,i,e.rowIndex)!==false){this.state[t.id]=false;Ext.fly(e).replaceClass("x-grid3-row-expanded","x-grid3-row-collapsed");this.fireEvent("collapse",this,t,i,e.rowIndex)}}});Ext.namespace("Ext.ux");Ext.ux.ColorPicker=function(e){e.bodyStyle={padding:"3px"};Ext.ux.ColorPicker.superclass.constructor.call(this,e);this.initialize(e)};Ext.extend(Ext.ux.ColorPicker,Ext.util.Observable,{HCHARS:"0123456789ABCDEF",initialize:function(e){this.events={};this.config=this.config||e;this.config.captions=this.config.captions||{};this.config.pickerHotPoint=this.config.pickerHotPoint||{x:3,y:3};this._HSV={h:0,s:100,v:100};this._RGB={r:255,g:255,b:255};this._HEX="000000";this.lastXYRgb={x:0,y:0};this.lastYHue=0;this.domElement=this.config.renderTo||Ext.DomHelper.append(document.body,{},true);this.domElement.addClass("x-cp-panel");this.cpCreateDomObjects();if(this.config.hidePanel){this.formContainer.hide()}this.rgbPicker.on("mousedown",this.rgbPickerClick.createDelegate(this),this);this.huePicker.on("mousedown",this.huePickerClick.createDelegate(this),this);this.wsColorContainer.on("mousedown",this.setColorFromWebsafe.createDelegate(this),this);this.inColorContainer.on("mousedown",this.setColorFromInvert.createDelegate(this),this);Ext.getCmp("redValue"+this.domElement.id).on("change",this.changeRGBField.createDelegate(this));Ext.getCmp("greenValue"+this.domElement.id).on("change",this.changeRGBField.createDelegate(this));Ext.getCmp("blueValue"+this.domElement.id).on("change",this.changeRGBField.createDelegate(this));Ext.getCmp("hueValue"+this.domElement.id).on("change",this.changeHSVField.createDelegate(this));Ext.getCmp("saturationValue"+this.domElement.id).on("change",this.changeHSVField.createDelegate(this));Ext.getCmp("brightnessValue"+this.domElement.id).on("change",this.changeHSVField.createDelegate(this));Ext.getCmp("colorValue"+this.domElement.id).on("change",this.changeHexaField.createDelegate(this));Ext.getCmp("redValue"+this.domElement.id).on("specialkey",this.changeRGBField.createDelegate(this));Ext.getCmp("greenValue"+this.domElement.id).on("specialkey",this.changeRGBField.createDelegate(this));Ext.getCmp("blueValue"+this.domElement.id).on("specialkey",this.changeRGBField.createDelegate(this));Ext.getCmp("hueValue"+this.domElement.id).on("specialkey",this.changeHSVField.createDelegate(this));Ext.getCmp("saturationValue"+this.domElement.id).on("specialkey",this.changeHSVField.createDelegate(this));Ext.getCmp("brightnessValue"+this.domElement.id).on("specialkey",this.changeHSVField.createDelegate(this));Ext.getCmp("colorValue"+this.domElement.id).on({specialkey:function(e,t){if(t.getKey()===t.ENTER){this.changeHexaField(e,e.getValue())}},scope:this});this.checkConfig();this.addEvents({pickcolor:true,changergb:true,changehsv:true,changehexa:true})},cpCreateDomObjects:function(){this.rgbPicker=Ext.DomHelper.append(this.domElement,{tag:"div",cls:"x-cp-rgb-msk"},true);this.rgbPointer=Ext.DomHelper.append(this.rgbPicker,{tag:"div",cls:"x-cp-rgb-picker"},true);this.rgbPointer.setXY([this.rgbPicker.getLeft()-this.config.pickerHotPoint.x,this.rgbPicker.getTop()-this.config.pickerHotPoint.y]);this.huePicker=Ext.DomHelper.append(this.domElement,{tag:"div",cls:"x-cp-hue-msk"},true);this.huePointer=Ext.DomHelper.append(this.huePicker,{tag:"div",cls:"x-cp-hue-picker"},true);this.huePointer.setXY([this.huePicker.getLeft()+this.huePointer.getWidth()/2+1,this.huePicker.getTop()-this.config.pickerHotPoint.y]);this.formContainer=Ext.DomHelper.append(Ext.DomHelper.append(this.domElement,{tag:"div",cls:"x-cp-control-container x-unselectable"},true),{tag:"div",cls:"x-cp-rgb-container x-unselectable",style:"clear:both"},true);this.colorContainer=Ext.DomHelper.append(this.formContainer,{cls:"x-cp-coloro-container x-unselectable"},true).update(this.config.captions.color||"Color");this.form=new Ext.FormPanel({frame:true,width:"auto",height:227,cls:"x-cp-form",labelWidth:12,items:[{xtype:"fieldset",title:gettext("RGB"),autoHeight:true,style:"padding: 2px",defaultType:"numberfield",items:[{fieldLabel:gettext("Red"),id:"redValue"+this.domElement.id},{fieldLabel:gettext("Green"),id:"greenValue"+this.domElement.id},{fieldLabel:gettext("Blue"),id:"blueValue"+this.domElement.id}]},{xtype:"fieldset",title:gettext("HSV"),autoHeight:true,style:"padding: 2px",defaultType:"numberfield",items:[{fieldLabel:gettext("Hue"),id:"hueValue"+this.domElement.id},{fieldLabel:gettext("Satur."),id:"saturationValue"+this.domElement.id},{fieldLabel:gettext("Bright."),id:"brightnessValue"+this.domElement.id}]},{xtype:"fieldset",title:gettext("Color"),autoHeight:true,style:"padding: 2px",defaultType:"textfield",items:[{fieldLabel:gettext("Color"),id:"colorValue"+this.domElement.id}]}]});this.form.render(this.formContainer);var e=Ext.DomHelper.append(this.form.body,{cls:"x-cp-colors-container x-unselectable"},true);this.wsColorContainer=Ext.DomHelper.append(e,{cls:"x-cp-color-container x-unselectable"},true).update(this.config.captions.websafe||"Websafe");this.inColorContainer=Ext.DomHelper.append(e,{cls:"x-cp-color-container x-unselectable"},true).update(this.config.captions.inverse||"Inverse");Ext.DomHelper.append(e,{tag:"div",style:"height:0px;border:none;clear:both;font-size:1px;"});this.form.render(this.formContainer);Ext.DomHelper.append(this.domElement,{tag:"div",style:"height:0px;border:none;clear:both;font-size:1px;"})},realToDec:function(e){return Math.min(255,Math.round(e*256))},hsvToRgb:function(e,t,i){if(e instanceof Array){return this.hsvToRgb.call(this,e[0],e[1],e[2])}var r,a,s,n,p,o,l,h;n=Math.floor(e/60%6);p=e/60-n;o=i*(1-t);l=i*(1-p*t);h=i*(1-(1-p)*t);switch(n){case 0:r=i;a=h;s=o;break;case 1:r=l;a=i;s=o;break;case 2:r=o;a=i;s=h;break;case 3:r=o;a=l;s=i;break;case 4:r=h;a=o;s=i;break;case 5:r=i;a=o;s=l;break}return[this.realToDec(r),this.realToDec(a),this.realToDec(s)]},rgbToHsv:function(e,t,i){if(e instanceof Array){return this.rgbToHsv.call(this,e[0],e[1],e[2])}e=e/255;t=t/255;i=i/255;var r,a,s,n,o,l;r=Math.min(Math.min(e,t),i);a=Math.max(Math.max(e,t),i);s=a-r;switch(a){case r:n=0;break;case e:n=60*(t-i)/s;if(t<i){n+=360}break;case t:n=60*(i-e)/s+120;break;case i:n=60*(e-t)/s+240;break}o=a===0?0:1-r/a;return[Math.round(n),o,a]},rgbToHex:function(e,t,i){if(e instanceof Array){return this.rgbToHex.call(this,e[0],e[1],e[2])}return this.decToHex(e)+this.decToHex(t)+this.decToHex(i)},decToHex:function(e){e=parseInt(e,10);e=!isNaN(e)?e:0;e=e>255||e<0?0:e;return this.HCHARS.charAt((e-e%16)/16)+this.HCHARS.charAt(e%16)},getHCharPos:function(e){return this.HCHARS.indexOf(e.toUpperCase())},hexToDec:function(e){var t=e.split("");return this.getHCharPos(t[0])*16+this.getHCharPos(t[1])},hexToRgb:function(e){return[this.hexToDec(e.substr(0,2)),this.hexToDec(e.substr(2,2)),this.hexToDec(e.substr(4,2))]},checkSafeNumber:function(e){if(!isNaN(e)){e=Math.min(Math.max(0,e),255);var t,i;for(t=0;t<256;t=t+51){i=t+51;if(e>=t&&e<=i){return e-t>25?i:t}}}return e},websafe:function(e,t,i){if(e instanceof Array){return this.websafe.call(this,e[0],e[1],e[2])}return[this.checkSafeNumber(e),this.checkSafeNumber(t),this.checkSafeNumber(i)]},invert:function(e,t,i){if(e instanceof Array){return this.invert.call(this,e[0],e[1],e[2])}return[255-e,255-t,255-i]},getHue:function(e){var t=360-Math.round((this.huePicker.getHeight()-e)/this.huePicker.getHeight()*360);return t===360?0:t},getHPos:function(e){return e*(this.huePicker.getHeight()/360)},getSaturation:function(e){return e/this.rgbPicker.getWidth()},getSPos:function(e){return e*this.rgbPicker.getWidth()},getValue:function(e){return(this.rgbPicker.getHeight()-e)/this.rgbPicker.getHeight()},getVPos:function(e){return this.rgbPicker.getHeight()-e*this.rgbPicker.getHeight()},updateColorsFromRGBPicker:function(){this._HSV={h:this._HSV.h,s:this.getSaturation(this.lastXYRgb.x),v:this.getValue(this.lastXYRgb.y)}},updateColorsFromHUEPicker:function(){this._HSV.h=this.getHue(this.lastYHue);var e=this.hsvToRgb(this._HSV.h,1,1);e=this.rgbToHex(e[0],e[1],e[2]);this.rgbPicker.setStyle({backgroundColor:"#"+e})},updateColorsFromRGBFields:function(){var e=this.rgbToHsv(Ext.getCmp("redValue"+this.domElement.id).getValue(),Ext.getCmp("greenValue"+this.domElement.id).getValue(),Ext.getCmp("blueValue"+this.domElement.id).getValue());this._HSV={h:e[0],s:e[1],v:e[2]}},updateColorsFromHexaField:function(){var e=this.hexToRgb(this._HEX);this._RGB={r:e[0],g:e[1],b:e[2]};e=this.rgbToHsv(e[0],e[1],e[2]);this._HSV={h:e[0],s:e[1],v:e[2]}},updateColorsFromHSVFields:function(){var e=this.hsvToRgb(this._HSV.h,this._HSV.s,this._HSV.v);this._RGB={r:e[0],g:e[1],b:e[2]}},updateRGBFromHSV:function(){var e=this.hsvToRgb(this._HSV.h,this._HSV.s,this._HSV.v);this._RGB={r:e[0],g:e[1],b:e[2]}},updateInputFields:function(){Ext.getCmp("redValue"+this.domElement.id).setValue(this._RGB.r);Ext.getCmp("greenValue"+this.domElement.id).setValue(this._RGB.g);Ext.getCmp("blueValue"+this.domElement.id).setValue(this._RGB.b);Ext.getCmp("hueValue"+this.domElement.id).setValue(this._HSV.h);Ext.getCmp("saturationValue"+this.domElement.id).setValue(Math.round(this._HSV.s*100));Ext.getCmp("brightnessValue"+this.domElement.id).setValue(Math.round(this._HSV.v*100));Ext.getCmp("colorValue"+this.domElement.id).setValue(this._HEX)},updateColor:function(){this._HEX=this.rgbToHex(this._RGB.r,this._RGB.g,this._RGB.b);this.colorContainer.setStyle({backgroundColor:"#"+this._HEX});this.colorContainer.set({title:gettext("#")+this._HEX});var e=this.rgbToHex(this.websafe(this._RGB.r,this._RGB.g,this._RGB.b));this.wsColorContainer.setStyle({backgroundColor:"#"+e});this.wsColorContainer.set({title:gettext("#")+e});this.wsColorContainer.setStyle({color:"#"+this.rgbToHex(this.invert(this.websafe(this._RGB.r,this._RGB.g,this._RGB.b)))});var e=this.rgbToHex(this.invert(this._RGB.r,this._RGB.g,this._RGB.b));this.inColorContainer.setStyle({backgroundColor:"#"+e});this.inColorContainer.setStyle({color:"#"+this._HEX});this.inColorContainer.set({title:gettext("#")+e});this.colorContainer.setStyle({color:"#"+e});this.updateInputFields();this.fireEvent("pickcolor",this,this._HEX)},updatePickers:function(){this.lastXYRgb={x:this.getSPos(this._HSV.s),y:this.getVPos(this._HSV.v)};this.rgbPointer.setXY([this.lastXYRgb.x-this.config.pickerHotPoint.x+this.rgbPicker.getLeft(),this.lastXYRgb.y-this.config.pickerHotPoint.y+this.rgbPicker.getTop()],this.config.animate);this.lastYHue=this.getHPos(this._HSV.h);this.huePointer.setXY([this.huePicker.getLeft()+this.huePointer.getWidth()/2+1,this.lastYHue+this.huePicker.getTop()-this.config.pickerHotPoint.y],this.config.animate);var e=this.hsvToRgb(this._HSV.h,1,1);e=this.rgbToHex(e[0],e[1],e[2]);this.rgbPicker.setStyle({backgroundColor:"#"+e})},rgbPickerClick:function(e,t){this.lastXYRgb={x:e.getPageX()-this.rgbPicker.getLeft(),y:e.getPageY()-this.rgbPicker.getTop()};this.rgbPointer.setXY([e.getPageX()-this.config.pickerHotPoint.x,e.getPageY()-this.config.pickerHotPoint.y],this.config.animate);this.updateColorsFromRGBPicker();this.updateRGBFromHSV();this.updateColor()},huePickerClick:function(e,t){this.lastYHue=e.getPageY()-this.huePicker.getTop();this.huePointer.setY([e.getPageY()-3],this.config.animate);this.updateColorsFromHUEPicker();this.updateRGBFromHSV();this.updateColor()},changeRGBField:function(e,t,i){if(!(t instanceof String)){t=e.getValue()}if(t<0){t=0}if(t>255){t=255}if(e==Ext.getCmp("redValue"+this.domElement.id)){this._RGB.r=t}else if(e==Ext.getCmp("greenValue"+this.domElement.id)){this._RGB.g=t}else if(e==Ext.getCmp("blueValue"+this.domElement.id)){this._RGB.b=t}this.updateColorsFromRGBFields();this.updateColor();this.updatePickers();this.fireEvent("changergb",this,this._RGB)},changeHSVField:function(e,t,i){if(!(t instanceof String)){t=e.getValue()}if(e==Ext.getCmp("hueValue"+this.domElement.id)){if(t<0){t=0}if(t>360){t=360}this._HSV.h=t}else{if(t<0){t=0}if(t>100){t=100}if(e==Ext.getCmp("saturationValue"+this.domElement.id)){this._HSV.s=t/100}else if(e==Ext.getCmp("brightnessValue"+this.domElement.id)){this._HSV.v=t/100}}this.updateColorsFromHSVFields();this.updateColor();this.updatePickers();this.fireEvent("changehsv",this,this._HSV)},changeHexaField:function(e,t,i){t=t.trim().substring(0,6);if(t.length===3){t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2]}if(!t.match(/^[0-9a-f]{6}$/i)){t="000000"}this._HEX=t;this.updateColorsFromHexaField();this.updateColor();this.updatePickers();this.fireEvent("changehexa",this,this._HEX)},setColorFromWebsafe:function(){this.setColor(this.wsColorContainer.getColor("backgroundColor","",""))},setColorFromInvert:function(){this.setColor(this.inColorContainer.getColor("backgroundColor","",""))},checkConfig:function(){if(this.config){if(this.config.color){this.setColor(this.config.color)}else if(this.config.hsv){this.setHSV(this.config.hsv)}else if(this.config.rgb){this.setRGB(this.config.rgb)}}},setColor:function(e){var t=this.hexToRgb(e);this._RGB={r:t[0],g:t[1],b:t[2]};var t=this.rgbToHsv(t);this._HSV={h:t[0],s:t[1],v:t[2]};this.updateColor();this.updatePickers()},setRGB:function(e){this._RGB=e;var t=this.rgbToHsv(e.r,e.g,e.b);this._HSV={h:t[0],s:t[1],v:t[2]};this.updateColor();this.updatePickers()},setHSV:function(e){this._HSV={h:e.h,s:e.s/100,v:e.v/100};var t=this.hsvToRgb(e.h,e.s/100,e.v/100);this._RGB={r:t[0],g:t[1],b:t[2]};this.updateColor();this.updatePickers()},getColor:function(e){return(e?"":"#")+this._HEX},getRGB:function(){return this._RGB},getHSV:function(){return this._HSV},setPanelVisible:function(e,t){return this.formContainer.setVisible(e,t)},isPanelVisible:function(){return this.formContainer.isDisplayed()},showPicker:function(){this.domElement.show()},hidePicker:function(){this.domElement.hide()}});Ext.ux.ColorPanel=function(e){this.config=e;this.config.renderTo=this.config.renderTo||Ext.DomHelper.append(document.body,{},true);Ext.ux.ColorPanel.superclass.constructor.call(this,e);this.domElement=Ext.get(this.config.renderTo);this.render(this.domElement);this.config.renderTo=this.body;this.initialize(this.config);this.getEl().addClass("x-cp-panel");this.domElement.removeClass("x-cp-panel");this.body.setStyle({padding:"5px"})};Ext.extend(Ext.ux.ColorPanel,Ext.Panel);Ext.applyIf(Ext.ux.ColorPanel.prototype,Ext.ux.ColorPicker.prototype);Ext.ux.ColorDialog=function(e){this.config=e;this.config.resizable=false;this.config.renderTo=this.config.renderTo||Ext.DomHelper.append(document.body,{},true);Ext.ux.ColorDialog.superclass.constructor.call(this,e);this.domElement=Ext.get(this.config.renderTo);this.render(this.domElement);this.config.renderTo=this.body;this.initialize(this.config);this.body.addClass("x-cp-panel");this.body.setStyle({padding:"5px"});this.setSize(398,300)};Ext.extend(Ext.ux.ColorDialog,Ext.Window);Ext.applyIf(Ext.ux.ColorDialog.prototype,Ext.ux.ColorPicker.prototype);Ext.namespace("Styler");Styler.ColorManager=function(e){Ext.apply(this,e)};Ext.apply(Styler.ColorManager.prototype,{field:null,init:function(e){this.register(e)},destroy:function(){if(this.field){this.unregister(this.field)}},register:function(e){if(this.field){this.unregister(this.field)}this.field=e;e.on({focus:this.fieldFocus,destroy:this.destroy,scope:this})},unregister:function(e){e.un("focus",this.fieldFocus,this);e.un("destroy",this.destroy,this);if(Styler.ColorManager.picker&&e==this.field){Styler.ColorManager.picker.un("pickcolor",this.setFieldValue,this)}this.field=null},fieldFocus:function(e){if(!Styler.ColorManager.pickerWin){Styler.ColorManager.picker=new Ext.ux.ColorPanel({hidePanel:false,autoHeight:false});Styler.ColorManager.pickerWin=new Ext.Window({title:gettext("Color Picker"),layout:"fit",closeAction:"hide",width:405,height:300,plain:true,items:Styler.ColorManager.picker})}Styler.ColorManager.picker.purgeListeners();this.setPickerValue();Styler.ColorManager.picker.on({pickcolor:this.setFieldValue,scope:this});Styler.ColorManager.pickerWin.show()},setFieldValue:function(e,t){if(this.field.isVisible()){this.field.setValue("#"+t)}},setPickerValue:function(){var e=this.field;var t=e.getHexValue?e.getHexValue():e.getValue();if(t){Styler.ColorManager.picker.setColor(t.substring(1))}}});(function(){Ext.util.Observable.observeClass(gxp.form.ColorField);gxp.form.ColorField.on({render:function(e){var t=new Styler.ColorManager;t.register(e)}})})();Styler.ColorManager.picker=null;Styler.ColorManager.pickerWin=null;Ext.namespace("GeoExt.ux");GeoExt.ux.PrintPreview=Ext.extend(Ext.Container,{paperSizeText:gettext("Paper size:"),resolutionText:gettext("Resolution:"),printText:gettext("Print"),emptyTitleText:gettext("Enter map title here."),includeLegendText:gettext("Include legend?"),includeMapCommentsText:gettext("Include comments?"),includeRiskText:gettext("Open Statistics Configuration"),fractionalZoomText:gettext("Use precise zoom"),fractionalZoomDesc:"Check this box, to zoom to the exact extent of the drawn box. Note this will take longer",emptyCommentText:gettext("Enter comments here."),creatingPdfText:gettext("Creating PDF...\n This can take a few minutes"),printProvider:null,sourceMap:null,printMapPanel:null,mapTitleField:"mapTitle",commentField:"comment",legend:null,includeLegend:false,includeRiskTable:false,includeMapComments:false,mapTitle:null,comment:null,addMapOverlay:true,busyMask:null,form:null,autoEl:"center",cls:"x-panel-body x-panel-body-noheader",initComponent:function(){var e={sourceMap:this.sourceMap,printProvider:this.printProvider};if(this.printMapPanel){if(!(this.printMapPanel instanceof GeoExt.PrintMapPanel)){e.xtype="gx_printmappanel";this.printMapPanel=new GeoExt.PrintMapPanel(Ext.applyIf(this.printMapPanel,e))}}else{this.printMapPanel=new GeoExt.PrintMapPanel(e)}this.sourceMap=this.printMapPanel.sourceMap;this.printProvider=this.printMapPanel.printProvider;this.form=this.createForm();if(!this.items){this.items=[]}this.items.push(this.createToolbar(),{xtype:"container",cls:"gx-printpreview",autoHeight:this.autoHeight,autoWidth:this.autoWidth,items:[this.form,this.printMapPanel]});GeoExt.ux.PrintPreview.superclass.initComponent.call(this);this.addMapOverlay&&this.printMapPanel.add(this.createMapOverlay());this.printMapPanel.on({resize:this.updateSize,scope:this});this.on({render:function(){if(!this.busyMask){this.busyMask=new Ext.LoadMask(this.getEl(),{msg:gettext("Creating PDF...<br/>This can take a few minutes")})}this.printProvider.on({beforeprint:this.busyMask.show,print:this.busyMask.hide,printexception:this.busyMask.hide,scope:this.busyMask})},scope:this})},createToolbar:function(){var e=[];this.printProvider.layouts.getCount()>1&&e.push(this.paperSizeText,{xtype:"combo",width:98,plugins:new GeoExt.plugins.PrintProviderField({printProvider:this.printProvider}),store:this.printProvider.layouts,displayField:"name",typeAhead:true,mode:"local",forceSelection:true,triggerAction:"all",selectOnFocus:true},"&nbsp;");this.printProvider.dpis.getCount()>1&&e.push(this.resolutionText,{xtype:"combo",width:62,plugins:new GeoExt.plugins.PrintProviderField({printProvider:this.printProvider}),store:this.printProvider.dpis,displayField:"name",tpl:'<tpl for="."><div class="x-combo-list-item">{name} dpi</div></tpl>',typeAhead:true,mode:"local",forceSelection:true,triggerAction:"all",selectOnFocus:true,setValue:function(e){e=parseInt(e)+" dpi";Ext.form.ComboBox.prototype.setValue.apply(this,arguments)}},"&nbsp;");e.push("->",{text:this.printText,iconCls:"icon-print",handler:function(){this.printMapPanel.print(this.includeLegend&&{legend:this.legend})},scope:this});return{xtype:"toolbar",items:e}},createForm:function(){var e={xtype:"textfield",name:this.mapTitleField,value:this.mapTitle,emptyText:this.emptyTitleText,margins:"0 5 0 0",anchor:"100%",hideLabel:true,plugins:new GeoExt.plugins.PrintProviderField({printProvider:this.printProvider})};if(this.legend){var t=new Ext.form.Checkbox({name:"legend",checked:this.includeLegend,boxLabel:this.includeLegendText,hideLabel:true,ctCls:"gx-item-nowrap",handler:function(e,t){this.includeLegend=t},scope:this})}var i=this.fractionalZoomDesc;var r=new Ext.form.Checkbox({name:"fractionalzoom",checked:false,boxLabel:this.fractionalZoomText,hideLabel:true,ctCls:"gx-item-nowrap",listeners:{render:function(e){Ext.QuickTips.register({target:e,text:i})}},handler:function(e,t){var i=this.printMapPanel.map.getCenter();this.printMapPanel.map.fractionalZoom=t;this.printMapPanel.map.setCenter(i,Math.round(this.printMapPanel.map.zoom))},scope:this});var a=new Ext.form.Checkbox({name:"map_comments",id:"map_comments",checked:this.includeMapComments,boxLabel:this.includeMapCommentsText,hideLabel:true,ctCls:"gx-item-nowrap",handler:function(e,t){this.includeMapComments=t},scope:this});return new Ext.form.FormPanel({autoHeight:true,border:false,defaults:{anchor:"100%"},items:[this.legend?{xtype:"container",layout:"hbox",cls:"x-form-item",items:[t,a,r]}:e,e,{xtype:"textarea",name:this.commentField,value:this.comment,emptyText:this.emptyCommentText,hideLabel:true,plugins:new GeoExt.plugins.PrintProviderField({printProvider:this.printProvider})}]})},createMapOverlay:function(){var e=this.printMapPanel.map;var t=new OpenLayers.Control.ScaleLine({geodesic:!(e.getProjectionObject()||new OpenLayers.Projection(e.projection||"EPSG:4326")).equals("EPSG:4326")});e.addControl(t);t.activate();return new Ext.Panel({cls:"gx-map-overlay",layout:"column",width:235,bodyStyle:"padding:5px",items:[{xtype:"box",el:t.div,width:t.maxWidth},{xtype:"container",layout:"form",style:"padding: .2em 5px 0 0;",columnWidth:1,cls:"x-small-editor x-form-item",items:{xtype:"combo",name:"scale",anchor:"100%",hideLabel:true,store:this.printMapPanel.previewScales,displayField:"name",typeAhead:true,mode:"local",forceSelection:true,triggerAction:"all",selectOnFocus:true,getListParent:function(){return this.el.up(".x-window")||document.body},plugins:new GeoExt.plugins.PrintPageField({printPage:this.printMapPanel.printPage})}},{xtype:"box",autoEl:{tag:"div",cls:"gx-northarrow"}}],listeners:{render:function(){function e(e){e.stopPropagation()}this.getEl().on({click:e,dblclick:e,mousedown:e})}}})},updateSize:function(){this.suspendEvents();var e=this.printMapPanel.getWidth();this.form.setWidth(e);this.form.items.get(0).setWidth(e);var t=this.initialConfig.minWidth||0;this.items.get(0).setWidth(this.form.ownerCt.el.getPadding("lr")+Math.max(e,t));var i=this.ownerCt;if(i&&i instanceof Ext.Window){this.ownerCt.syncShadow()}this.resumeEvents()},beforeDestroy:function(){if(this.busyMask){this.printProvider.un("beforeprint",this.busyMask.show,this.busyMask);this.printProvider.un("print",this.busyMask.hide,this.busyMask)}this.printMapPanel.un("resize",this.updateSize,this);GeoExt.ux.PrintPreview.superclass.beforeDestroy.apply(this,arguments)}});Ext.reg("gxux_printpreview",GeoExt.ux.PrintPreview);Ext.USE_NATIVE_JSON=true;Ext.override(Ext.dd.DragTracker,{onMouseMove:function(e,t){if(this.active&&Ext.isIE&&!Ext.isIE9&&!e.browserEvent.button){e.preventDefault();this.onMouseUp(e);return}e.preventDefault();var i=e.getXY(),r=this.startXY;this.lastXY=i;if(!this.active){if(Math.abs(r[0]-i[0])>this.tolerance||Math.abs(r[1]-i[1])>this.tolerance){this.triggerStart(e)}else{return}}this.fireEvent("mousemove",this,e);this.onDrag(e);this.fireEvent("drag",this,e)}});(function(){Ext.preg("gx_wmssource",gxp.plugins.WMSSource);Ext.preg("gx_olsource",gxp.plugins.OLSource);Ext.preg("gx_googlesource",gxp.plugins.GoogleSource);Ext.preg("gx_bingsource",gxp.plugins.BingSource);Ext.preg("gx_osmsource",gxp.plugins.OSMSource);Ext.preg("gxp_layertree",gxp.plugins.LayerManager)})();var GeoExplorer=Ext.extend(gxp.Viewer,{zoomSliderText:gettext("<div>Zoom Level: {zoom}</div><div>Scale: 1:{scale}</div>"),loadConfigErrorText:gettext("Trouble reading saved configuration: <br />"),loadConfigErrorDefaultText:gettext("Server Error."),xhrTroubleText:gettext("Communication Trouble: Status "),layersText:gettext("Layers"),titleText:gettext("Title"),bookmarkText:gettext("Bookmark URL"),permakinkText:gettext("Permalink"),appInfoText:gettext("GeoExplorer"),aboutText:gettext("About GeoExplorer"),mapInfoText:gettext("Map Info"),descriptionText:gettext("Description"),contactText:gettext("Contact"),aboutThisMapText:gettext("About this Map"),aboutUrl:"../about.html",mapPanel:null,constructor:function(e){this.mapItems=[{xtype:"gxp_scaleoverlay"},{xtype:"gx_zoomslider",vertical:true,height:100,plugins:new GeoExt.ZoomSliderTip({template:this.zoomSliderText})}];e.viewerTools=[{hidden:true,actions:["layerchooser"],checked:true},{hidden:true,actions:["-"],checked:true},{leaf:true,text:gxp.plugins.Navigation.prototype.tooltip,checked:true,iconCls:"gxp-icon-pan",ptype:"gxp_navigation",toggleGroup:"navigation"},{leaf:true,text:gxp.plugins.WMSGetFeatureInfo.prototype.infoActionTip,checked:true,iconCls:"gxp-icon-getfeatureinfo",ptype:"gxp_wmsgetfeatureinfo",format:"grid",toggleGroup:"interaction"},{leaf:true,text:gxp.plugins.Measure.prototype.measureTooltip,checked:true,iconCls:"gxp-icon-measure-length",ptype:"gxp_measure",controlOptions:{immediate:true},toggleGroup:"interaction"},{leaf:true,text:gxp.plugins.Zoom.prototype.zoomInTooltip+" / "+gxp.plugins.Zoom.prototype.zoomOutTooltip,checked:true,iconCls:"gxp-icon-zoom-in",ptype:"gxp_zoom"},{leaf:true,text:gxp.plugins.NavigationHistory.prototype.previousTooltip+" / "+gxp.plugins.NavigationHistory.prototype.nextTooltip,checked:true,iconCls:"gxp-icon-zoom-previous",ptype:"gxp_navigationhistory"},{leaf:true,text:gxp.plugins.ZoomToExtent.prototype.tooltip,checked:true,iconCls:gxp.plugins.ZoomToExtent.prototype.iconCls,ptype:"gxp_zoomtoextent"},{leaf:true,text:gxp.plugins.Legend.prototype.tooltip,checked:true,iconCls:"gxp-icon-legend",ptype:"gxp_legend"},{hidden:true,actions:["->"],checked:true},{hidden:true,actions:["aboutbutton"],checked:true}];GeoExplorer.superclass.constructor.apply(this,arguments)},loadConfig:function(r){var e=window.location.hash.substr(1);var t=e.match(/^maps\/(\d+)$/);if(t){this.id=Number(t[1]);Ext.Ajax.request({url:"../"+e,success:function(e){var t=Ext.util.JSON.decode(e.responseText);delete t.tools;this.applyConfig(Ext.applyIf(t,r))},failure:function(e){var t;try{t=Ext.util.JSON.decode(e.responseText)}catch(e){}var i=this.loadConfigErrorText;if(t&&t.error){i+=t.error}else{i+=this.loadConfigErrorDefaultText}this.on({ready:function(){this.displayXHRTrouble(i,e.status)},scope:this});delete this.id;window.location.hash="";this.applyConfig(r)},scope:this})}else{var i=Ext.urlDecode(document.location.search.substr(1));if(i){if(i.q){var a=Ext.util.JSON.decode(i.q);Ext.apply(r,a)}if(i.layers){var s=i.layers.split(/\s*,\s*/);for(var n=0,o=s.length;n<o;++n){r.map.layers.push({source:"local",name:s[n],visibility:true,bbox:i.lazy&&i.bbox?i.bbox.split(","):undefined})}}if(i.bbox){delete r.map.zoom;delete r.map.center;r.map.extent=i.bbox.split(/\s*,\s*/)}if(i.lazy&&r.sources.local){r.sources.local.requiredProperties=[]}}this.applyConfig(r)}},displayXHRTrouble:function(e,t){Ext.Msg.show({title:this.xhrTroubleText+t,msg:e,icon:Ext.MessageBox.WARNING})},initPortal:function(){this.createTools();GeoExplorer.superclass.initPortal.apply(this,arguments)},createTools:function(){new Ext.Button({id:"aboutbutton",text:this.appInfoText,iconCls:"icon-geoexplorer",handler:this.displayAppInfo,scope:this})},showUrl:function(e){if(e.status==200){var t=new Ext.Window({title:this.bookmarkText,layout:"form",labelAlign:"top",modal:true,bodyStyle:"padding: 5px",width:300,items:[{xtype:"textfield",fieldLabel:this.permakinkText,readOnly:true,anchor:"100%",selectOnFocus:true,value:window.location.href}]});t.show();t.items.first().selectText()}else{var i=Ext.util.JSON.decode(e.responseText);this.displayXHRTrouble(i.error,e.status)}},getBookmark:function(){var e=Ext.apply(OpenLayers.Util.getParameters(),{q:Ext.util.JSON.encode(this.getState())});var t=document.location.href.split("?").shift()+"?"+Ext.urlEncode(e);return t},displayAppInfo:function(){var e=new Ext.Panel({title:this.appInfoText,html:"<iframe style='border: none; height: 100%; width: 100%' src='"+this.aboutUrl+"' frameborder='0' border='0'><a target='_blank' href='"+this.aboutUrl+"'>"+this.aboutText+"</a> </iframe>"});var t=Ext.applyIf(this.about,{title:gettext(""),abstract:"",contact:""});var i=new Ext.Panel({title:this.mapInfoText,html:'<div class="gx-info-panel">'+"<h2>"+this.titleText+"</h2><p>"+t.title+"</p><h2>"+this.descriptionText+"</h2><p>"+t["abstract"]+"</p> <h2>"+this.contactText+"</h2><p>"+t.contact+"</p></div>",height:"auto",width:"auto"});var r=new Ext.TabPanel({activeTab:0,items:[i,e]});var a=new Ext.Window({title:this.aboutThisMapText,modal:true,layout:"fit",width:300,height:300,items:[r]});a.show()},getState:function(){var e=GeoExplorer.superclass.getState.apply(this,arguments);delete e.tools;return e}});GeoExplorer.Composer=Ext.extend(GeoExplorer,{cookieParamName:"geoexplorer-user",mapText:gettext("Map"),saveMapText:gettext("Save map"),exportMapText:gettext("Export map"),toolsTitle:gettext("Choose tools to include in the toolbar:"),previewText:gettext("Preview"),backText:gettext("Back"),nextText:gettext("Next"),loginText:gettext("Login"),logoutText:gettext("Logout, {user}"),loginErrorText:gettext("Invalid username or password."),userFieldText:gettext("User"),passwordFieldText:gettext("Password"),tableText:gettext("Table"),queryText:gettext("Query"),logoutConfirmTitle:gettext("Warning"),logoutConfirmMessage:gettext("Logging out will undo any unsaved changes, remove any layers you may have added, and reset the map composition. Do you want to save your composition first?"),constructor:function(e){if(e.authStatus===401){this.authorizedRoles=[]}else if(e.authStatus!==404){this.authorizedRoles=["ROLE_ADMINISTRATOR"]}delete e.authStatus;e.tools=[{ptype:"gxp_layermanager",outputConfig:{id:"layers",tbar:[],autoScroll:true},outputTarget:"tree"},{ptype:"gxp_addlayers",actionTarget:"layers.tbar",outputTarget:"tree",uploadSource:"local",postUploadAction:{plugin:"styler"},catalogSourceKey:"local",search:{selectedSource:"csw"}},{ptype:"gxp_removelayer",actionTarget:["layers.tbar","layers.contextMenu"]},{ptype:"gxp_layerproperties",id:"layerproperties",outputConfig:{defaults:{autoScroll:true},width:320},actionTarget:["layers.tbar","layers.contextMenu"],outputTarget:"tree"},{ptype:"gxp_styler",id:"styler",outputConfig:{autoScroll:true,width:320},actionTarget:["layers.tbar","layers.contextMenu"],outputTarget:"tree"},{ptype:"gxp_zoomtolayerextent",actionTarget:{target:"layers.contextMenu",index:0}},{ptype:"gxp_navigation",toggleGroup:"navigation"},{ptype:"gxp_zoom",toggleGroup:"navigation",showZoomBoxAction:true,controlOptions:{zoomOnClick:false}},{ptype:"gxp_navigationhistory"},{ptype:"gxp_zoomtoextent"},{actions:["aboutbutton"],actionTarget:"paneltbar"},{actions:["-"],actionTarget:"paneltbar"},{actions:["mapmenu"],actionTarget:"paneltbar"},{ptype:"gxp_print",customParams:{outputFilename:"GeoExplorer-print"},printService:e.printService,actionTarget:["paneltbar","paneltbarcalc"],showButtonText:true},{actions:["-"],actionTarget:"paneltbar"},{ptype:"gxp_wmsgetfeatureinfo",format:"grid",toggleGroup:"interaction",showButtonText:true,actionTarget:"paneltbar"},{ptype:"gxp_featuremanager",id:"querymanager",selectStyle:{cursor:""},autoLoadFeatures:true,maxFeatures:50,paging:true,pagingType:gxp.plugins.FeatureManager.WFS_PAGING},{ptype:"gxp_queryform",featureManager:"querymanager",autoExpand:"query",actionTarget:"paneltbar",outputTarget:"query"},{ptype:"gxp_featuregrid",featureManager:"querymanager",showTotalResults:true,autoLoadFeature:false,alwaysDisplayOnMap:true,controlOptions:{multiple:true},displayMode:"selected",outputTarget:"table",outputConfig:{id:"featuregrid",columnsSortable:false}},{ptype:"gxp_zoomtoselectedfeatures",featureManager:"querymanager",actionTarget:["featuregrid.contextMenu","featuregrid.bbar"]},{ptype:"gxp_addFeatureFilter",featureManager:"querymanager",actionTarget:["featuregrid.contextMenu","featuregrid.bbar"]},{ptype:"gxp_measure",toggleGroup:"interaction",controlOptions:{immediate:true},showButtonText:true,actionTarget:"paneltbar"},{ptype:"gxp_featuremanager",id:"featuremanager",maxFeatures:20,paging:false},{ptype:"gxp_featureeditor",featureManager:"featuremanager",autoLoadFeature:true,splitButton:true,showButtonText:true,toggleGroup:"interaction",actionTarget:"paneltbar"},{actions:["showANDMA"],actionTarget:"paneltbar",id:"showANDMAModule"},{actions:["statMenu"],actionTarget:"paneltbar"},{actions:["finderTool"],actionTarget:"paneltbar"},{ptype:"gxp_villageinspector",format:"grid",toggleGroup:"interaction",showButtonText:true,actionTarget:"paneltbar"},{actions:["secEntry"],actionTarget:"paneltbar",id:"secEntryModule"},{ptype:"gxp_statfeaturemanager",id:"statfeaturemanager",maxFeatures:20,paging:false},{actions:["->"],actionTarget:"paneltbar"},{actions:["loginbutton"],actionTarget:"paneltbar"}];GeoExplorer.Composer.superclass.constructor.apply(this,arguments)},loadConfig:function(e){GeoExplorer.Composer.superclass.loadConfig.apply(this,arguments);var a=Ext.urlDecode(document.location.search.substr(1));if(a&&a.styler){for(var t=e.map.layers.length-1;t>=0;--t){delete e.map.layers[t].selected}e.map.layers.push({source:"local",name:a.styler,selected:true,bbox:a.lazy&&a.bbox?a.bbox.split(","):undefined});this.on("layerselectionchange",function(e){var t=this.tools.styler,i=e.getLayer(),r=i.maxExtent;if(r&&!a.bbox){this.mapPanel.map.zoomToExtent(r)}this.doAuthorized(t.roles,t.addOutput,t)},this,{single:true})}},setCookieValue:function(e,t){document.cookie=e+"="+escape(t)},clearCookieValue:function(e){document.cookie=e+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/"},getCookieValue:function(e){var t,i,r,a=document.cookie.split(";");for(t=0;t<a.length;t++){i=a[t].substr(0,a[t].indexOf("="));r=a[t].substr(a[t].indexOf("=")+1);i=i.replace(/^\s+|\s+$/g,"");if(i==e){return unescape(r)}}return null},logout:function(){var t=function(){this.clearCookieValue("JSESSIONID");this.clearCookieValue(this.cookieParamName);this.setAuthorizedRoles([]);window.location.reload()};Ext.Msg.show({title:this.logoutConfirmTitle,msg:this.logoutConfirmMessage,buttons:Ext.Msg.YESNOCANCEL,icon:Ext.MessageBox.WARNING,fn:function(e){if(e==="yes"){this.save(t,this)}else if(e==="no"){t.call(this)}},scope:this})},authenticate:function(){var i=new Ext.FormPanel({url:"../login/",frame:true,labelWidth:60,defaultType:"textfield",errorReader:{read:function(e){var t=false;var i=[];if(e.status===200){t=true}else{i=[{data:{id:"username",msg:this.loginErrorText}},{data:{id:"password",msg:this.loginErrorText}}]}return{success:t,records:i}}},items:[{fieldLabel:this.userFieldText,name:"username",width:137,allowBlank:false,listeners:{render:function(){this.focus(true,100)}}},{fieldLabel:this.passwordFieldText,name:"password",width:137,inputType:"password",allowBlank:false}],buttons:[{text:this.loginText,formBind:true,handler:e,scope:this}],keys:[{key:[Ext.EventObject.ENTER],handler:e,scope:this}]});function e(){i.buttons[0].disable();i.getForm().submit({success:function(e,t){Ext.getCmp("paneltbar").items.each(function(e){if(e.needsAuthorization===true){e.enable()}});var i=e.findField("username").getValue();this.setCookieValue(this.cookieParamName,i);this.setAuthorizedRoles(["ROLE_ADMINISTRATOR"]);this.showLogout(i);r.un("beforedestroy",this.cancelAuthentication,this);r.close()},failure:function(e,t){this.authorizedRoles=[];i.buttons[0].enable();e.markInvalid({username:this.loginErrorText,password:this.loginErrorText})},scope:this})}var r=new Ext.Window({title:this.loginText,layout:"fit",width:235,height:130,plain:true,border:false,modal:true,items:[i],listeners:{beforedestroy:this.cancelAuthentication,scope:this}});r.show()},applyLoginState:function(e,t,i,r){var a=Ext.getCmp("loginbutton");a.setIconClass(e);a.setText(t);a.setHandler(i,r)},showLogin:function(){var e=this.loginText;var t=this.authenticate;this.applyLoginState("login",e,t,this)},showLogout:function(e){var t=new Ext.Template(this.logoutText).applyTemplate({user:e});var i=this.logout;this.applyLoginState("logout",t,i,this)},initPortal:function(){var t=new gxp.CrumbPanel({id:"tree",region:"west",width:320,split:true,collapsible:true,collapseMode:"mini",hideCollapseTool:true,header:false});var i='<span style="color:red;font-weight:bold" data-qtip="Required">*</span>';var c={strokeColor:"#ee0000",strokeWidth:2,strokeOpacity:0,fillColor:"#ee0000",fillOpacity:0};var d={strokeColor:"purple",strokeWidth:2,strokeOpacity:.6,fillColor:"#FFF",fillOpacity:.75};var f={strokeColor:"#0000FF",strokeWidth:1,strokeOpacity:1,pointRadius:12,graphicName:"circle",fillColor:"#ee0000",fillOpacity:.4};var y={strokeColor:"#0000FF",strokeWidth:1,strokeOpacity:1,pointRadius:7,graphicName:"star",fillColor:"#ee0000",fillOpacity:.4};var g=new OpenLayers.StyleMap({default:OpenLayers.Util.applyDefaults({pointRadius:2,strokeWidth:1},OpenLayers.Feature.Vector.style["default"])});var m=new OpenLayers.Style({fillColor:"${getFillColor}",strokeColor:"#ff9933",strokeWidth:2,graphicName:"${getSymbol}",label:gettext("${number}"),fontColor:"#333333",fontFamily:"sans-serif",pointRadius:"${getRadius}",fontSize:"12px"},{context:{getRadius:function(e){if(e.attributes.type_settlement=="Capital"){return 15}else if(e.attributes.type_settlement=="Provincial capital"){return 15}else if(e.attributes.type_settlement=="Provincial Centre"){return 15}else if(e.attributes.type_settlement=="District Centre"){return 15}else if(e.attributes.type_settlement=="District Center"){return 15}else{return 5}},getFillColor:function(e){if(e.attributes.type_settlement=="Capital"){return"#ff3300"}else if(e.attributes.type_settlement=="Provincial capital"){return"#ff3300"}else if(e.attributes.type_settlement=="Provincial Centre"){return"#ff3300"}else if(e.attributes.type_settlement=="District Centre"){return"#ff3300"}else if(e.attributes.type_settlement=="District Center"){return"#ff3300"}else{return"#ffcc66"}},getSymbol:function(e){if(e.attributes.type_settlement=="Capital"){return"star"}else if(e.attributes.type_settlement=="Provincial capital"){return"star"}else if(e.attributes.type_settlement=="Provincial Centre"){return"star"}else if(e.attributes.type_settlement=="District Centre"){return"star"}else if(e.attributes.type_settlement=="District Center"){return"star"}else{return"circle"}}}});var v={fillColor:"#ff3300",strokeColor:"#ff9933",strokeWidth:2,graphicName:"circle",label:gettext("${number}"),fontColor:"#333333",fontFamily:"sans-serif",fontWeight:"bold",pointRadius:17,fontSize:"12px"};var x={externalGraphic:"../../static/lib/icons/red_pin.png",pointRadius:12,graphicXOffset:1,graphicYOffset:-20};var L=new OpenLayers.Layer.Vector("Cosmetic Layer",{displayInLayerSwitcher:false,rendererOptions:{zIndexing:true},renderers:["Canvas","VML"]});var b=new OpenLayers.Layer.Vector("Finder Layer",{displayInLayerSwitcher:false,renderers:["Canvas","VML"],styleMap:new OpenLayers.StyleMap({default:m,select:v})});var h=new OpenLayers.Layer.Vector("Filter Layer",{displayInLayerSwitcher:false,renderers:["Canvas","VML"],styleMap:new OpenLayers.StyleMap({default:c})});var p=new OpenLayers.Layer.Vector("Mask Layer",{displayInLayerSwitcher:false,renderers:["Canvas","VML"],ratio:3,styleMap:new OpenLayers.StyleMap({default:d})});var E=new OpenLayers.Layer.Vector("Selected EQ Layer",{displayInLayerSwitcher:false,renderers:["Canvas","VML"],styleMap:new OpenLayers.StyleMap({default:f})});var S=new OpenLayers.Layer.WMS("afg_ppla","http://asdc.immap.org/geoserver/wms",{layers:"geonode:afg_ppla",transparent:true,format:"image/png8",styles:"polygon_nothing"},{isBaseLayer:false,displayInLayerSwitcher:false,opacity:0});var O=new OpenLayers.Layer.Vector("ANDMA Offices",{displayInLayerSwitcher:false,renderers:["Canvas","VML"],strategies:[new OpenLayers.Strategy.Fixed],styleMap:new OpenLayers.StyleMap({default:y}),protocol:new OpenLayers.Protocol.HTTP({url:"http://asdc.immap.org/geoserver/wfs",format:new OpenLayers.Format.GeoJSON,params:{service:"WFS",version:"1.1.0",request:"GetFeature",typeName:"geonode:andma_office",srsName:"EPSG:900913",outputFormat:"json"}})});var C=new OpenLayers.Layer.Vector("sec_entry_vector",{displayInLayerSwitcher:false,renderers:["Canvas","VML"],styleMap:new OpenLayers.StyleMap({default:x})});var w=new OpenLayers.Control.SelectFeature(O);function T(e){var t=e.data.note.split("|");popup=new GeoExt.Popup({title:e.data.name_en,location:e,width:250,html:"<strong>"+gettext("Contact Person: ")+t[0]+"<br/>"+gettext("Phone Number: ")+t[1]+"</strong>",maximizable:true,collapsible:true});popup.on({close:function(){if(OpenLayers.Util.indexOf(O.selectedFeatures,this.feature)>-1){w.unselect(this.feature)}}});popup.show()}O.events.on({featureselected:function(e){T(e.feature)}});O.setVisibility(false);this.mapPanel.map.addLayer(L);this.mapPanel.map.addLayer(h);this.mapPanel.map.addLayer(b);this.mapPanel.map.addLayer(p);this.mapPanel.map.addLayer(E);this.mapPanel.map.addLayer(S);this.mapPanel.map.addLayer(O);this.mapPanel.map.addLayer(C);this.mapPanel.map.addControl(w);w.activate();var F=new OpenLayers.Control.DrawFeature(h,OpenLayers.Handler.Polygon,{eventListeners:{featureadded:function(e){}}});h.events.register("sketchcomplete",F,function(e){e.feature.attributes.featureid=e.feature.id;e.feature.attributes.type="Free Draw"});this.mapPanel.map.addControl(F);function P(e){var t=[];t.push(new gxp.TextSymbolizer({symbolizer:e.style,attributes:new GeoExt.data.AttributeStore({url:"http://api.geoext.org/1.1/examples/data/describe_feature_type.xml"}),listeners:{change:function(e){},scope:this}}));return t}this.mapPanel.map.addControl(new OpenLayers.Control.ModifyFeature(L,{id:"cosmetic_modify_control",onModificationStart:function(e){if(e.style==null){e.style=e.layer.styleMap.styles.default.defaultStyle}Ext.getCmp("CosmeticForm").removeAll();Ext.getCmp("CosmeticForm").add(P(e));Ext.getCmp("CosmeticForm").doLayout()},onModification:function(e){},onModificationEnd:function(e){}}));this.mapPanel.map.getControl("cosmetic_modify_control").mode|=OpenLayers.Control.ModifyFeature.DRAG;var r=new GeoExt.data.FeatureStore({layer:h,fields:[{name:"prov_code"},{name:"prov_na_en"}],proxy:new GeoExt.data.ProtocolProxy({protocol:new OpenLayers.Protocol.HTTP({url:"http://asdc.immap.org/geoserver/wfs",format:new OpenLayers.Format.GeoJSON,params:{service:"WFS",version:"1.1.0",request:"GetFeature",typeName:"geonode:afg_admbnda_adm1",srsName:"EPSG:900913",outputFormat:"json"}})}),autoLoad:false});var N=new GeoExt.data.FeatureStore({layer:b,fields:[{name:"vil_uid"},{name:"name_en"},{name:"namelong"},{name:"city"},{name:"facility_name"},{name:"number"},{name:"type_settlement"},{name:"apttype"},{name:"facility_types_description"},{name:"fromlayer"},{name:"score"}],proxy:new GeoExt.data.ProtocolProxy({protocol:new OpenLayers.Protocol.HTTP({url:"../../geoapi/get_villages/",format:new OpenLayers.Format.GeoJSON,params:{service:"WFS",version:"1.1.0",request:"GetFeature",typeName:"geonode:afg_pplp",srsName:"EPSG:900913",outputFormat:"json"}})}),autoLoad:false});N.on({load:function(){N.sort("score","desc")}});r.on({load:function(){if(Ext.getCmp("filterForm").getForm().getValues()["selectedFilter"]!="drawArea"&&Ext.getCmp("filterForm").getForm().getValues()["selectedFilter"]!="currentExtent")u.zoomToExtent(h.getDataExtent());p.removeAllFeatures();var e=h.features[0].geometry;var t=e.getBounds();var i=[];var r=t.scale(100).toGeometry();i.push(new OpenLayers.Feature.Vector(r));var a=e;if(a instanceof OpenLayers.Geometry.MultiPolygon){for(var s=0;s<a.components.length;s++){var n=a.components[s];var o=n.components[0];r.addComponent(o)}}else if(a instanceof OpenLayers.Geometry.Polygon){var o=a.components[0];r.addComponent(o);if(a.components.length>1){for(var s=1;s<a.components.length;s++){var l=new OpenLayers.Geometry.Polygon([a.components[s]]);i.push(new OpenLayers.Feature.Vector(l))}}}p.addFeatures(i);u.raiseLayer(p,9e4)}});var M=new GeoExt.data.FeatureStore({fields:[{name:"prov_code"},{name:"prov_na_en"}],proxy:new GeoExt.data.ProtocolProxy({protocol:new OpenLayers.Protocol.HTTP({url:"http://asdc.immap.org/geoserver/wfs",format:new OpenLayers.Format.GeoJSON,params:{service:"WFS",version:"1.1.0",request:"GetFeature",typeName:"geonode:afg_admbnda_adm1",srsName:"EPSG:900913",outputFormat:"json",propertyName:"prov_code,prov_na_en"}})}),autoLoad:true});var a=new GeoExt.data.FeatureStore({fields:[{name:"dist_code"},{name:"dist_na_en"}],proxy:new GeoExt.data.ProtocolProxy({protocol:new OpenLayers.Protocol.HTTP({url:"http://asdc.immap.org/geoserver/wfs",format:new OpenLayers.Format.GeoJSON,params:{service:"WFS",version:"1.1.0",request:"GetFeature",typeName:"geonode:afg_admbnda_adm2",srsName:"EPSG:900913",outputFormat:"json",propertyName:"dist_code,dist_na_en"}})}),autoLoad:false});a.setDefaultSort("dist_na_en","ASC");var R=new GeoExt.data.FeatureStore({fields:[{name:"vuid"},{name:"name_en"}],proxy:new GeoExt.data.ProtocolProxy({protocol:new OpenLayers.Protocol.HTTP({url:"http://asdc.immap.org/geoserver/wfs",format:new OpenLayers.Format.GeoJSON,params:{service:"WFS",version:"1.1.0",request:"GetFeature",typeName:"geonode:afg_ppla",srsName:"EPSG:900913",outputFormat:"json",propertyName:"vuid,name_en"}})}),autoLoad:false});R.setDefaultSort("name_en","ASC");var e=new Date;var A=new Date(e.getFullYear(),e.getMonth(),e.getDate()-7).format("Y-m-d");var _=new Date(e.getFullYear(),e.getMonth(),e.getDate()-30).format("Y-m-d");var k=new Date(e.getFullYear(),e.getMonth(),e.getDate()-1500).format("Y-m-d");var I=new Ext.data.JsonStore({url:"../../geoapi/geteqevents/",root:"objects",totalProperty:"total_count",fields:[{name:"id",type:"integer"},{name:"title",type:"string"},{name:"date_custom",type:"string"},{name:"event_code",type:"string"},{name:"sm_available",type:"string"}],autoLoad:true});I.on("load",function(e,t,i){var r=e.getAt(e.totalLength-1);Ext.getCmp("eventsEQSelection").setValue(r.get("event_code"));var a=null;if(u.getLayersByName("Earthquake shakemap").length>0){a=u.getLayersByName("Earthquake shakemap")[0];a.mergeNewParams({CQL_FILTER:"event_code='"+r.get("event_code")+"'"})}var s=[];e.data.each(function(e,t){s.push(e.data.event_code)});s=JSON.stringify(s);s=s.replace("[","(");s=s.replace("]",")");var n='"';var o=new RegExp(n,"g");s=s.replace(o,"'");var l=null;if(u.getLayersByName("Earthquake events").length>0){l=u.getLayersByName("Earthquake events")[0];l.mergeNewParams({CQL_FILTER:"event_code in "+s})}u.raiseLayer(h,1e4);u.raiseLayer(E,1e4);u.raiseLayer(p,9e4);u.raiseLayer(C,1e4)});var u=this.mapPanel.map;var D=new Ext.Panel({title:gettext("Statistics"),xtype:"form",id:"bd_stats_panel",border:false,split:true,collapsible:true,collapseMode:"mini",bodyPadding:5,collapsed:false,hidden:true,width:320,bbar:new Ext.Toolbar({disabled:false,id:"paneltbarcalc",items:["->"]}),fieldDefaults:{labelAlign:"top",msgTarget:"side"},defaults:{anchor:"100%",autoScroll:true},items:[new Ext.form.FormPanel({id:"filterForm",width:"100%",frame:true,layout:"table",frame:true,layoutConfig:{columns:1},bbar:new Ext.Toolbar({items:[{fieldLabel:gettext("Date"),name:"dateOccurs",id:"dateOccurs",xtype:"datefield",width:130,hidden:true,value:(new Date).format("m/d/y")},"->",{text:gettext("Reset"),iconCls:"gxp-icon-reset",id:"stat_reset_button",scope:this,handler:function(){h.removeAllFeatures();p.removeAllFeatures();var e=new Ext.Template("Apply filter to generate the statistics");e.overwrite(Ext.getCmp("baselineView").body,{});e.overwrite(Ext.getCmp("floodriskView").body,{});e.overwrite(Ext.getCmp("floodForecastView").body,{});e.overwrite(Ext.getCmp("avalancheView").body,{});e.overwrite(Ext.getCmp("avalancheForecastView").body,{});e.overwrite(Ext.getCmp("eqView").body,{});e.overwrite(Ext.getCmp("accessibilitiesView").body,{});e.overwrite(Ext.getCmp("landslideView").body,{});e.overwrite(Ext.getCmp("droughtView").body,{});Ext.getCmp("baselineView").body.highlight("#c3daf9",{block:true})}},{text:gettext("Apply"),iconCls:"save",id:"stat_apply_button",scope:this,handler:function(){B.load({params:{query_type:"main_type",start_date:Ext.getCmp("startdt").getValue().format("Y-m-d"),end_date:Ext.getCmp("enddt").getValue().format("Y-m-d"),filterlock:o()}});U.load({params:{query_type:"main_target",start_date:Ext.getCmp("startdt").getValue().format("Y-m-d"),end_date:Ext.getCmp("enddt").getValue().format("Y-m-d"),filterlock:o()}});var e=[];var t="";if(Ext.getCmp("provSelection").value!="")t=Ext.getCmp("provSelection").value;if(Ext.getCmp("districtSelection").value!="")t=Ext.getCmp("districtSelection").value;if(Ext.getCmp("filterForm").getForm().getValues()["selectedFilter"]=="currentExtent"){var i=new OpenLayers.Feature.Vector(u.getExtent().toGeometry(),{fid:"extent01"});i.attributes={featureid:"extent01",type:"extent"};u.getLayersByName("Filter Layer")[0].addFeatures(i)}else if(Ext.getCmp("filterForm").getForm().getValues()["selectedFilter"]=="entireAfg"){}else if(Ext.getCmp("filterForm").getForm().getValues()["selectedFilter"]=="currentProvince"){}else if(Ext.getCmp("filterForm").getForm().getValues()["selectedFilter"]=="drawArea"){}var e=o();if(typeof t=="undefined"){t=""}selIndex=Ext.getCmp("eventsEQSelection").selectedIndex;if(selIndex<0){selIndex=Ext.getCmp("eventsEQSelection").getStore().totalLength-1}selectedEQ=Ext.getCmp("eventsEQSelection").getStore().getAt(selIndex);_storeCalc.setFeatureStore(e,Ext.getCmp("filterForm").getForm().getValues()["selectedFilter"],t,Ext.getCmp("dateOccurs").getValue().format("Y-m-d"));_storeCalc.setAccessibilityStore(e,Ext.getCmp("filterForm").getForm().getValues()["selectedFilter"],t);_storeCalc.setEarthQuakeFeatureStore(e,Ext.getCmp("filterForm").getForm().getValues()["selectedFilter"],t,Ext.getCmp("eventsEQSelection").getValue(),Ext.getCmp("eventsEQSelection").getStore().getAt(selIndex).data.title,Ext.getCmp("eventsEQSelection").getStore().getAt(selIndex).data.date_custom);_storeCalc.setLandslideStore(e,Ext.getCmp("filterForm").getForm().getValues()["selectedFilter"],t);_storeCalc.setDroughtFeatureStore(e,Ext.getCmp("filterForm").getForm().getValues()["selectedFilter"],t,Ext.getCmp("dateOccurs").getValue().format("Y-m-d"));_storeCalc.filter=e;_storeCalc.adminCode=t;var r=Ext.getCmp("dateOccurs").getValue().format("Y-m-d").split("-");reverse_date_opt=new Date(r[0],r[1]-1,r[2]);reverse_date_opt.setDate(reverse_date_opt.getDate()-1);date_array_reverse=reverse_date_opt.dateFormat("Y-m-d").split("-");if(u.getLayersByName(gettext("Historical Flood Prediction")).length>0){u.getLayersByName(gettext("Historical Flood Prediction"))[0].mergeNewParams({viewparams:"year:"+r[0]+";month:"+r[1]+";day:"+r[2]+";"})}if(u.getLayersByName(gettext("Flood likelihood 2 year return period (GLOFAS)")).length>0){u.getLayersByName(gettext("Flood likelihood 2 year return period (GLOFAS)"))[0].mergeNewParams({viewparams:"year:"+date_array_reverse[0]+";month:"+date_array_reverse[1]+";day:"+date_array_reverse[2]+";"})}if(u.getLayersByName(gettext("Flood likelihood 5 year return period (GLOFAS)")).length>0){u.getLayersByName(gettext("Flood likelihood 5 year return period (GLOFAS)"))[0].mergeNewParams({viewparams:"year:"+date_array_reverse[0]+";month:"+date_array_reverse[1]+";day:"+date_array_reverse[2]+";"})}if(u.getLayersByName(gettext("Flood likelihood 20 year return period (GLOFAS)")).length>0){u.getLayersByName(gettext("Flood likelihood 20 year return period (GLOFAS)"))[0].mergeNewParams({viewparams:"year:"+date_array_reverse[0]+";month:"+date_array_reverse[1]+";day:"+date_array_reverse[2]+";"})}if(u.getLayersByName(gettext("Flood prediction")).length>0){var a="TRUE";var s="TRUE";if(Ext.getCmp("cb_rf_type").getValue()=="GFMS only")s="FALSE";else if(Ext.getCmp("cb_rf_type").getValue()=="GLOFAS only")a="FALSE";u.getLayersByName(gettext("Flood prediction"))[0].mergeNewParams({viewparams:"year:"+r[0]+";month:"+r[1]+";day:"+r[2]+";gfms:"+a+";glofas:"+s+";"})}if(u.getLayersByName(gettext("Flashflood Prediction")).length>0){u.getLayersByName(gettext("Flashflood Prediction"))[0].mergeNewParams({viewparams:"year:"+r[0]+";month:"+r[1]+";day:"+r[2]+";"})}if(u.getLayersByName("Glofas Points").length>0){u.getLayersByName("Glofas Points")[0].destroyFeatures();u.getLayersByName("Glofas Points")[0].protocol.url="/getOverviewMaps/getGlofasPointsJSON?date="+reverse_date_opt.dateFormat("Y-m-d");u.getLayersByName("Glofas Points")[0].protocol.options.url="/getOverviewMaps/getGlofasPointsJSON?date="+reverse_date_opt.dateFormat("Y-m-d");u.getLayersByName("Glofas Points")[0].refresh({force:true})}if(u.getLayersByName(gettext("Drought Prediction")).length>0){Ext.Ajax.request({url:"../../geoapi/getdroughtlayer/",method:"POST",params:Ext.encode({date:Ext.getCmp("dateOccurs").getValue().format("Y-m-d")}),headers:{"Content-Type":"application/json"},success:function(e){woy_data=Ext.decode(e.responseText);u.getLayersByName(gettext("Drought Prediction"))[0].mergeNewParams({viewparams:"woy:"+woy_data.woy+";"})},scope:this})}}}]}),items:[{xtype:"radio",boxLabel:gettext("Current Extent"),name:"selectedFilter",id:"currentExtent",inputValue:"currentExtent",listeners:{check:function(e,t){Ext.getCmp("currentExtent_c").setValue(t)}}},{xtype:"radio",boxLabel:gettext("Entire Afghanistan"),name:"selectedFilter",id:"entireAfg",inputValue:"entireAfg",checked:true,listeners:{check:function(e,t){Ext.getCmp("entireAfg_c").setValue(t)}}},{xtype:"radio",boxLabel:gettext("Provinces and Districts"),name:"selectedFilter",id:"currentProvince",inputValue:"currentProvince",listeners:{check:function(e,t){Ext.getCmp("currentProvince_c").setValue(t);if(t){Ext.getCmp("provSelection").disabled=false;Ext.getCmp("districtSelection").disabled=false}else{Ext.getCmp("provSelection").disabled=true;Ext.getCmp("provSelection").reset();Ext.getCmp("districtSelection").disabled=true;Ext.getCmp("districtSelection").reset();h.destroyFeatures()}}}},{xtype:"combo",fieldLabel:gettext("Provinces"),emptyText:gettext("Select a province..."),id:"provSelection",disabled:true,typeAhead:true,triggerAction:"all",forceSelection:true,editable:false,lazyRender:true,mode:"local",store:M,sm:new GeoExt.grid.FeatureSelectionModel,valueField:"prov_code",displayField:"prov_na_en",scope:this,listeners:{select:function(e,t,i){Ext.getCmp("districtSelection").reset();Ext.getCmp("provSelection_c").setValue(e.getValue());r.load({params:{service:"WFS",version:"1.1.0",request:"GetFeature",typeName:"geonode:afg_admbnda_adm1",srsName:"EPSG:900913",outputFormat:"json",CQL_FILTER:"prov_code = "+t.data.prov_code}});a.load({params:{service:"WFS",version:"1.1.0",request:"GetFeature",typeName:"geonode:afg_admbnda_adm2",srsName:"EPSG:900913",outputFormat:"json",propertyName:"dist_code,dist_na_en",CQL_FILTER:"prov_code = "+t.data.prov_code}})}}},{xtype:"combo",fieldLabel:gettext("Districts"),id:"districtSelection",emptyText:gettext("Select a district..."),typeAhead:true,disabled:true,triggerAction:"all",forceSelection:true,editable:false,lazyRender:true,mode:"local",store:a,sm:new GeoExt.grid.FeatureSelectionModel,valueField:"dist_code",displayField:"dist_na_en",listeners:{select:function(e,t,i){Ext.getCmp("districtSelection_c").setValue(e.getValue());r.load({params:{service:"WFS",version:"1.1.0",request:"GetFeature",typeName:"geonode:afg_admbnda_adm2",srsName:"EPSG:900913",outputFormat:"json",CQL_FILTER:"dist_code = "+t.data.dist_code}})}}},{xtype:"radio",boxLabel:gettext("Draw Area"),name:"selectedFilter",id:"drawArea",inputValue:"drawArea",listeners:{check:function(e,t){Ext.getCmp("drawArea_c").setValue(t);if(t){F.activate()}else{F.deactivate();h.destroyFeatures()}}}}]}),new Ext.TabPanel({activeTab:0,enableTabScroll:true,width:"100%",id:"statContainer",defaults:{autoScroll:true,layout:"fit"},items:[{title:gettext("Baseline"),id:"baselineView",defaults:{autoScroll:true,layout:"fit"},height:850,style:"height:850px;",overflowY:"scroll",html:gettext("Apply filter to generate the statistics")},{title:gettext("Accessibility"),id:"accessibilitiesView",defaults:{autoScroll:true},height:850,style:"height:850px;",overflowY:"scroll",html:gettext("Apply filter to generate the statistics")},{title:gettext("Flood Prediction"),id:"floodForecastView",defaults:{autoScroll:true},height:850,style:"height:850px;",overflowY:"scroll",html:gettext("Apply filter to generate the statistics"),tbar:new Ext.Container({layout:"anchor",xtype:"container",defaults:{anchor:"100%",height:27},items:[new Ext.Toolbar({items:[{fieldLabel:gettext("Date"),name:"dateOccurs1",id:"dateOccurs1",xtype:"datefield",width:130,value:(new Date).format("m/d/y"),format:"d F Y",listeners:{select:function(e,t,i){Ext.getCmp("dateOccurs").setValue(t);Ext.getCmp("dateOccurs2").setValue(t);Ext.getCmp("dateOccurs3").setValue(t)}}},{xtype:"tbspacer"},new Ext.form.ComboBox({id:"cb_rf_type",tpl:'<tpl for="."><div ext:qtip="{target}. {desc}" class="x-combo-list-item">{target}</div></tpl>',store:new Ext.data.ArrayStore({fields:["target","desc"],data:[["GFMS + GLOFAS","Combination of Global Flood Monitoring System (GFMS) from University of Maryland and Global Flood Awareness System (GLOFAS) from JRC"],["GFMS only","Global Flood Monitoring System (GFMS) from University of Maryland"],["GLOFAS only","Global Flood Awareness System (GLOFAS) from JRC"]]}),displayField:"target",width:130,typeAhead:true,mode:"local",forceSelection:true,triggerAction:"all",emptyText:"Select a state...",selectOnFocus:true,listeners:{afterrender:function(e){var t=e.getStore().getAt(0).get("target");e.setValue(t)}}})]})]})},{title:gettext("Flood Risk"),id:"floodriskView",defaults:{autoScroll:true},height:850,style:"height:850px;",overflowY:"scroll",html:gettext("Apply filter to generate the statistics")},{title:gettext("Avalanche Prediction"),id:"avalancheForecastView",defaults:{autoScroll:true},height:850,style:"height:850px;",overflowY:"scroll",html:gettext("Apply filter to generate the statistics"),tbar:new Ext.Container({layout:"anchor",xtype:"container",defaults:{anchor:"100%",height:27},items:[new Ext.Toolbar({items:[{fieldLabel:gettext("Date"),name:"dateOccurs2",id:"dateOccurs2",xtype:"datefield",width:130,value:(new Date).format("m/d/y"),format:"d F Y",listeners:{select:function(e,t,i){Ext.getCmp("dateOccurs").setValue(t);Ext.getCmp("dateOccurs1").setValue(t);Ext.getCmp("dateOccurs3").setValue(t)}}}]})]})},{title:gettext("Avalanche Risk"),id:"avalancheView",defaults:{autoScroll:true},height:850,style:"height:850px;",overflowY:"scroll",html:gettext("Apply filter to generate the statistics")},{title:gettext("Earthquake"),id:"eqView",defaults:{autoScroll:true},height:850,style:"height:850px;",overflowY:"scroll",tbar:new Ext.Container({layout:"anchor",xtype:"container",defaults:{anchor:"100%",height:27},items:[new Ext.Toolbar({items:[{xtype:"combo",fieldLabel:gettext("Events"),id:"eventsEQSelection",emptyText:gettext("Select an EQ Event..."),width:275,typeAhead:true,triggerAction:"all",forceSelection:true,editable:false,lazyRender:true,tpl:new Ext.XTemplate('<tpl for="."><div class="search-item">',"<span>{title}</span><br />{date_custom}","</div></tpl>"),mode:"local",store:I,valueField:"event_code",displayField:"title",itemSelector:"div.search-item",listeners:{select:function(e,t,i){var r=null;if(u.getLayersByName("Earthquake shakemap").length>0){r=u.getLayersByName("Earthquake shakemap")[0];r.mergeNewParams({CQL_FILTER:"event_code='"+t.data.event_code+"'"})}_storeCalc.setEarthQuakeFeatureStore(_storeCalc.filter,Ext.getCmp("filterForm").getForm().getValues()["selectedFilter"],_storeCalc.adminCode,t.data.event_code,t.data.title,t.data.date_custom);wkt=new OpenLayers.Format.WKT;var a=wkt.read(t.json.wkb_geometry);a.geometry.transform(new OpenLayers.Projection("EPSG:4326"),new OpenLayers.Projection("EPSG:900913"));u.getLayersByName("Selected EQ Layer")[0].removeAllFeatures();u.getLayersByName("Selected EQ Layer")[0].addFeatures(a);u.panTo(new OpenLayers.LonLat(a.geometry.x,a.geometry.y))},afterrender:function(e){}}}]})]}),html:gettext("Apply filter to generate the statistics")},{title:gettext("Landslide Risk"),id:"landslideView",defaults:{autoScroll:true},height:850,style:"height:850px;",overflowY:"scroll",html:gettext("Apply filter to generate the statistics")},{title:gettext("Drought"),id:"droughtView",defaults:{autoScroll:true},height:850,style:"height:850px;",overflowY:"scroll",html:gettext("Apply filter to generate the statistics"),tbar:new Ext.Container({layout:"anchor",xtype:"container",defaults:{anchor:"100%",height:27},items:[new Ext.Toolbar({items:[{fieldLabel:gettext("Date"),name:"dateOccurs3",id:"dateOccurs3",xtype:"datefield",width:130,value:(new Date).format("m/d/y"),format:"d F Y",listeners:{select:function(e,t,i){Ext.getCmp("dateOccurs").setValue(t);Ext.getCmp("dateOccurs1").setValue(t);Ext.getCmp("dateOccurs2").setValue(t)}}}]})]})}]})]});var G=new Ext.grid.GridPanel({store:N,width:320,loadMask:true,viewConfig:{getRowClass:function(e,t,i,r){return"gridcellHeight_custom"},emptyText:gettext("No data"),loadingText:gettext("Loading...")},columns:[{header:gettext("Search Results:"),width:300,autoHeight:true,sortable:true,xtype:"templatecolumn",tpl:new Ext.XTemplate('<div style="float:left; padding:3px">','<tpl for=".">',"<tpl if=\"type_settlement == 'Capital' || type_settlement == 'Provincial capital' || type_settlement == 'Provincial Centre' || type_settlement == 'District Centre' || type_settlement == 'District Center'\">",'<div class="full-circle-highlight"><div class="height_fix"></div><div class="content">{number}</div></div>',"</tpl>","<tpl elseif=\"type_settlement != 'Capital' && type_settlement != 'Provincial capital' && type_settlement != 'Provincial Centre' && type_settlement != 'District Centre' && type_settlement != 'District Center'\">",'<div class="full-circle"><div class="height_fix"></div><div class="content">{number}</div></div>',"</tpl>","</tpl>","</div>",'<div style="float:left; padding-top: 7px; padding-left: 2px;">','<span class="finderheader">{name_en} {facility_name} {namelong}</span>','<tpl if="score &gt; 0">','<br/><span class="findersubheader">{score} Score Matched </span>',"</tpl>","<tpl else>",'<br/><span class="findersubheader">{type_settlement}{facility_types_description}{apttype}</span>',"</tpl>","</div>",'<div class="{fromlayer}" style="float:right;padding-top: 1px; padding-right: 2px; color: rgba(158, 158, 158, 0.6);">',"</div>"),flex:1}],sm:new GeoExt.grid.FeatureSelectionModel});G.getSelectionModel().on("rowselect",function(e,t,i){u.panTo(new OpenLayers.LonLat(i.data.feature.geometry.x,i.data.feature.geometry.y));if(i.data.feature.data.fromlayer=="glyphicon glyphicon-home"&&Ext.getCmp("show_s_inspector_toggle").pressed){u.getControlsBy("id","s_inspect")[0].activate();u.getControlsBy("id","s_inspect")[0].request(u.getPixelFromLonLat(new OpenLayers.LonLat(i.data.feature.geometry.x,i.data.feature.geometry.y)));u.getControlsBy("id","s_inspect")[0].deactivate()}});var z=new Ext.Panel({title:gettext("Finder Tool"),xtype:"form",id:"bd_findertool_panel",border:false,split:true,collapsible:true,collapseMode:"mini",bodyPadding:5,collapsed:false,hidden:true,width:320,layout:"fit",items:[new Ext.TabPanel({activeTab:0,autoWidth:true,fullscreen:true,tabBarPosition:"top",resizeTabs:true,border:false,frame:false,items:[{title:"Find Location",layout:"border",bbar:new Ext.Toolbar({items:[{text:gettext("Show settlement inspector"),iconCls:"icon-village-inspector",enableToggle:true,tooltip:"Show settlement inspector on row or point click",id:"show_s_inspector_toggle",handler:function(){}},"->",{text:gettext("Reset"),iconCls:"gxp-icon-reset",handler:function(){h.removeAllFeatures();p.removeAllFeatures();b.removeAllFeatures();Ext.getCmp("provSelectionLocator").reset();Ext.getCmp("districtSelectionLocator").reset();Ext.getCmp("settlemnentSelectionLocator").reset();a.removeAll();R.removeAll()}}]}),tbar:{xtype:"container",layout:"anchor",id:"finderKindFilterTB",defaults:{anchor:"0"},defaultType:"toolbar",items:[{items:["","",{xtype:"checkbox",id:"settlementCB",fieldLabel:gettext(""),boxLabel:gettext("Settlements"),inputValue:"settlement",listeners:{check:{fn:function(e,t){if(t){Ext.getCmp("hfCB").setValue(false);Ext.getCmp("airportCB").setValue(false);Ext.getCmp("oasisCB").setValue(false);Ext.getCmp("freeSearchForm").onTrigger2Click();Ext.getCmp("tbVUID").show()}}}}},{xtype:"checkbox",id:"hfCB",fieldLabel:gettext(""),boxLabel:gettext("Health Facilities"),inputValue:"hf",listeners:{check:{fn:function(e,t){if(t){Ext.getCmp("settlementCB").setValue(false);Ext.getCmp("airportCB").setValue(false);Ext.getCmp("oasisCB").setValue(false);Ext.getCmp("freeSearchForm").onTrigger2Click();Ext.getCmp("tbVUID").hide()}}}}},{xtype:"checkbox",id:"airportCB",fieldLabel:gettext(""),boxLabel:gettext("Airports"),inputValue:"airport",checked:true,listeners:{check:{fn:function(e,t){if(t){Ext.getCmp("settlementCB").setValue(false);Ext.getCmp("hfCB").setValue(false);Ext.getCmp("oasisCB").setValue(false);Ext.getCmp("freeSearchForm").onTrigger2Click();Ext.getCmp("tbVUID").hide()}}}}},{xtype:"checkbox",id:"oasisCB",fieldLabel:gettext(""),boxLabel:gettext("Settlements Oasis"),inputValue:"s_oasis",listeners:{check:{fn:function(e,t){if(t){Ext.getCmp("settlementCB").setValue(false);Ext.getCmp("hfCB").setValue(false);Ext.getCmp("airportCB").setValue(false);Ext.getCmp("freeSearchForm").onTrigger2Click();Ext.getCmp("tbVUID").show()}}}}}]}]},items:[new Ext.form.FormPanel({id:"comboLocatorForm",width:"100%",frame:true,region:"north",border:false,layout:"form",layoutConfig:{columns:1},height:100,items:[{xtype:"combo",width:175,fieldLabel:gettext("Provinces"),labelStyle:"width:50px",emptyText:gettext("Select a province..."),id:"provSelectionLocator",disabled:false,typeAhead:true,triggerAction:"all",forceSelection:true,editable:false,lazyRender:true,mode:"local",store:M,sm:new GeoExt.grid.FeatureSelectionModel,valueField:"prov_code",displayField:"prov_na_en",scope:this,listeners:{select:function(e,t,i){Ext.getCmp("districtSelectionLocator").reset();Ext.getCmp("settlemnentSelectionLocator").reset();a.removeAll();R.removeAll();Ext.getCmp("freeSearchForm").onTrigger2Click();r.load({params:{service:"WFS",version:"1.1.0",request:"GetFeature",typeName:"geonode:afg_admbnda_adm1",srsName:"EPSG:900913",outputFormat:"json",CQL_FILTER:"prov_code = "+t.data.prov_code}});a.load({params:{service:"WFS",version:"1.1.0",request:"GetFeature",typeName:"geonode:afg_admbnda_adm2",srsName:"EPSG:900913",outputFormat:"json",propertyName:"dist_code,dist_na_en",CQL_FILTER:"prov_code = "+t.data.prov_code}})}}},{xtype:"combo",fieldLabel:gettext("Districts"),id:"districtSelectionLocator",emptyText:gettext("Select a district..."),labelStyle:"width:50px",typeAhead:true,width:175,disabled:false,triggerAction:"all",forceSelection:true,editable:false,lazyRender:true,mode:"local",store:a,sm:new GeoExt.grid.FeatureSelectionModel,valueField:"dist_code",displayField:"dist_na_en",listeners:{select:function(e,t,i){Ext.getCmp("settlemnentSelectionLocator").reset();R.removeAll();Ext.getCmp("freeSearchForm").onTrigger2Click();r.load({params:{service:"WFS",version:"1.1.0",request:"GetFeature",typeName:"geonode:afg_admbnda_adm2",srsName:"EPSG:900913",outputFormat:"json",CQL_FILTER:"dist_code = "+t.data.dist_code}});R.load({params:{service:"WFS",version:"1.1.0",request:"GetFeature",typeName:"geonode:afg_ppla",srsName:"EPSG:900913",outputFormat:"json",propertyName:"vuid,name_en",CQL_FILTER:"dist_code = "+t.data.dist_code}})}}},{xtype:"combo",fieldLabel:gettext("Settlements"),id:"settlemnentSelectionLocator",emptyText:gettext("Select a settlement..."),labelStyle:"width:50px",typeAhead:true,width:175,disabled:false,triggerAction:"all",forceSelection:true,editable:false,lazyRender:true,mode:"local",store:R,sm:new GeoExt.grid.FeatureSelectionModel,valueField:"vuid",displayField:"name_en",listeners:{select:function(e,t,i){r.load({params:{service:"WFS",version:"1.1.0",request:"GetFeature",typeName:"geonode:afg_ppla",srsName:"EPSG:900913",outputFormat:"json",CQL_FILTER:"vuid = '"+t.data.vuid+"'"}})}}}]}),new Ext.Panel({minHeight:350,region:"center",autoScroll:true,width:320,border:false,layout:"fit",items:G,tbar:{xtype:"container",layout:"anchor",defaults:{anchor:"0"},defaultType:"toolbar",id:"searchTB",items:[{items:["Search by name: ",{xtype:"checkbox",id:"fuzzyCB",fieldLabel:gettext(""),boxLabel:gettext("Fuzzy"),inputValue:"fuzzy",checked:true,listeners:{check:function(e,t){Ext.getCmp("freeSearchForm").onTrigger2Click()}}},new Ext.ux.form.SearchField({id:"freeSearchForm",store:N,style:"width:320px !important",width:320})]},{id:"tbVUID",hidden:true,items:["Search by Village ID: ",new Ext.ux.form.SearchField({id:"villageIDSearchForm",store:N,style:"width:320px !important",width:320})]}]}})]},{title:"Coordinate",items:[new Ext.FormPanel({labelWidth:75,url:"save-form.php",frame:false,border:false,bodyStyle:"padding:5px 5px 0",autoWidth:true,defaults:{width:215},defaultType:"textfield",items:[{xtype:"combo",mode:"local",value:"WGS 84",triggerAction:"all",forceSelection:true,editable:false,fieldLabel:"Projection",name:"projection",id:"projectionCB",displayField:"name",valueField:"value",store:new Ext.data.JsonStore({fields:["name","value"],data:[{name:"Decimal Degree (WGS84)",value:"WGS 84"},{name:"Degree Minute Seconds (WGS84)",value:"WGS 84 DMS"},{name:"UTM 41 North",value:"UTM41N"},{name:"UTM 42 North",value:"UTM42N"},{name:"MGRS",value:"MGRS"}]}),listeners:{select:function(){var e=Ext.getCmp("projectionCB").getValue();Ext.getCmp("lat").setValue("");Ext.getCmp("lon").setValue("");Ext.getCmp("lat_D").setValue("");Ext.getCmp("lat_M").setValue("");Ext.getCmp("lat_S").setValue("");Ext.getCmp("lon_D").setValue("");Ext.getCmp("lon_M").setValue("");Ext.getCmp("lon_S").setValue("");if(e=="WGS 84"){Ext.getCmp("lat").label.update("Latitude");Ext.getCmp("lon").label.update("Longitude");Ext.getCmp("lon").show();Ext.getCmp("lat").show();Ext.getCmp("Latitude_DMS").hide();Ext.getCmp("Longitude_DMS").hide()}else if(e=="UTM41N"||e=="UTM42N"){Ext.getCmp("lat").label.update("Northing");Ext.getCmp("lon").label.update("Easting");Ext.getCmp("lon").show();Ext.getCmp("lat").show();Ext.getCmp("Latitude_DMS").hide();Ext.getCmp("Longitude_DMS").hide()}else if(e=="MGRS"){Ext.getCmp("lon").hide();Ext.getCmp("lat").label.update("MGRS");Ext.getCmp("zone").hide();Ext.getCmp("lat").show();Ext.getCmp("Latitude_DMS").hide();Ext.getCmp("Longitude_DMS").hide()}else if(e=="WGS 84 DMS"){Ext.getCmp("lon").hide();Ext.getCmp("lat").hide();Ext.getCmp("zone").hide();Ext.getCmp("Latitude_DMS").show();Ext.getCmp("Longitude_DMS").show()}}}},{fieldLabel:"Latitude",name:"lat",id:"lat"},{fieldLabel:"Longitude",name:"lon",id:"lon",maskRe:/[0-9.]/},{fieldLabel:"Zone Number",name:"zone",id:"zone",maskRe:/[0-9.]/,hidden:true},{xtype:"compositefield",fieldLabel:"Latitude",id:"Latitude_DMS",hidden:true,items:[{xtype:"textfield",id:"lat_D",name:"lat_D",width:25,allowBlank:false},{xtype:"displayfield",value:"&deg;"},{xtype:"textfield",id:"lat_M",name:"lat_M",width:25,allowBlank:false},{xtype:"displayfield",value:"'"},{xtype:"textfield",id:"lat_S",name:"lat_S",width:25,allowBlank:false},{xtype:"displayfield",value:'"'}]},{xtype:"compositefield",fieldLabel:"Longitude",id:"Longitude_DMS",hidden:true,items:[{xtype:"textfield",id:"lon_D",name:"lon_D",width:25,allowBlank:false},{xtype:"displayfield",value:"&deg;"},{xtype:"textfield",id:"lon_M",name:"lon_M",width:25,allowBlank:false},{xtype:"displayfield",value:"'"},{xtype:"textfield",id:"lon_S",name:"lon_S",width:25,allowBlank:false},{xtype:"displayfield",value:'"'}]},{xtype:"menuseparator",width:"100%"},{fieldLabel:"DMS<br/>(WGS84)",xtype:"displayfield",id:"textCoordinate",value:""},{fieldLabel:"Decimals<br/>(WGS84)",xtype:"displayfield",id:"textCoordinateDecimals",value:""},{fieldLabel:"UTM",xtype:"displayfield",id:"textCoordinateUTM",value:""},{fieldLabel:"MGRS",xtype:"displayfield",id:"textCoordinateMGRS",value:""}],buttons:[{text:"Plot to Map",handler:function(){var e=Ext.getCmp("projectionCB").getValue();var t=new usngs.Converter;if(e=="WGS 84"){var i=parseFloat(Ext.getCmp("lat").getValue());var r=parseFloat(Ext.getCmp("lon").getValue());var a={};t.LLtoUTM(i,r,a);Ext.getCmp("textCoordinate").setValue(OpenLayers.Util.getFormattedLonLat(i,"lat")+"<br/>"+OpenLayers.Util.getFormattedLonLat(r,"lon"));Ext.getCmp("textCoordinateDecimals").setValue("Lat "+i.toFixed(6)+"<br/>"+"Lon "+r.toFixed(6));Ext.getCmp("textCoordinateUTM").setValue(a[2]+"N"+"<br/>"+"Northing "+a[1].toFixed(1)+"<br/>"+"Easting "+a[0].toFixed(1));Ext.getCmp("textCoordinateMGRS").setValue(t.LLtoMGRS(i,r,5));var s=new OpenLayers.LonLat(r,i).transform(new OpenLayers.Projection("EPSG:4326"),new OpenLayers.Projection("EPSG:900913"));var n=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(s.lon,s.lat))}else if(e=="UTM41N"){var i=parseFloat(Ext.getCmp("lat").getValue());var r=parseFloat(Ext.getCmp("lon").getValue());var o=t.UTMtoLL(i,r,41);Ext.getCmp("textCoordinate").setValue(OpenLayers.Util.getFormattedLonLat(o.lat,"lat")+"<br/>"+OpenLayers.Util.getFormattedLonLat(o.lon,"lon"));Ext.getCmp("textCoordinateDecimals").setValue("Lat "+o.lat.toFixed(6)+"<br/>"+"Lon "+o.lon.toFixed(6));Ext.getCmp("textCoordinateUTM").setValue(41+"N"+"<br/>"+"Northing "+i.toFixed(1)+"<br/>"+"Easting "+r.toFixed(1));Ext.getCmp("textCoordinateMGRS").setValue(t.LLtoMGRS(o.lat,o.lon,5));var s=new OpenLayers.LonLat(o.lon,o.lat).transform(new OpenLayers.Projection("EPSG:4326"),new OpenLayers.Projection("EPSG:900913"));var n=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(s.lon,s.lat))}else if(e=="UTM42N"){var i=parseFloat(Ext.getCmp("lat").getValue());var r=parseFloat(Ext.getCmp("lon").getValue());var o=t.UTMtoLL(i,r,42);Ext.getCmp("textCoordinate").setValue(OpenLayers.Util.getFormattedLonLat(o.lat,"lat")+"<br/>"+OpenLayers.Util.getFormattedLonLat(o.lon,"lon"));Ext.getCmp("textCoordinateDecimals").setValue("Lat "+o.lat.toFixed(6)+"<br/>"+"Lon "+o.lon.toFixed(6));Ext.getCmp("textCoordinateUTM").setValue(42+"N"+"<br/>"+"Northing "+i.toFixed(1)+"<br/>"+"Easting "+r.toFixed(1));Ext.getCmp("textCoordinateMGRS").setValue(t.LLtoMGRS(o.lat,o.lon,5));var s=new OpenLayers.LonLat(o.lon,o.lat).transform(new OpenLayers.Projection("EPSG:4326"),new OpenLayers.Projection("EPSG:900913"));var n=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(s.lon,s.lat))}else if(e=="MGRS"){var i=Ext.getCmp("lat").getValue();var a={};var l=t.USNGtoLL(i);t.LLtoUTM(l.north,l.east,a);Ext.getCmp("textCoordinate").setValue(OpenLayers.Util.getFormattedLonLat(l.north,"lat")+"<br/>"+OpenLayers.Util.getFormattedLonLat(l.east,"lon"));Ext.getCmp("textCoordinateDecimals").setValue("Lat "+l.north.toFixed(6)+"<br/>"+"Lon "+l.east.toFixed(6));Ext.getCmp("textCoordinateUTM").setValue(a[2]+"N"+"<br/>"+"Northing "+a[1].toFixed(1)+"<br/>"+"Easting "+a[0].toFixed(1));Ext.getCmp("textCoordinateMGRS").setValue(t.LLtoMGRS(l.north,l.east,5));var s=new OpenLayers.LonLat(l.east,l.north).transform(new OpenLayers.Projection("EPSG:4326"),new OpenLayers.Projection("EPSG:900913"));var n=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(s.lon,s.lat))}else if(e=="WGS 84 DMS"){var i=parseFloat(Ext.getCmp("lat_D").getValue());i=i+parseFloat(Ext.getCmp("lat_M").getValue())/60;i=i+parseFloat(Ext.getCmp("lat_S").getValue())/3600;var r=parseFloat(Ext.getCmp("lon_D").getValue());r=r+parseFloat(Ext.getCmp("lon_M").getValue())/60;r=r+parseFloat(Ext.getCmp("lon_S").getValue())/3600;var a={};t.LLtoUTM(i,r,a);Ext.getCmp("textCoordinate").setValue(OpenLayers.Util.getFormattedLonLat(i,"lat")+"<br/>"+OpenLayers.Util.getFormattedLonLat(r,"lon"));Ext.getCmp("textCoordinateDecimals").setValue("Lat "+i.toFixed(6)+"<br/>"+"Lon "+r.toFixed(6));Ext.getCmp("textCoordinateUTM").setValue(a[2]+"N"+"<br/>"+"Northing "+a[1].toFixed(1)+"<br/>"+"Easting "+a[0].toFixed(1));Ext.getCmp("textCoordinateMGRS").setValue(t.LLtoMGRS(i,r,5));var s=new OpenLayers.LonLat(r,i).transform(new OpenLayers.Projection("EPSG:4326"),new OpenLayers.Projection("EPSG:900913"));var n=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(s.lon,s.lat))}u.getLayersByName("sec_entry_vector")[0].removeAllFeatures();u.getLayersByName("sec_entry_vector")[0].addFeatures([n]);u.raiseLayer(u.getLayersByName("sec_entry_vector")[0],1e4);u.panTo(s)}},{text:"Pick from Map",enableToggle:true,id:"bt_pickfrommap",handler:function(){if(this.pressed){this.setText("Stop Picking");var e=new OpenLayers.Control.CustomClick({id:"CustomClick"});u.addControl(e);e.activate()}else{u.getControl("CustomClick").deactivate();u.removeControl(u.getControl("CustomClick"));console.log(u);this.setText("Pick from Map")}}},{text:"Clear",handler:function(){u.getLayersByName("sec_entry_vector")[0].removeAllFeatures();Ext.getCmp("textCoordinate").setValue("");Ext.getCmp("textCoordinate").setValue("");Ext.getCmp("textCoordinateDecimals").setValue("");Ext.getCmp("textCoordinateUTM").setValue("");Ext.getCmp("textCoordinateMGRS").setValue("")}}]})]},{title:"Draw Cosmetic",id:"cosmeticTabPanel",items:[new Ext.Panel({frame:false,border:false,bodyStyle:"padding:5px 5px 0",autoWidth:true,defaults:{width:250,autoScroll:true},defaultType:"textfield",layout:"fit",scrollable:true,items:[new Ext.Panel({layout:"fit",autoHeight:true,id:"CosmeticForm",region:"center",autoScroll:true,layout:{type:"auto",align:"stretch"}})],tbar:[{text:"Edit",enableToggle:true,toggleGroup:"DrawInteraction",allowDepress:true,toggleHandler:function(){if(this.pressed){u.getControl("cosmetic_modify_control").activate()}else{u.getControl("cosmetic_modify_control").deactivate()}}},"->",{text:"Polygon",enableToggle:true,toggleGroup:"DrawInteraction",allowDepress:true,toggleHandler:function(){if(this.pressed){var e=new OpenLayers.Control.DrawFeature(u.getLayersByName("Cosmetic Layer")[0],OpenLayers.Handler.Polygon,{eventListeners:{featureadded:function(e){}}});e.id="customDraw";u.addControl(e);e.activate()}else{u.getControl("customDraw").deactivate();u.removeControl(u.getControl("customDraw"))}}},{text:"Point",enableToggle:true,toggleGroup:"DrawInteraction",allowDepress:true,toggleHandler:function(){if(this.pressed){var e=new OpenLayers.Control.DrawFeature(u.getLayersByName("Cosmetic Layer")[0],OpenLayers.Handler.Point,{eventListeners:{featureadded:function(e){}}});e.id="customPoint";u.addControl(e);e.activate()}else{u.getControl("customPoint").deactivate();u.removeControl(u.getControl("customPoint"))}}},{text:"Line",enableToggle:true,toggleGroup:"DrawInteraction",allowDepress:true,toggleHandler:function(){if(this.pressed){var e=new OpenLayers.Control.DrawFeature(u.getLayersByName("Cosmetic Layer")[0],OpenLayers.Handler.Path,{eventListeners:{featureadded:function(e){}}});e.id="customLine";u.addControl(e);e.activate()}else{u.getControl("customLine").deactivate();u.removeControl(u.getControl("customLine"))}}}]})]}],listeners:{afterrender:function(e){var t=Ext.getCmp("cosmeticTabPanel");e.hideTabStripItem(t)}}})]});var B=new Ext.data.JsonStore({root:"objects",totalProperty:"total_count",fields:[{name:"visible",type:"bolean"},{name:"main_type",type:"string"},{name:"count",type:"integer"},{name:"injured",type:"integer"},{name:"affected",type:"integer"},{name:"violent",type:"integer"},{name:"dead",type:"integer"}],proxy:new Ext.data.HttpProxy({url:"../../geoapi/sam_params/",method:"POST"})});var U=new Ext.data.JsonStore({root:"objects",totalProperty:"total_count",fields:[{name:"visible",type:"bolean"},{name:"main_target",type:"string"},{name:"count",type:"integer"},{name:"injured",type:"integer"},{name:"affected",type:"integer"},{name:"violent",type:"integer"},{name:"dead",type:"integer"}],proxy:new Ext.data.HttpProxy({url:"../../geoapi/sam_params/",method:"POST"})});var s=new Ext.grid.CheckboxSelectionModel({checkOnly:true,singleSelect:false,multipleSelect:true,sortable:false,dataIndex:"visible",width:20,listeners:{selectionchange:function(e){var t=e.selections.length>=e.grid.getStore().getTotalCount();if(t){l();reloadIncidentStatistics(e,n,o())}if(e.selections.length==0){l();setTimeout(reloadIncidentStatistics(e,n,o()),50)}},click:function(e){l();reloadIncidentStatistics(e,n,o())},scope:this}});var n=new Ext.grid.CheckboxSelectionModel({checkOnly:true,singleSelect:false,multipleSelect:true,sortable:false,dataIndex:"visible",width:20,listeners:{selectionchange:function(e){var t=e.selections.length>=e.grid.getStore().getTotalCount();if(t){l();reloadIncidentStatistics(s,e,o())}if(e.selections.length==0){l();setTimeout(reloadIncidentStatistics(s,e,o()),50)}},click:function(e){l();reloadIncidentStatistics(s,e,o())},scope:this}});B.on("load",function(e,t,i){s.selectAll(true);l()});U.on("load",function(e,t,i){n.selectAll(true)});var o=function(){var i=[];h.features.forEach(function(e){var t=e.geometry.clone().transform(new OpenLayers.Projection("EPSG:900913"),new OpenLayers.Projection("EPSG:4326"));if(e.attributes.type=="Free Draw"||e.attributes.type=="extent"){i.push(t.toString())}else{i.push(t.components[0].toString())}});return i};var l=function(){var t=[];u.layers.forEach(function(e){if(e.params){if(e.params.LAYERS=="geonode:afg_incident_oasis"){t.push(e)}}});if(t.length>0){params="incident_date > '"+Ext.getCmp("startdt").getValue().format("m.d.Y")+"' AND incident_date < '"+Ext.getCmp("enddt").getValue().format("m.d.Y")+"'";if(s.getSelections().length>0){if(s.selections.length<s.grid.getStore().getTotalCount()){var i="";var r=true;s.getSelections().forEach(function(e){if(r)i+="'"+e.data.main_type+"'";else i+=",'"+e.data.main_type+"'";r=false});params=params+" AND main_type IN ("+i+")"}}else{params=params+" AND main_type IN ('none')"}if(n.getSelections().length>0){if(n.selections.length<n.grid.getStore().getTotalCount()){var i="";var r=true;n.getSelections().forEach(function(e){if(r)i+="'"+e.data.main_target+"'";else i+=",'"+e.data.main_target+"'";r=false});params=params+" AND main_target IN ("+i+")"}}else{params=params+" AND main_target IN ('none')"}t.forEach(function(e){e.mergeNewParams({CQL_FILTER:params})})}};var V=new Ext.Panel({title:gettext("Humanitarian Access"),xtype:"form",id:"bd_SAM_panel",border:false,split:true,collapsible:true,collapseMode:"mini",bodyPadding:5,collapsed:false,hidden:true,width:320,layout:"fit",defaults:{autoScroll:true},items:[new Ext.form.FormPanel({id:"comboSecurityIncidentsForm",width:"100%",frame:true,region:"center",border:false,layout:"form",layoutConfig:{columns:1},height:100,items:[{html:"<div id='securityTip'>&nbsp;</div>",xtype:"panel"},{fieldLabel:gettext("Start Date"),name:"startdt",id:"startdt",vtype:"daterange",xtype:"datefield",width:130,format:"d F Y",endDateField:"enddt",value:(new Date).add(Date.DAY,-365).format("m/d/y")},{fieldLabel:gettext("End Date"),name:"enddt",id:"enddt",vtype:"daterange",xtype:"datefield",width:130,format:"d F Y",startDateField:"startdt",value:(new Date).format("m/d/y")},new Ext.Panel({title:gettext("1. Area of interests"),height:200,autoScroll:true,collapsible:true,collapsed:true,border:false,split:true,width:300,collapseMode:"mini",bbar:new Ext.Toolbar({items:["->",{text:gettext("Reset"),iconCls:"gxp-icon-reset",scope:this,handler:function(){Ext.getCmp("stat_reset_button").handler()}},{text:gettext("Apply"),iconCls:"save",scope:this,handler:function(){Ext.getCmp("stat_apply_button").handler()}}]}),items:[{xtype:"radio",boxLabel:gettext("Current Extent"),name:"selectedFilter",id:"currentExtent_c",inputValue:"currentExtent",listeners:{check:function(e,t){Ext.getCmp("currentExtent").setValue(t)}}},{xtype:"radio",boxLabel:gettext("Entire Afghanistan"),name:"selectedFilter",id:"entireAfg_c",inputValue:"entireAfg",checked:true,listeners:{check:function(e,t){Ext.getCmp("entireAfg").setValue(t)}}},{xtype:"radio",boxLabel:gettext("Provinces and Districts"),name:"selectedFilter",id:"currentProvince_c",inputValue:"currentProvince",listeners:{check:function(e,t){Ext.getCmp("currentProvince").setValue(t);if(t){Ext.getCmp("provSelection_c").disabled=false;Ext.getCmp("districtSelection_c").disabled=false}else{Ext.getCmp("provSelection_c").disabled=true;Ext.getCmp("provSelection_c").reset();Ext.getCmp("districtSelection_c").disabled=true;Ext.getCmp("districtSelection_c").reset()}}}},{xtype:"combo",fieldLabel:gettext("Provinces"),emptyText:gettext("Select a province..."),id:"provSelection_c",disabled:true,typeAhead:true,triggerAction:"all",forceSelection:true,editable:false,lazyRender:true,mode:"local",store:M,sm:new GeoExt.grid.FeatureSelectionModel,valueField:"prov_code",displayField:"prov_na_en",scope:this,listWidth:175,listeners:{select:function(e,t,i){Ext.getCmp("provSelection").onSelect(t,i);Ext.getCmp("provSelection").setValue(e.getValue());Ext.getCmp("districtSelection_c").reset()}}},{xtype:"combo",fieldLabel:gettext("Districts"),id:"districtSelection_c",emptyText:gettext("Select a district..."),typeAhead:true,disabled:true,triggerAction:"all",forceSelection:true,editable:false,lazyRender:true,listWidth:175,mode:"local",store:a,sm:new GeoExt.grid.FeatureSelectionModel,valueField:"dist_code",displayField:"dist_na_en",listeners:{select:function(e,t,i){Ext.getCmp("districtSelection").onSelect(t,i);Ext.getCmp("districtSelection").setValue(e.getValue())}}},{xtype:"radio",boxLabel:gettext("Draw Area"),name:"selectedFilter",id:"drawArea_c",inputValue:"drawArea",listeners:{check:function(e,t){Ext.getCmp("drawArea").setValue(t)}}}]}),{xtype:"menuseparator",width:"100%"},new Ext.Panel({region:"center",autoScroll:true,width:300,border:false,layout:"fit",items:[new Ext.grid.GridPanel({collapsible:true,collapsed:true,border:false,title:gettext("2. Type of Incidents"),store:B,width:300,height:175,id:"grid_incident_type",layout:"fit",selModel:s,deferRowRender:false,loadMask:true,viewConfig:{getRowClass:function(e,t,i,r){return"gridcellHeight_custom1"},emptyText:gettext("No data"),loadingText:gettext("Loading...")},columns:[s,{header:gettext("Tick the type of incident to apply:"),width:275,xtype:"templatecolumn",tpl:new Ext.XTemplate('<div style="padding-left: 2px;">','<span class="finderheader">{main_type}</span><br/>','<span class="incidentsubheader">'+gettext("Incidents:")+" {count}</span>","</div>"),flex:1}]}),{xtype:"menuseparator",width:"100%"},new Ext.grid.GridPanel({store:U,collapsible:true,collapsed:true,border:false,title:gettext("3. Target of Incidents"),width:300,height:175,id:"grid_incident_target",layout:"fit",selModel:n,deferRowRender:false,loadMask:true,viewConfig:{getRowClass:function(e,t,i,r){return"gridcellHeight_custom1"},emptyText:gettext("No data"),loadingText:gettext("Loading...")},columns:[n,{header:gettext("Tick the target of incident to apply:"),width:275,xtype:"templatecolumn",tpl:new Ext.XTemplate('<div style="padding-left: 2px;">','<span class="finderheader">{main_target}</span><br/>','<span class="incidentsubheader">'+gettext("Incidents:")+" {count}</span>","</div>"),flex:1}]}),{xtype:"menuseparator",width:"100%"},new Ext.TabPanel({activeTab:0,border:false,enableTabScroll:true,width:"98%",id:"statIncident",autoHeight:true,defaults:{autoScroll:true,layout:"fit"},items:[{title:gettext("Type"),id:"typeView",defaults:{autoScroll:true,layout:"fit"},autoHeight:true,overflowY:"scroll",html:gettext("Apply filter to generate the statistics")},{title:gettext("Target"),id:"targetView",defaults:{autoScroll:true,layout:"fit"},autoHeight:true,overflowY:"scroll",html:gettext("Apply filter to generate the statistics")},{title:gettext("Incidents"),id:"incidentView",defaults:{autoScroll:true,layout:"fit"},autoHeight:true,overflowY:"scroll",html:gettext("Apply filter to generate the incidents")}]})]})]})]});var H=new Ext.BoxComponent({autoEl:{tag:"iframe",frameborder:"0",src:"/securitydb/"},listeners:{afterrender:function(){this.getEl().on("load",function(){})}}});var W=new Ext.Panel({title:gettext("Manage Security data"),xtype:"form",id:"bd_sec_entries_panel",border:false,split:true,collapsible:true,collapseMode:"mini",bodyPadding:5,collapsed:false,hidden:true,width:320,layout:"fit",defaults:{autoScroll:true},items:[H]});Ext.getCmp("bd_SAM_panel").on("expand",function(e){u.layers.forEach(function(e){if(e.params){if(e.params.LAYERS=="geonode:afg_incident_oasis"){e.setVisibility(true)}}});B.load({params:{query_type:"main_type",start_date:Ext.getCmp("startdt").getValue().format("Y-m-d"),end_date:Ext.getCmp("enddt").getValue().format("Y-m-d"),filterlock:o()}});U.load({params:{query_type:"main_target",start_date:Ext.getCmp("startdt").getValue().format("Y-m-d"),end_date:Ext.getCmp("enddt").getValue().format("Y-m-d"),filterlock:o()}})});Ext.getCmp("startdt").on("select",function(e){B.load({params:{query_type:"main_type",start_date:Ext.getCmp("startdt").getValue().format("Y-m-d"),end_date:Ext.getCmp("enddt").getValue().format("Y-m-d"),filterlock:o()}});U.load({params:{query_type:"main_target",start_date:Ext.getCmp("startdt").getValue().format("Y-m-d"),end_date:Ext.getCmp("enddt").getValue().format("Y-m-d"),filterlock:o()}})});Ext.getCmp("enddt").on("select",function(e){B.load({params:{query_type:"main_type",start_date:Ext.getCmp("startdt").getValue().format("Y-m-d"),end_date:Ext.getCmp("enddt").getValue().format("Y-m-d"),filterlock:o()}});U.load({params:{query_type:"main_target",start_date:Ext.getCmp("startdt").getValue().format("Y-m-d"),end_date:Ext.getCmp("enddt").getValue().format("Y-m-d"),filterlock:o()}})});var j=new Ext.Panel({region:"east",id:"east",title:gettext(""),xtype:"form",border:false,split:true,collapsible:true,collapseMode:"mini",hideCollapseTool:true,bodyPadding:5,collapsed:true,width:320,layout:"accordion",items:[D,z,V,W],listeners:{collapse:function(){F.deactivate();Ext.getCmp("filterForm").getForm().reset()}}});var q=new Ext.Panel({region:"south",id:"south",height:220,border:false,split:true,collapsible:true,collapseMode:"mini",collapsed:true,hideCollapseTool:true,header:false,layout:"border",items:[{region:"center",id:"table",title:this.tableText,layout:"fit"},{region:"west",width:320,id:"query",title:this.queryText,split:true,collapsible:true,collapseMode:"mini",collapsed:true,hideCollapseTool:true,layout:"fit"}]});var Z=new Ext.Toolbar({disabled:true,id:"paneltbar",items:[]});this.on("ready",function(){var e=Z.items.filterBy(function(e){return e.initialConfig&&e.initialConfig.disabled});Z.enable();e.each(function(e){e.disable()})});var X=new gxp.GoogleEarthPanel({mapPanel:this.mapPanel,id:"globe",tbar:[],listeners:{beforeadd:function(e){return e.get("group")!=="background"}}});var Y=[];X.on("show",function(){Y.length=0;Z.items.each(function(e){if(e.disabled){Y.push(e)}});Z.disable();for(var e in this.tools){var t=this.tools[e];if(t.outputTarget==="map"){t.removeOutput()}}var i=Ext.getCmp("tree");var r=i&&i.getTopToolbar();if(r){r.items.each(function(e){if(e.disabled){Y.push(e)}});r.disable()}},this);X.on("hide",function(){Z.enable();var e=Ext.getCmp("tree");var t=e&&e.getTopToolbar();if(t){t.enable()}for(var i=0,r=Y.length;i<r;++i){Y[i].disable()}},this);this.mapPanelContainer=new Ext.Panel({layout:"card",region:"center",defaults:{border:false},items:[this.mapPanel,X],activeItem:0});this.portalItems=[{region:"center",layout:"border",tbar:Z,items:[this.mapPanelContainer,t,q,j]}];GeoExplorer.Composer.superclass.initPortal.apply(this,arguments)},createTools:function(){GeoExplorer.Composer.superclass.createTools.apply(this,arguments);new Ext.Button({id:"loginbutton"});if(this.authorizedRoles){if(this.authorizedRoles.length===0){this.showLogin()}else{var e=this.getCookieValue(this.cookieParamName);if(e===null){e="unknown"}this.showLogout(e)}}new Ext.Button({id:"mapmenu",text:this.mapText,iconCls:"icon-map",menu:new Ext.menu.Menu({items:[{text:this.exportMapText,handler:function(){this.doAuthorized(["ROLE_ADMINISTRATOR"],function(){this.save(this.showEmbedWindow)},this)},scope:this,iconCls:"icon-export"},{text:this.saveMapText,handler:function(){this.doAuthorized(["ROLE_ADMINISTRATOR"],function(){this.save(this.showUrl)},this)},scope:this,iconCls:"icon-save"}]})});new Ext.Button({id:"statMenu",text:gettext("Statistics"),iconCls:"icon-export",enableToggle:true,toggleGroup:"interaction",pressed:false,toggleHandler:function(){if(this.pressed){Ext.getCmp("east").expand();Ext.getCmp("bd_stats_panel").show();Ext.getCmp("bd_stats_panel").expand()}else{if(!Ext.getCmp("finderTool").pressed&&!Ext.getCmp("SAMTool").pressed&&!Ext.getCmp("secEntry").pressed)Ext.getCmp("east").collapse();Ext.getCmp("bd_stats_panel").hide()}}});new Ext.Button({id:"finderTool",text:gettext("Finder Tool"),iconCls:"icon-finder-tool",enableToggle:true,toggleGroup:"interaction",pressed:false,toggleHandler:function(){if(this.pressed){Ext.getCmp("east").expand();Ext.getCmp("bd_findertool_panel").show();Ext.getCmp("bd_findertool_panel").expand()}else{if(!Ext.getCmp("statMenu").pressed&&!Ext.getCmp("SAMTool").pressed&&!Ext.getCmp("secEntry").pressed)Ext.getCmp("east").collapse();Ext.getCmp("bd_findertool_panel").hide()}}});new Ext.Button({id:"secEntry",text:gettext("Security Entries"),iconCls:"icon-sam-tool",enableToggle:true,toggleGroup:"interaction",disabled:false,pressed:false,toggleHandler:function(){if(this.pressed){Ext.getCmp("east").expand();Ext.getCmp("bd_sec_entries_panel").show();Ext.getCmp("bd_sec_entries_panel").expand()}else{if(!Ext.getCmp("statMenu").pressed&&!Ext.getCmp("finderTool").pressed&&!Ext.getCmp("SAMTool").pressed)Ext.getCmp("east").collapse();Ext.getCmp("bd_sec_entries_panel").hide()}}});var t=this.mapPanel.map;new Ext.Button({id:"showANDMA",text:gettext("ANDMA Offices"),iconCls:"icon-sam-tool",enableToggle:true,toggleGroup:"plus",disabled:false,pressed:false,toggleHandler:function(){if(this.pressed){t.getLayersByName("ANDMA Offices")[0].setVisibility(true);t.raiseLayer(t.getLayersByName("ANDMA Offices")[0],1e4)}else{t.getLayersByName("ANDMA Offices")[0].setVisibility(false)}}})},openStats:function(){var e=new Ext.Window({title:gettext("kontol"),layout:"fit",resizable:false,modal:true,items:[]});e.show()},openPreview:function(e){var t=new Ext.Window({title:this.previewText,layout:"fit",resizable:false,items:[{border:false,html:e.getIframeHTML()}]});t.show();var i=t.items.get(0).body;var r=i.dom.firstChild;var a=new Ext.LoadMask(i);a.show();Ext.get(r).on("load",function(){a.hide()})},showEmbedWindow:function(){var e=new Ext.tree.TreePanel({title:this.toolsTitle,autoScroll:true,root:{nodeType:"async",expanded:true,children:this.viewerTools},rootVisible:false,id:"geobuilder-0"});var t=function(e){var t=Ext.getCmp("geobuilder-wizard-panel").getLayout();var i=t.activeItem.id.split("geobuilder-")[1];var r=parseInt(i,10)+e;t.setActiveItem(r);Ext.getCmp("wizard-prev").setDisabled(r==0);Ext.getCmp("wizard-next").setDisabled(r==1);if(e==1){this.save()}};var i=new gxp.EmbedMapDialog({id:"geobuilder-1",url:"../viewer/#maps/"+this.id});var r={id:"geobuilder-wizard-panel",border:false,layout:"card",activeItem:0,defaults:{border:false,hideMode:"offsets"},bbar:[{id:"preview",text:this.previewText,handler:function(){this.save(this.openPreview.createDelegate(this,[i]))},scope:this},"->",{id:"wizard-prev",text:this.backText,handler:t.createDelegate(this,[-1]),scope:this,disabled:true},{id:"wizard-next",text:this.nextText,handler:t.createDelegate(this,[1]),scope:this}],items:[e,i]};new Ext.Window({layout:"fit",width:500,height:300,title:this.exportMapText,items:[r]}).show()}});Ext.namespace("GeoExplorer");GeoExplorer.Viewer=Ext.extend(GeoExplorer,{applyConfig:function(e){var t=e.viewerTools||this.viewerTools;var i=[];var r;for(var a=0,s=t.length;a<s;a++){var n=t[a];if(n.checked===true){var o=["checked","iconCls","id","leaf","loader","text"];for(var l in o){delete n[o[l]]}r=Ext.applyIf({actionTarget:"paneltbar"},n);i.push(r)}}e.tools=i;GeoExplorer.Viewer.superclass.applyConfig.call(this,e)},initPortal:function(){this.toolbar=new Ext.Toolbar({disabled:true,id:"paneltbar"});this.on("ready",function(){this.toolbar.enable()},this);this.mapPanelContainer=new Ext.Panel({layout:"card",region:"center",defaults:{border:false},items:[this.mapPanel,new gxp.GoogleEarthPanel({mapPanel:this.mapPanel,listeners:{beforeadd:function(e){return e.get("group")!=="background"}}})],activeItem:0});this.portalItems=[{region:"center",layout:"border",tbar:this.toolbar,items:[this.mapPanelContainer]}];GeoExplorer.Viewer.superclass.initPortal.apply(this,arguments)},createTools:function(){GeoExplorer.Viewer.superclass.createTools.apply(this,arguments);Ext.getCmp("aboutbutton").setText(null).setIconClass("icon-about");new Ext.Button({id:"layerchooser",tooltip:gettext("Layer Switcher"),iconCls:"icon-layer-switcher",menu:new gxp.menu.LayerMenu({layers:this.mapPanel.layers})})}});Ext.namespace("GeoExt");GeoExt.Lang=new(Ext.extend(Ext.util.Observable,{locale:navigator.language||navigator.userLanguage,dict:null,constructor:function(){this.addEvents("localize");this.dict={};Ext.util.Observable.constructor.apply(this,arguments)},add:function(e,t){var i=this.dict[e];if(!i){this.dict[e]=Ext.apply({},t)}else{for(var r in t){i[r]=Ext.apply(i[r]||{},t[r])}}if(!e||e===this.locale){this.set(e)}else if(this.locale.indexOf(e+"-")===0){this.set(this.locale)}},set:function(e){var t=e?e.split("-"):[];var i="";var r={},a;for(var s=0,n=t.length;s<n;++s){i+=(i&&"-"||"")+t[s];if(i in this.dict){a=this.dict[i];for(var o in a){if(o in r){Ext.apply(r[o],a[o])}else{r[o]=Ext.apply({},a[o])}}}}for(var o in r){var l=window;var h=o.split(".");var p=false;for(var s=0,n=h.length;s<n;++s){var u=h[s];if(u in l){l=l[u]}else{p=true;break}}if(!p){Ext.apply(l,r[o])}}this.locale=e;this.fireEvent("localize",e)}}));GeoExt.Lang.add("en",{"GeoExplorer.prototype":{zoomSliderText:gettext("<div>Zoom Level: {zoom}</div><div>Scale: 1:{scale}</div>"),loadConfigErrorText:gettext("Trouble reading saved configuration: <br />"),loadConfigErrorDefaultText:gettext("Server Error."),xhrTroubleText:gettext("Communication Trouble: Status "),layersText:gettext("Layers"),titleText:gettext("Title"),zoomLevelText:gettext("Zoom level"),bookmarkText:gettext("Bookmark URL"),permakinkText:gettext("Permalink"),appInfoText:gettext("GeoExplorer"),aboutText:gettext("About GeoExplorer"),mapInfoText:gettext("Map info"),descriptionText:gettext("Description"),contactText:gettext("Contact"),aboutThisMapText:gettext("About this map")},"GeoExplorer.Composer.prototype":{mapText:gettext("Map"),tableText:gettext("Table"),queryText:gettext("Query"),exportMapText:gettext("Publish map"),saveMapText:gettext("Save map"),toolsTitle:gettext("Choose tools to include in the toolbar:"),previewText:gettext("Preview"),backText:gettext("Back"),nextText:gettext("Next"),loginText:gettext("Login"),loginErrorText:gettext("Invalid username or password."),userFieldText:gettext("User"),passwordFieldText:gettext("Password"),logoutConfirmTitle:gettext("Warning"),logoutConfirmMessage:gettext("Logging out will undo any unsaved changes, remove any layers you may have added, and reset the map composition. Do you want to save your composition first?")}});GeoExt.Lang.add("en",{"gxp.menu.LayerMenu.prototype":{layerText:gettext("Layer")},"gxp.plugins.AddLayers.prototype":{addActionMenuText:gettext("Add layers"),addActionTip:gettext("Add layers"),addServerText:gettext("Add a New Server"),addButtonText:gettext("Add layers"),untitledText:gettext("Untitled"),addLayerSourceErrorText:gettext("Error getting WMS capabilities ({msg}).\nPlease check the url and try again."),availableLayersText:gettext("Available Layers"),expanderTemplateText:gettext("<p><b>Abstract:</b> {abstract}</p>"),panelTitleText:gettext("Title"),layerSelectionText:gettext("View available data from:"),doneText:gettext("Done"),uploadText:gettext("Upload layers"),addFeedActionMenuText:gettext("Add feeds"),searchText:gettext("Search for layers")},"gxp.plugins.BingSource.prototype":{title:gettext("Bing Layers"),roadTitle:gettext("Bing Roads"),aerialTitle:gettext("Bing Aerial"),labeledAerialTitle:gettext("Bing Aerial With Labels")},"gxp.plugins.FeatureEditor.prototype":{splitButtonText:gettext("Edit"),createFeatureActionText:gettext("Create"),editFeatureActionText:gettext("Modify"),createFeatureActionTip:gettext("Create a new feature"),editFeatureActionTip:gettext("Edit existing feature"),commitTitle:gettext("Commit message"),commitText:gettext("Please enter a commit message for this edit:")},"gxp.plugins.FeatureGrid.prototype":{displayFeatureText:gettext("Display on map"),firstPageTip:gettext("First page"),previousPageTip:gettext("Previous page"),zoomPageExtentTip:gettext("Zoom to page extent"),nextPageTip:gettext("Next page"),lastPageTip:gettext("Last page"),totalMsg:"Features {1} to {2} of {0}"},"gxp.plugins.GoogleEarth.prototype":{menuText:gettext("3D Viewer"),tooltip:gettext("Switch to 3D Viewer")},"gxp.plugins.GoogleSource.prototype":{title:gettext("Google Layers"),roadmapAbstract:"Show street map",satelliteAbstract:"Show satellite imagery",hybridAbstract:"Show imagery with street names",terrainAbstract:"Show street map with terrain"},"gxp.plugins.LayerProperties.prototype":{menuText:gettext("Layer Properties"),toolTip:gettext("Layer Properties")},"gxp.plugins.LayerTree.prototype":{shortTitle:gettext("Layers"),rootNodeText:gettext("Layers"),overlayNodeText:gettext("Overlays"),baseNodeText:gettext("Base Layers")},"gxp.plugins.LayerManager.prototype":{baseNodeText:gettext("Base Maps")},"gxp.plugins.Legend.prototype":{menuText:gettext("Show legend"),tooltip:gettext("Show legend")},"gxp.plugins.LoadingIndicator.prototype":{loadingMapMessage:gettext("Loading map...")},"gxp.plugins.MapBoxSource.prototype":{title:gettext("MapBox Layers"),blueMarbleTopoBathyJanTitle:gettext("Blue Marble Topography & Bathymetry (January)"),blueMarbleTopoBathyJulTitle:gettext("Blue Marble Topography & Bathymetry (July)"),blueMarbleTopoJanTitle:gettext("Blue Marble Topography (January)"),blueMarbleTopoJulTitle:gettext("Blue Marble Topography (July)"),controlRoomTitle:gettext("Control Room"),geographyClassTitle:gettext("Geography Class"),naturalEarthHypsoTitle:gettext("Natural Earth Hypsometric"),naturalEarthHypsoBathyTitle:gettext("Natural Earth Hypsometric & Bathymetry"),naturalEarth1Title:gettext("Natural Earth I"),naturalEarth2Title:gettext("Natural Earth II"),worldDarkTitle:gettext("World Dark"),worldLightTitle:gettext("World Light"),worldPrintTitle:gettext("World Print")},"gxp.plugins.Measure.prototype":{buttonText:gettext("Measure"),lengthMenuText:gettext("Length"),areaMenuText:gettext("Area"),lengthTooltip:gettext("Measure length"),areaTooltip:gettext("Measure area"),measureTooltip:gettext("Measure")},"gxp.plugins.Navigation.prototype":{menuText:gettext("Pan map"),tooltip:gettext("Pan map")},"gxp.plugins.NavigationHistory.prototype":{previousMenuText:gettext("Zoom to previous extent"),nextMenuText:gettext("Zoom to next extent"),previousTooltip:gettext("Zoom to previous extent"),nextTooltip:gettext("Zoom to next extent")},"gxp.plugins.OSMSource.prototype":{title:gettext("OpenStreetMap Layers"),mapnikAttribution:"&copy; <a href='http://www.openstreetmap.org/copyright'>OpenStreetMap</a> contributors",osmarenderAttribution:"Data CC-By-SA by <a href='http://openstreetmap.org/'>OpenStreetMap</a>"},"gxp.plugins.Print.prototype":{buttonText:gettext("Print"),menuText:gettext("Print map"),tooltip:gettext("Print map"),previewText:gettext("Print Preview"),notAllNotPrintableText:gettext("Not All Layers Can Be Printed"),nonePrintableText:gettext("None of your current map layers can be printed")},"gxp.plugins.MapQuestSource.prototype":{title:gettext("MapQuest Layers"),osmAttribution:"Tiles Courtesy of <a href='http://open.mapquest.co.uk/' target='_blank'>MapQuest</a> <img src='http://developer.mapquest.com/content/osm/mq_logo.png' border='0'>",osmTitle:gettext("MapQuest OpenStreetMap"),naipAttribution:"Tiles Courtesy of <a href='http://open.mapquest.co.uk/' target='_blank'>MapQuest</a> <img src='http://developer.mapquest.com/content/osm/mq_logo.png' border='0'>",naipTitle:gettext("MapQuest Imagery")},"gxp.plugins.QueryForm.prototype":{queryActionText:gettext("Query"),queryMenuText:gettext("Query layer"),queryActionTip:gettext("Query the selected layer"),queryByLocationText:gettext("Query by current map extent"),queryByAttributesText:gettext("Query by attributes"),queryMsg:"Querying...",cancelButtonText:gettext("Cancel"),noFeaturesTitle:gettext("No Match"),noFeaturesMessage:gettext("Your query did not return any results.")},"gxp.plugins.RemoveLayer.prototype":{removeMenuText:gettext("Remove layer"),removeActionTip:gettext("Remove layer")},"gxp.plugins.Styler.prototype":{menuText:gettext("Layer Styles"),tooltip:gettext("Layer Styles")},"gxp.plugins.WMSGetFeatureInfo.prototype":{buttonText:gettext("Identify"),infoActionTip:gettext("Get Feature Info"),popupTitle:gettext("Feature Info")},"gxp.plugins.Zoom.prototype":{zoomMenuText:gettext("Zoom box"),zoomInMenuText:gettext("Zoom in"),zoomOutMenuText:gettext("Zoom out"),zoomTooltip:gettext("Zoom by dragging a box"),zoomInTooltip:gettext("Zoom in"),zoomOutTooltip:gettext("Zoom out")},"gxp.plugins.ZoomToExtent.prototype":{menuText:gettext("Zoom to max extent"),tooltip:gettext("Zoom to max extent")},"gxp.plugins.ZoomToDataExtent.prototype":{menuText:gettext("Zoom to layer extent"),tooltip:gettext("Zoom to layer extent")},"gxp.plugins.ZoomToLayerExtent.prototype":{menuText:gettext("Zoom to layer extent"),tooltip:gettext("Zoom to layer extent")},"gxp.plugins.ZoomToSelectedFeatures.prototype":{menuText:gettext("Zoom to selected features"),tooltip:gettext("Zoom to selected features")},"gxp.FeatureEditPopup.prototype":{closeMsgTitle:gettext("Save Changes?"),closeMsg:"This feature has unsaved changes. Would you like to save your changes?",deleteMsgTitle:gettext("Delete Feature?"),deleteMsg:"Are you sure you want to delete this feature?",editButtonText:gettext("Edit"),editButtonTooltip:gettext("Make this feature editable"),deleteButtonText:gettext("Delete"),deleteButtonTooltip:gettext("Delete this feature"),cancelButtonText:gettext("Cancel"),cancelButtonTooltip:gettext("Stop editing, discard changes"),saveButtonText:gettext("Save"),saveButtonTooltip:gettext("Save changes")},"gxp.FillSymbolizer.prototype":{fillText:gettext("Fill"),colorText:gettext("Color"),opacityText:gettext("Opacity")},"gxp.FilterBuilder.prototype":{builderTypeNames:["any","all","none","not all"],preComboText:gettext("Match"),postComboText:gettext("of the following:"),addConditionText:gettext("add condition"),addGroupText:gettext("add group"),removeConditionText:gettext("remove condition")},"gxp.grid.CapabilitiesGrid.prototype":{nameHeaderText:gettext("Name"),titleHeaderText:gettext("Title"),queryableHeaderText:gettext("Queryable"),layerSelectionLabel:gettext("View available data from:"),layerAdditionLabel:gettext("or add a new server."),expanderTemplateText:gettext("<p><b>Abstract:</b> {abstract}</p>")},"gxp.PointSymbolizer.prototype":{graphicCircleText:gettext("circle"),graphicSquareText:gettext("square"),graphicTriangleText:gettext("triangle"),graphicStarText:gettext("star"),graphicCrossText:gettext("cross"),graphicXText:gettext("x"),graphicExternalText:gettext("external"),urlText:gettext("URL"),opacityText:gettext("opacity"),symbolText:gettext("Symbol"),sizeText:gettext("Size"),rotationText:gettext("Rotation")},"gxp.QueryPanel.prototype":{queryByLocationText:gettext("Query by location"),currentTextText:gettext("Current extent"),queryByAttributesText:gettext("Query by attributes"),layerText:gettext("Layer")},"gxp.RulePanel.prototype":{scaleSliderTemplate:"{scaleType} Scale 1:{scale}",labelFeaturesText:gettext("Label Features"),labelsText:gettext("Labels"),basicText:gettext("Basic"),advancedText:gettext("Advanced"),limitByScaleText:gettext("Limit by scale"),limitByConditionText:gettext("Limit by condition"),symbolText:gettext("Symbol"),nameText:gettext("Name")},"gxp.ScaleLimitPanel.prototype":{scaleSliderTemplate:"{scaleType} Scale 1:{scale}",minScaleLimitText:gettext("Min scale limit"),maxScaleLimitText:gettext("Max scale limit")},"gxp.StrokeSymbolizer.prototype":{solidStrokeName:"solid",dashStrokeName:"dash",dotStrokeName:"dot",titleText:gettext("Stroke"),styleText:gettext("Style"),colorText:gettext("Color"),widthText:gettext("Width"),opacityText:gettext("Opacity")},"gxp.StylePropertiesDialog.prototype":{titleText:gettext("General"),nameFieldText:gettext("Name"),titleFieldText:gettext("Title"),abstractFieldText:gettext("Abstract")},"gxp.TextSymbolizer.prototype":{labelValuesText:gettext("Label values"),haloText:gettext("Halo"),sizeText:gettext("Size")},"gxp.WMSLayerPanel.prototype":{attributionText:gettext("Attribution"),aboutText:gettext("About"),titleText:gettext("Title"),nameText:gettext("Name"),descriptionText:gettext("Description"),displayText:gettext("Display"),opacityText:gettext("Opacity"),formatText:gettext("Format"),transparentText:gettext("Transparent"),cacheText:gettext("Cache"),cacheFieldText:gettext("Use cached version"),stylesText:gettext("Available Styles"),infoFormatText:gettext("Info format"),infoFormatEmptyText:gettext("Select a format"),displayOptionsText:gettext("Display options"),queryText:gettext("Limit with filters"),scaleText:gettext("Limit by scale"),minScaleText:gettext("Min scale"),maxScaleText:gettext("Max scale"),switchToFilterBuilderText:gettext("Switch back to filter builder"),cqlPrefixText:gettext("or "),cqlText:gettext("use CQL filter instead"),singleTileText:gettext("Single tile"),singleTileFieldText:gettext("Use a single tile")},"gxp.EmbedMapDialog.prototype":{publishMessage:gettext("Your map is ready to be published to the web! Simply copy the following HTML to embed the map in your website:"),heightLabel:gettext("Height"),widthLabel:gettext("Width"),mapSizeLabel:gettext("Map Size"),miniSizeLabel:gettext("Mini"),smallSizeLabel:gettext("Small"),premiumSizeLabel:gettext("Premium"),largeSizeLabel:gettext("Large")},"gxp.WMSStylesDialog.prototype":{addStyleText:gettext("Add"),addStyleTip:gettext("Add a new style"),chooseStyleText:gettext("Choose style"),deleteStyleText:gettext("Remove"),deleteStyleTip:gettext("Delete the selected style"),editStyleText:gettext("Edit"),editStyleTip:gettext("Edit the selected style"),duplicateStyleText:gettext("Duplicate"),duplicateStyleTip:gettext("Duplicate the selected style"),addRuleText:gettext("Add"),addRuleTip:gettext("Add a new rule"),newRuleText:gettext("New Rule"),deleteRuleText:gettext("Remove"),deleteRuleTip:gettext("Delete the selected rule"),editRuleText:gettext("Edit"),editRuleTip:gettext("Edit the selected rule"),duplicateRuleText:gettext("Duplicate"),duplicateRuleTip:gettext("Duplicate the selected rule"),cancelText:gettext("Cancel"),saveText:gettext("Save"),styleWindowTitle:gettext("User Style: {0}"),ruleWindowTitle:gettext("Style Rule: {0}"),stylesFieldsetTitle:gettext("Styles"),rulesFieldsetTitle:gettext("Rules")},"gxp.LayerUploadPanel.prototype":{titleLabel:gettext("Title"),titleEmptyText:gettext("Layer title"),abstractLabel:gettext("Description"),abstractEmptyText:gettext("Layer description"),fileLabel:gettext("Data"),fieldEmptyText:gettext("Browse for data archive..."),uploadText:gettext("Upload"),uploadFailedText:gettext("Upload failed"),processingUploadText:gettext("Processing upload..."),waitMsgText:gettext("Uploading your data..."),invalidFileExtensionText:gettext("File extension must be one of: "),optionsText:gettext("Options"),workspaceLabel:gettext("Workspace"),workspaceEmptyText:gettext("Default workspace"),dataStoreLabel:gettext("Store"),dataStoreEmptyText:gettext("Choose a store"),dataStoreNewText:gettext("Create new store"),crsLabel:gettext("CRS"),crsEmptyText:gettext("Coordinate Reference System ID"),invalidCrsText:gettext("CRS identifier should be an EPSG code (e.g. EPSG:4326)")},"gxp.NewSourceDialog.prototype":{title:gettext("Add new server..."),cancelText:gettext("Cancel"),addServerText:gettext("Add Server"),invalidURLText:gettext("Enter a valid URL to a WMS endpoint (e.g. http://example.com/geoserver/wms)"),contactingServerText:gettext("Contacting Server...")},"gxp.ScaleOverlay.prototype":{zoomLevelText:gettext("Zoom level")},"gxp.Viewer.prototype":{saveErrorText:gettext("Trouble saving: ")},"gxp.FeedSourceDialog.prototype":{feedTypeText:gettext("Source"),addPicasaText:gettext("Picasa Photos"),addYouTubeText:gettext("YouTube Videos"),addRSSText:gettext("Other GeoRSS Feed"),addFeedText:gettext("Add to Map"),addTitleText:gettext("Title"),keywordText:gettext("Keyword"),doneText:gettext("Done"),titleText:gettext("Add Feeds"),maxResultsText:gettext("Max Items")}});